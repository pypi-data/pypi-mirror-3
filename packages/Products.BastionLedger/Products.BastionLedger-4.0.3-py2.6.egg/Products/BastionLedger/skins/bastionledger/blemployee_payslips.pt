<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionledger">

  <metal:border fill-slot="top_slot">
    <tal:border define="dummy python:request.set('enable_border',1)" />
  </metal:border>

<body>
  <div metal:fill-slot="main"
       tal:define="utool context/@@plone_portal_state/portal_url">
      <h1><img src="" alt="" tal:define="icon python:context.getIcon(1)" 
               tal:attributes="src string:${utool}/${icon}">&nbsp;<span tal:replace="context/Title | context/getId"/> Payslips</h1>

        <a href=""
           class="link-parent"
           tal:define="parent_url python:context.navigationParent(context, template.getId())"
           tal:condition="parent_url"
           tal:attributes="href parent_url"
           i18n:translate="go_to_parent_url">
        Ledger
        </a>

       <table summary="" border="0" cellpadding="2" cellspacing="0" width="100%"
              tal:define="entries python: context.objectItemsByDate(['BLPaySlip', 'BLReport']);"
              tal:condition="python: not request.form.has_key('id')">
           <tr class="row">
               <td width="25"  class="field"><b>Type</b></td>
               <td width="45%" class="field"><b>Date</b></td>
               <td width="15%" class="field" align="right"><b>Gross</b></td>
               <td width="15%" class="field" align="right"><b>Tax</b></td>
               <td width="15%" class="field" align="right"><b>Net</b></td>
     	       <td width="16"  class="field">&nbsp;</td>
           </tr>
           <tal:block tal:repeat="item_tuple entries">
               <tr class="row-hilite"
                   tal:attributes="class python: test(repeat['item_tuple'].index % 2, 'row-normal', 'row-hilite')"
                   tal:define="id python:item_tuple[0]; item python:item_tuple[1]">
                   <td class="field">
                      <a href="" tal:attributes="href id">
                           <img border="0" src="" tal:define="icon python:item.getIcon(1)" 
                                tal:attributes="src string:${utool}/${icon}"/>
                      </a>
                   </td>
                   <td class="field">
                       <a href="" tal:attributes="href id"
                                  tal:content="item/effective | item/title_or_id" tal:on-error="string:"/>
                   </td>
                   <td class="field" nowrap align="right">
                       <span tal:condition="python: item.meta_type=='BLPaySlip'" 
                             tal:replace="item/gross" tal:on-error="string:"/>
                   </td>
                   <td class="list-item" align="right" nowrap> 
                       <span tal:condition="python: item.meta_type=='BLPaySlip'" 
                             tal:replace="item/net" tal:on-error="string:"/>
                   </td>
                   <td class="field" nowrap align="right">
                       <span tal:condition="python: item.meta_type=='BLPaySlip'" 
                             tal:replace="python: -item.net_to_date" tal:on-error="string:"/>
                   </td>
                   <td class="field">&nbsp;</td>
               </tr>
           </tal:block>
           <tal:block tal:define="balance context/balance" tal:condition="python: balance != 0">
             <tr><td colspan="5"><hr/></td></tr>
             <tr>
                 <td colspan="3">&nbsp;</td>
                 <td class="field"><strong>Balance</strong></td>
                 <td class="field" align="right" nowrap> 
                     <strong tal:content="python: abs(balance)"/>
                 </td>
             </tr>
           </tal:block>
       </table>

       <div tal:replace="structure provider:plone.documentactions">
           Document actions (print, sendto etc)
       </div>

  </div>
 
</body>
</html>
