<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>7. Tests &mdash; CubicWeb 3.13.5</title>
    <link rel="stylesheet" href="../_static/lglb-sphinx-doc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.13.5',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="CubicWeb 3.13.5" href="../index.html" />
    <link rel="up" title="Repository development" href="index.html" />
    <link rel="next" title="8. Migration" href="migration.html" />
    <link rel="prev" title="6.4. Tasks" href="repo/tasks.html" /> 
  </head>
  <body>
<div class="header">
 <a href="http://www.cubicweb.org">
  <img alt="cubicweb logo" src="../_static/cubicweb.png"/>
 </a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="migration.html" title="8. Migration"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="repo/tasks.html" title="6.4. Tasks"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">CubicWeb 3.13.5</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Repository development</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">7. Tests</a><ul>
<li><a class="reference external" href="#unit-tests">7.1. Unit tests</a><ul>
<li><a class="reference external" href="#unit-test-by-example">7.1.1. Unit test by example</a><ul>
<li><a class="reference external" href="#managing-connections-or-users">7.1.1.1. Managing connections or users</a></li>
</ul>
</li>
<li><a class="reference external" href="#email-notifications-tests">7.1.2. Email notifications tests</a></li>
<li><a class="reference external" href="#visible-actions-tests">7.1.3. Visible actions tests</a></li>
</ul>
</li>
<li><a class="reference external" href="#automatic-views-testing">7.2. Automatic views testing</a></li>
<li><a class="reference external" href="#cache-heavy-database-setup">7.3. Cache heavy database setup</a></li>
<li><a class="reference external" href="#testing-on-a-real-life-database">7.4. Testing on a real-life database</a></li>
<li><a class="reference external" href="#testing-with-other-cubes">7.5. Testing with other cubes</a></li>
<li><a class="reference external" href="#literate-programming">7.6. Literate programming</a><ul>
<li><a class="reference external" href="#skipping-a-scenario">7.6.1. Skipping a scenario</a></li>
<li><a class="reference external" href="#passing-paramaters">7.6.2. Passing paramaters</a></li>
</ul>
</li>
<li><a class="reference external" href="#test-apis">7.7. Test APIS</a><ul>
<li><a class="reference external" href="#using-pytest">7.7.1. Using Pytest</a></li>
<li><a class="reference external" href="#using-the-testcase-base-class">7.7.2. Using the <cite>TestCase</cite> base class</a></li>
<li><a class="reference external" href="#cubicwebtc-api">7.7.3. CubicWebTC API</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="repo/tasks.html"
                                  title="previous chapter">6.4. Tasks</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="migration.html"
                                  title="next chapter">8. Migration</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/devrepo/testing.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tests">
<h1>7. Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h1>
<div class="section" id="unit-tests">
<h2>7.1. Unit tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline">¶</a></h2>
<p>The <em>CubicWeb</em> framework provides the
<a title="cubicweb.devtools.testlib.CubicWebTC" class="reference internal" href="#cubicweb.devtools.testlib.CubicWebTC"><tt class="xref docutils literal"><span class="pre">cubicweb.devtools.testlib.CubicWebTC</span></tt></a> test base class .</p>
<p>Tests shall be put into the mycube/test directory. Additional test
data shall go into mycube/test/data.</p>
<p>It is much advised to write tests concerning entities methods,
actions, hooks and operations, security. The
<a title="cubicweb.devtools.testlib.CubicWebTC" class="reference internal" href="#cubicweb.devtools.testlib.CubicWebTC"><tt class="xref docutils literal"><span class="pre">CubicWebTC</span></tt></a> base class has
convenience methods to help test all of this.</p>
<p>In the realm of views, automatic tests check that views are valid
XHTML. See <a class="reference internal" href="#automatic-views-tests"><em>Automatic views testing</em></a> for details. Since 3.9, bases
for web functional testing using <a class="reference external" href="http://www.getwindmill.com/">windmill</a> are set. See test cases in
cubicweb/web/test/windmill and python wrapper in
cubicweb/web/test_windmill/ if you want to use this in your own cube.</p>
<p>Most unit tests need a live database to work against. This is achieved
by CubicWeb using automatically sqlite (bundled with Python, see
<a class="reference external" href="http://docs.python.org/library/sqlite3.html">http://docs.python.org/library/sqlite3.html</a>) as a backend.</p>
<p>The database is stored in the mycube/test/tmpdb,
mycube/test/tmpdb-template files. If it does not (yet) exists, it will
be built automatically when the test suit starts.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Whenever the schema changes (new entities, attributes, relations)
one must delete these two files. Changes concerned only with entity
or relation type properties (constraints, cardinalities,
permissions) and generally dealt with using the
<cite>sync_schema_props_perms()</cite> fonction of the migration environment
need not a database regeneration step.</p>
</div>
<div class="section" id="unit-test-by-example">
<span id="hook-test"></span><h3>7.1.1. Unit test by example<a class="headerlink" href="#unit-test-by-example" title="Permalink to this headline">¶</a></h3>
<p>We start with an example extracted from the keyword cube (available
from <a class="reference external" href="http://www.cubicweb.org/project/cubicweb-keyword">http://www.cubicweb.org/project/cubicweb-keyword</a>).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cubicweb.devtools.testlib</span> <span class="kn">import</span> <span class="n">CubicWebTC</span>
<span class="kn">from</span> <span class="nn">cubicweb</span> <span class="kn">import</span> <span class="n">ValidationError</span>

<span class="k">class</span> <span class="nc">ClassificationHooksTC</span><span class="p">(</span><span class="n">CubicWebTC</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setup_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">()</span>
        <span class="n">group_etype</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">find_one_entity</span><span class="p">(</span><span class="s">&#39;CWEType&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;CWGroup&#39;</span><span class="p">)</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">create_entity</span><span class="p">(</span><span class="s">&#39;Classification&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">u&#39;classif1&#39;</span><span class="p">,</span>
                               <span class="n">classifies</span><span class="o">=</span><span class="n">group_etype</span><span class="p">)</span>
        <span class="n">user_etype</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">find_one_entity</span><span class="p">(</span><span class="s">&#39;CWEType&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;CWUser&#39;</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">create_entity</span><span class="p">(</span><span class="s">&#39;Classification&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">u&#39;classif2&#39;</span><span class="p">,</span>
                               <span class="n">classifies</span><span class="o">=</span><span class="n">user_etype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kw1</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">create_entity</span><span class="p">(</span><span class="s">&#39;Keyword&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">u&#39;kwgroup&#39;</span><span class="p">,</span> <span class="n">included_in</span><span class="o">=</span><span class="n">c1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kw2</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">create_entity</span><span class="p">(</span><span class="s">&#39;Keyword&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">u&#39;kwuser&#39;</span><span class="p">,</span> <span class="n">included_in</span><span class="o">=</span><span class="n">c2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_cannot_create_cycles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># direct obvious cycle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kw1</span><span class="o">.</span><span class="n">set_relations</span><span class="p">,</span>
                          <span class="n">subkeyword_of</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kw1</span><span class="p">)</span>
        <span class="c"># testing indirect cycles</span>
        <span class="n">kw3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;INSERT Keyword SK: SK name &quot;kwgroup2&quot;, SK included_in C, &#39;</span>
                           <span class="s">&#39;SK subkeyword_of K WHERE C name &quot;classif1&quot;, K eid </span><span class="si">%s</span><span class="s">&#39;</span>
                           <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">kw1</span><span class="o">.</span><span class="n">eid</span><span class="p">)</span><span class="o">.</span><span class="n">get_entity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kw1</span><span class="o">.</span><span class="n">set_relations</span><span class="p">(</span><span class="n">subkeyword_of</span><span class="o">=</span><span class="n">kw3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">)</span>
</pre></div>
</div>
<p>The test class defines a <tt class="xref docutils literal"><span class="pre">setup_database()</span></tt> method which populates the
database with initial data. Each test of the class runs with this
pre-populated database. A commit is done automatically after the
<tt class="xref docutils literal"><span class="pre">setup_database()</span></tt> call. You don&#8217;t have to call it explicitely.</p>
<p>The test case itself checks that an Operation does it job of
preventing cycles amongst Keyword entities.</p>
<p><cite>create_entity</cite> is a useful method, which easily allows to create an
entity. You can link this entity to others entities, by specifying as
argument, the relation name, and the entity to link, as value. In the
above example, the <cite>Classification</cite> entity is linked to a <cite>CWEtype</cite>
via the relation <cite>classifies</cite>. Conversely, if you are creating a
<cite>CWEtype</cite> entity, you can link it to a <cite>Classification</cite> entity, by
adding <cite>reverse_classifies</cite> as argument.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><tt class="xref docutils literal"><span class="pre">commit()</span></tt> method is not called automatically in test_XXX
methods. You have to call it explicitely if needed (notably to test
operations). It is a good practice to call <tt class="xref docutils literal"><span class="pre">clear_all_caches()</span></tt>
on entities after a commit to avoid request cache effects.</p>
</div>
<p>You can see an example of security tests in the
<a class="reference external" href="../tutorials/advanced/part02_security.html#adv-tuto-security"><em>Step 1: configuring security into the schema</em></a>.</p>
<p>It is possible to have these tests run continuously using <a class="reference external" href="http://www.logilab.org/project/apycot">apycot</a>.</p>
<div class="section" id="managing-connections-or-users">
<span id="securitytest"></span><h4>7.1.1.1. Managing connections or users<a class="headerlink" href="#managing-connections-or-users" title="Permalink to this headline">¶</a></h4>
<p>Since unit tests are done with the SQLITE backend and this does not
support multiple connections at a time, you must be careful when
simulating security, changing users.</p>
<p>By default, tests run with a user with admin privileges. This
user/connection must never be closed.</p>
<p>Before a self.login, one has to release the connection pool in use
with a self.commit, self.rollback or self.close.</p>
<p>The <cite>login</cite> method returns a connection object that can be used as a
context manager:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s">&#39;user1&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">user</span><span class="p">:</span>
    <span class="n">req</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">req</span>
    <span class="n">req</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>On exit of the context manager, either a commit or rollback is issued,
which releases the connection.</p>
<p>When one is logged in as a normal user and wants to switch back to the
admin user without committing, one has to use
self.restore_connection().</p>
<p>Usage with restore_connection:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># execute using default admin connection</span>
<span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="c"># I want to login with another user, ensure to free admin connection pool</span>
<span class="c"># (could have used rollback but not close here</span>
<span class="c"># we should never close defaut admin connection)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">cnx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s">&#39;user&#39;</span><span class="p">)</span>
<span class="c"># execute using user connection</span>
<span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="c"># I want to login with another user or with admin user</span>
<span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">();</span>  <span class="n">cnx</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c"># restore admin connection, never use cnx = self.login(&#39;admin&#39;), it will return</span>
<span class="c"># the default admin connection and one may be tempted to close it</span>
<span class="bp">self</span><span class="o">.</span><span class="n">restore_connection</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not use the references kept to the entities created with a
connection from another !</p>
</div>
</div>
</div>
<div class="section" id="email-notifications-tests">
<h3>7.1.2. Email notifications tests<a class="headerlink" href="#email-notifications-tests" title="Permalink to this headline">¶</a></h3>
<p>When running tests potentially generated e-mails are not really sent
but is found in the list <cite>MAILBOX</cite> of module
<tt class="xref docutils literal"><span class="pre">cubicweb.devtools.testlib</span></tt>.</p>
<p>You can test your notifications by analyzing the contents of this list, which
contains objects with two attributes:</p>
<ul class="simple">
<li><cite>recipients</cite>, the list of recipients</li>
<li><cite>msg</cite>, object email.Message</li>
</ul>
<p>Let us look at simple example from the <tt class="docutils literal"><span class="pre">blog</span></tt> cube.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cubicweb.devtools.testlib</span> <span class="kn">import</span> <span class="n">CubicWebTC</span><span class="p">,</span> <span class="n">MAILBOX</span>

<span class="k">class</span> <span class="nc">BlogTestsCubicWebTC</span><span class="p">(</span><span class="n">CubicWebTC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test blog specific behaviours&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_notifications</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">()</span>
        <span class="n">cubicweb_blog</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">create_entity</span><span class="p">(</span><span class="s">&#39;Blog&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">u&#39;cubicweb&#39;</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="s">u&#39;cubicweb is beautiful&#39;</span><span class="p">)</span>
        <span class="n">blog_entry_1</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">create_entity</span><span class="p">(</span><span class="s">&#39;BlogEntry&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">u&#39;hop&#39;</span><span class="p">,</span>
                                         <span class="n">content</span><span class="o">=</span><span class="s">u&#39;cubicweb hop&#39;</span><span class="p">)</span>
        <span class="n">blog_entry_1</span><span class="o">.</span><span class="n">set_relations</span><span class="p">(</span><span class="n">entry_of</span><span class="o">=</span><span class="n">cubicweb_blog</span><span class="p">)</span>
        <span class="n">blog_entry_2</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">create_entity</span><span class="p">(</span><span class="s">&#39;BlogEntry&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">u&#39;yes&#39;</span><span class="p">,</span>
                                         <span class="n">content</span><span class="o">=</span><span class="s">u&#39;cubicweb yes&#39;</span><span class="p">)</span>
        <span class="n">blog_entry_2</span><span class="o">.</span><span class="n">set_relations</span><span class="p">(</span><span class="n">entry_of</span><span class="o">=</span><span class="n">cubicweb_blog</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">MAILBOX</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">MAILBOX</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">mail</span> <span class="o">=</span> <span class="n">MAILBOX</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span> <span class="s">&#39;[data] hop&#39;</span><span class="p">)</span>
        <span class="n">mail</span> <span class="o">=</span> <span class="n">MAILBOX</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span> <span class="s">&#39;[data] yes&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="visible-actions-tests">
<h3>7.1.3. Visible actions tests<a class="headerlink" href="#visible-actions-tests" title="Permalink to this headline">¶</a></h3>
<p>It is easy to write unit tests to test actions which are visible to
user or to a category of users. Let&#8217;s take an example in the
<a class="reference external" href="http://www.cubicweb.org/project/cubicweb-conference">conference cube</a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ConferenceActionsTC</span><span class="p">(</span><span class="n">CubicWebTC</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setup_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_entity</span><span class="p">(</span><span class="s">&#39;Conference&#39;</span><span class="p">,</span>
                                       <span class="n">title</span><span class="o">=</span><span class="s">u&#39;my conf&#39;</span><span class="p">,</span>
                                       <span class="n">url_id</span><span class="o">=</span><span class="s">u&#39;conf&#39;</span><span class="p">,</span>
                                       <span class="n">start_on</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">27</span><span class="p">),</span>
                                       <span class="n">end_on</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">29</span><span class="p">),</span>
                                       <span class="n">call_open</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                       <span class="n">reverse_is_chair_at</span><span class="o">=</span><span class="n">chair</span><span class="p">,</span>
                                       <span class="n">reverse_is_reviewer_at</span><span class="o">=</span><span class="n">reviewer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_admin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">()</span>
        <span class="n">rset</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">find_entities</span><span class="p">(</span><span class="s">&#39;Conference&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertListEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pactions</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">rset</span><span class="p">),</span>
                              <span class="p">[(</span><span class="s">&#39;workflow&#39;</span><span class="p">,</span> <span class="n">workflow</span><span class="o">.</span><span class="n">WorkflowActions</span><span class="p">),</span>
                               <span class="p">(</span><span class="s">&#39;edit&#39;</span><span class="p">,</span> <span class="n">confactions</span><span class="o">.</span><span class="n">ModifyAction</span><span class="p">),</span>
                               <span class="p">(</span><span class="s">&#39;managepermission&#39;</span><span class="p">,</span> <span class="n">actions</span><span class="o">.</span><span class="n">ManagePermissionsAction</span><span class="p">),</span>
                               <span class="p">(</span><span class="s">&#39;addrelated&#39;</span><span class="p">,</span> <span class="n">actions</span><span class="o">.</span><span class="n">AddRelatedActions</span><span class="p">),</span>
                               <span class="p">(</span><span class="s">&#39;delete&#39;</span><span class="p">,</span> <span class="n">actions</span><span class="o">.</span><span class="n">DeleteAction</span><span class="p">),</span>
                               <span class="p">(</span><span class="s">&#39;generate_badge_action&#39;</span><span class="p">,</span> <span class="n">badges</span><span class="o">.</span><span class="n">GenerateBadgeAction</span><span class="p">),</span>
                               <span class="p">(</span><span class="s">&#39;addtalkinconf&#39;</span><span class="p">,</span> <span class="n">confactions</span><span class="o">.</span><span class="n">AddTalkInConferenceAction</span><span class="p">)</span>
                               <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertListEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_submenu</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">rset</span><span class="p">,</span> <span class="s">&#39;addrelated&#39;</span><span class="p">),</span>
                              <span class="p">[(</span><span class="s">u&#39;add Track in_conf Conference object&#39;</span><span class="p">,</span>
                                <span class="s">u&#39;http://testing.fr/cubicweb/add/Track&#39;</span>
                                <span class="s">u&#39;?__linkto=in_conf</span><span class="si">%%</span><span class="s">3A</span><span class="si">%(conf)s%%</span><span class="s">3Asubject&amp;&#39;</span>
                                <span class="s">u&#39;__redirectpath=conference</span><span class="si">%%</span><span class="s">2Fconf&amp;&#39;</span>
                                <span class="s">u&#39;__redirectvid=&#39;</span> <span class="o">%</span> <span class="p">{</span><span class="s">&#39;conf&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">eid</span><span class="p">}),</span>
                               <span class="p">])</span>
</pre></div>
</div>
<p>You just have to execute a rql query corresponding to the view you want to test,
and to compare the result of
<tt class="xref docutils literal"><span class="pre">pactions()</span></tt> with the list of actions
that must be visible in the interface. This is a list of tuples. The first
element is the action&#8217;s <cite>__regid__</cite>, the second the action&#8217;s class.</p>
<p>To test actions in submenu, you just have to test the result of
<tt class="xref docutils literal"><span class="pre">action_submenu()</span></tt> method. The last
parameter of the method is the action&#8217;s category. The result is a list of
tuples. The first element is the action&#8217;s title, and the second element the
action&#8217;s url.</p>
</div>
</div>
<div class="section" id="automatic-views-testing">
<span id="automatic-views-tests"></span><h2>7.2. Automatic views testing<a class="headerlink" href="#automatic-views-testing" title="Permalink to this headline">¶</a></h2>
<p>This is done automatically with the <tt class="xref docutils literal"><span class="pre">cubicweb.devtools.testlib.AutomaticWebTest</span></tt>
class. At cube creation time, the mycube/test/test_mycube.py file
contains such a test. The code here has to be uncommented to be
usable, without further modification.</p>
<p>The <tt class="docutils literal"><span class="pre">auto_populate</span></tt> method uses a smart algorithm to create
pseudo-random data in the database, thus enabling the views to be
invoked and tested.</p>
<p>Depending on the schema, hooks and operations constraints, it is not
always possible for the automatic auto_populate to proceed.</p>
<p>It is possible of course to completely redefine auto_populate. A
lighter solution is to give hints (fill some class attributes) about
what entities and relations have to be skipped by the auto_populate
mechanism. These are:</p>
<ul class="simple">
<li><cite>no_auto_populate</cite>, may contain a list of entity types to skip</li>
<li><cite>ignored_relations</cite>, may contain a list of relation types to skip</li>
<li><cite>application_rql</cite>, may contain a list of rql expressions that
auto_populate cannot guess by itself; these must yield resultsets
against which views may be selected.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Take care to not let the imported <cite>AutomaticWebTest</cite> in your test module
namespace, else both your subclass <em>and</em> this parent class will be run.</p>
</div>
</div>
<div class="section" id="cache-heavy-database-setup">
<h2>7.3. Cache heavy database setup<a class="headerlink" href="#cache-heavy-database-setup" title="Permalink to this headline">¶</a></h2>
<p>Some tests suite require a complex setup of the database that takes seconds (or
event minutes) to complete. Doing the whole setup for all individual tests make
the whole run very slow. The <tt class="docutils literal"><span class="pre">CubicWebTC</span></tt> class offer a simple way to prepare
specific database once for multiple tests. The <cite>test_db_id</cite> class attribute of
your <tt class="docutils literal"><span class="pre">CubicWebTC</span></tt> must be set a unique identifier and the
<tt class="xref docutils literal"><span class="pre">pre_setup_database()</span></tt> class method build the cached content. As the
<tt class="xref docutils literal"><span class="pre">pre_setup_database()</span></tt> method is not grantee to be called, you must not set
any class attribut to be used during test there.  Databases for each <cite>test_db_id</cite>
are automatically created if not already in cache.  Clearing the cache is up to
the user. Cache files are found in the <tt class="docutils literal"><span class="pre">data/database</span></tt> subdirectory of your
test directory.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Take care to always have the same <tt class="xref docutils literal"><span class="pre">pre_setup_database()</span></tt> function for all
call with a given <cite>test_db_id</cite> otherwise you test will have unpredictable
result given the first encountered one.</p>
</div>
</div>
<div class="section" id="testing-on-a-real-life-database">
<h2>7.4. Testing on a real-life database<a class="headerlink" href="#testing-on-a-real-life-database" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">CubicWebTC</span></tt> class uses the <cite>cubicweb.devtools.ApptestConfiguration</cite>
configuration class to setup its testing environment (database driver,
user password, application home, and so on). The <cite>cubicweb.devtools</cite>
module also provides a <cite>RealDatabaseConfiguration</cite>
class that will read a regular cubicweb sources file to fetch all
this information but will also prevent the database to be initalized
and reset between tests.</p>
<p>For a test class to use a specific configuration, you have to set
the <cite>_config</cite> class attribute on the class as in:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cubicweb.devtools</span> <span class="kn">import</span> <span class="n">RealDatabaseConfiguration</span>
<span class="kn">from</span> <span class="nn">cubicweb.devtools.testlib</span> <span class="kn">import</span> <span class="n">CubicWebTC</span>

<span class="k">class</span> <span class="nc">BlogRealDatabaseTC</span><span class="p">(</span><span class="n">CubicWebTC</span><span class="p">):</span>
    <span class="n">_config</span> <span class="o">=</span> <span class="n">RealDatabaseConfiguration</span><span class="p">(</span><span class="s">&#39;blog&#39;</span><span class="p">,</span>
                                        <span class="n">sourcefile</span><span class="o">=</span><span class="s">&#39;/path/to/realdb_sources&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_blog_rss</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">()</span>
        <span class="n">rset</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;Any B ORDERBY D DESC WHERE B is BlogEntry, &#39;</span>
                           <span class="s">&#39;B created_by U, U login &quot;logilab&quot;, B creation_date D&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s">&#39;rss&#39;</span><span class="p">,</span> <span class="n">rset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="testing-with-other-cubes">
<h2>7.5. Testing with other cubes<a class="headerlink" href="#testing-with-other-cubes" title="Permalink to this headline">¶</a></h2>
<p>Sometimes a small component cannot be tested all by itself, so one
needs to specify other cubes to be used as part of the the unit test
suite. This is handled by the <tt class="docutils literal"><span class="pre">bootstrap_cubes</span></tt> file located under
<tt class="docutils literal"><span class="pre">mycube/test/data</span></tt>. One example from the <cite>preview</cite> cube:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">card</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">preview</span>
</pre></div>
</div>
<p>The format is:</p>
<ul class="simple">
<li>possibly several empy lines or lines starting with <tt class="docutils literal"><span class="pre">#</span></tt> (comment lines)</li>
<li>one line containing a coma separated list of cube names.</li>
</ul>
<p>It is also possible to add a <tt class="docutils literal"><span class="pre">schema.py</span></tt> file in
<tt class="docutils literal"><span class="pre">mycube/test/data</span></tt>, which will be used by the testing framework,
therefore making new entity types and relations available to the
tests.</p>
</div>
<div class="section" id="literate-programming">
<h2>7.6. Literate programming<a class="headerlink" href="#literate-programming" title="Permalink to this headline">¶</a></h2>
<p>CubicWeb provides some literate programming capabilities. The <a class="reference external" href="../admin/cubicweb-ctl.html#cubicweb-ctl"><em>cubicweb-ctl tool</em></a>
<cite>shell</cite> command accepts differents format files. If your file ends with <cite>.txt</cite>
or <cite>.rst</cite>, the file will be parsed by <tt class="xref docutils literal"><span class="pre">doctest.testfile</span></tt> with CubicWeb
<a class="reference external" href="migration.html#migration"><em>Migration</em></a> API enabled in it.</p>
<p>Create a <cite>scenario.txt</cite> file into <cite>test/</cite> directory and fill with some content.
Please refer the <tt class="xref docutils literal"><span class="pre">doctest.testfile</span></tt> <a class="reference external" href="http://docs.python.org/library/doctest.html">documentation</a>.</p>
<p>Then, you can run it directly by:</p>
<div class="highlight-python"><pre>$ cubicweb-ctl shell &lt;cube_instance&gt; test/scenario.txt</pre>
</div>
<p>When your scenario file is ready, put it in a new test case to be able to run
it automatically.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">logilab.common.testlib</span> <span class="kn">import</span> <span class="n">unittest_main</span>
<span class="kn">from</span> <span class="nn">cubicweb.devtools.testlib</span> <span class="kn">import</span> <span class="n">CubicWebTC</span>

<span class="k">class</span> <span class="nc">AcceptanceTC</span><span class="p">(</span><span class="n">CubicWebTC</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">test_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertDocTestFile</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span> <span class="s">&#39;scenario.txt&#39;</span><span class="p">))</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
        <span class="n">unittest_main</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="skipping-a-scenario">
<h3>7.6.1. Skipping a scenario<a class="headerlink" href="#skipping-a-scenario" title="Permalink to this headline">¶</a></h3>
<p>If you want to set up initial conditions that you can&#8217;t put in your unit test
case, you have to use a <tt class="xref docutils literal"><span class="pre">KeyboardInterrupt</span></tt> exception only because of the
way <tt class="xref docutils literal"><span class="pre">doctest</span></tt> module will catch all the exceptions internally.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">condition_not_met</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">raise</span> <span class="ne">KeyboardInterrupt</span><span class="p">(</span><span class="s">&#39;please, check your fixture.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="passing-paramaters">
<h3>7.6.2. Passing paramaters<a class="headerlink" href="#passing-paramaters" title="Permalink to this headline">¶</a></h3>
<p>Using extra arguments to parametrize your scenario is possible by prepend them
by double dashes.</p>
<p>Please refer to the <cite>cubicweb-ctl shell &#8211;help</cite> usage.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Your scenario file must be utf-8 encoded.</p>
</div>
</div>
</div>
<div class="section" id="test-apis">
<h2>7.7. Test APIS<a class="headerlink" href="#test-apis" title="Permalink to this headline">¶</a></h2>
<div class="section" id="using-pytest">
<h3>7.7.1. Using Pytest<a class="headerlink" href="#using-pytest" title="Permalink to this headline">¶</a></h3>
<p>The <cite>pytest</cite> utility (shipping with <a class="reference external" href="http://www.logilab.org/project/logilab-common">logilab-common</a>, which is a
mandatory dependency of CubicWeb) extends the Python unittest
functionality and is the preferred way to run the CubicWeb test
suites. Bare unittests also work the usual way.</p>
<p>To use it, you may:</p>
<ul class="simple">
<li>just launch <cite>pytest</cite> in your cube to execute all tests (it will
discover them automatically)</li>
<li>launch <cite>pytest unittest_foo.py</cite> to execute one test file</li>
<li>launch <cite>pytest unittest_foo.py bar</cite> to execute all test methods and
all test cases whose name contain <cite>bar</cite></li>
</ul>
<p>Additionally, the <cite>-x</cite> option tells pytest to exit at the first error
or failure. The <cite>-i</cite> option tells pytest to drop into pdb whenever an
exception occurs in a test.</p>
<p>When the <cite>-x</cite> option has been used and the run stopped on a test, it
is possible, after having fixed the test, to relaunch pytest with the
<cite>-R</cite> option to tell it to start testing again from where it previously
failed.</p>
</div>
<div class="section" id="using-the-testcase-base-class">
<h3>7.7.2. Using the <cite>TestCase</cite> base class<a class="headerlink" href="#using-the-testcase-base-class" title="Permalink to this headline">¶</a></h3>
<p>The base class of CubicWebTC is logilab.common.testlib.TestCase, which
provides a lot of convenient assertion methods.</p>
<dl class="class">
<dt id="logilab.common.testlib.TestCase">
<em class="property">class </em><tt class="descclassname">logilab.common.testlib.</tt><tt class="descname">TestCase</tt><big>(</big><em>methodName='runTest'</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase" title="Permalink to this definition">¶</a></dt>
<dd><p>A unittest.TestCase extension with some additional methods.</p>
<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertDictEquals">
<tt class="descname">assertDictEquals</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertDictEquals" title="Permalink to this definition">¶</a></dt>
<dd><p>compares two dicts</p>
<p>If the two dict differ, the first difference is shown in the error
message
:param dict1: a Python Dictionary
:param dict2: a Python Dictionary
:param msg: custom message (String) in case of failure</p>
</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertDirEqual">
<tt class="descname">assertDirEqual</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertDirEqual" title="Permalink to this definition">¶</a></dt>
<dd>compares two files using difflib</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertDirEquals">
<tt class="descname">assertDirEquals</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertDirEquals" title="Permalink to this definition">¶</a></dt>
<dd>compares two files using difflib</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertFileEqual">
<tt class="descname">assertFileEqual</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertFileEqual" title="Permalink to this definition">¶</a></dt>
<dd>compares two files using difflib</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertFileEquals">
<tt class="descname">assertFileEquals</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertFileEquals" title="Permalink to this definition">¶</a></dt>
<dd>compares two files using difflib</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertFloatAlmostEquals">
<tt class="descname">assertFloatAlmostEquals</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertFloatAlmostEquals" title="Permalink to this definition">¶</a></dt>
<dd><p>compares if two floats have a distance smaller than expected
precision.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>obj</em> &#8211; a Float</li>
<li><em>other</em> &#8211; another Float to be comparted to &lt;obj&gt;</li>
<li><em>prec</em> &#8211; a Float describing the precision</li>
<li><em>relative</em> &#8211; boolean switching to relative/absolute precision</li>
<li><em>msg</em> &#8211; a String for a custom message</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertIsInstance">
<tt class="descname">assertIsInstance</tt><big>(</big><em>obj</em>, <em>klass</em>, <em>msg=None</em>, <em>strict=False</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertIsInstance" title="Permalink to this definition">¶</a></dt>
<dd><p>check if an object is an instance of a class</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>obj</em> &#8211; the Python Object to be checked</li>
<li><em>klass</em> &#8211; the target class</li>
<li><em>msg</em> &#8211; a String for a custom message</li>
<li><em>strict</em> &#8211; if True, check that the class of &lt;obj&gt; is &lt;klass&gt;;
else check with &#8216;isinstance&#8217;</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertLineEqual">
<tt class="descname">assertLineEqual</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertLineEqual" title="Permalink to this definition">¶</a></dt>
<dd><p>compare two strings and assert that the text lines of the strings
are equal.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>string1</em> &#8211; a String</li>
<li><em>string2</em> &#8211; a String</li>
<li><em>msg</em> &#8211; custom message (String) in case of failure</li>
<li><em>striplines</em> &#8211; Boolean to trigger line stripping before comparing</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertLinesEquals">
<tt class="descname">assertLinesEquals</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertLinesEquals" title="Permalink to this definition">¶</a></dt>
<dd><p>compare two strings and assert that the text lines of the strings
are equal.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>string1</em> &#8211; a String</li>
<li><em>string2</em> &#8211; a String</li>
<li><em>msg</em> &#8211; custom message (String) in case of failure</li>
<li><em>striplines</em> &#8211; Boolean to trigger line stripping before comparing</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertListEquals">
<tt class="descname">assertListEquals</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertListEquals" title="Permalink to this definition">¶</a></dt>
<dd><p>compares two lists</p>
<p>If the two list differ, the first difference is shown in the error
message</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>list_1</em> &#8211; a Python List</li>
<li><em>list_2</em> &#8211; a second Python List</li>
<li><em>msg</em> &#8211; custom message (String) in case of failure</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertNone">
<tt class="descname">assertNone</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertNone" title="Permalink to this definition">¶</a></dt>
<dd><p>assert obj is None</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameter:</th><td class="field-body"><em>obj</em> &#8211; Python Object to be tested</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertNotNone">
<tt class="descname">assertNotNone</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertNotNone" title="Permalink to this definition">¶</a></dt>
<dd>assert obj is not None</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertRaises">
<tt class="descname">assertRaises</tt><big>(</big><em>excClass</em>, <em>callableObj=None</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertRaises" title="Permalink to this definition">¶</a></dt>
<dd><p>override default failUnlessRaises method to return the raised
exception instance.</p>
<p>Fail unless an exception of class excClass is thrown
by callableObj when invoked with arguments args and keyword
arguments kwargs. If a different type of exception is
thrown, it will not be caught, and the test case will be
deemed to have suffered an error, exactly as for an
unexpected exception.</p>
<p>CAUTION! There are subtle differences between Logilab and unittest2
- exc is not returned in standard version
- context capabilities in standard version
- try/except/else construction (minor)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>excClass</em> &#8211; the Exception to be raised</li>
<li><em>callableObj</em> &#8211; a callable Object which should raise &lt;excClass&gt;</li>
<li><em>args</em> &#8211; a List of arguments for &lt;callableObj&gt;</li>
<li><em>kwargs</em> &#8211; a List of keyword arguments  for &lt;callableObj&gt;</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertSetEquals">
<tt class="descname">assertSetEquals</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertSetEquals" title="Permalink to this definition">¶</a></dt>
<dd><p>compares two sets and shows difference between both</p>
<p>Don&#8217;t use it for iterables other than sets.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>got</em> &#8211; the Set that we found</li>
<li><em>expected</em> &#8211; the second Set to be compared to the first one</li>
<li><em>msg</em> &#8211; custom message (String) in case of failure</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertStreamEqual">
<tt class="descname">assertStreamEqual</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertStreamEqual" title="Permalink to this definition">¶</a></dt>
<dd>compare two streams (using difflib and readlines())</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertStreamEquals">
<tt class="descname">assertStreamEquals</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertStreamEquals" title="Permalink to this definition">¶</a></dt>
<dd>compare two streams (using difflib and readlines())</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertTextEqual">
<tt class="descname">assertTextEqual</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertTextEqual" title="Permalink to this definition">¶</a></dt>
<dd><p>compare two multiline strings (using difflib and splitlines())</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>text1</em> &#8211; a Python BaseString</li>
<li><em>text2</em> &#8211; a second Python Basestring</li>
<li><em>junk</em> &#8211; List of Caracters</li>
<li><em>msg_prefix</em> &#8211; String (message prefix)</li>
<li><em>striplines</em> &#8211; Boolean to trigger line stripping before comparing</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertTextEquals">
<tt class="descname">assertTextEquals</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertTextEquals" title="Permalink to this definition">¶</a></dt>
<dd><p>compare two multiline strings (using difflib and splitlines())</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>text1</em> &#8211; a Python BaseString</li>
<li><em>text2</em> &#8211; a second Python Basestring</li>
<li><em>junk</em> &#8211; List of Caracters</li>
<li><em>msg_prefix</em> &#8211; String (message prefix)</li>
<li><em>striplines</em> &#8211; Boolean to trigger line stripping before comparing</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertUnordIterEqual">
<tt class="descname">assertUnordIterEqual</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertUnordIterEqual" title="Permalink to this definition">¶</a></dt>
<dd><p>compares two iterable and shows difference between both</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>got</em> &#8211; the unordered Iterable that we found</li>
<li><em>expected</em> &#8211; the expected unordered Iterable</li>
<li><em>msg</em> &#8211; custom message (String) in case of failure</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertUnordIterEquals">
<tt class="descname">assertUnordIterEquals</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertUnordIterEquals" title="Permalink to this definition">¶</a></dt>
<dd><p>compares two iterable and shows difference between both</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>got</em> &#8211; the unordered Iterable that we found</li>
<li><em>expected</em> &#8211; the expected unordered Iterable</li>
<li><em>msg</em> &#8211; custom message (String) in case of failure</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertUnorderedIterableEqual">
<tt class="descname">assertUnorderedIterableEqual</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertUnorderedIterableEqual" title="Permalink to this definition">¶</a></dt>
<dd><p>compares two iterable and shows difference between both</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>got</em> &#8211; the unordered Iterable that we found</li>
<li><em>expected</em> &#8211; the expected unordered Iterable</li>
<li><em>msg</em> &#8211; custom message (String) in case of failure</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertUnorderedIterableEquals">
<tt class="descname">assertUnorderedIterableEquals</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertUnorderedIterableEquals" title="Permalink to this definition">¶</a></dt>
<dd><p>compares two iterable and shows difference between both</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>got</em> &#8211; the unordered Iterable that we found</li>
<li><em>expected</em> &#8211; the expected unordered Iterable</li>
<li><em>msg</em> &#8211; custom message (String) in case of failure</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertXMLEqualsTuple">
<tt class="descname">assertXMLEqualsTuple</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertXMLEqualsTuple" title="Permalink to this definition">¶</a></dt>
<dd>compare an ElementTree Element to a tuple formatted as follow:
(tagname, [attrib[, children[, text[, tail]]]])</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertXMLStringWellFormed">
<tt class="descname">assertXMLStringWellFormed</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertXMLStringWellFormed" title="Permalink to this definition">¶</a></dt>
<dd><p>asserts the XML string is well-formed (no DTD conformance check)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameter:</th><td class="field-body"><em>context</em> &#8211; number of context lines in standard message
(show all data if negative).
Only available with element tree</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.assertXMLWellFormed">
<tt class="descname">assertXMLWellFormed</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.assertXMLWellFormed" title="Permalink to this definition">¶</a></dt>
<dd><p>asserts the XML stream is well-formed (no DTD conformance check)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameter:</th><td class="field-body"><em>context</em> &#8211; number of context lines in standard message
(show all data if negative).
Only available with element tree</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="logilab.common.testlib.TestCase.datapath">
<em class="property">classmethod </em><tt class="descname">datapath</tt><big>(</big><em>*fname</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.datapath" title="Permalink to this definition">¶</a></dt>
<dd>joins the object&#8217;s datadir and <cite>fname</cite></dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.defaultTestResult">
<tt class="descname">defaultTestResult</tt><big>(</big><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.defaultTestResult" title="Permalink to this definition">¶</a></dt>
<dd>return a new instance of the defaultTestResult</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.failUnlessRaises">
<tt class="descname">failUnlessRaises</tt><big>(</big><em>excClass</em>, <em>callableObj=None</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.failUnlessRaises" title="Permalink to this definition">¶</a></dt>
<dd><p>override default failUnlessRaises method to return the raised
exception instance.</p>
<p>Fail unless an exception of class excClass is thrown
by callableObj when invoked with arguments args and keyword
arguments kwargs. If a different type of exception is
thrown, it will not be caught, and the test case will be
deemed to have suffered an error, exactly as for an
unexpected exception.</p>
<p>CAUTION! There are subtle differences between Logilab and unittest2
- exc is not returned in standard version
- context capabilities in standard version
- try/except/else construction (minor)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>excClass</em> &#8211; the Exception to be raised</li>
<li><em>callableObj</em> &#8211; a callable Object which should raise &lt;excClass&gt;</li>
<li><em>args</em> &#8211; a List of arguments for &lt;callableObj&gt;</li>
<li><em>kwargs</em> &#8211; a List of keyword arguments  for &lt;callableObj&gt;</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.innerSkip">
<tt class="descname">innerSkip</tt><big>(</big><em>msg=None</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.innerSkip" title="Permalink to this definition">¶</a></dt>
<dd>mark a generative test as skipped for the &lt;msg&gt; reason</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.optval">
<tt class="descname">optval</tt><big>(</big><em>option</em>, <em>default=None</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.optval" title="Permalink to this definition">¶</a></dt>
<dd>return the option value or default if the option is not define</dd></dl>

<dl class="attribute">
<dt id="logilab.common.testlib.TestCase.pdbclass">
<tt class="descname">pdbclass</tt><a class="headerlink" href="#logilab.common.testlib.TestCase.pdbclass" title="Permalink to this definition">¶</a></dt>
<dd>alias of <tt class="xref docutils literal"><span class="pre">Debugger</span></tt></dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.set_description">
<tt class="descname">set_description</tt><big>(</big><em>descr</em><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.set_description" title="Permalink to this definition">¶</a></dt>
<dd>sets the current test&#8217;s description.
This can be useful for generative tests because it allows to specify
a description per yield</dd></dl>

<dl class="method">
<dt id="logilab.common.testlib.TestCase.shortDescription">
<tt class="descname">shortDescription</tt><big>(</big><big>)</big><a class="headerlink" href="#logilab.common.testlib.TestCase.shortDescription" title="Permalink to this definition">¶</a></dt>
<dd>override default unittest shortDescription to handle correctly
generative tests</dd></dl>

</dd></dl>

</div>
<div class="section" id="cubicwebtc-api">
<h3>7.7.3. CubicWebTC API<a class="headerlink" href="#cubicwebtc-api" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="cubicweb.devtools.testlib.CubicWebTC">
<em class="property">class </em><tt class="descclassname">cubicweb.devtools.testlib.</tt><tt class="descname">CubicWebTC</tt><big>(</big><em>methodName='runTest'</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC" title="Permalink to this definition">¶</a></dt>
<dd><p>abstract class for test using an apptest environment</p>
<p>attributes:</p>
<ul class="simple">
<li><cite>vreg</cite>, the vregistry</li>
<li><cite>schema</cite>, self.vreg.schema</li>
<li><cite>config</cite>, cubicweb configuration</li>
<li><cite>cnx</cite>, dbapi connection to the repository using an admin user</li>
<li><cite>session</cite>, server side session associated to <cite>cnx</cite></li>
<li><cite>app</cite>, the cubicweb publisher (for web testing)</li>
<li><cite>repo</cite>, the repository object</li>
<li><cite>admlogin</cite>, login of the admin user</li>
<li><cite>admpassword</cite>, password of the admin user</li>
<li><cite>shell</cite>, create and use shell environment</li>
</ul>
<dl class="attribute">
<dt id="cubicweb.devtools.testlib.CubicWebTC.adminsession">
<tt class="descname">adminsession</tt><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.adminsession" title="Permalink to this definition">¶</a></dt>
<dd>return current server side session (using default manager account)</dd></dl>

<dl class="attribute">
<dt id="cubicweb.devtools.testlib.CubicWebTC.app">
<tt class="descname">app</tt><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.app" title="Permalink to this definition">¶</a></dt>
<dd>return a cubicweb publisher</dd></dl>

<dl class="method">
<dt id="cubicweb.devtools.testlib.CubicWebTC.assertSentEmail">
<tt class="descname">assertSentEmail</tt><big>(</big><em>subject</em>, <em>recipients=None</em>, <em>nb_msgs=None</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.assertSentEmail" title="Permalink to this definition">¶</a></dt>
<dd><p>test recipients in system mailbox for given email subject</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><em>subject</em> &#8211; email subject to find in mailbox</li>
<li><em>recipients</em> &#8211; list of email recipients</li>
<li><em>nb_msgs</em> &#8211; expected number of entries</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">list of matched emails</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="cubicweb.devtools.testlib.CubicWebTC.create_user">
<em class="property">classmethod </em><tt class="descname">create_user</tt><big>(</big><em>req</em>, <em>login=None</em>, <em>groups=('users'</em>, <em>)</em>, <em>password=None</em>, <em>email=None</em>, <em>commit=True</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.create_user" title="Permalink to this definition">¶</a></dt>
<dd>create and return a new user entity</dd></dl>

<dl class="method">
<dt id="cubicweb.devtools.testlib.CubicWebTC.ctrl_publish">
<tt class="descname">ctrl_publish</tt><big>(</big><em>req</em>, <em>ctrl='edit'</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.ctrl_publish" title="Permalink to this definition">¶</a></dt>
<dd>call the publish method of the edit controller</dd></dl>

<dl class="method">
<dt id="cubicweb.devtools.testlib.CubicWebTC.expect_redirect">
<tt class="descname">expect_redirect</tt><big>(</big><em>callback</em>, <em>req</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.expect_redirect" title="Permalink to this definition">¶</a></dt>
<dd>call the given callback with req as argument, expecting to get a
Redirect exception</dd></dl>

<dl class="method">
<dt id="cubicweb.devtools.testlib.CubicWebTC.expect_redirect_publish">
<tt class="descname">expect_redirect_publish</tt><big>(</big><em>req</em>, <em>path='edit'</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.expect_redirect_publish" title="Permalink to this definition">¶</a></dt>
<dd>call the publish method of the application publisher, expecting to
get a Redirect exception</dd></dl>

<dl class="classmethod">
<dt id="cubicweb.devtools.testlib.CubicWebTC.grant_permission">
<em class="property">classmethod </em><tt class="descname">grant_permission</tt><big>(</big><em>session</em>, <em>entity</em>, <em>group</em>, <em>pname=None</em>, <em>plabel=None</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.grant_permission" title="Permalink to this definition">¶</a></dt>
<dd>insert a permission on an entity. Will have to commit the main
connection to be considered</dd></dl>

<dl class="classmethod">
<dt id="cubicweb.devtools.testlib.CubicWebTC.init_config">
<em class="property">classmethod </em><tt class="descname">init_config</tt><big>(</big><em>config</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.init_config" title="Permalink to this definition">¶</a></dt>
<dd><p>configuration initialization hooks.</p>
<p>You may only want to override here the configuraton logic.</p>
<p>Otherwise, consider to use a different <tt class="xref docutils literal"><span class="pre">ApptestConfiguration</span></tt>
defined in the <cite>configcls</cite> class attribute</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.devtools.testlib.CubicWebTC.list_actions_for">
<tt class="descname">list_actions_for</tt><big>(</big><em>rset</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.list_actions_for" title="Permalink to this definition">¶</a></dt>
<dd>returns the list of actions that can be applied on <cite>rset</cite></dd></dl>

<dl class="method">
<dt id="cubicweb.devtools.testlib.CubicWebTC.list_boxes_for">
<tt class="descname">list_boxes_for</tt><big>(</big><em>rset</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.list_boxes_for" title="Permalink to this definition">¶</a></dt>
<dd>returns the list of boxes that can be applied on <cite>rset</cite></dd></dl>

<dl class="method">
<dt id="cubicweb.devtools.testlib.CubicWebTC.list_startup_views">
<tt class="descname">list_startup_views</tt><big>(</big><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.list_startup_views" title="Permalink to this definition">¶</a></dt>
<dd>returns the list of startup views</dd></dl>

<dl class="method">
<dt id="cubicweb.devtools.testlib.CubicWebTC.list_views_for">
<tt class="descname">list_views_for</tt><big>(</big><em>rset</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.list_views_for" title="Permalink to this definition">¶</a></dt>
<dd>returns the list of views that can be applied on <cite>rset</cite></dd></dl>

<dl class="method">
<dt id="cubicweb.devtools.testlib.CubicWebTC.login">
<tt class="descname">login</tt><big>(</big><em>login</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.login" title="Permalink to this definition">¶</a></dt>
<dd>return a connection for the given login/password</dd></dl>

<dl class="classmethod">
<dt id="cubicweb.devtools.testlib.CubicWebTC.pre_setup_database">
<em class="property">classmethod </em><tt class="descname">pre_setup_database</tt><big>(</big><em>session</em>, <em>config</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.pre_setup_database" title="Permalink to this definition">¶</a></dt>
<dd><p>add your pre database setup code by overriding this method</p>
<p>Do not forget to set the cls.test_db_id value to enable caching of the
result.</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.devtools.testlib.CubicWebTC.remote_call">
<tt class="descname">remote_call</tt><big>(</big><em>fname</em>, <em>*args</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.remote_call" title="Permalink to this definition">¶</a></dt>
<dd>remote json call simulation</dd></dl>

<dl class="method">
<dt id="cubicweb.devtools.testlib.CubicWebTC.req_from_url">
<tt class="descname">req_from_url</tt><big>(</big><em>url</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.req_from_url" title="Permalink to this definition">¶</a></dt>
<dd><p>parses <cite>url</cite> and builds the corresponding CW-web request</p>
<p>req.form will be setup using the url&#8217;s query string</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.devtools.testlib.CubicWebTC.request">
<tt class="descname">request</tt><big>(</big><em>rollbackfirst=False</em>, <em>url=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.request" title="Permalink to this definition">¶</a></dt>
<dd>return a web ui request</dd></dl>

<dl class="attribute">
<dt id="cubicweb.devtools.testlib.CubicWebTC.requestcls">
<tt class="descname">requestcls</tt><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.requestcls" title="Permalink to this definition">¶</a></dt>
<dd>alias of <tt class="xref docutils literal"><span class="pre">FakeRequest</span></tt></dd></dl>

<dl class="attribute">
<dt id="cubicweb.devtools.testlib.CubicWebTC.schema">
<tt class="descname">schema</tt><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.schema" title="Permalink to this definition">¶</a></dt>
<dd>return the application schema</dd></dl>

<dl class="attribute">
<dt id="cubicweb.devtools.testlib.CubicWebTC.session">
<tt class="descname">session</tt><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.session" title="Permalink to this definition">¶</a></dt>
<dd>return current server side session (using default manager account)</dd></dl>

<dl class="method">
<dt id="cubicweb.devtools.testlib.CubicWebTC.setup_database">
<tt class="descname">setup_database</tt><big>(</big><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.setup_database" title="Permalink to this definition">¶</a></dt>
<dd>add your database setup code by overriding this method</dd></dl>

<dl class="method">
<dt id="cubicweb.devtools.testlib.CubicWebTC.shell">
<tt class="descname">shell</tt><big>(</big><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.shell" title="Permalink to this definition">¶</a></dt>
<dd>return a shell session object</dd></dl>

<dl class="method">
<dt id="cubicweb.devtools.testlib.CubicWebTC.url_publish">
<tt class="descname">url_publish</tt><big>(</big><em>url</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.url_publish" title="Permalink to this definition">¶</a></dt>
<dd><p>takes <cite>url</cite>, uses application&#8217;s app_resolver to find the
appropriate controller, and publishes the result.</p>
<p>This should pretty much correspond to what occurs in a real CW server
except the apache-rewriter component is not called.</p>
</dd></dl>

<dl class="method">
<dt id="cubicweb.devtools.testlib.CubicWebTC.user">
<tt class="descname">user</tt><big>(</big><em>req=None</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.user" title="Permalink to this definition">¶</a></dt>
<dd>return the application schema</dd></dl>

<dl class="method">
<dt id="cubicweb.devtools.testlib.CubicWebTC.view">
<tt class="descname">view</tt><big>(</big><em>vid</em>, <em>rset=None</em>, <em>req=None</em>, <em>template='main-template'</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cubicweb.devtools.testlib.CubicWebTC.view" title="Permalink to this definition">¶</a></dt>
<dd><p>This method tests the view <cite>vid</cite> on <cite>rset</cite> using <cite>template</cite></p>
<p>If no error occurred while rendering the view, the HTML is analyzed
and parsed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Returns:</th><td class="field-body">an instance of <cite>cubicweb.devtools.htmlparser.PageInfo</cite>
encapsulation the generated HTML</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="migration.html" title="8. Migration"
             >next</a> |</li>
        <li class="right" >
          <a href="repo/tasks.html" title="6.4. Tasks"
             >previous</a> |</li>
        <li><a href="../index.html">CubicWeb 3.13.5</a> &raquo;</li>
          <li><a href="index.html" >Repository development</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2001-2010, Logilab.
      Last updated on Sep 08, 2011.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.6.
    </div>
  </body>
</html>