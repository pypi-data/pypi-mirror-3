

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Aglyph cookbook &mdash; Aglyph v1.1.0 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Aglyph v1.1.0 documentation" href="index.html" />
    <link rel="next" title="Aglyph testing summary" href="testing.html" />
    <link rel="prev" title="aglyph.compat.ipyetree — an ElementTree parser for IronPython" href="aglyph.compat.ipyetree.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="testing.html" title="Aglyph testing summary"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="aglyph.compat.ipyetree.html" title="aglyph.compat.ipyetree — an ElementTree parser for IronPython"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Aglyph v1.1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="aglyph-cookbook">
<h1>Aglyph cookbook<a class="headerlink" href="#aglyph-cookbook" title="Permalink to this headline">¶</a></h1>
<p>This article is a combination FAQ, DO/DON&#8217;T list, and &#8220;recipe&#8221; list for using
Aglyph effectively.</p>
<div class="section" id="use-aglyph-with-python-2-or-python-3-and-with-all-popular-variants">
<h2>Use Aglyph with Python 2 or Python 3, and with all popular variants<a class="headerlink" href="#use-aglyph-with-python-2-or-python-3-and-with-all-popular-variants" title="Permalink to this headline">¶</a></h2>
<p>Aglyph runs on <em>both</em> Python 2 and Python 3, and on recent versions of the
<a class="reference external" href="http://pypy.org/">PyPy</a>, <a class="reference external" href="http://www.jython.org/">Jython</a>,
<a class="reference external" href="http://ironpython.net/">IronPython</a>, and
<a class="reference external" href="http://www.stackless.com/">Stackless Python</a> variants.</p>
<p>Whether your application runs on Python 2 or Python 3, and whether you&#8217;re
using CPython or a variant, you will:</p>
<ul class="simple">
<li>use the same distribution of Aglyph</li>
<li>use the same classes† and methods from the <a class="reference internal" href="api-ref.html"><em>Aglyph API</em></a></li>
<li>configure your Aglyph context (whether XML or pure-Python) in the same way</li>
</ul>
<p>† <em>IronPython</em> developers should refer to <a class="reference internal" href="aglyph.compat.ipyetree.html#module-aglyph.compat.ipyetree" title="aglyph.compat.ipyetree"><tt class="xref py py-mod docutils literal"><span class="pre">aglyph.compat.ipyetree</span></tt></a>.</p>
</div>
<div class="section" id="use-3rd-party-classes-functions-as-components">
<h2>Use 3rd-party classes/functions as components<a class="headerlink" href="#use-3rd-party-classes-functions-as-components" title="Permalink to this headline">¶</a></h2>
<p>Using 3rd-party classes/functions as components (either to provide dependencies
to them, use them as dependencies, or both) is no different than using your
application&#8217;s classes/functions as components.</p>
<p>As long as the 3rd-party class/function in question has an importable
<em>&#8220;relative_module.identifier&#8221;</em> dotted-name string, it can have its dependencies
injected:</p>
<p>In XML:</p>
<div class="highlight-python"><pre>&lt;component id="third-party-thing" dotted-name="external.package.Thing"&gt;
    ...
&lt;/component&gt;</pre>
</div>
<p>In pure Python:</p>
<div class="highlight-python"><pre>binder.bind("third-party-thing", "external.package.Thing")...</pre>
</div>
</div>
<div class="section" id="define-dependencies-in-xml-for-built-ins-not-described-by-the-aglyph-dtd">
<h2>Define dependencies in XML for built-ins not described by the Aglyph DTD<a class="headerlink" href="#define-dependencies-in-xml-for-built-ins-not-described-by-the-aglyph-dtd" title="Permalink to this headline">¶</a></h2>
<p>Aglyph describes only the most common built-in types (<tt class="docutils literal"><span class="pre">bytes</span></tt>, <tt class="docutils literal"><span class="pre">str</span></tt>,
<tt class="docutils literal"><span class="pre">int</span></tt>, <tt class="docutils literal"><span class="pre">float</span></tt>, <tt class="docutils literal"><span class="pre">list</span></tt>, <tt class="docutils literal"><span class="pre">tuple</span></tt>, and <tt class="docutils literal"><span class="pre">dict</span></tt>) in the DTD, but this
doesn&#8217;t mean other built-ins <em>can&#8217;t</em> be used.</p>
<p>For this use case, Aglyph XML configuration supports the <tt class="docutils literal"><span class="pre">&lt;eval&gt;</span></tt> element,
which creates a <a class="reference external" href="http://docs.python.org/library/functools.html#functools.partial" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">functools.partial()</span></tt></a> that will call the built-in
<a class="reference external" href="http://docs.python.org/library/functions.html#eval" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">eval()</span></tt></a> function with the element text as an argument:</p>
<div class="highlight-python"><pre>&lt;component id="app.Thing"&gt;
    &lt;init&gt;
        &lt;arg keyword="fruits"&gt;
            &lt;eval&gt;&lt;![CDATA[frozenset(["Apple", "Orange", "Banana", "Pear"])]]&gt;&lt;/eval&gt;
        &lt;/arg&gt;
    &lt;/init&gt;
&lt;/component&gt;</pre>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>The environment for <a class="reference external" href="http://docs.python.org/library/functions.html#eval" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">eval()</span></tt></a> is <strong>restricted</strong> to a subset of
built-in constants, classes, and functions for security reasons.</p>
<p>Most of what you&#8217;ll need is there (except things like <a class="reference external" href="http://docs.python.org/library/functions.html#__import__" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">__import__()</span></tt></a>,
<a class="reference external" href="http://docs.python.org/library/functions.html#compile" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">compile()</span></tt></a>, etc.), but if you encounter <tt class="docutils literal"><span class="pre">NameError</span></tt> when the
component is being assembled, it&#8217;s likely because you&#8217;re attempting to use
a built-in that has been removed from the <a class="reference external" href="http://docs.python.org/library/functions.html#eval" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">eval()</span></tt></a> namespace.</p>
<p>The complete list of <em>available</em> built-ins varies between Python versions
(e.g. <a class="reference external" href="http://docs.python.org/library/functions.html#callable" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">callable()</span></tt></a> was removed in Python 3.0 but added back in Python
3.2).</p>
<p>The docstring for the <tt class="docutils literal"><span class="pre">aglyph.context.XMLContext._parse_eval()</span></tt>
method has more details:</p>
<dl class="last method">
<dt id="aglyph.context.XMLContext._parse_eval">
<tt class="descclassname">XMLContext.</tt><tt class="descname">_parse_eval</tt><big>(</big><em>eval_element</em><big>)</big><a class="reference internal" href="_modules/aglyph/context.html#XMLContext._parse_eval"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aglyph.context.XMLContext._parse_eval" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a <a class="reference external" href="http://docs.python.org/library/functools.html#functools.partial" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">functools.partial()</span></tt></a> that will evaluate an
expression when called, using the built-in <a class="reference external" href="http://docs.python.org/library/functions.html#eval" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">eval()</span></tt></a>
function.</p>
<p><em>eval_element</em> is an <a class="reference external" href="http://docs.python.org/library/xml.etree.elementtree.html#xml.etree.ElementTree.Element" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">xml.etree.ElementTree.Element</span></tt></a>
representing an <tt class="docutils literal"><span class="pre">&lt;eval&gt;</span></tt> element.</p>
<p>The environment for <a class="reference external" href="http://docs.python.org/library/functions.html#eval" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">eval()</span></tt></a> is a restricted subset of
<tt class="xref py py-mod docutils literal"><span class="pre">builtins</span></tt>, providing access to the following built-ins
<strong>only</strong> (and subject to availability based on Python version):</p>
<table class="hlist"><tr><td><ul class="simple">
<li><tt class="docutils literal"><span class="pre">ArithmeticError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">AssertionError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">AttributeError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">BaseException</span></tt></li>
<li><tt class="docutils literal"><span class="pre">BufferError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">BytesWarning</span></tt></li>
<li><tt class="docutils literal"><span class="pre">DeprecationWarning</span></tt></li>
<li><tt class="docutils literal"><span class="pre">EOFError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Ellipsis</span></tt></li>
<li><tt class="docutils literal"><span class="pre">EnvironmentError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Exception</span></tt></li>
<li><tt class="xref docutils literal"><span class="pre">False</span></tt></li>
<li><tt class="docutils literal"><span class="pre">FloatingPointError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">FutureWarning</span></tt></li>
<li><tt class="docutils literal"><span class="pre">GeneratorExit</span></tt></li>
<li><tt class="docutils literal"><span class="pre">IOError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">ImportError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">ImportWarning</span></tt></li>
<li><tt class="docutils literal"><span class="pre">IndentationError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">IndexError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">KeyError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">KeyboardInterrupt</span></tt></li>
<li><tt class="docutils literal"><span class="pre">LookupError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">MemoryError</span></tt></li>
</ul>
</td><td><ul class="simple">
<li><tt class="docutils literal"><span class="pre">NameError</span></tt></li>
<li><tt class="xref docutils literal"><span class="pre">None</span></tt></li>
<li><tt class="docutils literal"><span class="pre">NotImplemented</span></tt></li>
<li><tt class="docutils literal"><span class="pre">NotImplementedError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">OSError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">OverflowError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">PendingDeprecationWarning</span></tt></li>
<li><tt class="docutils literal"><span class="pre">ReferenceError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">ResourceWarning</span></tt></li>
<li><tt class="docutils literal"><span class="pre">RuntimeError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">RuntimeWarning</span></tt></li>
<li><tt class="docutils literal"><span class="pre">StandardError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">StopIteration</span></tt></li>
<li><tt class="docutils literal"><span class="pre">SyntaxError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">SyntaxWarning</span></tt></li>
<li><tt class="docutils literal"><span class="pre">SystemError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">TabError</span></tt></li>
<li><tt class="xref docutils literal"><span class="pre">True</span></tt></li>
<li><tt class="docutils literal"><span class="pre">TypeError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">UnboundLocalError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">UnicodeDecodeError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">UnicodeEncodeError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">UnicodeError</span></tt></li>
</ul>
</td><td><ul class="simple">
<li><tt class="docutils literal"><span class="pre">UnicodeTranslateError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">UnicodeWarning</span></tt></li>
<li><tt class="docutils literal"><span class="pre">UserWarning</span></tt></li>
<li><tt class="docutils literal"><span class="pre">ValueError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Warning</span></tt></li>
<li><tt class="docutils literal"><span class="pre">ZeroDivisionError</span></tt></li>
<li><tt class="docutils literal"><span class="pre">__debug__</span></tt></li>
<li><tt class="docutils literal"><span class="pre">abs</span></tt></li>
<li><tt class="docutils literal"><span class="pre">all</span></tt></li>
<li><tt class="docutils literal"><span class="pre">any</span></tt></li>
<li><tt class="docutils literal"><span class="pre">apply</span></tt></li>
<li><tt class="docutils literal"><span class="pre">ascii</span></tt></li>
<li><tt class="docutils literal"><span class="pre">basestring</span></tt></li>
<li><tt class="docutils literal"><span class="pre">bin</span></tt></li>
<li><tt class="docutils literal"><span class="pre">bool</span></tt></li>
<li><tt class="docutils literal"><span class="pre">buffer</span></tt></li>
<li><tt class="docutils literal"><span class="pre">bytearray</span></tt></li>
<li><tt class="docutils literal"><span class="pre">bytes</span></tt></li>
<li><tt class="docutils literal"><span class="pre">callable</span></tt></li>
<li><tt class="docutils literal"><span class="pre">chr</span></tt></li>
<li><tt class="docutils literal"><span class="pre">cmp</span></tt></li>
<li><tt class="docutils literal"><span class="pre">coerce</span></tt></li>
<li><tt class="docutils literal"><span class="pre">complex</span></tt></li>
</ul>
</td><td><ul class="simple">
<li><tt class="docutils literal"><span class="pre">dict</span></tt></li>
<li><tt class="docutils literal"><span class="pre">dir</span></tt></li>
<li><tt class="docutils literal"><span class="pre">divmod</span></tt></li>
<li><tt class="docutils literal"><span class="pre">enumerate</span></tt></li>
<li><tt class="docutils literal"><span class="pre">filter</span></tt></li>
<li><tt class="docutils literal"><span class="pre">float</span></tt></li>
<li><tt class="docutils literal"><span class="pre">format</span></tt></li>
<li><tt class="docutils literal"><span class="pre">frozenset</span></tt></li>
<li><tt class="docutils literal"><span class="pre">getattr</span></tt></li>
<li><tt class="docutils literal"><span class="pre">hasattr</span></tt></li>
<li><tt class="docutils literal"><span class="pre">hash</span></tt></li>
<li><tt class="docutils literal"><span class="pre">hex</span></tt></li>
<li><tt class="docutils literal"><span class="pre">id</span></tt></li>
<li><tt class="docutils literal"><span class="pre">int</span></tt></li>
<li><tt class="docutils literal"><span class="pre">intern</span></tt></li>
<li><tt class="docutils literal"><span class="pre">isinstance</span></tt></li>
<li><tt class="docutils literal"><span class="pre">issubclass</span></tt></li>
<li><tt class="docutils literal"><span class="pre">iter</span></tt></li>
<li><tt class="docutils literal"><span class="pre">len</span></tt></li>
<li><tt class="docutils literal"><span class="pre">list</span></tt></li>
<li><tt class="docutils literal"><span class="pre">long</span></tt></li>
<li><tt class="docutils literal"><span class="pre">map</span></tt></li>
<li><tt class="docutils literal"><span class="pre">max</span></tt></li>
</ul>
</td><td><ul class="simple">
<li><tt class="docutils literal"><span class="pre">memoryview</span></tt></li>
<li><tt class="docutils literal"><span class="pre">min</span></tt></li>
<li><tt class="docutils literal"><span class="pre">next</span></tt></li>
<li><tt class="docutils literal"><span class="pre">object</span></tt></li>
<li><tt class="docutils literal"><span class="pre">oct</span></tt></li>
<li><tt class="docutils literal"><span class="pre">ord</span></tt></li>
<li><tt class="docutils literal"><span class="pre">pow</span></tt></li>
<li><tt class="docutils literal"><span class="pre">range</span></tt></li>
<li><tt class="docutils literal"><span class="pre">reduce</span></tt></li>
<li><tt class="docutils literal"><span class="pre">repr</span></tt></li>
<li><tt class="docutils literal"><span class="pre">reversed</span></tt></li>
<li><tt class="docutils literal"><span class="pre">round</span></tt></li>
<li><tt class="docutils literal"><span class="pre">set</span></tt></li>
<li><tt class="docutils literal"><span class="pre">slice</span></tt></li>
<li><tt class="docutils literal"><span class="pre">sorted</span></tt></li>
<li><tt class="docutils literal"><span class="pre">str</span></tt></li>
<li><tt class="docutils literal"><span class="pre">sum</span></tt></li>
<li><tt class="docutils literal"><span class="pre">tuple</span></tt></li>
<li><tt class="docutils literal"><span class="pre">type</span></tt></li>
<li><tt class="docutils literal"><span class="pre">unichr</span></tt></li>
<li><tt class="docutils literal"><span class="pre">unicode</span></tt></li>
<li><tt class="docutils literal"><span class="pre">xrange</span></tt></li>
<li><tt class="docutils literal"><span class="pre">zip</span></tt></li>
</ul>
</td></tr></table>
</dd></dl>

</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>It is not necessary to use <a class="reference external" href="http://docs.python.org/library/functions.html#eval" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">eval()</span></tt></a> when creating a context
programmatically, as any built-in type or function can be used freely.</p>
<p>The example given above, using programmatic configuration, could be
simplified as follows:</p>
<div class="highlight-python"><pre>binder.bind(Thing).init(fruits=frozenset(
    ["Apple", "Orange", "Banana", "Pear"])</pre>
</div>
<p class="last">Because a <a class="reference external" href="http://docs.python.org/library/stdtypes.html#frozenset" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">frozenset</span></tt></a> is immutable, there is no need to use a
<a class="reference external" href="http://docs.python.org/library/functools.html#functools.partial" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">functools.partial()</span></tt></a> or an <a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Evaluator</span></tt></a>. But if
the example were using a mutable <a class="reference external" href="http://docs.python.org/library/stdtypes.html#set" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">set</span></tt></a>, for example, then a
<a class="reference external" href="http://docs.python.org/library/functools.html#functools.partial" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">functools.partial()</span></tt></a> or an <a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Evaluator</span></tt></a> may
be appropriate.</p>
</div>
</div>
<div class="section" id="exploit-the-flexibility-of-a-reference">
<h2>Exploit the flexibility of a <tt class="docutils literal"><span class="pre">Reference</span></tt><a class="headerlink" href="#exploit-the-flexibility-of-a-reference" title="Permalink to this headline">¶</a></h2>
<p>An <a class="reference internal" href="aglyph.component.html#aglyph.component.Reference" title="aglyph.component.Reference"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Reference</span></tt></a> is a powerful mechanism for creating
cross-references between components.</p>
<p>A <tt class="docutils literal"><span class="pre">Reference</span></tt> value is just a component ID, but a <tt class="docutils literal"><span class="pre">Reference</span></tt> triggers
special behavior within an <a class="reference internal" href="aglyph.assembler.html#aglyph.assembler.Assembler" title="aglyph.assembler.Assembler"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.assembler.Assembler</span></tt></a> or
<a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Evaluator</span></tt></a> when it is encountered during assembly or
evaluation (respectively): wherever the <tt class="docutils literal"><span class="pre">Reference</span></tt> appears, it will be
automatically replaced with the fully-assembled component it identifies.</p>
<p>In most cases, a <tt class="docutils literal"><span class="pre">Reference</span></tt> will be used as an initialization argument or
attribute value:</p>
<p>In XML:</p>
<div class="highlight-python"><pre>&lt;component id="an-object" dotted-name="builtins.object"/&gt;
&lt;component id="cookbook.ReferenceExample"&gt;
    &lt;init&gt;
        &lt;arg reference"an-object"/&gt;
    &lt;/init&gt;
&lt;/component&gt;</pre>
</div>
<p>In pure Python:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;an-object&quot;</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span>
<span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;cookbook.ReferenceExample&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">Reference</span><span class="p">(</span><span class="s">&quot;an-object&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>When using <a class="reference internal" href="aglyph.binder.html#aglyph.binder.Binder" title="aglyph.binder.Binder"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.binder.Binder</span></tt></a> for programmatic configuration, a
&#8220;shortcut&#8221; is also available if you are binding by class or function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">Service</span><span class="p">,</span> <span class="n">ServiceImpl</span><span class="p">)</span>
<span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">Provider</span><span class="p">)</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">Service</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case, assuming that <tt class="docutils literal"><span class="pre">Service</span></tt> is in the &#8220;cookbook&#8221; module, Aglyph
treats <tt class="docutils literal"><span class="pre">init(Service)</span></tt> the same as <tt class="docutils literal"><span class="pre">init(Reference(&quot;cookbook.Service&quot;))</span></tt>.</p>
<p>A <tt class="docutils literal"><span class="pre">Reference</span></tt> may be used in <em>any</em> of the following places, allowing for
extremely flexible configurations:</p>
<ul class="simple">
<li>an initialization argument value (positional or keyword) for an
<a class="reference internal" href="aglyph.component.html#aglyph.component.Component" title="aglyph.component.Component"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Component</span></tt></a> or an <a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Evaluator</span></tt></a></li>
<li>an attribute value for an <a class="reference internal" href="aglyph.component.html#aglyph.component.Component" title="aglyph.component.Component"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Component</span></tt></a></li>
<li>a key and/or value of a mapping type</li>
<li>an item of a non-mapping sequence type</li>
</ul>
<p>In a nutshell: an <a class="reference internal" href="aglyph.component.html#aglyph.component.Reference" title="aglyph.component.Reference"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Reference</span></tt></a> may be used in <em>any</em>
case where a value is being defined, and will be replaced at assembly-time by
the fully-assembled component identified by that reference.</p>
</div>
<div class="section" id="be-careful-with-eval-functools-partial-evaluator-and-reference">
<h2>Be careful with <tt class="docutils literal"><span class="pre">&lt;eval&gt;</span></tt>, <tt class="docutils literal"><span class="pre">functools.partial</span></tt>, <tt class="docutils literal"><span class="pre">Evaluator</span></tt>, and <tt class="docutils literal"><span class="pre">Reference</span></tt><a class="headerlink" href="#be-careful-with-eval-functools-partial-evaluator-and-reference" title="Permalink to this headline">¶</a></h2>
<p>An XML <tt class="docutils literal"><span class="pre">&lt;eval&gt;</span></tt> element (which is translated into a <a class="reference external" href="http://docs.python.org/library/functools.html#functools.partial" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">functools.partial()</span></tt></a>
that calls <a class="reference external" href="http://docs.python.org/library/functions.html#eval" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">eval()</span></tt></a>), a user-created <a class="reference external" href="http://docs.python.org/library/functools.html#functools.partial" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">functools.partial()</span></tt></a>, an
<a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Evaluator</span></tt></a>, and an <a class="reference internal" href="aglyph.component.html#aglyph.component.Reference" title="aglyph.component.Reference"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Reference</span></tt></a>
all share one common characteristic: <strong>these constructs do not resolve to their
actual values until assembly-time.</strong></p>
<p>It is crucial to understand this when using these constructs as values in
cases where Python requires a <em>hashable</em> type (i.e. an object that implements
the <tt class="docutils literal"><span class="pre">__hash__</span></tt> protocol). This includes, but is not limited to:</p>
<ul class="simple">
<li>keys of a <a class="reference external" href="http://docs.python.org/library/stdtypes.html#dict" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a> (or any other mapping type)</li>
<li>items of a <a class="reference external" href="http://docs.python.org/library/stdtypes.html#set" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">set</span></tt></a> or <a class="reference external" href="http://docs.python.org/library/stdtypes.html#frozenset" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">frozenset</span></tt></a></li>
</ul>
<p>In these cases, the construct <strong>must</strong> resolve to a <em>hashable</em> object, or
Python will raise <tt class="docutils literal"><span class="pre">TypeError</span></tt> at assembly time.</p>
</div>
<div class="section" id="respect-unicode-and-character-encodings-in-xml-configuration">
<h2>Respect Unicode and character encodings in XML configuration<a class="headerlink" href="#respect-unicode-and-character-encodings-in-xml-configuration" title="Permalink to this headline">¶</a></h2>
<p>Aglyph properly handles Unicode text and encoded-bytes data in XML
configuration files, and can provide your application components with the
correct type (regardless of Python version) on assembly.</p>
<p>Consider the following example:</p>
<div class="highlight-python"><pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;context id="cookbook"&gt;
    &lt;component id="cookbook.TextAndData"&gt;
        &lt;attributes&gt;
            &lt;attribute name="text"&gt;
                &lt;unicode&gt;ΑΦΔ&lt;/unicode&gt;
            &lt;/attribute&gt;
            &lt;attribute name="data1"&gt;
                &lt;str encoding="utf-8"&gt;ΑΦΔ&lt;/str&gt;
            &lt;/attribute&gt;
            &lt;attribute name="data2"&gt;
                &lt;str encoding="iso-8859-7"&gt;ΑΦΔ&lt;/str&gt;
            &lt;/attribute&gt;
        &lt;/attributes&gt;
    &lt;/component&gt;
&lt;/context&gt;</pre>
</div>
<p>When this component is assembled, the <tt class="docutils literal"><span class="pre">text</span></tt> attribute will be a Unicode
string (<a class="reference external" href="http://docs.python.org/library/functions.html#unicode" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">unicode()</span></tt></a>), and the <tt class="docutils literal"><span class="pre">data1</span></tt> and <tt class="docutils literal"><span class="pre">data2</span></tt> attributes will be
encoded bytes (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">str()</span></tt></a>) in the UTF-8 and ISO-8859-7 character sets,
respectively:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">assemble</span><span class="p">(</span><span class="s">&quot;cookbook.TextAndData&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span><span class="o">.</span><span class="n">text</span>
<span class="go">u&#39;\u0391\u03a6\u0394&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span><span class="o">.</span><span class="n">data1</span>
<span class="go">&#39;\xce\x91\xce\xa6\xce\x94&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span><span class="o">.</span><span class="n">data2</span>
<span class="go">&#39;\xc1\xd6\xc4&#39;</span>
</pre></div>
</div>
<div class="section" id="differences-between-python-2-and-python-3">
<h3>Differences between Python 2 and Python 3<a class="headerlink" href="#differences-between-python-2-and-python-3" title="Permalink to this headline">¶</a></h3>
<p>The built-in <a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">str()</span></tt></a> type has changed significantly between Python 2 and
Python 3 (see <a class="reference external" href="http://docs.python.org/release/3.0/whatsnew/3.0.html#text-vs-data-instead-of-unicode-vs-8-bit">Text Vs. Data Instead Of Unicode Vs. 8-bit</a>).</p>
<p>In short: <a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">str()</span></tt></a> represented encoded byte data up to and including
Python 2, but representes <em>Unicode text</em> as of Python 3.0.</p>
<p>A simple table illustrates the difference in types between Python 2 and 3:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="40%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Version</th>
<th class="head">Unicode text</th>
<th class="head">Encoded byte data</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Python 2</td>
<td><tt class="docutils literal"><span class="pre">unicode</span></tt></td>
<td><tt class="docutils literal"><span class="pre">str</span></tt></td>
</tr>
<tr><td>Python 3</td>
<td><tt class="docutils literal"><span class="pre">str</span></tt></td>
<td><tt class="docutils literal"><span class="pre">bytes</span></tt></td>
</tr>
</tbody>
</table>
<p>The <a class="reference download internal" href="_downloads/aglyph-context-1.0.0.dtd"><tt class="xref download docutils literal"><span class="pre">Aglyph</span> <span class="pre">1.0.0</span> <span class="pre">context</span> <span class="pre">DTD</span></tt></a> defines <tt class="docutils literal"><span class="pre">&lt;bytes&gt;</span></tt>, <tt class="docutils literal"><span class="pre">&lt;str&gt;</span></tt>,
and <tt class="docutils literal"><span class="pre">&lt;unicode&gt;</span></tt> elements that correspond to the types in the table above, but
treats the element content differently depending on the version of Python in
which Aglyph is running:</p>
<p class="rubric">Python 2</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">&lt;bytes[</span> <span class="pre">encoding=&quot;...&quot;]&gt;...&lt;/bytes&gt;</span></tt></dt>
<dd>Element content is returned as a Python 2 <a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">str()</span></tt></a> encoded byte string
(identical to <tt class="docutils literal"><span class="pre">&lt;str&gt;</span></tt>)</dd>
<dt><tt class="docutils literal"><span class="pre">&lt;str[</span> <span class="pre">encoding=&quot;...&quot;]&gt;...&lt;/str&gt;</span></tt></dt>
<dd>Element content is returned as a Python 2 <a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">str()</span></tt></a> encoded byte string</dd>
<dt><tt class="docutils literal"><span class="pre">&lt;unicode&gt;...&lt;/unicode&gt;</span></tt></dt>
<dd>Element content is returned as a Python 2 <a class="reference external" href="http://docs.python.org/library/functions.html#unicode" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">unicode()</span></tt></a> Unicode string</dd>
</dl>
<p class="rubric">Python 3</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">&lt;bytes[</span> <span class="pre">encoding=&quot;...&quot;]&gt;...&lt;/bytes&gt;</span></tt></dt>
<dd>Element content is returned as a Python 3 <tt class="docutils literal"><span class="pre">bytes</span></tt> encoded byte object</dd>
<dt><tt class="docutils literal"><span class="pre">&lt;str&gt;...&lt;/str&gt;</span></tt></dt>
<dd><p class="first">Element content is returned as a Python 3 <tt class="docutils literal"><span class="pre">str</span></tt> Unicode string</p>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Althoug the DTD permits an <em>encoding=&#8221;...&#8221;</em> attribute on <tt class="docutils literal"><span class="pre">&lt;str&gt;</span></tt>
elements, the attribute is <strong>ignored</strong> in Python 3 (a <em>WARNING</em>-level
log message is generated if it is present)</p>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">&lt;unicode&gt;...&lt;/unicode&gt;</span></tt></dt>
<dd>Element content is returned as a Python 3 <tt class="docutils literal"><span class="pre">str</span></tt> Unicode string (identical
to <tt class="docutils literal"><span class="pre">&lt;str&gt;</span></tt></dd>
</dl>
<p>To summarize the above:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">&lt;bytes&gt;</span></tt> is interpreted as a <tt class="docutils literal"><span class="pre">str</span></tt> type in Python 2 and a <tt class="docutils literal"><span class="pre">bytes</span></tt> type
in Python 3</li>
<li><tt class="docutils literal"><span class="pre">&lt;str&gt;</span></tt> is always interpreted as a <tt class="docutils literal"><span class="pre">str</span></tt> type</li>
<li><tt class="docutils literal"><span class="pre">&lt;unicode&gt;</span></tt> is interpreted as a <tt class="docutils literal"><span class="pre">unicode</span></tt> type in Python 2 and a <tt class="docutils literal"><span class="pre">str</span></tt>
type in Python 3</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For clarity in XML context documents, it is always safe to use <tt class="docutils literal"><span class="pre">&lt;bytes&gt;</span></tt>
for encoded byte data and <tt class="docutils literal"><span class="pre">&lt;unicode&gt;</span></tt> for Unicode text (regardless of
Python version), avoiding entirely the ambiguity of <tt class="docutils literal"><span class="pre">&lt;str&gt;</span></tt>.</p>
</div>
</div>
</div>
<div class="section" id="avoid-circular-dependencies">
<h2>Avoid circular dependencies<a class="headerlink" href="#avoid-circular-dependencies" title="Permalink to this headline">¶</a></h2>
<p>Consider two components, <strong>A</strong> and <strong>B</strong>. If <strong>B</strong> is a dependency of <strong>A</strong>,
and <strong>A</strong> is also a dependency of <strong>B</strong>, then a circular dependency exists:</p>
<div class="highlight-python"><pre>&lt;component id="cookbook.A"&gt;
    &lt;init&gt;
        &lt;arg reference="cookbook.B"/&gt;
    &lt;/init&gt;
&lt;/comonent&gt;
&lt;component id="cookbook.B"&gt;
    &lt;init&gt;
        &lt;arg reference="cookbook.A"/&gt;
    &lt;/init&gt;
&lt;/comonent&gt;</pre>
</div>
<p>Aglyph will raise <a class="reference internal" href="aglyph.html#aglyph.AglyphError" title="aglyph.AglyphError"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.AglyphError</span></tt></a> when it detects a circular
reference during assembly.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In software design in general, circular dependencies are frowned upon
because they can lead to problems ranging from increased maintenance costs
to infinite recursion and memory leaks. The existence of a circular
dependency usually implies that the design can be improved to avoid such a
relationship.</p>
</div>
</div>
<div class="section" id="protect-injected-dependencies-from-being-modified-by-reference">
<h2>Protect injected dependencies from being modified by reference<a class="headerlink" href="#protect-injected-dependencies-from-being-modified-by-reference" title="Permalink to this headline">¶</a></h2>
<p>Consider the following component (configured programmatically):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">Thing</span><span class="p">)</span><span class="o">.</span><span class="n">attributes</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<p>If this component is assembled, and the <tt class="docutils literal"><span class="pre">mutable</span></tt> attribute is modified, that
change will persist in the component definition:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">thing</span> <span class="o">=</span> <span class="n">binder</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">Thing</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">thing</span><span class="o">.</span><span class="n">mutable</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">thing</span><span class="o">.</span><span class="n">mutable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">thing</span><span class="o">.</span><span class="n">mutable</span>
<span class="go">[1, 2, 3, 4]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">another</span> <span class="o">=</span> <span class="n">binder</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">Thing</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">another</span><span class="o">.</span><span class="n">mutable</span>
<span class="go">[1, 2, 3, 4]</span>
</pre></div>
</div>
<p>It is likely that this is <em>not</em> desired behavior. To protect against
modify-by-reference, use a <a class="reference external" href="http://docs.python.org/library/functools.html#functools.partial" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">functools.partial()</span></tt></a> <strong>if</strong> the value does not
contain nested <tt class="docutils literal"><span class="pre">Reference</span></tt> <tt class="docutils literal"><span class="pre">Evaluator</span></tt> objects; otherwise, use an
<a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Evaluator</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">Thing</span><span class="p">)</span><span class="o">.</span><span class="n">attributes</span><span class="p">(</span><span class="n">mutable</span><span class="o">=</span><span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
<span class="n">thing_ref</span> <span class="o">=</span> <span class="n">Reference</span><span class="p">(</span><span class="n">format_dotted_name</span><span class="p">(</span><span class="n">Thing</span><span class="p">))</span>
<span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">Other</span><span class="p">)</span><span class="o">.</span><span class="n">attributes</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">Evaluator</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="n">thing_ref</span><span class="p">]))</span>
</pre></div>
</div>
<p>Now the <tt class="docutils literal"><span class="pre">mutable</span></tt> attribute can still be modified on an instance of
<tt class="docutils literal"><span class="pre">Thing</span></tt>, but newly-assembled instances will always have the value specified
in the component definition. And looking up an instance of <tt class="docutils literal"><span class="pre">Other</span></tt> will
correctly assemble the nested reference to <tt class="docutils literal"><span class="pre">Thing</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">thing</span> <span class="o">=</span> <span class="n">binder</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">Thing</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">thing</span><span class="o">.</span><span class="n">mutable</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">thing</span><span class="o">.</span><span class="n">mutable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">thing</span><span class="o">.</span><span class="n">mutable</span>
<span class="go">[1, 2, 3, 4]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">another</span> <span class="o">=</span> <span class="n">binder</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">Thing</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">another</span><span class="o">.</span><span class="n">mutable</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">other</span> <span class="o">=</span> <span class="n">binder</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">Other</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">field</span><span class="p">,</span> <span class="n">Thing</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>An interesting twist on the first example given above:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">Thing</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s">&quot;singleton&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">attributes</span><span class="p">(</span>
    <span class="n">mutable</span><span class="o">=</span><span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
</pre></div>
</div>
<p>Because the component is now a singleton, a change to <tt class="docutils literal"><span class="pre">mutable</span></tt> that persists
is now <em>correct</em> behavior (the same holds true if the assembly strategy had
been &#8220;borg&#8221;).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When using XML configuration, a <tt class="docutils literal"><span class="pre">&lt;list&gt;</span></tt> or <tt class="docutils literal"><span class="pre">&lt;dict&gt;</span></tt>
dependency, or a <tt class="docutils literal"><span class="pre">&lt;tuple&gt;</span></tt> dependency with one or more items, is
<strong>automatically</strong> defined as an <a class="reference internal" href="aglyph.component.html#aglyph.component.Evaluator" title="aglyph.component.Evaluator"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.component.Evaluator</span></tt></a>.
Pure-Python configuration does not have the benefit of this
automatic behavior.</p>
</div>
</div>
<div class="section" id="write-wrappers-for-objects-that-are-not-created-by-importable-classes-or-functions">
<h2>Write wrappers for objects that are not created by importable classes or functions<a class="headerlink" href="#write-wrappers-for-objects-that-are-not-created-by-importable-classes-or-functions" title="Permalink to this headline">¶</a></h2>
<p>There are several object creation cases that Aglyph does <strong>not</strong> directly
support:</p>
<ol class="arabic simple">
<li>obtaining an object by using a <em>&#64;staticmethod</em> or <em>&#64;classmethod</em></li>
<li>creating an object of an &#8220;inner class&#8221;</li>
<li>obtaining an object by calling an instance (bound) method of a class, or
directly accessing an instance member</li>
</ol>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Spam</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="c"># case 1</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_instance</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="c"># case 1</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="c"># case 2</span>
    <span class="k">class</span> <span class="nc">Eggs</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
        <span class="c"># case 3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thing</span> <span class="o">=</span> <span class="o">...</span>

    <span class="c"># case 3</span>
    <span class="k">def</span> <span class="nf">acquire_something</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>However, there are times when you can&#8217;t avoid these cases (e.g. you&#8217;re using a
3rd-party library). In this case, you can create &#8220;wrapper&#8221; functions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">get_spam_instance</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Spam</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_spam_eggs</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Spam</span><span class="o">.</span><span class="n">Eggs</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_spam</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Spam</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_thing_from_spam</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Spam</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">eggs</span>

<span class="k">def</span> <span class="nf">get_something_from_spam</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Spam</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">acquire_something</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>There&#8217;s no need to use these functions in your application proper; they&#8217;re
simply conveniences for Aglyph. It is recommended that you place them into a
separate module (if you&#8217;re using programmatic configuration, the module where
your <a class="reference internal" href="aglyph.binder.html#aglyph.binder.Binder" title="aglyph.binder.Binder"><tt class="xref py py-class docutils literal"><span class="pre">aglyph.binder.Binder</span></tt></a> is defined is a logical choice). This way,
you can define components and injection dependencies for the importable
functions. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">get_spam_instance</span><span class="p">)</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">attributes</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">binder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;eggs&quot;</span><span class="p">,</span> <span class="n">get_spam_eggs</span><span class="p">)</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">attributes</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Aglyph cookbook</a><ul>
<li><a class="reference internal" href="#use-aglyph-with-python-2-or-python-3-and-with-all-popular-variants">Use Aglyph with Python 2 or Python 3, and with all popular variants</a></li>
<li><a class="reference internal" href="#use-3rd-party-classes-functions-as-components">Use 3rd-party classes/functions as components</a></li>
<li><a class="reference internal" href="#define-dependencies-in-xml-for-built-ins-not-described-by-the-aglyph-dtd">Define dependencies in XML for built-ins not described by the Aglyph DTD</a></li>
<li><a class="reference internal" href="#exploit-the-flexibility-of-a-reference">Exploit the flexibility of a <tt class="docutils literal"><span class="pre">Reference</span></tt></a></li>
<li><a class="reference internal" href="#be-careful-with-eval-functools-partial-evaluator-and-reference">Be careful with <tt class="docutils literal"><span class="pre">&lt;eval&gt;</span></tt>, <tt class="docutils literal"><span class="pre">functools.partial</span></tt>, <tt class="docutils literal"><span class="pre">Evaluator</span></tt>, and <tt class="docutils literal"><span class="pre">Reference</span></tt></a></li>
<li><a class="reference internal" href="#respect-unicode-and-character-encodings-in-xml-configuration">Respect Unicode and character encodings in XML configuration</a><ul>
<li><a class="reference internal" href="#differences-between-python-2-and-python-3">Differences between Python 2 and Python 3</a></li>
</ul>
</li>
<li><a class="reference internal" href="#avoid-circular-dependencies">Avoid circular dependencies</a></li>
<li><a class="reference internal" href="#protect-injected-dependencies-from-being-modified-by-reference">Protect injected dependencies from being modified by reference</a></li>
<li><a class="reference internal" href="#write-wrappers-for-objects-that-are-not-created-by-importable-classes-or-functions">Write wrappers for objects that are not created by importable classes or functions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="aglyph.compat.ipyetree.html"
                        title="previous chapter"><tt class="docutils literal docutils literal docutils literal"><span class="pre">aglyph.compat.ipyetree</span></tt> &#8212; an <em>ElementTree</em> parser for <em>IronPython</em></a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="testing.html"
                        title="next chapter">Aglyph testing summary</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/cookbook.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="testing.html" title="Aglyph testing summary"
             >next</a> |</li>
        <li class="right" >
          <a href="aglyph.compat.ipyetree.html" title="aglyph.compat.ipyetree — an ElementTree parser for IronPython"
             >previous</a> |</li>
        <li><a href="index.html">Aglyph v1.1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2006-2011, Matthew Zipay.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>