<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="bastioncrypto">

  <metal:border fill-slot="top_slot">
    <tal:border define="dummy python:request.set('enable_border',1)" />
  </metal:border>

  <body>

    <div metal:fill-slot="main"
         tal:define="errors options/state/getErrors;
                     utool context/@@plone_portal_state/portal_url;">

      <h1><img src="" tal:define="icon python: context.getIcon(1)"
               tal:attributes="src string:${utool}/${icon}">&nbsp;
          <span tal:replace="here/title_or_id"/></h1>

      <a href=""
           class="link-parent"
           tal:define="parent_url python:here.navigationParent(here, template.getId())"
           tal:condition="parent_url"
           tal:attributes="href parent_url"
           i18n:translate="go_to_parent_url">Up one level</a>

      <form action="." enctype="multipart/form-data" method="post"
            tal:attributes="action template/getId" >

        <fieldset>
 
          <legend i18n:translate="legend_domain_details">Submit a PGP Key</legend>
 
          <p class="formHelp" i18n:translate="help_uploads">
          Add your PGP Public key here.  You should provide either your key in text form, or the 
          file containing your public key (as identified via your email address).  This file 
          will have a MIME type of <i>PGP armored data public key block</i>, as 
          created by the <b>gpg --export --armor &lt;your@email&gt;</b> command for example.</p>

          <p class="formHelp">You can also access this keyserver using the <b>gpg 
           --keyserver=<span tal:replace="here/absolute_url"/></b> command.</p>              

          <div class="field"
               tal:define="error errors/key|nothing;
                           Key request/key | nothing;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="key" i18n:translate="label_key">Key</label>
                                                                                 

            <div tal:content="error">Validation error output</div>
                                                                                 
            <textarea name="keytext" rows="10" cols="10" tal:content="Key"/>
                                                                                 
          </div>
                                                                                 
          <div class="field"
               tal:define="error errors/keyfile|nothing;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="keyfile" i18n:translate="label_or_file">or File</label>
                                                                                 
            <div tal:content="error">Validation error output</div>
                                                                                 
            <input type="file" id="keyfile" name="keyfile" size="40" value="" />
                                                                                
          </div>
                                                                                 

          <div class="formControls">
            <input class="context"
                   type="submit"
                   name="form.button.Submit"
                   value="Upload"
                   i18n:attributes="value" />
          </div>

        </fieldset>

        <input type="hidden" name="form.submitted" value="1" />

      </form>

      <fieldset tal:define="member here/portal_membership/getAuthenticatedMember"
                tal:condition="python: member and getattr(member, 'email', None)">

          <legend>bastioncrypto</legend>

          <p class="formHelp">If you have installed our BastionCrypto
          <a href="http://www.last-bastion.net/BastionCrypto">helper</a> for your operating system
          (this is available as the <em>BastionCrypto-helper</em> package in 
            <a href="https://linux.last-bastion.net">BastionLinux</a>).</p>

          <p class="formHelp">You must also have your web browser configured to invoke the helper for
          <code>application/x-bastioncrypto</code> content types.</p>
       
          <form name="automagic" action="" method="post" tal:attributes="action request/URL1">
             <div class="formControls">
                <input class="context"
                       type="submit"
		       name="add_bastioncrypto:method"
                       value="bastioncrypto Add"
                       i18n:attributes="value" />
             </div>
          </form>
 
        </fieldset>
 
    </div>

  </body>
</html>

