<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/prefs_main_template/macros/master"
      i18n:domain="zscheduler">

  <div metal:fill-slot="prefs_configlet_main"
         tal:define="utool context/@@plone_portal_state/portal_url;
	             tool nocall: context/portal_crontab;
		     events tool/queueValues;
                     timezone tool/timezone;
                     lockable python:hasattr(here, 'wl_isLocked');
                     isLocked python:lockable and here.wl_isLocked();">

      <h1><img src="" alt="" tal:define="icon python:context.getIcon(1)" 
               tal:attributes="src string:${utool}/${icon}">&nbsp;<span tal:replace="tool/title_or_id"/></h1>

      <a href=""
         class="link-parent"
         tal:attributes="href string: $portal_url/plone_control_panel"
         i18n:translate="label_up_to_preferences">
       Up to Plone setup
      </a>

      <p class="formHelp" tal:condition="not: events">There are no scheduled events for this portal.</p>

      <form action="" tal:attributes="action template/getId" method="post" tal:condition="events">

         <span class="label">Now</span>
         <span tal:replace="python: DateTime().toZone(timezone)"/>

         <table cellpadding="2" cellspacing="0" summary="">
           <tr>
              <td/>
              <td/>
              <td><span class="label">Path</span></td>
              <td><span class="label">Scheduled</span></td>
              <td><span class="label">Last Run</span></td>
              <td><span class="label">Status</span></td>
           </tr>
           <tr tal:repeat="event events"
               tal:attributes="class python: test(repeat['event'].odd, 'odd', 'even')">
              <td>
                <input type="checkbox"  name="urls:list" value="" 
                         tal:attributes="value python: '/'.join(event.getPhysicalPath())"/>
              </td>
              <td>
                 <img src="" tal:define="icon python: event.getIcon(1);"
                             tal:attributes="src string:${utool}/${icon}; alt event/meta_type"/>
              </td>
              <td>
                  <a href=""
                     tal:attributes="href event/absolute_url"
                     tal:content=" python: '/'.join(event.getPhysicalPath())"/>
              </td>
               <td>
                   <span tal:replace="python: event.time.toZone(timezone)"
                         tal:on-error="string:"/>
               </td>
               <td>
                   <span tal:replace="python: event.last_executed.toZone(timezone)"
                         tal:on-error="string:"/>
               </td>
               <td tal:define="active event/active">
                   <span tal:condition="active">active</span>
                   <span tal:condition="not: active">inactive</span>
               </td>
           </tr>
           <tr>
             <td colspan="6">
                <input type="submit" class="context" name="form.button.Schedule" value=" Schedule "/>
                <input type="submit" class="context" name="form.button.Unschedule" value=" Unschedule "/>
             </td>
           </tr>
         </table>

         <input type="hidden" name="form.submitted" value="1"/>

      </form>

  </div>

</html>
