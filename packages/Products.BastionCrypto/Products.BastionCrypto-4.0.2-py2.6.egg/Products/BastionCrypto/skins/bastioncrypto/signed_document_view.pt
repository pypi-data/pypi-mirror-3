<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">
<body>

<metal:main fill-slot="main">
    <tal:main-macro metal:define-macro="main"
           tal:define="len_text python:len(here.text);
                       is_editable context/@@plone_context_state/is_editable;
                       signatories here/signatories">
    
        <h1 tal:content="here/title_or_id" class="documentFirstHeading">
          Title or id
        </h1>
    
        <div class="documentDescription"
             tal:content="here/Description">
            description
        </div>
    
        <p tal:condition="python: not len_text and is_editable"
           i18n:translate="no_body_text"
           class="discreet">
            This item does not have any body text, click the edit tab to change it.
        </p>
    
        <div class="documentEditable standalone" tal:condition="request/raw | nothing" 
             tal:content="structure python: modules['Products.PythonScripts.standard'].newline_to_br(here.pgp_headers())"/>

        <div class="stx"
             tal:condition="len_text"
             tal:attributes="class python:test(here.Format() in ('text/structured',
                                                   'text/x-rst', ), 'stx', 'plain')">
            <div tal:replace="structure python:here.CookedBody(stx_level=2)" />
        </div>
    
        <p tal:condition="python: not signatories"
           i18n:translate="no_body_text"
           class="discreet">
            This item has not yet been signed.
        </p>

        <div class="documentEditable standalone" tal:condition="request/raw | nothing" 
             tal:content="structure python: modules['Products.PythonScripts.standard'].newline_to_br(here.pgp_trailers())"/>

        <div class="stx" tal:condition="signatories">
            <dl>
               <span tal:repeat="siginfo here/getSignatoryInfo" tal:omit-tag="">
                   <dt>
                       <img src="" tal:attributes="src here/icon"/>
                       <a href="" tal:attributes="href siginfo/absolute_url" tal:content="siginfo/name"/>
                   </dt>
                   <dd><span tal:replace="siginfo/date"/></dd>
               </span>
            </dl>
            <span tal:condition="not: request/raw | nothing" class="discreet">Show <a href="" 
                tal:attributes="href string:${here/absolute_url}/view?raw=1">PGP Headers</a></span>
        </div>
    
        <div metal:use-macro="structure provider:plone.belowcontentbody">
            Document actions (print, sendto etc)
        </div>

    </tal:main-macro>
</metal:main>

</body>
</html>

