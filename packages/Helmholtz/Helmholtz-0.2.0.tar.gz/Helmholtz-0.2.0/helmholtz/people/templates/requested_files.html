{% load access_request %}

{% if request_user == user or user.is_superuser %}
  <div class="history">
    <h3><span>File Requests</span></h3>
    {% if user.requests.count %}
    <div class="table_container"> 
     <table cellspacing="0"> 
      <thead> 
       <tr> 
        <th> 
        </th>
        <th class="header_field">request date</th> 
        <th class="header_field">file</th> 
        <th class="header_field">state</th> 
        <th class="header_field">response date</th>
        <th class="header_field">response by</th>
        <th class="header_field">download</th>
       <tr> 
      </thead> 
    
      <tbody>
      {% for request in user.requests.all %}
       <tr class="{% cycle 'row_even' 'row_odd' %}">
        <td><img class="expander" src="{{MEDIA_URL}}images/icon_addlink.gif"></img></td>
        <td>{{request.request_date|date:"D d M Y"}}</td>
        <td>{{request.object}}</td> 
        <td>{{request.get_state_display}}</td>
        <td>{% if request.response_date %}{{request.response_date|date:"D d M Y"}}{% else %}None{% endif %}</td>
        <td>{% if request.response_by %}{{request.response_by.get_full_name}}{% else %}None{% endif %}</td>
        <td>
         {% download_status request.object user %}
        </td>
       </tr> 
       <tr class="detail_row" >
        <td colspan="7">
         <ul><li>No Data Available for this File.</li></ul>
        </td>
       </tr> 
      {% endfor %}
      </tbody> 
    
      <tfoot> 
       <tr class="footer"> 
        <td colspan="7">  
         <br/> 
        </td> 
       </tr> 
      </tfoot>
     </table>
    </div> 
  {% else %}
  No Data Available.
  {% endif %} 
  </div>
{% endif %}