<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionbanking">
 
<body>
  <div metal:fill-slot="main"
       tal:define="utool context/@@plone_portal_state/portal_url;">

      <h1><img src="" alt="" tal:define="icon python: context.getIcon(1)"
               tal:attributes="src string:${utool}/${icon}">&nbsp;<span tal:replace="context/title_or_id"/></h1>

      <a href=""
           class="link-parent"
           tal:define="parent_url python:context.navigationParent(context, template.getId())"
           tal:condition="parent_url"
           tal:attributes="href parent_url"
           i18n:translate="go_to_parent_url">Up one level</a>

      <div class="label">Transaction Ref</div>
      <div class="field" tal:define="ref context/getTransactionRef">
           <tal:ref tal:condition="nocall: ref">
               <img src=""
                    tal:define="icon python: ref.getIcon(1)" 
                    tal:attributes="src string:${utool}/${icon}"/>
               <a tal:attributes="href string:${ref/absolute_url}"
                  tal:content="ref/title_or_id"/>
           </tal:ref>
           <span tal:condition="python: not ref">N/a</span>
      </div>

      <div class="label">Our Reference</div>
      <div class="field" tal:define="ref context/referenceObject">
           <tal:ref tal:condition="nocall: ref">
               <img src=""
                    tal:define="icon python: ref.getIcon(1)"
                    tal:attributes="src string:${utool}/${icon}"/>
               <a tal:attributes="href string:${ref/absolute_url}"
                  tal:content="ref/title_or_id"/>
           </tal:ref>
           <span tal:condition="python: not ref" tal:content="context/reference"/>
      </div>

      <div class="label">Their Reference(s)</div>
      <div class="field">
           <ul>
              <li tal:repeat="ref context/remote_ref" tal:content="ref"/>
           </ul>
      </div>

      <div class="label">Submitted</div>
      <div class="field" tal:content="python: context.toLocalizedTime(context.submitted, long_format=1)"/>

      <div class="label">Submitter</div>
      <div class="field" 
           tal:define="instigator context/instigator;
                       member python: context.portal_membership.getMemberById(instigator)">
          <span tal:condition="python: not member" tal:replace="instigator"/>
          <a class="link-user" tal:condition="python: member" 
             tal:attributes="href string:${portal_url}/prefs_user_details?userid=${instigator}"
             tal:content="instigator"/>
      </div>

      <tal:payee tal:define="payee python: context.payee" tal:condition="nocall: payee">
          <div class="label">Payee</div>
          <div class="field">
              <img src="" tal:attributes="src string:${portal_url}/creditcard.gif"/>
              <a href="payee" tal:content="payee"/>
          </div>
      </tal:payee>

      <div class="label">Amount</div>
      <div class="field" tal:content="context/amount"/>

      <fieldset tal:define="entries context/getReturnCodes" tal:condition="entries">

         <legend>History</legend>

       <table border="0" cellpadding="2" cellspacing="0" width="100%">
           <tr class="list-header" tal:condition="entries">
               <td class="list-item" valign="top"><label>Created</label></td>
               <td class="list-item" valign="top"><label>Instigator</label></td>
               <td class="list-item" valign="top"><label>Reference</label></td>
               <td class="list-item" valign="top"><label>Amount</label></td>
               <td class="list-item" valign="top"><label>RC</label></td>
               <td class="list-item" valign="top"><label>Sev</label></td>
     	       <td class="list-item" valign="top"><label>Message</label></td>
     	       <td class="list-item" valign="top"><label>Response</label></td>
           </tr>
           <tal:entries repeat="item_tuple entries">
               <tr class="row-hilite"
                   tal:define="item python:item_tuple[1]; item_id python: item_tuple[0]"
                   tal:attributes="class python: test(repeat['item_tuple'].index % 2, 'even', 'odd')">
                   <td class="list-item" valign="top" tal:on-error="string:" nowrap
                       tal:content="python: item.bobobase_modification_time().strftime('%Y-%m-%d %H:%M')"/>
                   <td class="list-item" valign="top" tal:content="item/instigator"/>
                   <td class="list-item" valign="top" tal:content="item/reference"/>
                   <td class="list-item" valign="top" nowrap tal:content="item/amount"/>
                   <td class="list-item" valign="top" tal:content="item/returncode"/>
                   <td class="list-item" valign="top" tal:content="item/prettySeverity"/>
                   <td class="list-item" valign="top">
                      <small tal:content="item/message"/>
                   </td>
                   <td class="list-item" valign="top">
                      <small class="formHelp" tal:content="item/response"/>
                    </td>
               </tr>
           </tal:entries>
         </table>


      </fieldset>

      <div tal:replace="structure provider:plone.documentactions">
           Document actions (print, sendto etc)
      </div>

  </div>
 
</body>
</html>
