(function(a){a.ZBlog.loader={div:null,start:function(e){e.empty();var c=a('<div class="loader"></div>').appendTo(e);var d=a('<img class="loading" src="/--static--/ztfy.blog/img/loading.gif" />').appendTo(c);a.ZBlog.loader.div=c},stop:function(){if(a.ZBlog.loader.div!=null){a.ZBlog.loader.div.replaceWith("");a.ZBlog.loader.div=null}}};a.ZBlog.form={check:function(c){a.ZBlog.ajax.check(a.fn.ajaxSubmit,"/--static--/ztfy.jqueryui/js/jquery-form.min.js",c)},hideStatus:function(){a("FORM DIV.status").animate({opacity:0,height:0,"margin-top":0,"margin-bottom":0,"padding-top":0,"padding-bottom":0},2000,function(){a(this).remove()})},reset:function(c){c.reset();a("input:first",c).focus()},add:function(d,c,e){a.ZBlog.form.check(function(){a.ZBlog.form._add(d,c,e)});return false},_add:function(d,c,f){if(typeof(tinyMCE)!="undefined"){tinyMCE.triggerSave()}var e={};if(c){e.parent=c}a(a.ZBlog.form).data("add_action",a(d).attr("action"));a.ZBlog.ajax.submit(d,a(d).attr("action")+"/@@ajax/ajaxCreate",e,f||a.ZBlog.form._addCallback,null,"json")},_addCallback:function(c,d){if(d=="success"){output=c.output;if(output=="ERRORS"){var g=a.ZBlog.dialog.getCurrent();a("DIV.status",g).remove();a("DIV.error",g).remove();var d=a("<div></div>").addClass("status");a("<div></div>").addClass("summary").text(c.errors.status).appendTo(d);var k=a("<ul></ul>").appendTo(d);for(var f=0;f<c.errors.errors.length;f++){var e=c.errors.errors[f];if(e.widget){a("<li></li>").text(e.widget+" : "+e.message).appendTo(k);var h=a("[id="+e.id+"]",g).parents("DIV.widget");var j=a(h).parents("DIV.row");h=h.clone(true);a("DIV.widget",j).remove();a("DIV.error",j).remove();a("<div></div>").addClass("error").append(a("<div></div>").addClass("error").text(e.message)).appendTo(j);h.appendTo(j)}else{a("<li></li>").text(e.message).appendTo(k)}}a("FORM",g).before(d)}else{if(output=="RELOAD"){window.location.reload()}else{if(output&&output.startsWith("<!-- OK -->")){a.ZBlog.dialog.close();a("#content").replaceWith(output)}else{var g=a.ZBlog.dialog.getCurrent();a("DIV.dialog",g).replaceWith(output);a("FORM",g).attr("action",a(a.ZBlog.form).data("add_action"));a("#form-buttons-add",g).bind("click",function(i){a.ZBlog.form.add(this.form,c.parent)});a("#form-buttons-cancel",g).bind("click",function(i){a.ZBlog.dialog.close()});a("#tabforms UL.tabs",g).tabs(a(g).selector+" DIV.panes > DIV")}}}}},edit:function(c,d,e){a.ZBlog.form.check(function(){a.ZBlog.form._edit(c,d,e)});return false},_edit:function(c,d,e){if(typeof(tinyMCE)!="undefined"){tinyMCE.triggerSave()}a(a.ZBlog.form).data("edit_action",a(c).attr("action"));a.ZBlog.ajax.submit(c,a(c).attr("action")+"/@@ajax/ajaxEdit",{},e||a.ZBlog.form._editCallback,null,"json")},_editCallback:function(m,e){if(e=="success"){var d=m.output;if(d=="RELOAD"){window.location.reload()}else{if(d=="REDIRECT"){a.ZBlog.dialog.close();window.location.href=m.target}else{if(d=="OK"){a.ZBlog.dialog.close();a("DIV.status").remove();a("DIV.required-info").after('<div class="status"><div class="summary">'+a.ZBlog.I18n.DATA_UPDATED+"</div></div>")}else{if(d=="NONE"){a.ZBlog.dialog.close();a("DIV.status").remove();a("DIV.required-info").after('<div class="status"><div class="summary">'+a.ZBlog.I18n.NO_UPDATE+"</div></div>")}else{if(d=="ERRORS"){var h=a.ZBlog.dialog.getCurrent();a("DIV.status",h).remove();a("DIV.error",h).remove();var e=a("<div></div>").addClass("status");a("<div></div>").addClass("summary").text(m.errors.status).appendTo(e);var k=a("<ul></ul>").appendTo(e);for(var f=0;f<m.errors.errors.length;f++){var j=m.errors.errors[f];if(j.widget){a("<li></li>").text(j.widget+" : "+j.message).appendTo(k);var g=a("[id="+j.id+"]",h).parents("DIV.widget");var l=a(g).parents("DIV.row");g=g.clone(true);a("DIV.widget",l).remove();a("DIV.error",l).remove();a("<div></div>").addClass("error").append(a("<div></div>").addClass("error").text(j.message)).appendTo(l);g.appendTo(l)}else{a("<li></li>").text(j.message).appendTo(k)}}a("FORM",h).before(e)}else{if(d&&d.startsWith("<!-- OK -->")){a.ZBlog.dialog.close();a("DIV.form").replaceWith(d);setTimeout("$.ZBlog.form.hideStatus();",2000)}else{var h=a.ZBlog.dialog.getCurrent();a("DIV.dialog",h).replaceWith(d);var c=a("FORM",h);c.attr("action",a(a.ZBlog.form).data("edit_action"));a("#"+c.attr("id")+"-buttons-dialog_submit",h).bind("click",function(i){a.ZBlog.form.edit(this.form)});a("#"+c.attr("id")+"-buttons-dialog_cancel",h).bind("click",function(i){a.ZBlog.dialog.close()});a("#tabforms UL.tabs",h).tabs(a(h).selector+" DIV.panes > DIV")}}}}}}}setTimeout("$.ZBlog.form.hideStatus();",2000)}};a.ZBlog.actions={showLoginForm:function(d){var c=a("SPAN.inputs",d);c.parents("LI:first").addClass("selected");c.show();a("INPUT",c).get(0).focus()},login:function(c){if(typeof(c)=="undefined"){c=a('FORM[name="login_form"]')}a.ZBlog.form.check(function(){a.ZBlog.actions._login(c)});return false},_login:function(c){a.ZBlog.ajax.submit(c,a(c).attr("action")+"/@@ajax/login",{},a.ZBlog.actions._loginCallback,a.ZBlog.actions._loginError,"json")},_loginCallback:function(c,d){if(d=="success"){if(c=="OK"){window.location.reload()}else{jAlert(a.ZBlog.I18n.BAD_LOGIN_MESSAGE,a.ZBlog.I18n.BAD_LOGIN_TITLE,null)}}},_loginError:function(d,c){jAlert(c,a.ZBlog.I18n.ERROR_OCCURED,null)},logout:function(){a.get(window.location.href+"/@@login.html/@@ajax/logout",a.ZBlog.actions._logoutCallback)},_logoutCallback:function(c,d){window.location.reload()}};a.ZBlog.code={resizeFrame:function(c){a(c).css("height",a("BODY",c.contentDocument).height()+20)}};var b=a("HTML").attr("lang")||a("HTML").attr("xml:lang");a.getScript("/--static--/ztfy.blog/js/i18n/"+b+".js");if(a.browser.safari){a.support.opacity=true}})(jQuery);