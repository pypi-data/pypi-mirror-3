<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      
      <title>
    Completion
 &mdash; sqlkit v0.9.5.1 documentation</title>
      
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sqlkit.css" type="text/css" />
    <link rel="stylesheet" href="../_static/print.css" type="text/css" media="print" />

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="sqlkit v0.9.5.1 documentation" href="../index.html" />
        <link rel="up" title="Editing data" href="editing.html" />
        <link rel="next" title="Validation" href="validation.html" />
        <link rel="prev" title="Editing data" href="editing.html" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '0.9.5.1',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>


<!-- <link rel="stylesheet" href="http://www.myjqueryplugins.com/plugins/jmenu/demo/jquery/jMenu.jquery.css" type="text/css" /> -->
      <link rel="stylesheet" href="../_static/jMenu.jquery.css" type="text/css" />

      <!-- <script type="text/javascript" src="http://www.myjqueryplugins.com/plugins/jmenu/demo/jquery/jMenu.jquery.js"></script> -->

      <script type="text/javascript">

	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-18221996-2']);
	_gaq.push(['_trackPageview']);

	(function() {
	  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();

      </script>
      <script type="text/javascript" src="../_static/jMenu.jquery.js"></script>
      <script type="text/javascript">
	      $(document).ready(function(){
		      $("#jMenu").jMenu({
			      ulWidth : '150',
			      effects : {
				      effectSpeedOpen : 300,
				      effectSpeedClose : 300,
				      effectTypeOpen : 'slide',
				      effectTypeClose : 'slide',
				      effectOpen : 'linear',
				      effectClose : 'linear'
			      },
			      TimeBeforeOpening : 100,
			      TimeBeforeClosing : 400,
			      animatedText : false,
			      paddingLeft: 1		});
	      })
      </script>
<!-- Preview -->
     <script type="text/javascript" src="../_static/imgpreview.js"></script>
     <script type="text/javascript">
       $(document).ready(function(){
           $('.preview').imgPreview();
       });
     </script>
     
     <!--[if !IE 7]>
	     <style type="text/css">
		     #wrap {display:table;height:100%}
	     </style>
     <![endif]-->
    </head>
    <body>
        




<div id="wrap">
    
<div id="header">

	<div class="logo"><a href="../misc/tour.html">
       <img src="../_static/sqlkit.png" align="left"  alt="Logo" border="0"/></a>
        </div>
	<div id="description">Acces to db made easy</div>
</div>


   <div style="clear:left;"></div>


<div >
	<ul id="jMenu">
            <li><a class="fNiv" href="../index.html" title="Home" 
                  >Home</a></li>

            <li><a li class="fNiv" href="contents.html"
                  title="Sqlkit - the python package" 
                  >Sqlkit</a>

	       <ul>
		 <li ><a href="contents.html"
		       title="Sqlkit - the python package" 
		       >Sqlkit</a></li>

		 <li ><a href="sqlwidget.html" title="Widgets" 
		       >Widgets</a>
		       <ul> 
			 <li ><a href="mask.html" title="Mask" 
			       >Mask view</a></li>
			 <li ><a href="table.html" title="Table" 
			       >Table view</a></li>
		       </ul>
                 </li>
		 <li ><a href="browsing.html" title="Browsing Data" 
		       >Browsing data</a>
		    <ul> 
		      <li ><a href="constraints.html" title="Constraints" 
			    >Constraints</a></li>
		      <li ><a href="filters.html" title="Filters" 
			    >Filters</a></li>
		      <li ><a href="totals.html" title="Totals" 
			    >Totals</a></li>
		    </ul>
                 </li>
		 <li ><a href="editing.html" title="Editing Data" 
		       >Editing data</a>
			 <ul> 
			   <li ><a href="#" title="Completion" 
				 >Completion</a></li>
			   <li ><a href="validation.html" title="Validation" 
				 >Validation</a></li>
			   <li ><a href="relationship.html" title="Relationships" 
				 >Relationships</a></li>
			 </ul>
		       </li>
		 <li ><a href="printing.html" title="Printing" 
		       ><span>Printing</span></a></li>
		 <li ><a href="advanced/contents.html" title="Advanced configuration" 
		       >Advanced configuration</a>
			 <ul> 
			   <li ><a href="advanced/fields.html" title="Fields" 
				 >Fields</a></li>
			   <li ><a href="advanced/views.html" title="Views" 
				 >Views</a></li>
			 </ul>
		       </li>

	       </ul>
            </li>

            <li><a class="fNiv" href="../misc/sqledit.html"
                  title="Sqledit GUI" 
                  >Sqledit GUI</a></li>

            <li><a class="fNiv" href="../misc/tutorials.html"
                  title="Support & tutorials" 
                  >Support & Tutorials</a>
	       <ul>
		 <li ><a href="../misc/sqledit.html"
		       title="Sqledit - the application" 
		       >Sqledit - the application</a></li>
		 <li ><a href="../misc/tour.html"
		       title="Sqlkit - the features'tour"
		       >Sqlkit - features' tour</a></li>
		 <li ><a href="../misc/sqledit.html"
		       title="Sqledit - the application" 
		       >Installing instructions</a></li>
		</ul> 
            </li>

            <li><a class="fNiv" href="../layout/contents.html" title="Layout"
                  >Layout</a></li>

            <li><a  class="fNiv"href="../misc/contents.html" title="Download" 
                  >Download</a>

	       <ul>
		 <li ><a href="../misc/contents.html"
		       title="Download"
		       >Download</a></li>
		 <li ><a href="http://sqlkit.argolinux.org/download/Changelog"  title="Changelog"
		       title="Changelog"
		       >Changelog</a></li>
		 <li ><a href="../misc/backward_incompatibilities.html"
		       title="Backward incompatibilities"
		       >Backward incompatibilities</a></li>
	       </ul>
            </li>



        </ul>
</div>
   <div style="clear:left;"></div>

    
    <div class="related">
      <ul>
	
<!-- <div class="prevnext"> -->
<!--    <li class="right"  style="margin-right: 10px">Indice -->
<!--      <a href="../genindex.html" title="Indice generale" -->
<!--                accesskey="I">indice</a></li> -->

        <li class="right">Prev:
        <a href="editing.html" title="previous chapter">Editing data</a></li>
        <li class="right">Next:
        <a href="validation.html" title="next chapter">Validation</a></li>
<!-- </div> -->


      </ul>

    </div>

    
  <div class="sphinxsidebar">
     <div class="sphinxsidebarwrapper">


	    <div class="topnav">
    <h3>Table of contents</h3>
		    <ul>
<li><a class="reference external" href="#">Completion</a><ul>
<li><a class="reference external" href="#foreign-key-description-search-field">foreign key description &amp; search field</a><ul>
<li><a class="reference external" href="#sqlkit-db-utils">sqlkit.db.utils</a></li>
<li><a class="reference external" href="#sqlkit-table">_sqlkit_table</a></li>
<li><a class="reference external" href="#format-and-str">format and __str__</a></li>
</ul>
</li>
<li><a class="reference external" href="#autocompletion">Autocompletion</a><ul>
<li><a class="reference external" href="#completion-and-return-in-tables">completion and Return in Tables</a></li>
</ul>
</li>
<li><a class="reference external" href="#group-by">Group_by</a></li>
<li><a class="reference external" href="#filtering-completion">Filtering completion</a><ul>
<li><a class="reference external" href="#dynamic-filters">dynamic filters</a></li>
<li><a class="reference external" href="#enum-mode-with-foreign-keys">enum mode with foreign keys</a></li>
<li><a class="reference external" href="#enum-mode-w-o-foreign-key">enum mode w/o foreign key</a></li>
<li><a class="reference external" href="#more-customization">more customization</a></li>
<li><a class="reference external" href="#customizing-description">customizing description</a></li>
</ul>
</li>
<li><a class="reference external" href="#module-sqlkit.widgets.common.completion">Behavior on completion with m2m/m2o relationship</a><ul>
<li><a class="reference external" href="#public-api">Public API</a></li>
</ul>
</li>
</ul>
</li>
</ul>

		<div class="clearboth"></div>
	    </div>



    <h3>Questions?</h3>

    <p>Subscribe to out mailing list <a href="http://groups.google.com/group/sqlkit">
       Google group</a>:</p>

    <form action="http://groups.google.com/group/sqlkit/boxsubscribe" style="padding-left: 1em">
      <input type="text" name="email" value="your@email"/>
      <input type="submit" name="sub" value="Subscribe" />
    </form>
    <div id="searchbox" style="display: none">

    <h3>Quick search</h3>
	<form class="search" action="../search.html" method="get">
	  <input type="text" name="q" size="18" />
	  <input type="submit" value="Search" />
	  <input type="hidden" name="check_keywords" value="yes" />

	  <input type="hidden" name="area" value="default" />
	</form>
	<p class="searchtip" style="font-size: 90%">
        Enter search terms or a module, class or function name.
	</p>
    <h3>License</h3>
	<img src="../_static/gplv3.png" alt="logo GPLv3">

    </div>
    <script type="text/javascript">$('#searchbox').show(0);</script>

     </div>
  </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">

            <div class="body">
                
<div class="section" id="completion">
<span id="id1"></span><h1>Completion<a class="headerlink" href="#completion" title="Permalink to this headline">¶</a></h1>
<img align="right" alt="../_images/completion.png" class="align-right" src="../_images/completion.png" />
<p>Completion is the way you can avoid writing too much if the system already
has your data. It means you write some text that will be used as filter in a
select statements of all possible values. Completion is active</p>
<ul class="simple">
<li>in text fields</li>
<li>in foreign key fields</li>
<li>in many2many fields with <a title="sqlkit.widgets.SqlTable.set_editable" class="reference external" href="table.html#sqlkit.widgets.SqlTable.set_editable"><tt class="xref docutils literal"><span class="pre">set_editable(True)</span></tt></a></li>
</ul>
<p>This operation has the following main actors:</p>
<blockquote>
<ol class="arabic simple">
<li>the <strong>search field</strong>: the field where what you type is searched for. In
the image, &#8216;f&#8217; is the typed text that will be searched for
in the field <em>last_name</em> that is the <em>search_field</em>. The letter &#8216;f&#8217;
will be used to filter the output. In this example the first_name
(Roberto, Federico, Françoise) is not part of the search, but is used
to better represent the possible matches.</li>
<li>the <strong>object that should be returned</strong>:<ul>
<li>the <em>string</em> to be used (as in enum mode, or in completion in values
used in the same column). This is only available for char/text fields
No validation is done by default on this field, the completed text
can be further edited.</li>
<li>the <em>foreign key</em> (frequently an <tt class="docutils literal"><span class="pre">id</span></tt>) along with a
<em>representation of the referenced record</em> (e.g.: the fullname of a
director). A check is made: there&#8217;s no way to input a text that is
not matched on the  remote field (see <a class="reference internal" href="#description"><em>foreign key description &amp; search field</em></a> below).</li>
<li>a <em>complete record</em> as when we edit a relation and we use a filter on
one field but we aim at setting a complete record. E.g.: we select an
actor from a list and we may be filtering the name or the nation. See
example 40d.</li>
</ul>
</li>
<li>the <strong>representation of the result</strong>: when using completion on a
ForeignKey or on an m2m relation, the representation of the possible
values needs to be taken. In the example of the image &#8216;Fellini&#8217; the the
representation of the referenced record that was referenced by a numeric
id.</li>
<li>the <strong>operator</strong> used when searching: normally <tt class="docutils literal"><span class="pre">regexp</span></tt> or
<tt class="docutils literal"><span class="pre">like</span></tt>. In the image here you see that &#8216;Truffault&#8217; is returned that does
not start with &#8216;F&#8217; but <em>contains</em> &#8216;f&#8217;.</li>
</ol>
</blockquote>
<p>The match of the completion has these <em>modes</em>:</p>
<blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">start:</th><td class="field-body">partially written text is used as a filter and completion must
match from the start of the field. It uses LIKE operator</td>
</tr>
<tr class="field"><th class="field-name">regexp:</th><td class="field-body">the match is done via regular expression if db supports it or via
LIKE operator adding <tt class="docutils literal"><span class="pre">%</span></tt> on both sides</td>
</tr>
<tr class="field"><th class="field-name">enum:</th><td class="field-body">any value matches. All possible values are shown. This mimics an enum
field. When there are only few values this may result more natural than
the others</td>
</tr>
</tbody>
</table>
</blockquote>
<p>Since completion implies a search that may return <em>many</em> records, it&#8217;s only
triggered on demand. Normal binding are:</p>
<blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">shift   Return:</th><td class="field-body">triggers &#8216;start&#8217; mode completion</td>
</tr>
<tr class="field"><th class="field-name">control Return:</th><td class="field-body">triggers &#8216;regexp&#8217; mode completion. This is also triggered
pressing the down arrow of a foreign key</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">shift control Return:</th></tr>
<tr><td>&nbsp;</td><td class="field-body">triggers &#8216;enum&#8217; mode</td>
</tr>
</tbody>
</table>
</blockquote>
<p>Pressing <tt class="docutils literal"><span class="pre">Alt</span></tt> along with the other keys will prevent any
<a class="reference internal" href="#filter-completion"><em>Filtering completion</em></a></p>
<div class="section" id="foreign-key-description-search-field">
<span id="description"></span><h2>foreign key description &amp; search field<a class="headerlink" href="#foreign-key-description-search-field" title="Permalink to this headline">¶</a></h2>
<p>When displaying data (and data shown by a completion are no exception), a
foreign key is substituted by a more descriptive text. Let&#8217;s see how to
customize it.</p>
<p>Make sure you understood the limitation on ForeignKey expressed in
<a class="reference external" href="../misc/tour.html#basic-limitations"><em>Basic assumptions and limitations</em></a></p>
<p>You can customize the way a record is represented by:</p>
<ul class="simple">
<li>using <a title="sqlkit.db.utils.TableDescr" class="reference external" href="advanced/dbutils.html#sqlkit.db.utils.TableDescr"><tt class="xref docutils literal"><span class="pre">sqlkit.db.utils.TableDescr</span></tt></a> class</li>
<li>writing configuration info in a database table (normally <tt class="docutils literal"><span class="pre">_sqlkit_table</span></tt>)</li>
</ul>
<div class="section" id="sqlkit-db-utils">
<h3>sqlkit.db.utils<a class="headerlink" href="#sqlkit-db-utils" title="Permalink to this headline">¶</a></h3>
<p>You would use module sqlkit.db.utils and create an object <a class="reference external" href="advanced/dbutils.html#tabledescr"><em>Table Description</em></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sqlkit.db.utils</span> <span class="kn">import</span> <span class="n">TableDescr</span>
<span class="n">utils</span><span class="o">.</span><span class="n">TableDescr</span><span class="p">(</span><span class="s">&#39;movie&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%(title)s</span><span class="s"> - </span><span class="si">%(year)s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</pre></div>
</div>
<p>metadata is necessary so that TableDescr knows where to go and auto-load
Table to introspect it if you don&#8217;t provide the search_field (see below)</p>
</div>
<div class="section" id="sqlkit-table">
<span id="id2"></span><h3>_sqlkit_table<a class="headerlink" href="#sqlkit-table" title="Permalink to this headline">¶</a></h3>
<p>It&#8217;s possible to write in the database the format string to be used in the
table. A table called <tt class="docutils literal"><span class="pre">_sqlkit_table</span></tt> is searched for (firebird backend
doesn&#8217;t allow leading &#8216;_&#8217; in table names so &#8216;_&#8217;  is stripped for it).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">search_field:</th><td class="field-body">The value of this field is used for the search. If no such field was
defined, the first char field of the tale is used, if it exists.</td>
</tr>
<tr class="field"><th class="field-name">format:</th><td class="field-body">the value of this field is used to represent the record, e.g.: &#8220;%(title)s %(year)s&#8221;</td>
</tr>
</tbody>
</table>
<p>You can easily edit this table using <a class="reference external" href="../misc/sqledit.html#sqledit"><em>Sqledit - the standalone program to browse and edit data</em></a></p>
</div>
<div class="section" id="format-and-str">
<h3>format and __str__<a class="headerlink" href="#format-and-str" title="Permalink to this headline">¶</a></h3>
<p>When SqlWidget creates a class on the fly it looks for the &#8216;format&#8217; field to
add a __str__ method to the class, so that this representation is used
whenever suitable (e.g.: when a filter action is performed in a Mask)</p>
</div>
</div>
<div class="section" id="autocompletion">
<span id="autostart"></span><h2>Autocompletion<a class="headerlink" href="#autocompletion" title="Permalink to this headline">¶</a></h2>
<p>You can force completion to start after n chars has been entered setting the
completion object <tt class="docutils literal"><span class="pre">autostart</span></tt> value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span> <span class="o">=</span> <span class="n">SqlMask</span><span class="p">(</span><span class="s">&#39;movie&#39;</span><span class="p">,</span> <span class="n">dbproxy</span><span class="o">=</span><span class="n">db</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">director_id</span><span class="o">.</span><span class="n">autostart</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Completion will be recalculated every time the written string is shorter that
the last text that triggered the completion.</p>
<p>Take care not to use a little value for <tt class="docutils literal"><span class="pre">autostart</span></tt> on large tables.</p>
<div class="section" id="completion-and-return-in-tables">
<h3>completion and Return in Tables<a class="headerlink" href="#completion-and-return-in-tables" title="Permalink to this headline">¶</a></h3>
<p>There is another situation in which a completion is started
automatically. When editing a foreign key (or an m2m): if a <tt class="docutils literal"><span class="pre">Return</span></tt> is
hit, a select is issued to check if it&#8217;s a valid value and if not that value
is used as base for completion. The difference from triggering a normal
completion is that if a valid value is found, no further completion is done.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Since completion uses the already written chars to filter possible solution,
if you further delete such chars you are not seeing all the real possible
solutions but only the already retrieved ones. You can request a new
completion...</p>
</div>
</div>
</div>
<div class="section" id="group-by">
<h2>Group_by<a class="headerlink" href="#group-by" title="Permalink to this headline">¶</a></h2>
<p>There is also en easy possibility to add grouping of completion via a
foreign_key attribute. It&#8217;s enough to set the group_by attribute of
completion_group_by:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">director_id</span><span class="o">.</span><span class="n">group_by</span> <span class="o">=</span> <span class="s">&#39;nation&#39;</span>
</pre></div>
</div>
<img alt="../_images/completion_group_by.png" src="../_images/completion_group_by.png" />
</div>
<div class="section" id="filtering-completion">
<span id="filter-completion"></span><h2>Filtering completion<a class="headerlink" href="#filtering-completion" title="Permalink to this headline">¶</a></h2>
<p>You can programmatically decide to filter what a completion returns in a
very easy way using <a class="reference external" href="constraints.html#constraints"><em>django like syntax</em></a> (the same used
to set constraints):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span> <span class="o">=</span> <span class="n">SqlTable</span><span class="p">(</span><span class="n">Movie</span><span class="p">,</span><span class="o">...</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">title__icontains</span><span class="o">=</span><span class="s">&#39;love&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>this line will instruct the completion to only show titles that contain the
world &#8220;love&#8221;.</p>
<p>Filters on a field that is a foreign key will be relative to the related
table:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># nation_cod is a field_name of the table</span>
<span class="n">t</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">director_id</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">nation_cod</span><span class="o">=</span><span class="s">&#39;ITA&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>will build a constraint on the <strong>director</strong> table filtering only italian
directors.</p>
<p>If you set relation on your Director class as in:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Director</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">nation_cod</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Nation</span><span class="o">.</span><span class="n">cod</span><span class="p">))</span>
    <span class="n">nation</span> <span class="o">=</span> <span class="n">relation</span><span class="p">(</span><span class="n">Nation</span><span class="p">)</span>
</pre></div>
</div>
<p>you can set filter on the completion based on this relation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## nation__code (note the double underscore!!!) will trigger</span>
<span class="c">## a filter on the cod field_name of the relation nation</span>
<span class="n">t</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">director_id</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">nation__cod</span><span class="o">=</span><span class="s">&#39;ITA&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="dynamic-filters">
<h3>dynamic filters<a class="headerlink" href="#dynamic-filters" title="Permalink to this headline">¶</a></h3>
<p>It&#8217;s also possible to set a &#8220;dynamic filter&#8221; i.e. a filter depending on the
value already of another field:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">last_name</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">nation</span><span class="o">=</span><span class="s">&#39;$nation&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case the value of $nation will be set using <tt class="docutils literal"><span class="pre">t.get_value('nation')</span></tt>
In case you have a related table you can go back to the main table:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span><span class="o">.</span><span class="n">related</span><span class="o">.</span><span class="n">movie</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">director_id</span><span class="o">=</span><span class="s">&#39;$main.director_id&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="enum-mode-with-foreign-keys">
<h3>enum mode with foreign keys<a class="headerlink" href="#enum-mode-with-foreign-keys" title="Permalink to this headline">¶</a></h3>
<p>Enum mode is the way you can mimic a standard enumeration field: you see all
fields independently from what you have in your entry. This is more natural
in some circumstances if you only have few values.</p>
<p>You can get this behavior all the times just hitting
Control-Shift-Return or in ForeignKey fields double-clicking the down arrow.
Since you probably want this depending on the values
of the table you can programmatically choose to serve completion <em>only</em> via
this way setting <tt class="docutils literal"><span class="pre">force_enum</span> <span class="pre">=</span> <span class="pre">True</span></tt> on the completion:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">director_id</span><span class="o">.</span><span class="n">force_enum</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
</div>
<div class="section" id="enum-mode-w-o-foreign-key">
<h3>enum mode w/o foreign key<a class="headerlink" href="#enum-mode-w-o-foreign-key" title="Permalink to this headline">¶</a></h3>
<p>There is another way that mimics enum mode, i.e. setting directly the
possible completion values via the method
<a title="sqlkit.widgets.common.completion.SimpleCompletion.set_values" class="reference internal" href="#sqlkit.widgets.common.completion.SimpleCompletion.set_values"><tt class="xref docutils literal"><span class="pre">set_values</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">set_values</span><span class="p">([</span><span class="s">&#39;open&#39;</span><span class="p">,</span> <span class="s">&#39;closed&#39;</span><span class="p">,</span> <span class="s">&#39;waiting for input&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">a_function_that_returns_possible_values</span><span class="p">)</span>
</pre></div>
</div>
<p>the signature of this function must be:</p>
<dl class="function">
<dt id="my_values">
<tt class="descname">my_values</tt><big>(</big><em>value</em><big>)</big><a class="headerlink" href="#my_values" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameter:</th><td class="field-body"><em>value</em> &#8211; the value that may have been written in the entry, used to
filter values, as usual</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="more-customization">
<h3>more customization<a class="headerlink" href="#more-customization" title="Permalink to this headline">¶</a></h3>
<p>There are normally 2 possible completion according to the filter level.
An example can better clarify: suppose you have an entry where you are supposed
to enter a username. You set a filter on <em>active</em> users, now you need to fix
an old record that really has a user that is no longer <em>active</em>. You need to
loosen you filtering criterion momentarily. You can do that Pressing the
<tt class="docutils literal"><span class="pre">Alt</span></tt> key along with normal <tt class="docutils literal"><span class="pre">Ctrl-Enter</span></tt> or <tt class="docutils literal"><span class="pre">Shift-Enter</span></tt></p>
<p>These two filtering criteria are stored in two <tt class="docutils literal"><span class="pre">session.query</span></tt> objects and
are stored in the completion with attributes:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">filtered_query:</th><td class="field-body">the query with filters. You set filters on this query with
<tt class="docutils literal"><span class="pre">filter()</span></tt> method. If a <tt class="docutils literal"><span class="pre">filtered_query</span></tt> already_exists,
filters are added, otherwise it&#8217;s written from <tt class="docutils literal"><span class="pre">query</span></tt></td>
</tr>
<tr class="field"><th class="field-name">query:</th><td class="field-body">the default query, used when no filter is desired (<tt class="docutils literal"><span class="pre">Alt</span></tt> is pressed).
You set filters on this adding argument &#8220;main_query = True&#8221; to
<tt class="docutils literal"><span class="pre">.filter(main_query=True)</span></tt>.</td>
</tr>
</tbody>
</table>
<p>Of course each one can be customized with the normal sqlalchemy syntax also.</p>
<p>Note that if you have both filters (with and without main_query option)
order makes difference as <tt class="docutils literal"><span class="pre">filtered_query</span></tt> is built based on <tt class="docutils literal"><span class="pre">query</span></tt>
when .filter is called for the first time. If you change <tt class="docutils literal"><span class="pre">query</span></tt> after
calling <tt class="docutils literal"><span class="pre">.filter()</span></tt> you end up with unrelated filter condition (that&#8217;s
allowed as you may really want this).</p>
<p>Remember that <a class="reference external" href="validation.html#validation"><em>Validation</em></a> is a completely different mechanism than
completion even if it&#8217;s not possible to add a field that doesn&#8217;t come from a
completion.</p>
</div>
<div class="section" id="customizing-description">
<span id="id3"></span><h3>customizing description<a class="headerlink" href="#customizing-description" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">query</span></tt> attribute of the completion determines which fields will be
present in the completions list, the <tt class="docutils literal"><span class="pre">format</span></tt> attribute decides how it
will be represented. Default value is determined as described
<a class="reference internal" href="#description"><em>above</em></a>, but you can customize it as you prefer, as far
as you use fields present in the query. As an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">director_id</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%(first_name)s</span><span class="s"> </span><span class="si">%(last_name)s</span><span class="s"> -- </span><span class="si">%(nation)s</span><span class="s">&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="module-sqlkit.widgets.common.completion">
<h2>Behavior on completion with m2m/m2o relationship<a class="headerlink" href="#module-sqlkit.widgets.common.completion" title="Permalink to this headline">¶</a></h2>
<p>When the completion is in a SqlTable that represents a not editable m2m
relationship (as <tt class="docutils literal"><span class="pre">actors</span></tt> would be for <tt class="docutils literal"><span class="pre">movies</span></tt>), the completion does
not simply add the single field but substitutes the whole record.</p>
<p>On such a relationship table&#8217;s completion you can set filter that will act
on all fields. Rationale: if you have a movie/actor relationship and set a
constraint on actors so that only female should be selected, you probably
want to retain that filter independently from the fact that you select the
nation, the first or the last name.</p>
<div class="section" id="public-api">
<h3>Public API<a class="headerlink" href="#public-api" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="sqlkit.widgets.common.completion.SimpleCompletion">
<em class="property">class </em><tt class="descclassname">sqlkit.widgets.common.completion.</tt><tt class="descname">SimpleCompletion</tt><big>(</big><em>master</em>, <em>widget</em>, <em>field_name</em><big>)</big><a class="headerlink" href="#sqlkit.widgets.common.completion.SimpleCompletion" title="Permalink to this definition">¶</a></dt>
<dd><p>An object that hold all the information on how to retrieve possible completions in simple cases</p>
<dl class="attribute">
<dt id="sqlkit.widgets.common.completion.SimpleCompletion.autostart">
<tt class="descname">autostart</tt><a class="headerlink" href="#sqlkit.widgets.common.completion.SimpleCompletion.autostart" title="Permalink to this definition">¶</a></dt>
<dd>A possible interger stating after how many chars completion should start automatically</dd></dl>

<dl class="attribute">
<dt id="sqlkit.widgets.common.completion.SimpleCompletion.force_enum">
<tt class="descname">force_enum</tt><a class="headerlink" href="#sqlkit.widgets.common.completion.SimpleCompletion.force_enum" title="Permalink to this definition">¶</a></dt>
<dd>Modify output: show all options regardless of what has been already written in the field</dd></dl>

<dl class="attribute">
<dt id="sqlkit.widgets.common.completion.SimpleCompletion.group_by">
<tt class="descname">group_by</tt><a class="headerlink" href="#sqlkit.widgets.common.completion.SimpleCompletion.group_by" title="Permalink to this definition">¶</a></dt>
<dd>The field_name on which the output should be grouped.
<tt class="docutils literal"><span class="pre">field_name</span></tt> will be added to the request and used to group completion options.</dd></dl>

<dl class="attribute">
<dt id="sqlkit.widgets.common.completion.SimpleCompletion.filtered_query">
<tt class="descname">filtered_query</tt><a class="headerlink" href="#sqlkit.widgets.common.completion.SimpleCompletion.filtered_query" title="Permalink to this definition">¶</a></dt>
<dd>The query that will be issued upon completion request. You can customize it as for <a title="query" class="reference external" href="sqlwidget.html#query"><tt class="xref docutils literal"><span class="pre">query</span></tt></a></dd></dl>

<dl class="attribute">
<dt id="sqlkit.widgets.common.completion.SimpleCompletion.query">
<tt class="descname">query</tt><a class="headerlink" href="#sqlkit.widgets.common.completion.SimpleCompletion.query" title="Permalink to this definition">¶</a></dt>
<dd>The query that will be issued upon completion request if <tt class="docutils literal"><span class="pre">Alt</span></tt> is pressed (i.e.: not
all filters applied). You can add filters width <a title="sqlkit.widgets.common.completion.SimpleCompletion.filter" class="reference internal" href="#sqlkit.widgets.common.completion.SimpleCompletion.filter"><tt class="xref docutils literal"><span class="pre">filter()</span></tt></a> or via SqlAlchemy syntax.</dd></dl>

<dl class="method">
<dt id="sqlkit.widgets.common.completion.SimpleCompletion.filter">
<tt class="descname">filter</tt><big>(</big><em>OR=False</em>, <em>main_query=False</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#sqlkit.widgets.common.completion.SimpleCompletion.filter" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameter:</th><td class="field-body"><em>main_query</em> &#8211; add the filter to the main query</td>
</tr>
</tbody>
</table>
<p>Add filters to the completion. Filters must be expressed in django-like syntax
Value can be in the form <tt class="docutils literal"><span class="pre">$field_name</span></tt> (see below):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span> <span class="o">=</span> <span class="n">SqlMask</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">field1</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cod</span><span class="o">=</span><span class="s">&#39;$field2&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>would request</p>
<blockquote>
<ol class="arabic simple">
<li>to retrieve the value of field2 via t.get_value(field2)</li>
<li>to add .filter(field2 = value) to the query that retrieves the possible
completions</li>
</ol>
</blockquote>
<p>Filter conditions are relative <em>to the mapper of the completion</em>: for a completion
on a ForeignKey it&#8217;s the referenced table&#8217;s mapper. To state it again and referring
to example 40 of the demo: if you edit movie table and complete on diector_id, the
following code would select the <tt class="docutils literal"><span class="pre">nation</span></tt> of the director in table <tt class="docutils literal"><span class="pre">director</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">director_id</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">nation</span><span class="o">=</span><span class="s">&#39;IT&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In point 1. above <tt class="docutils literal"><span class="pre">t.get_value()</span></tt> is relative to
the SqlWidget in which the completion is requested.  This is relevant
when related tables are present in the mask. Field value of the main
mask can be referred to as <tt class="docutils literal"><span class="pre">$main.field_name</span></tt></p>
<blockquote>
<ol class="arabic">
<li><p class="first">each token starting with <tt class="docutils literal"><span class="pre">$</span></tt> as in <tt class="docutils literal"><span class="pre">$title</span></tt> is stripped
from the <tt class="docutils literal"><span class="pre">$</span></tt> and the remaining part is used as field_name and
t.get_value(field_name) is used instead</p>
</li>
<li><p class="first">if the field_name part starts with <tt class="docutils literal"><span class="pre">main.</span></tt> (as in <tt class="docutils literal"><span class="pre">$main.title</span></tt>)
t.get_value(field_name) is not issued in the active SqlWidget but in
the SqlWidget pointed to by <tt class="docutils literal"><span class="pre">relationship_leader</span></tt></p>
<p>This in general is the main SqlMask holding possibly different m2m
tables. This makes it possible for rows in an m2m table to complete
only with values related to the referring header.</p>
</li>
</ol>
</blockquote>
</dd></dl>

<dl class="method">
<dt id="sqlkit.widgets.common.completion.SimpleCompletion.set_values">
<tt class="descname">set_values</tt><big>(</big><em>values</em><big>)</big><a class="headerlink" href="#sqlkit.widgets.common.completion.SimpleCompletion.set_values" title="Permalink to this definition">¶</a></dt>
<dd><p>Set explicitely the possible completion values.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameter:</th><td class="field-body"><em>values</em> &#8211; a list of values or a callable that will return a list
of possible values</td>
</tr>
</tbody>
</table>
<p>Can be a list or a callable that will be called to get the
real list of values passing the (possible) text in the entry
as parameter</p>
</dd></dl>

<dl class="attribute">
<dt id="sqlkit.widgets.common.completion.SimpleCompletion.attrs">
<tt class="descname">attrs</tt><a class="headerlink" href="#sqlkit.widgets.common.completion.SimpleCompletion.attrs" title="Permalink to this definition">¶</a></dt>
<dd>a list of attributes that will be added to the object retrieved to fill the completion choices.
You can add attributes if you need to have more data e.g. in <a class="reference external" href="sqlwidget.html#on-completion"><em>completion hooks</em></a></dd></dl>

</dd></dl>

<dl class="class">
<dt id="sqlkit.widgets.common.completion.FkeyCompletion">
<em class="property">class </em><tt class="descclassname">sqlkit.widgets.common.completion.</tt><tt class="descname">FkeyCompletion</tt><big>(</big><em>master</em>, <em>widget</em>, <em>*args</em>, <em>**kw</em><big>)</big><a class="headerlink" href="#sqlkit.widgets.common.completion.FkeyCompletion" title="Permalink to this definition">¶</a></dt>
<dd>A completion that follows foreign key to get values to complete and to substitute for lookup.
Inherits from <a title="sqlkit.widgets.common.completion.SimpleCompletion" class="reference internal" href="#sqlkit.widgets.common.completion.SimpleCompletion"><tt class="xref docutils literal"><span class="pre">SimpleCompletion</span></tt></a></dd></dl>

<dl class="class">
<dt id="sqlkit.widgets.common.completion.M2mCompletion">
<em class="property">class </em><tt class="descclassname">sqlkit.widgets.common.completion.</tt><tt class="descname">M2mCompletion</tt><big>(</big><em>*args</em>, <em>**kw</em><big>)</big><a class="headerlink" href="#sqlkit.widgets.common.completion.M2mCompletion" title="Permalink to this definition">¶</a></dt>
<dd><p>A completion that completes on the whole line: each field can be used to choose the same
record. It&#8217;s not possible in this mode to compose a new record field by field.</p>
<p>The lookup of foreign key values needs a different table than the one used to complete.
This is called table_lookup/column_lookup.</p>
<p>Inherits from <a title="sqlkit.widgets.common.completion.FkeyCompletion" class="reference internal" href="#sqlkit.widgets.common.completion.FkeyCompletion"><tt class="xref docutils literal"><span class="pre">FkeyCompletion</span></tt></a></p>
</dd></dl>

</div>
</div>
</div>


            </div>
        </div>
     </div>
   </div>

        
</div> <!-- wrap -->

            <div class="bottomnav footer">
                <div class="doc_copyright">
                Alessandro Dentella -- Copyright 2006-2007-2008-2009-2010
		  Sqlkit release 0.9.5.1
<!--                 % if hasdoc('copyright'): -->
<!--                     &copy; <a href="../copyright.html">Copyright</a> 2008, Sandro Dentella. -->
<!--                 % else: -->
<!--                     &copy; Copyright 2008, Sandro Dentella. -->
<!--                 % endif -->
                    creato usando  <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.4.
                </div>
            </div>
        












<br style="clear: left" />

    </body>
</html>




