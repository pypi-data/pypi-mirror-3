<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="bastionledger">
 
<body>
  <div metal:fill-slot="main" tal:define="entries here/orderItemValues;
                     utool context/@@plone_portal_state/portal_url;
                                          account here/blAccount">

      <h1><img src="" alt="" tal:define="icon python:context.getIcon(1)" 
               tal:attributes="src string:${utool}/${icon}">&nbsp;<span tal:replace="context/Title | context/getId"/></h1>

        <a href=""
           class="link-parent"
           tal:define="ledger_url python:context.navigationParent(context, template.getId())"
           tal:condition="ledger_url"
           tal:attributes="href ledger_url"
           i18n:translate="go_to_ledger_url">
        Up one Level
        </a>
      
      <form action="" name="edit_form" method="post"
            tal:attributes="action string:${context/getId}/${template/getId}">

        <metal:order define-macro="order">
         <table summary="" border="0" cellspacing="0" cellpadding="2" width="100%">
           <tr>
               <td valign="top">
                   <div class="field"
                        tal:define="error errors/title|nothing;
                                    Title request/title | here/title;"
                        tal:attributes="class python:test(error, 'field error', 'field')">

                   <label for="order_date" i18n:translate="label_title">Title</label>

                   <div tal:content="error">Validation error output</div>

                   <input type="text" id="title" name="title" value="" size="35"
                           tal:attributes="value Title;"/>

                   </div>
                   <div class="field"
                        tal:define="error errors/contact|nothing;
                                    Contact request/contact | here/contact;"
                        tal:attributes="class python:test(error, 'field error', 'field')">

                   <label for="order_date" i18n:translate="label_contact">Contact Name</label>

                   <div tal:content="error">Validation error output</div>

                   <input type="text" id="contact" name="contact" value="" size="35"
                           tal:attributes="value Contact;"/>

                   </div>
                   <div class="field"
                        tal:define="error errors/email|nothing;
                                    Email request/email | here/email;"
                        tal:attributes="class python:test(error, 'field error', 'field')">

                   <label for="order_date" i18n:translate="label_email">Contact Email</label>

                   <div tal:content="error">Validation error output</div>

                   <input type="text" id="email" name="email" value="" size="35"
                           tal:attributes="value Email;"/>

                   </div>

               </td>
               <td valign="top">
                   <div class="field"
                        tal:define="error errors/taxincluded|nothing;
                                    Taxincluded request/taxincluded | here/taxincluded;"
                        tal:attributes="class python:test(error, 'field error', 'field')">

                   <label for="order_date" i18n:translate="label_order_date">Tax Included</label>

                   <span class="fieldRequired" title="Required"
                         i18n:attributes="taxincluded"
                         i18n:translate="label_required">(Required)</span>

                   <div tal:content="error">Validation error output</div>

                   <input type="checkbox" id="taxincluded" name="taxincluded:boolean" value="1"
                           tal:attributes="checked Taxincluded;"/>

                   </div>
                   <div class="field"
                        tal:define="error errors/discount|nothing;
                                    Discount request/discount | python: here.discount * 100;"
                        tal:attributes="class python:test(error, 'field error', 'field')">

                   <label for="order_date" i18n:translate="label_discount">Discount</label>
                   <label>&nbsp;(%)</label>

                   <div tal:content="error">Validation error output</div>

                   <input type="text" id="discount" name="discount:float" value="" size="5"
                           tal:attributes="value Discount;"/>

                   </div>
               </td>
           </tr>
        </table>


        <div class="field"
             tal:define="error errors/notes|nothing;
                         Notes request/notes | here/notes;"
             tal:attributes="class python:test(error, 'field error', 'field')">

           <label for="notes" i18n:translate="label_notes">Notes</label>

           <div tal:content="error">Validation error output</div>

           <textarea id="notes" name="notes:text" value=""
                   tal:content="Notes"/>

        </div>
 
       </metal:order>

       <metal:orderdates metal:define-macro="orderdates">
                   <div class="field"
                        tal:define="error errors/orderdate|nothing;
                                    Orderdate request/orderdate | here/orderdate;
                                    inputvalue Orderdate;
                                    formname string:edit_form;
                                    show_hm python: False;
                                    inputname string:orderdate;"
                        tal:attributes="class python:test(error, 'field error', 'field')">

                   <label for="order_date" i18n:translate="label_order_date">Order Date</label>

                   <span class="fieldRequired" title="Required"
                         i18n:attributes="orderdate"
                         i18n:translate="label_required">(Required)</span>

                   <div tal:content="error">Validation error output</div>
                    <span metal:use-macro="here/calendar_macros/macros/calendarDatePickerBox"/>

                   </div>
                   <div class="field"
                        tal:define="error errors/reqdate|nothing;
                                    Reqdate request/reqdate | here/reqdate;
                                    inputvalue Reqdate;
                                    formname string:edit_form;
                                    show_hm python: False;
                                    inputname string:reqdate;"
                        tal:attributes="class python:test(error, 'field error', 'field')">

                   <label for="order_date" i18n:translate="label_order_date">Required Date</label>

                   <span class="fieldRequired" title="Required"
                         i18n:attributes="reqdate"
                         i18n:translate="label_required">(Required)</span>

                   <div tal:content="error">Validation error output</div>
                   <span metal:use-macro="here/calendar_macros/macros/calendarDatePickerBox"/>

                   </div>
       </metal:orderdates>

       <metal:orderlines define-macro="orderlines">
            <!-- need VLSI index searching here!! -->
            <div class="field">
               <select name="part_ids:list" multiple size="3">
                    <option tal:repeat="part here/availableParts"
                            tal:attributes="value part/getId"
                            tal:content="string:${part/getId} - ${part/title}"/>
               </select>
            </div>

            <div class="formControls">
                <input class="standalone"  type="submit"
                         name="form.button.Add"
                       value=" Add Items " i18n:attributes="value" />
            </div>

        <table summary="" border="0" cellpadding="2" cellspacing="0" width="100%" 
               tal:condition="entries"
 	       tal:define="freight here/blorder_freight">
            <tr class="row">
                <td width="16" class="field">&nbsp;</td>
                <td width="25" class="field"><label>Type</label></td>
                <td class="field"><label>Description</label></td>
                <td class="field" align="right"><label>Quantity</label></td>
                <td class="field" align="right"><label>Unit Price</label></td>
                <td class="field" align="right"><label>Amount</label></td>
                <td>&nbsp;</td>
             </tr>
             <tr tal:repeat="item entries" class="row"
                 tal:attributes="class python:test(repeat['item'].odd(), 'odd', 'even')">
                 <td class="field" valign="top">
                      <input type="hidden" name="parts.id:records" value=""
                             tal:attributes="value item/getId"/>
                      <input type="checkbox" name="ids:list" value=""
                                   tal:attributes="value item/getId"/>
                 </td>
                 <td class="field" valign="top">
                     <img border="0" src=""  tal:define="icon python:item.getIcon(1)" 
                          tal:attributes="src string:${utool}/${icon}"/>
                 </td>
                 <td class="field" valign="top">
                     <div tal:define="part python: item.blPart()">
                         <a href="" tal:attributes="href part/absolute_url" tal:content="item/title"/>
                     </div>
                     <textarea name="parts.note:text:records" rows="2" cols="20"
                                tal:content="item/note"/>
                 </td>
                 <td class="field" align="right" valign="top">
                      <input type="text" name="parts.quantity:float:records" value="" size="10"
                             align="right" tal:attributes="value item/quantity"/>
                 </td>
                 <td class="field" align="right" nowrap valign="top">
                      <input type="text" name="parts.unit:currency:records" value="" size="12"
                             align="right" tal:attributes="value item/unit"/>
                 <td class="field" align="right" valign="top" nowrap tal:content="item/calculateGrossPrice"/>
                 <td valign="top">&nbsp;</td>
             </tr>
             <tr>
                   <td colspan="4" class="formControls">
                       <input class="standalone"  type="submit"
                                name="form.button.Delete"
                              value=" Delete " i18n:attributes="value" />
                   </td>
                   <td class="field" align="right"><label>Total</label></td>
                   <td class="field" align="right" nowrap>
                      <label tal:content="here/getGross"/></td>
                   <td class="field">&nbsp;</td>
                </tr>
                <tal:block tal:condition="here/discount">
                    <tr class="field">
                        <td colspan="5" class="field" align="right">Discount</td>
                        <td class="field" align="right"
                            tal:content="python: here.getGross() * here.discount"/>
                    </tr>
                 </tal:block>
                 <tal:block tal:condition="not: here/taxincluded">
                    <tr class="field" 
                        tal:repeat="acct python: here.Ledger.accountsForTag('sales_tax')" 
                        tal:on-error="string:" >
                       <td colspan="5" class="field" align="right"><em tal:content="acct/title"/></td>
                       <td class="field" align="right" tal:content="python: here.calculateTax(acct)"/>
                       <td/>
                    </tr>
                 </tal:block>
                 <tal:block tal:condition="python: freight > 0">
                   <tr class="form-element">
                      <td colspan="5" class="field" align="right"><i>plus freight</i></td>
                      <td class="field" align="right"
                          tal:content="freight"/>
                      <td/>
                   </tr>
                 </tal:block>
                 <tal:block tal:condition="python: freight > 0 or here.discount or not here.taxincluded">
                    <tr>
                       <td colspan="4"/>
                       <td class="field" align="right"><label>Net</label></td>
                       <td class="field" align="right"><label tal:content="here/getNet"/></td>
                       <td class="field">&nbsp;</td>
                    </tr>
                 </tal:block>
             </table>

         </metal:orderlines>

         <div class="formControls">
              <input class="context"  type="submit" tal:condition="entries"
                       name="form.button.Edit"
                     value=" Edit " i18n:attributes="value" />
         </div>

         <input type="hidden" name="form.submitted" value="1" />

      </form>

  </div>
 
</body>
</html>
