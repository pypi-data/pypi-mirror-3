<tal:block 
    tal:define="value string:;isBinary python: False;
                portal_url python:here.portal_url.getPortalObject().absolute_url();
                noParagraphs python:int(here.REQUEST.get('noParagraphs'))+1;
                here python:context.portal_factory._getTempFolder('MultiParagraphPage')['tempobj'];
                field python:here.Schema()['text'];
                widget nocall:field/widget;
                inputvalue string:;
                inputname here/REQUEST/inputname;
                fieldName inputname;
                hashedId string:newparagraph_$inputname;
                editorid string:kupu-editor-${inputname};
                member context/portal_membership/getAuthenticatedMember;
                wysiwyg_editor python:member.getProperty('wysiwyg_editor', '').lower() or context.portal_properties.site_properties.getProperty('default_editor', '').lower();

                ">
              <h3><tal:block i18n:translate="multiparagraphpage_paragraph_no" i18n:domain="valentine.multiparagraphpage">Paragraph no</tal:block> <tal:block tal:content="noParagraphs"/></h3>
              <input type="hidden" 
                     tal:attributes="name  python:'__order__%s'%(fieldName);
                                     value noParagraphs"/>
              <tal:area_format>
                  <metal:block use-macro="here/widgets/visual/macros/area_format" />
              </tal:area_format>
              <metal:use use-macro="here/widgets/epoz/macros/edit_area">
                <metal:fill fill-slot="text_format"/>
              </metal:use>
              <hr/>
  <div tal:attributes="id hashedId" 
       tal:define="inputname field/getHashedName;
                   kupuTimeoutScript string:initPloneKupu('kupu-editor-${inputname}');
                   tinymceTimeoutScript string:jq.getScript('tiny_mce_gzip.js');
                   timeoutScript python:wysiwyg_editor=='kupu' and kupuTimeoutScript or (wysiwyg_editor=='tinymce' and tinymceTimeoutScript) or ''">
    <input type="button" tal:attributes="onclick string:jq('#${hashedId}').load('${context/absolute_url}/@@newparagraph', {'noParagraphs':'$noParagraphs', 'inputname':'$inputname'}, function() { setTimeout(function() { $timeoutScript}, 300) })" value="Add paragraph"/>
  </div>  
</tal:block>
