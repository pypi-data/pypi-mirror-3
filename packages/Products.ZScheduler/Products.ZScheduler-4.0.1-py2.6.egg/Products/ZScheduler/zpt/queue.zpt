<html tal:replace="structure context/manage_page_header"/>

  <div tal:omit-tag=""
       tal:define="results context/events;
                   results_start python:0;
                   results_start request/results_start | results_start;
                   Batch python:modules['ZTUtils'].Batch;
                   mq python:modules['ZTUtils'].make_query;
                   results_batch python:Batch(results, context.queue_batch_size, results_start, orphan=2)">

    <span tal:replace="structure here/manage_tabs"/>
 
    <br/>

    <form action="" tal:attributes="action request/URL1" name="objectItems">
       <table width="100%">
          <tr>
            <td class="form-text">
                 ZScheduler contains <span tal:replace="python: len(results)"/> event(s).
            </td>
            <td class="form-text">
                 Now is <span class="form-label" tal:content="python: DateTime().toZone(context.timezone)"/>
            </td>
            <td align="right" class="form-element">
                 <input type="submit" name="manage_refresh:method" value=" Refresh Queue"/>
                 <input type="submit" name="manage_reload:method" value=" Reload Events "/>
                 <input type="submit" name="manage_restartTimer:method" value=" Restart Timer "/>
            </td>
          </tr>
       </table>

       <table width="100%" cellspacing="0" cellpadding="2" border="0" tal:condition="results">
          <tr class="list-header">
             <td width="32"  class="list-item" align="left" nowrap
                 tal:define="p results_batch/previous">
                <div tal:omit-tag="" tal:condition="p">
                    <a href=""
                         tal:define="qs python: mq(request.form, results_start=p.first)"
                         tal:attributes="href python: 'manage_main?%s' %  qs">
                      << Prev
                    </a>
                </div>
                <div tal:condition="not: p" tal:omit-tag="">&nbsp;</div>
             </td>
             <td class="list-item" align="left">Path</td>
             <td class="list-item" aligh="left" nowrap>Scheduled</td>
             <td class="list-item" aligh="left" nowrap>Last Run</td>
             <td class="list-item" align="right" nowrap
                 tal:define="n results_batch/next">
                <div tal:omit-tag="" tal:condition="n">
                      <a href=""
                         tal:define="qs python: mq(request.form, results_start=n.first)"
                         tal:attributes="href python: 'manage_main?%s' % qs">
                        Next >>
                      </a>
                </div>
                <div tal:condition="not: n" tal:omit-tag="">&nbsp;</div>
             </td>
          </tr>
          <tr  class="row-hilite" 
               tal:repeat="event results_batch"
               tal:attributes="class python: test(repeat['event'].odd, 'row-normal', 'row-hilite')">
               <td class="list-item">
                  <input type="checkbox" name="urls:list" value="" 
                         tal:attributes="value python: '/'.join(event.getPhysicalPath())">
               </td>
               <td class="list-item">
                  <a href=""
                     tal:attributes="href string:${event/absolute_url}/manage_workspace"
                     tal:content=" python: '/'.join(event.getPhysicalPath())"/>
               </td>
               <td class="list-item">
                   <span tal:replace="python: event.time.toZone(context.timezone)"
                         tal:on-error="string:"/>
               </td>
               <td class="list-item" colspan="2">
                   <span tal:replace="python: event.last_executed.toZone(context.timezone)"
                         tal:on-error="string:"/>
               </td>
          </tr>
          <tr>
               <td colspan="4" class="form-element">
                  <input type="submit" name="manage_delete:method" value=" Delete "/>
                  <input type="submit" name="manage_unschedule:method" value=" Unschedule "/>
                  <input type="submit" name="manage_schedule:method" value=" Reschedule "/>
               </td>
          </tr>
       </table>
    </form>

   </div>
<html tal:replace="structure context/manage_page_footer"/>


