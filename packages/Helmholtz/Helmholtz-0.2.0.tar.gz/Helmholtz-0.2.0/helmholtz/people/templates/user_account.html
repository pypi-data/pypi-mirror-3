<div class="header">User Account</div>
 <div class="container">
 <ul>
 {% comment %}
 username and email are not accessible
 to other users than the user itself or superuser
 {% endcomment %}

  <li>connections : <span class="value">{{user.connections.count}}</span> <img id="open_connections_button" src="{{MEDIA_URL}}images/icon_addlink.gif"></img>
   <div id="connections_container">
    <div id="connections_by_months"></div>
   </div>  
  </li>
 {% with user.groups.all as groups %}
  <li>groups : <span class="value">{{groups.count}}</span> <img id="open_groups_button" src="{{MEDIA_URL}}images/icon_addlink.gif"></img>
 {% if groups.count %}
   <ul id="groups_container">
   {% for group in groups %}
    <li id="list_of_groups">
     <span class="value">{{group.name}}</span>
    {% comment %}
     the request_user must be member of a group to send an e-mail to all collaborators of this one
    {% endcomment %}
    {% if request_user == user or request_user in group.user_set.all %}
     <a href="{% url contact-group group.pk %}">
      <img class="email_icon" src="{{MEDIA_URL}}images/email.jpg" width="15px" height="13px"></img>
     </a>
    {% endif %}
    </li>
  {% endfor %}
   </ul>
 {% endif %}
 {% endwith %}
 
  <li>collaborators : <span class="value">{{collaborators.count}}</span> <img id="open_members_button" src="{{MEDIA_URL}}images/icon_addlink.gif"></img>
 {% if collaborators.count %}
   <ul id="members_container">
   {% comment %}each user can send an email to another user{% endcomment %}
   {% for collaborator in collaborators %}
    <li>
     <a href="{% url user-profile collaborator.pk %}">{{collaborator.get_full_name|capfirst}}</a>
     <a href="{% url contact-user collaborator.pk %}">
      <img class="email_icon" src="{{MEDIA_URL}}images/email.jpg" width="15px" height="13px"></img>
     </a>
    </li>
  {% endfor %}
   </ul>
 {% endif %}
  </li>
 {% comment %}emails and file requests are not useful for other users{% endcomment %}
 {% if request_user == user or request_user.is_superuser %}
  <li>requested files : <span class="value">{{user.requests.count}}</span> <img id="open_files_button" src="{{MEDIA_URL}}images/icon_addlink.gif"></img>
   <ul id="files_container">
    <li>accessible : <span class="value">{{proxy_user.accessible_files.count}}</span></li>
    <li>refused : <span class="value">{{proxy_user.refused_files.count}}</span></li>
    <li>pending : <span class="value">{{proxy_user.pending_files.count}}</span></li>
   </ul>
  </li>
  <li>emails : <span class="value">{{sent_by_server_emails}}</span> <img id="open_emails_button" src="{{MEDIA_URL}}images/icon_addlink.gif"></img>
   <ul id="emails_container">
    <li>received : <span class="value">{{received_emails.count}}</span></li>
    <li>sent to users : <span class="value">{{user_sent_emails.count}}</span></li>
    <li>sent to groups : <span class="value">{{group_sent_emails.count}}</span></li>
   </ul>
  </li>
 {% endif %}
 </ul>
</div>