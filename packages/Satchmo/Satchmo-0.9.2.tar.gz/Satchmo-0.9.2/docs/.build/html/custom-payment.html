

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Custom Payment Modules &mdash; Satchmo v0.9.2-development documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9.2-development',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="Satchmo v0.9.2-development documentation" href="index.html" />
    <link rel="next" title="Custom Product Attributes" href="product-attributes.html" />
    <link rel="prev" title="Customizing Admin" href="custom-admin.html" /> 
  </head>
  <body>

<div style="background-image: url(_static/satchmo-sliver.jpg); background-repeat: repeat-x; background-color: white; text-align: left;">
<img src="_static/satchmo-front.jpg">
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="product-attributes.html" title="Custom Product Attributes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="custom-admin.html" title="Customizing Admin"
             accesskey="P">previous</a> |</li>
        <li><a href="http://www.satchmoproject.com">Satchmo home </a> |&nbsp;</li>
        
        <li><a href="index.html">Satchmo v0.9.2-development documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Custom Payment Modules</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#building-your-processor">Building your processor</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#views">Views</a></li>
<li><a class="reference internal" href="#url-configuration">Url configuration</a></li>
<li><a class="reference internal" href="#enabling-the-new-module">Enabling the new module</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="custom-admin.html"
                        title="previous chapter">Customizing Admin</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="product-attributes.html"
                        title="next chapter">Custom Product Attributes</a></p>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<p>Documentation Version:</p>
<ul>
    <li><a href="/docs/dev">Current development version</a></li>
    <li><a href="/docs/rel/latest">Latest Release version</a></li>
    <li><a href="http://bitbucket.org/chris1610/satchmo/downloads/Satchmo-0-9-1.pdf">PDF Documentation</a></li>
</ul>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="custom-payment-modules">
<span id="id1"></span><h1>Custom Payment Modules<a class="headerlink" href="#custom-payment-modules" title="Permalink to this headline">¶</a></h1>
<p>While Satchmo currently has support for several different payment modules, you may
have unique needs or the desire to create your own payment processor module. This
document will discuss how to create your own payment modules.  If you do decide
to create your own module, please let us know so we can include it back into the
satchmo core and make the framework that much more robust.</p>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Satchmo&#8217;s payment processor modules are meant to be as modular as possible.  For
many types of payment processors, you should be able to use one of the existing
modules as a basis for creating your own.</p>
<p>All of the modules are stored in the <tt class="docutils literal"><span class="pre">/payment/modules</span></tt> directory.  If you take a
quick look at any one of the subdirectories, you will see a number of files:</p>
<blockquote>
<ul class="simple">
<li>__init__.py</li>
<li>config.py</li>
<li>processor.py</li>
<li>urls.py</li>
<li>views.py</li>
</ul>
</blockquote>
<p>The <tt class="docutils literal"><span class="pre">__init__.py</span></tt> is required so that satchmo can import the files.  There is no need
to put any code in this file.  Just be sure it exists!</p>
<p>The rest of the files are described below.</p>
</div>
<div class="section" id="building-your-processor">
<h2>Building your processor<a class="headerlink" href="#building-your-processor" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">processor.py</span></tt> file is where the majority of the heavy lifting is done.  The processor
does 4 things:</p>
<blockquote>
<ul class="simple">
<li>Sets up its configuration for the service (<tt class="docutils literal"><span class="pre">__init__</span></tt>)</li>
<li>Takes order data and formats it in the appropriate manner (<tt class="docutils literal"><span class="pre">prepareData</span></tt>)</li>
<li>Sends the data to the processing server/url (<tt class="docutils literal"><span class="pre">authorize_payment</span></tt>, <tt class="docutils literal"><span class="pre">capture_payment</span></tt>, <tt class="docutils literal"><span class="pre">capture_authorized_payment</span></tt>) and returns the results.</li>
</ul>
</blockquote>
<p>Of them, only <tt class="docutils literal"><span class="pre">capture_payment</span></tt> is required.  If the processor can both authorize and process, then you need to add a function <tt class="docutils literal"><span class="pre">can_authorize</span></tt>, which returns True, and implement the other two methods.  See the <tt class="docutils literal"><span class="pre">dummy</span></tt> module for an example.</p>
<p>Optionally, the processor can include include test code so that it is easy to verify from
the command line.</p>
<p>Here is a stub you can use to create your own processor:</p>
<div class="highlight-python"><pre>from payment.modules.base import BasePaymentProcessor, ProcessorResult

class PaymentProcessor(BasePaymentProcessor):
    def __init__(self, settings):
        # Set up your configuration for items like
        # Test server, url, various flags and settings
        super(PaymentProcessor, self).__init__('example', settings)

    def capture_payment(self):
        # Send the data via the appropriate manner and return a ProcessorResult
        # object.</pre>
</div>
<p>Refer to the dummy, authorize.net, cybersource or trustcommerce modules for various examples to
help you through the process.</p>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Each processor will have unique variables that need to be set.  The <tt class="docutils literal"><span class="pre">config.py</span></tt> file is where
you can leverage the Satchmo settings capability to add your unique variables.  Please
refer to the <a class="reference internal" href="configuration.html"><em>Basic Configuration</em></a> in order to understand how the system works. For more examples,
the existing working modules are great examples of what to setup.  The basic format is:</p>
<p>Create the new configuration group:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">PAYMENT_GROUP</span> <span class="o">=</span> <span class="n">ConfigurationGroup</span><span class="p">(</span><span class="s">&#39;PAYMENT_MYNEWPROCESSOR&#39;</span><span class="p">,</span>
    <span class="n">_</span><span class="p">(</span><span class="s">&#39;My New Processor Payment Settings&#39;</span><span class="p">),</span>
    <span class="n">ordering</span><span class="o">=</span><span class="mi">102</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The key of the <tt class="docutils literal"><span class="pre">ConfigurationGroup</span></tt> must be the module name, upper-cased.</p>
</div>
<p>For example, if your custom payment module was located in <tt class="docutils literal"><span class="pre">mypaymentmodules.mynewprocessor</span></tt>,
the <tt class="docutils literal"><span class="pre">ConfigurationGroup</span></tt> should be given the key <tt class="docutils literal"><span class="pre">PAYMENT_MYNEWPROCESSOR</span></tt>.
The reason for this is that the <tt class="docutils literal"><span class="pre">active_gateways()</span></tt> function in <tt class="docutils literal"><span class="pre">payment/__init__.py</span></tt> attempts
to automatically determine these keys by appending the upper-cased module name to <tt class="docutils literal"><span class="pre">PAYMENT_</span></tt>.</p>
<p>Now register the settings you need:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">config_register_list</span><span class="p">(</span>
    <span class="n">BooleanValue</span><span class="p">(</span><span class="n">PAYMENT_GROUP</span><span class="p">,</span>
        <span class="s">&#39;LIVE&#39;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Accept real payments&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;False if you want to be in test mode&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>

    <span class="n">StringValue</span><span class="p">(</span><span class="n">PAYMENT_GROUP</span><span class="p">,</span>
        <span class="s">&#39;LABEL&#39;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;English name for this group on the checkout screens&#39;</span><span class="p">),</span>
        <span class="n">default</span> <span class="o">=</span> <span class="s">&#39;Credit Cards&#39;</span><span class="p">,</span>
        <span class="n">help_text</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;This will be passed to the translation utility&#39;</span><span class="p">)),</span>

    <span class="n">StringValue</span><span class="p">(</span><span class="n">PAYMENT_GROUP</span><span class="p">,</span>
        <span class="s">&#39;URL_BASE&#39;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;The url base used for constructing urlpatterns which will use this module&#39;</span><span class="p">),</span>
        <span class="n">default</span> <span class="o">=</span> <span class="s">r&#39;^credit/&#39;</span><span class="p">),</span>

    <span class="n">MultipleStringValue</span><span class="p">(</span><span class="n">PAYMENT_GROUP</span><span class="p">,</span>
        <span class="s">&#39;CREDITCHOICES&#39;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Available credit cards&#39;</span><span class="p">),</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">((</span><span class="s">&#39;Amex&#39;</span><span class="p">,</span> <span class="s">&#39;American Express&#39;</span><span class="p">)),</span>
            <span class="p">((</span><span class="s">&#39;Visa&#39;</span><span class="p">,</span><span class="s">&#39;Visa&#39;</span><span class="p">)),</span>
            <span class="p">((</span><span class="s">&#39;Mastercard&#39;</span><span class="p">,</span><span class="s">&#39;Mastercard&#39;</span><span class="p">)),</span>
            <span class="p">((</span><span class="s">&#39;Discover&#39;</span><span class="p">,</span><span class="s">&#39;Discover&#39;</span><span class="p">))),</span>
        <span class="n">default</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Visa&#39;</span><span class="p">,</span> <span class="s">&#39;Mastercard&#39;</span><span class="p">,</span> <span class="s">&#39;Discover&#39;</span><span class="p">)),</span>

    <span class="n">StringValue</span><span class="p">(</span><span class="n">PAYMENT_GROUP</span><span class="p">,</span>
        <span class="s">&#39;PASSWORD&#39;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Your Processor password&#39;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>

    <span class="n">BooleanValue</span><span class="p">(</span><span class="n">PAYMENT_GROUP</span><span class="p">,</span>
        <span class="s">&#39;EXTRA_LOGGING&#39;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Verbose logs&quot;</span><span class="p">),</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Add extensive logs during post.&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>All of these settings can be accessed in your <tt class="docutils literal"><span class="pre">__init__</span></tt> method (shown above).
For example, the LIVE value above can be accessed by using <tt class="docutils literal"><span class="pre">settings.LIVE.value</span></tt></p>
</div>
<div class="section" id="views">
<h2>Views<a class="headerlink" href="#views" title="Permalink to this headline">¶</a></h2>
<p>Most payment processing have similar steps:</p>
<blockquote>
<ul class="simple">
<li>Collect demographic information</li>
<li>Collect payment information</li>
<li>Confirm info is correct</li>
<li>Return a status</li>
</ul>
</blockquote>
<p>The <tt class="docutils literal"><span class="pre">views.py</span></tt> file contains the information that maps your processor views to the existing
views or your own custom view.</p>
<p>For most people, the views contained in payment.views will be sufficient.  The example below
maps these views to views already available in Satchmo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">livesettings</span> <span class="kn">import</span> <span class="n">config_get_group</span>
<span class="kn">from</span> <span class="nn">payment.views</span> <span class="kn">import</span> <span class="n">confirm</span><span class="p">,</span> <span class="n">payship</span>

<span class="k">def</span> <span class="nf">pay_ship_info</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">payship</span><span class="o">.</span><span class="n">credit_pay_ship_info</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">config_get_group</span><span class="p">(</span><span class="s">&#39;PAYMENT_MYNEWPROCESSOR&#39;</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">confirm_info</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">confirm</span><span class="o">.</span><span class="n">credit_confirm_info</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">config_get_group</span><span class="p">(</span><span class="s">&#39;PAYMENT_MYNEWPROCESSOR&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>However, there is nothing stopping you from creating your own view:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">confirm_info</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c"># Do a lot of custom stuff here</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p>All of the current satchmo payment views are in <tt class="docutils literal"><span class="pre">/payment/views</span></tt>.
Please review these before trying to build one of your own!</p>
</div>
<div class="section" id="url-configuration">
<h2>Url configuration<a class="headerlink" href="#url-configuration" title="Permalink to this headline">¶</a></h2>
<p>Now that you have built your processor, configured your settings and built your views, you
need to tell Satchmo how to access these views.  This is where the <tt class="docutils literal"><span class="pre">urls.py</span></tt> file is useful.</p>
<p>For most processors, a simple file would look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">livesettings</span> <span class="kn">import</span> <span class="n">config_value</span><span class="p">,</span> <span class="n">config_get_group</span>


<span class="n">config</span> <span class="o">=</span> <span class="n">config_get_group</span><span class="p">(</span><span class="s">&#39;PAYMENT_MYNEWPROCESSOR&#39;</span><span class="p">)</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;satchmo&#39;</span><span class="p">,</span>
     <span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="s">&#39;mypaymentmodules.myprocessor.views.pay_ship_info&#39;</span><span class="p">,</span>
                    <span class="p">{</span><span class="s">&#39;SSL&#39;</span><span class="p">:</span><span class="n">config</span><span class="o">.</span><span class="n">SSL</span><span class="o">.</span><span class="n">value</span><span class="p">},</span> <span class="s">&#39;MYNEWPROCESSOR_satchmo_checkout-step2&#39;</span><span class="p">),</span>
     <span class="p">(</span><span class="s">r&#39;^confirm/$&#39;</span><span class="p">,</span> <span class="s">&#39;payment.modules.trustcommerce.views.confirm_info&#39;</span><span class="p">,</span>
                    <span class="p">{</span><span class="s">&#39;SSL&#39;</span><span class="p">:</span><span class="n">config</span><span class="o">.</span><span class="n">SSL</span><span class="o">.</span><span class="n">value</span><span class="p">},</span> <span class="s">&#39;MYNEWPROCESSOR_satchmo_checkout-step3&#39;</span><span class="p">),</span>
     <span class="p">(</span><span class="s">r&#39;^success/$&#39;</span><span class="p">,</span> <span class="s">&#39;payment.views.checkout.success&#39;</span><span class="p">,</span>
                    <span class="p">{</span><span class="s">&#39;SSL&#39;</span><span class="p">:</span><span class="n">config</span><span class="o">.</span><span class="n">SSL</span><span class="o">.</span><span class="n">value</span><span class="p">},</span> <span class="s">&#39;MYNEWPROCESSOR_satchmo_checkout-success&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The nice thing about this file is that it allows you to easily plug in the views
you need and rename the urls to whatever form you need.  Just make sure to
maintain the naming convention for the urls as shown above.</p>
</div>
<div class="section" id="enabling-the-new-module">
<h2>Enabling the new module<a class="headerlink" href="#enabling-the-new-module" title="Permalink to this headline">¶</a></h2>
<p>In order to enable your new payment processor, you must add it to your INSTALLED_APPS setting in your settings.py. For example:</p>
<div class="highlight-python"><pre>INSTALLED_APPS = (
        ...
        'payment',
        'mypaymentmodules.myprocessor',
        ...</pre>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>Hopefully this document will help you get started in creating your own payment
modules.  Before trying to tackle one on your own, take some time to look at
the existing models and get a feel for how things have been done.  Once you are
comfortable, we suggest copying one of the modules and using it as a starting
point for your subsequent efforts.  If you get stuck, please feel free to ask
the <a class="reference external" href="http://groups.google.com/group/satchmo-users">mailing list</a> for help.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="product-attributes.html" title="Custom Product Attributes"
             >next</a> |</li>
        <li class="right" >
          <a href="custom-admin.html" title="Customizing Admin"
             >previous</a> |</li>
        <li><a href="http://www.satchmoproject.com">Satchmo home </a> |&nbsp;</li>
        
        <li><a href="index.html">Satchmo v0.9.2-development documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010, Chris Moffitt.
      Last updated on Mar 10, 2012.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.5.
    </div>
<script src='http://www.google-analytics.com/ga.js' type='text/javascript'></script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1711397-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>
  </body>
</html>