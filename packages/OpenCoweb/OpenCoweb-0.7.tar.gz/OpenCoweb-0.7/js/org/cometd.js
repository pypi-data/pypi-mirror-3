define(function(){typeof dojo!=="undefined"&&!dojo.provide&&(dojo.provide=function(){},this.org=this.org||{},org.cometd={}),typeof dojo!=="undefined"?dojo.provide("org.cometd"):(this.org=this.org||{},org.cometd={}),org.cometd.JSON={},org.cometd.JSON.toJSON=org.cometd.JSON.fromJSON=function(a){throw"Abstract"},org.cometd.Utils={},org.cometd.Utils.isString=function(a){if(a===undefined||a===null)return!1;return typeof a==="string"||a instanceof String},org.cometd.Utils.isArray=function(a){if(a===undefined||a===null)return!1;return a instanceof Array},org.cometd.Utils.inArray=function(a,b){for(var c=0;c<b.length;++c)if(a===b[c])return c;return-1},org.cometd.Utils.setTimeout=function(a,b,c){return window.setTimeout(function(){try{b()}catch(c){a._debug("Exception invoking timed function",b,c)}},c)},org.cometd.Utils.clearTimeout=function(a){window.clearTimeout(a)},org.cometd.TransportRegistry=function(){var a=[],b={};this.getTransportTypes=function(){return a.slice(0)},this.findTransportTypes=function(c,d,e){var f=[];for(var g=0;g<a.length;++g){var h=a[g];b[h].accept(c,d,e)===!0&&f.push(h)}return f},this.negotiateTransport=function(c,d,e,f){for(var g=0;g<a.length;++g){var h=a[g];for(var i=0;i<c.length;++i)if(h===c[i]){var j=b[h];if(j.accept(d,e,f)===!0)return j}}return null},this.add=function(c,d,e){var f=!1;for(var g=0;g<a.length;++g)if(a[g]===c){f=!0;break}f||(typeof e!=="number"?a.push(c):a.splice(e,0,c),b[c]=d);return!f},this.find=function(c){for(var d=0;d<a.length;++d)if(a[d]===c)return b[c];return null},this.remove=function(c){for(var d=0;d<a.length;++d)if(a[d]===c){a.splice(d,1);var e=b[c];delete b[c];return e}return null},this.reset=function(){for(var c=0;c<a.length;++c)b[a[c]].reset()}},org.cometd.Transport=function(){var a,b;this.registered=function(c,d){a=c,b=d},this.unregistered=function(){a=null,b=null},this._debug=function(){b._debug.apply(b,arguments)},this._mixin=function(){return b._mixin.apply(b,arguments)},this.getConfiguration=function(){return b.getConfiguration()},this.getAdvice=function(){return b.getAdvice()},this.setTimeout=function(a,c){return org.cometd.Utils.setTimeout(b,a,c)},this.clearTimeout=function(a){org.cometd.Utils.clearTimeout(a)},this.convertToMessages=function(a){if(org.cometd.Utils.isString(a))try{return org.cometd.JSON.fromJSON(a)}catch(b){this._debug("Could not convert to JSON the following string",'"'+a+'"');throw b}if(org.cometd.Utils.isArray(a))return a;if(a===undefined||a===null)return[];if(a instanceof Object)return[a];throw"Conversion Error "+a+", typeof "+typeof a},this.accept=function(a,b,c){throw"Abstract"},this.getType=function(){return a},this.send=function(a,b){throw"Abstract"},this.reset=function(){this._debug("Transport",a,"reset")},this.abort=function(){this._debug("Transport",a,"aborted")},this.toString=function(){return this.getType()}},org.cometd.Transport.derive=function(a){function b(){}b.prototype=a;return new b},org.cometd.RequestTransport=function(){function l(a){if(d!==null)throw"Concurrent metaConnect requests not allowed, request id="+d.id+" not yet completed";var b=++c;this._debug("Transport",this.getType(),"metaConnect send, request",b,"envelope",a);var e={id:b,metaConnect:!0};h.call(this,a,e),d=e}function k(a,b){var c=org.cometd.Utils.inArray(a,e);c>=0&&e.splice(c,1);if(f.length>0){var d=f.shift(),h=d[0],j=d[1];this._debug("Transport dequeued request",j.id);if(b)this.getConfiguration().autoBatch&&g.call(this,h),i.call(this,h),this._debug("Transport completed request",a.id,h);else{var k=this;this.setTimeout(function(){k.complete(j,!1,j.metaConnect),h.onFailure(j.xhr,h.messages,"error","Previous request failed")},0)}}}function j(a){var b=a.id;this._debug("Transport",this.getType(),"metaConnect complete, request",b);if(d!==null&&d.id!==b)throw"Longpoll request mismatch, completing request "+b;d=null}function i(a){var b=++c,d={id:b,metaConnect:!1};e.length<this.getConfiguration().maxConnections-1?(e.push(d),h.call(this,a,d)):(this._debug("Transport",this.getType(),"queueing request",b,"envelope",a),f.push([a,d]))}function h(a,b){this.transportSend(a,b),b.expired=!1;if(!a.sync){var c=this.getConfiguration().maxNetworkDelay,d=c;b.metaConnect===!0&&(d+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",d,"ms for the response, maxNetworkDelay",c);var e=this;b.timeout=this.setTimeout(function(){b.expired=!0,b.xhr&&b.xhr.abort();var c="Request "+b.id+" of transport "+e.getType()+" exceeded "+d+" ms max network delay";e._debug(c),e.complete(b,!1,b.metaConnect),a.onFailure(b.xhr,a.messages,"timeout",c)},d)}}function g(a){while(f.length>0){var b=f[0],c=b[0],d=b[1];if(c.url===a.url&&c.sync===a.sync){f.shift(),a.messages=a.messages.concat(c.messages),this._debug("Coalesced",c.messages.length,"messages from request",d.id);continue}break}}var a=new org.cometd.Transport,b=org.cometd.Transport.derive(a),c=0,d=null,e=[],f=[];b.complete=function(a,b,c){c?j.call(this,a):k.call(this,a,b)},b.transportSend=function(a,b){throw"Abstract"},b.transportSuccess=function(a,b,c){b.expired||(this.clearTimeout(b.timeout),this.complete(b,!0,b.metaConnect),c&&c.length>0?a.onSuccess(c):a.onFailure(b.xhr,a.messages,"Empty HTTP response"))},b.transportFailure=function(a,b,c,d){b.expired||(this.clearTimeout(b.timeout),this.complete(b,!1,b.metaConnect),a.onFailure(b.xhr,a.messages,c,d))},b.send=function(a,b){b?l.call(this,a):i.call(this,a)},b.abort=function(){a.abort();for(var b=0;b<e.length;++b){var c=e[b];this._debug("Aborting request",c),c.xhr&&c.xhr.abort()}d&&(this._debug("Aborting metaConnect request",d),d.xhr&&d.xhr.abort()),this.reset()},b.reset=function(){a.reset(),d=null,e=[],f=[]};return b},org.cometd.LongPollingTransport=function(){var a=new org.cometd.RequestTransport,b=org.cometd.Transport.derive(a),c=!0;b.accept=function(a,b,d){return c||!b},b.xhrSend=function(a){throw"Abstract"},b.transportSend=function(a,b){this._debug("Transport",this.getType(),"sending request",b.id,"envelope",a);var d=this;try{var e=!0;b.xhr=this.xhrSend({transport:this,url:a.url,sync:a.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(a.messages),onSuccess:function(e){d._debug("Transport",d.getType(),"received response",e);var f=!1;try{var g=d.convertToMessages(e);g.length===0?(c=!1,d.transportFailure(a,b,"no response",null)):(f=!0,d.transportSuccess(a,b,g))}catch(h){d._debug(h),f||(c=!1,d.transportFailure(a,b,"bad response",h))}},onError:function(f,g){c=!1,e?d.setTimeout(function(){d.transportFailure(a,b,f,g)},0):d.transportFailure(a,b,f,g)}}),e=!1}catch(f){c=!1,this.setTimeout(function(){d.transportFailure(a,b,"error",f)},0)}},b.reset=function(){a.reset(),c=!0};return b},org.cometd.CallbackPollingTransport=function(){var a=new org.cometd.RequestTransport,b=org.cometd.Transport.derive(a),c=2e3;b.accept=function(a,b,c){return!0},b.jsonpSend=function(a){throw"Abstract"},b.transportSend=function(a,b){var d=this,e=0,f=a.messages.length,g=[];while(f>0){var h=org.cometd.JSON.toJSON(a.messages.slice(e,e+f)),i=a.url.length+encodeURI(h).length;if(i>c){if(f===1){var j="Bayeux message too big ("+i+" bytes, max is "+c+") for transport "+this.getType();this.setTimeout(function(){d.transportFailure(a,b,"error",j)},0);return}--f;continue}g.push(f),e+=f,f=a.messages.length-e}var k=a;if(g.length>1){var l=0,m=g[0];this._debug("Transport",this.getType(),"split",a.messages.length,"messages into",g.join(" + ")),k=this._mixin(!1,{},a),k.messages=a.messages.slice(l,m),k.onSuccess=a.onSuccess,k.onFailure=a.onFailure;for(var n=1;n<g.length;++n){var o=this._mixin(!1,{},a);l=m,m+=g[n],o.messages=a.messages.slice(l,m),o.onSuccess=a.onSuccess,o.onFailure=a.onFailure,this.send(o,b.metaConnect)}}this._debug("Transport",this.getType(),"sending request",b.id,"envelope",k);try{var p=!0;this.jsonpSend({transport:this,url:k.url,sync:k.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(k.messages),onSuccess:function(a){var c=!1;try{var e=d.convertToMessages(a);e.length===0?d.transportFailure(k,b,"no response"):(c=!0,d.transportSuccess(k,b,e))}catch(f){d._debug(f),c||d.transportFailure(k,b,"bad response",f)}},onError:function(a,c){p?d.setTimeout(function(){d.transportFailure(k,b,a,c)},0):d.transportFailure(k,b,a,c)}}),p=!1}catch(q){this.setTimeout(function(){d.transportFailure(k,b,"error",q)},0)}};return b},org.cometd.WebSocketTransport=function(){function m(a,b){try{var c=org.cometd.JSON.toJSON(a.messages);k.send(c),this._debug("Transport",this.getType(),"sent",a,"metaConnect =",b);var d=this.getConfiguration().maxNetworkDelay,e=d;b&&(e+=this.getAdvice().timeout);var f=[];for(var g=0;g<a.messages.length;++g){var h=a.messages[g];if(h.id){f.push(h.id);var l=this;i[h.id]=this.setTimeout(function(){var b="Message "+h.id+" of transport "+l.getType()+" exceeded "+e+" ms max network delay";l._debug(b),delete i[h.id];for(var c in j)if(j[c]===a){delete j[c];break}a.onFailure(k,a.messages,"timeout",b)},e)}}this._debug("Transport",this.getType(),"waiting at most",e," ms for messages",f,"maxNetworkDelay",d,", timeouts:",i)}catch(m){this.setTimeout(function(){a.onFailure(k,a.messages,"error",m)},0)}}var a=1,b=2,c=new org.cometd.Transport,d=org.cometd.Transport.derive(c),e,f=!0,g=!1,h=b,i={},j={},k,l;d.registered=function(a,b){c.registered(a,b),e=b},d.accept=function(a,b,c){return f&&!!window.WebSocket&&e.websocketEnabled===!0},d.onMessage=function(b){this._debug("Transport",this.getType(),"received websocket message",b);if(h===a){var c=this.convertToMessages(b.data),d=[];for(var e=0;e<c.length;++e){var f=c[e];if(/^\/meta\//.test(f.channel)||f.data===undefined)if(f.id){d.push(f.id);var g=i[f.id];g&&(this.clearTimeout(g),delete i[f.id],this._debug("Transport",this.getType(),"removed timeout for message",f.id,", timeouts",i))}"/meta/disconnect"===f.channel&&f.successful&&k.close()}var m=!1;for(var n=0;n<d.length;++n){var o=d[n];for(var p in j){var q=p.split(","),r=org.cometd.Utils.inArray(o,q);if(r>=0){m=!0,q.splice(r,1);var s=j[p];delete j[p],q.length>0&&(j[q.join(",")]=s);break}}}m&&this._debug("Transport",this.getType(),"removed envelope, envelopes",j),l.call(this,c)}},d.onClose=function(){this._debug("Transport",this.getType(),"closed",k),f=g;for(var a in i)this.clearTimeout(i[a]),delete i[a];for(var c in j)j[c].onFailure(k,j[c].messages,"closed"),delete j[c];h=b},d.send=function(b,c){this._debug("Transport",this.getType(),"sending",b,"metaConnect =",c);var d=[];for(var e=0;e<b.messages.length;++e){var f=b.messages[e];f.id&&d.push(f.id)}j[d.join(",")]=b,this._debug("Transport",this.getType(),"stored envelope, envelopes",j);if(h===a)m.call(this,b,c);else{var i=b.url.replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",i),k=new window.WebSocket(i);var n=this;k.onopen=function(){n._debug("WebSocket opened",k),g=!0,h=a,l=b.onSuccess,m.call(n,b,c)},k.onclose=function(){n.onClose()},k.onerror=function(){n.onClose()},k.onmessage=function(a){n.onMessage(a)}}},d.reset=function(){c.reset(),k&&k.close(),f=!0,g=!1,h=b,i={},j={},k=null,l=null};return d},org.cometd.Cometd=function(a){function bt(a){var c=m[a[0]];c&&(delete c[a[1]],b._debug("Removed listener",a))}function bs(a,c,d,e){var f=br(c,d);b._debug("Adding listener on",a,"with scope",f.scope,"and callback",f.method);var g={channel:a,scope:f.scope,callback:f.method,listener:e},h=m[a];h||(h=[],m[a]=h);var i=h.push(g)-1;g.id=i,g.handle=[a,i],b._debug("Added listener",g,"for channel",a,"having id =",i);return g.handle}function br(a,b){var c={scope:a,method:b};if(w(a))c.scope=undefined,c.method=a;else if(v(b)){if(!a)throw"Invalid scope "+a;c.method=a[b];if(!w(c.method))throw"Invalid callback "+b+" for scope "+a}else if(!w(b))throw"Invalid callback "+b;return c}function bq(a){var b=m[a];if(b)for(var c=0;c<b.length;++c)if(b[c])return!0;return!1}function bp(a){a=E(a);if(a!==undefined&&a!==null){V(a.advice);var b=a.channel;switch(b){case"/meta/handshake":$(a);break;case"/meta/connect":bb(a);break;case"/meta/disconnect":be(a);break;case"/meta/subscribe":bh(a);break;case"/meta/unsubscribe":bk(a);break;default:bn(a)}}}function bo(a,b){bm({successful:!1,failure:!0,channel:b.channel,request:b,xhr:a,advice:{reconnect:"none",interval:0}})}function bn(a){a.successful===undefined?a.data?H(a.channel,a):b._debug("Unknown message",a):a.successful?H("/meta/publish",a):bm(a)}function bm(a){H("/meta/publish",a),H("/meta/unsuccessful",a)}function bl(a,b){bj({successful:!1,failure:!0,channel:"/meta/unsubscribe",request:b,xhr:a,advice:{reconnect:"none",interval:0}})}function bk(a){a.successful?H("/meta/unsubscribe",a):bj(a)}function bj(a){H("/meta/unsubscribe",a),H("/meta/unsuccessful",a)}function bi(a,b){bg({successful:!1,failure:!0,channel:"/meta/subscribe",request:b,xhr:a,advice:{reconnect:"none",interval:0}})}function bh(a){a.successful?H("/meta/subscribe",a):bg(a)}function bg(a){H("/meta/subscribe",a),H("/meta/unsuccessful",a)}function bf(a,b){bd({successful:!1,failure:!0,channel:"/meta/disconnect",request:b,xhr:a,advice:{reconnect:"none",interval:0}})}function be(a){a.successful?(W(!1),H("/meta/disconnect",a)):bd(a)}function bd(a){W(!0),H("/meta/disconnect",a),H("/meta/unsuccessful",a)}function bc(a,b){t=!1,ba({successful:!1,failure:!0,channel:"/meta/connect",request:b,xhr:a,advice:{reconnect:"retry",interval:n}})}function bb(a){t=a.successful;if(t){H("/meta/connect",a);var b=B()?"none":q.reconnect;switch(b){case"retry":O(),U();break;case"none":W(!1);break;default:throw"Unrecognized advice action "+b}}else ba(a)}function ba(a){H("/meta/connect",a),H("/meta/unsuccessful",a);var b=B()?"none":q.reconnect;switch(b){case"retry":P(),U();break;case"handshake":e.reset(),O(),Y();break;case"none":W(!1);break;default:throw"Unrecognized advice action"+b}}function _(a,b){Z({successful:!1,failure:!0,channel:"/meta/handshake",request:b,xhr:a,advice:{reconnect:"retry",interval:n}})}function $(a){if(a.successful){i=a.clientId;var c=e.negotiateTransport(a.supportedConnectionTypes,a.version,d,u.url);if(c===null)throw"Could not negotiate transport with server; client "+e.findTransportTypes(a.version,d,u.url)+", server "+a.supportedConnectionTypes;f!==c&&(b._debug("Transport",f,"->",c),f=c),l=!1,R(),a.reestablish=s,s=!0,H("/meta/handshake",a);var g=B()?"none":q.reconnect;switch(g){case"retry":O(),U();break;case"none":W(!1);break;default:throw"Unrecognized advice action "+g}}else Z(a)}function Z(a){H("/meta/handshake",a),H("/meta/unsuccessful",a);var b=!B()&&q.reconnect!=="none";b?(P(),Y()):W(!1)}function Y(){A("handshaking"),l=!0,J(function(){X(r)})}function X(a){i=null,z(),B()?(e.reset(),V(u.advice)):V(b._mixin(!1,q,{reconnect:"retry"})),j=0,l=!0,r=a;var c="1.0",g=e.findTransportTypes(c,d,u.url),h={version:c,minimumVersion:"0.9",channel:"/meta/handshake",supportedConnectionTypes:g,advice:{timeout:q.timeout,interval:q.interval}},k=b._mixin(!1,{},r,h);f=e.negotiateTransport(g,c,d,u.url),b._debug("Initial transport is",f.getType()),A("handshaking"),b._debug("Handshake sent",k),M(!1,[k],!1,"handshake")}function W(a){I(),a&&f.abort(),i=null,A("disconnected"),j=0,O(),k.length>0&&(L.call(b,undefined,k,"error","Disconnected"),k=[])}function V(a){a&&(q=b._mixin(!1,{},u.advice,a),b._debug("New advice",q))}function U(){A("connecting"),J(function(){T()})}function T(){if(!B()){var a={channel:"/meta/connect",connectionType:f.getType()};t||(a.advice={timeout:0}),A("connecting"),b._debug("Connect sent",a),M(!1,[a],!0,"connect"),A("connected")}}function S(){--j;if(j<0)throw"Calls to startBatch() and endBatch() are not paired";j===0&&!B()&&!l&&R()}function R(){var a=k;k=[],a.length>0&&M(!1,a,!1)}function Q(){++j}function P(){n<u.maxBackoff&&(n+=u.backoffIncrement)}function O(){n=0}function N(a){j>0||l===!0?k.push(a):M(!1,[a],!1)}function M(a,c,d,e){for(var g=0;g<c.length;++g){var h=c[g];h.id=""+C(),i&&(h.clientId=i),h=F(h),h!==undefined&&h!==null?c[g]=h:c.splice(g--,1)}if(c.length!==0){var j=u.url;u.appendMessageTypeToURL&&(j.match(/\/$/)||(j=j+"/"),e&&(j=j+e));var k={url:j,sync:a,messages:c,onSuccess:function(a){try{K.call(b,a)}catch(c){b._debug("Exception during handling of messages",c)}},onFailure:function(a,c,d,e){try{L.call(b,a,c,d,e)}catch(f){b._debug("Exception during handling of failure",f)}}};b._debug("Send",k),f.send(k,d)}}function J(a){I();var c=q.interval+n;b._debug("Function scheduled in",c,"ms, interval =",q.interval,"backoff =",n,a),o=org.cometd.Utils.setTimeout(b,a,c)}function I(){o!==null&&org.cometd.Utils.clearTimeout(o),o=null}function H(a,b){G(a,b);var c=a.split("/"),d=c.length-1;for(var e=d;e>0;--e){var f=c.slice(0,e).join("/")+"/*";e===d&&G(f,b),f+="*",G(f,b)}}function G(a,c){var d=m[a];if(d&&d.length>0)for(var e=0;e<d.length;++e){var f=d[e];if(f)try{f.callback.call(f.scope,c)}catch(g){b._debug("Exception during notification",f,c,g);var h=b.onListenerException;if(w(h)){b._debug("Invoking listener exception callback",f,g);try{h.call(b,g,f.handle,f.listener,c)}catch(i){b._info("Exception during execution of listener callback",f,i)}}}}}function F(a){for(var b=0;b<p.length;++b){if(a===undefined||a===null)break;var c=p[b],d=c.extension.outgoing;if(w(d)){var e=D(c.extension,d,c.name,a,!0);a=e===undefined?a:e}}return a}function E(a){for(var b=0;b<p.length;++b){if(a===undefined||a===null)break;var c=u.reverseIncomingExtensions?p.length-1-b:b,d=p[c],e=d.extension.incoming;if(w(e)){var f=D(d.extension,e,d.name,a,!1);a=f===undefined?a:f}}return a}function D(a,c,d,e,f){try{return c.call(a,e)}catch(g){b._debug("Exception during execution of extension",d,g);var h=b.onExtensionException;if(w(h)){b._debug("Invoking extension exception callback",d,g);try{h.call(b,g,d,f,e)}catch(i){b._info("Exception during execution of exception callback in extension",d,i)}}return e}}function C(){return++h}function B(){return g==="disconnecting"||g==="disconnected"}function A(a){g!==a&&(b._debug("Status",g,"->",a),g=a)}function z(){for(var a in m){var c=m[a];for(var d=0;d<c.length;++d){var e=c[d];e&&!e.listener&&(delete c[d],b._debug("Removed subscription",e,"for channel",a))}}}function y(a){b._debug("Configuring cometd object with",a),v(a)&&(a={url:a}),a||(a={}),u=b._mixin(!1,u,a);if(!u.url)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var c=/(^https?:\/\/)?(((\[[^\]]+\])|([^:\/\?#]+))(:(\d+))?)?([^\?#]*)(.*)?/.exec(u.url),e=c[2],f=c[8],g=c[9];d=b._isCrossDomain(e);if(u.appendMessageTypeToURL)if(g!==undefined&&g.length>0)b._info("Appending message type to URI "+f+g+" is not supported, disabling 'appendMessageTypeToURL' configuration"),u.appendMessageTypeToURL=!1;else{var h=f.split("/"),i=h.length-1;f.match(/\/$/)&&(i-=1),h[i].indexOf(".")>=0&&(b._info("Appending message type to URI "+f+" is not supported, disabling 'appendMessageTypeToURL' configuration"),u.appendMessageTypeToURL=!1)}}function x(a,b){if(window.console){var c=window.console[a];w(c)&&c.apply(window.console,b)}}function w(a){if(a===undefined||a===null)return!1;return typeof a==="function"}function v(a){return org.cometd.Utils.isString(a)}var b=this,c=a||"default",d=!1,e=new org.cometd.TransportRegistry,f,g="disconnected",h=0,i=null,j=0,k=[],l=!1,m={},n=0,o=null,p=[],q={},r,s=!1,t=!1,u={maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",reverseIncomingExtensions:!0,maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,advice:{timeout:6e4,interval:0,reconnect:"retry"}};this._mixin=function(a,b,c){var d=b||{};for(var e=2;e<arguments.length;++e){var f=arguments[e];if(f===undefined||f===null)continue;for(var g in f){var h=f[g];if(h===b)continue;if(h===undefined)continue;a&&typeof h==="object"&&h!==null?h instanceof Array?d[g]=this._mixin(a,[],h):d[g]=this._mixin(a,{},h):d[g]=h}}return d},this._warn=function(){x("warn",arguments)},this._info=function(){u.logLevel!=="warn"&&x("info",arguments)},this._debug=function(){u.logLevel==="debug"&&x("debug",arguments)},this._isCrossDomain=function(a){return a&&a!==window.location.host};var K,L;this.send=N,this.receive=bp,K=function K(a){b._debug("Received",a);for(var c=0;c<a.length;++c){var d=a[c];bp(d)}},L=function L(a,c,d,e){b._debug("handleFailure",a,c,d,e);for(var f=0;f<c.length;++f){var g=c[f],h=g.channel;switch(h){case"/meta/handshake":_(a,g);break;case"/meta/connect":bc(a,g);break;case"/meta/disconnect":bf(a,g);break;case"/meta/subscribe":bi(a,g);break;case"/meta/unsubscribe":bl(a,g);break;default:bo(a,g)}}},this.registerTransport=function(a,b,c){var d=e.add(a,b,c);d&&(this._debug("Registered transport",a),w(b.registered)&&b.registered(a,this));return d},this.getTransportTypes=function(){return e.getTransportTypes()},this.unregisterTransport=function(a){var b=e.remove(a);b!==null&&(this._debug("Unregistered transport",a),w(b.unregistered)&&b.unregistered());return b},this.findTransport=function(a){return e.find(a)},this.configure=function(a){y.call(this,a)},this.init=function(a,b){this.configure(a),this.handshake(b)},this.handshake=function(a){A("disconnected"),s=!1,X(a)},this.disconnect=function(a,b){if(!B()){b===undefined&&(typeof a!=="boolean"&&(b=a,a=!1));var c={channel:"/meta/disconnect"},d=this._mixin(!1,{},b,c);A("disconnecting"),M(a===!0,[d],!1,"disconnect")}},this.startBatch=function(){Q()},this.endBatch=function(){S()},this.batch=function(a,b){var c=br(a,b);this.startBatch();try{c.method.call(c.scope),this.endBatch()}catch(d){this._debug("Exception during execution of batch",d),this.endBatch();throw d}},this.addListener=function(a,b,c){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!v(a))throw"Illegal argument type: channel must be a string";return bs(a,b,c,!0)},this.removeListener=function(a){if(!org.cometd.Utils.isArray(a))throw"Invalid argument: expected subscription, not "+a;bt(a)},this.clearListeners=function(){m={}},this.subscribe=function(a,b,c,d){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!v(a))throw"Illegal argument type: channel must be a string";if(B())throw"Illegal state: already disconnected";w(b)&&(d=c,c=b,b=undefined);var e=!bq(a),f=bs(a,b,c,!1);if(e){var g={channel:"/meta/subscribe",subscription:a},h=this._mixin(!1,{},d,g);N(h)}return f},this.unsubscribe=function(a,b){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(B())throw"Illegal state: already disconnected";this.removeListener(a);var c=a[0];if(!bq(c)){var d={channel:"/meta/unsubscribe",subscription:c},e=this._mixin(!1,{},b,d);N(e)}},this.clearSubscriptions=function(){z()},this.publish=function(a,b,c){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!v(a))throw"Illegal argument type: channel must be a string";if(B())throw"Illegal state: already disconnected";var d={channel:a,data:b},e=this._mixin(!1,{},c,d);N(e)},this.getStatus=function(){return g},this.isDisconnected=B,this.setBackoffIncrement=function(a){u.backoffIncrement=a},this.getBackoffIncrement=function(){return u.backoffIncrement},this.getBackoffPeriod=function(){return n},this.setLogLevel=function(a){u.logLevel=a},this.registerExtension=function(a,b){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!v(a))throw"Illegal argument type: extension name must be a string";var c=!1;for(var d=0;d<p.length;++d){var e=p[d];if(e.name===a){c=!0;break}}if(c){this._info("Could not register extension with name",a,"since another extension with the same name already exists");return!1}p.push({name:a,extension:b}),this._debug("Registered extension",a),w(b.registered)&&b.registered(a,this);return!0},this.unregisterExtension=function(a){if(!v(a))throw"Illegal argument type: extension name must be a string";var b=!1;for(var c=0;c<p.length;++c){var d=p[c];if(d.name===a){p.splice(c,1),b=!0,this._debug("Unregistered extension",a);var e=d.extension;w(e.unregistered)&&e.unregistered();break}}return b},this.getExtension=function(a){for(var b=0;b<p.length;++b){var c=p[b];if(c.name===a)return c.extension}return null},this.getName=function(){return c},this.getClientId=function(){return i},this.getURL=function(){return u.url},this.getTransport=function(){return f},this.getConfiguration=function(){return this._mixin(!0,{},u)},this.getAdvice=function(){return this._mixin(!0,{},q)},window.WebSocket||(window.WebSocket=window.MozWebSocket),window.WebSocket&&b.registerTransport("websocket",new org.cometd.WebSocketTransport)},typeof dojo!="undefined"&&dojo.provide("org.cometd.AckExtension"),org.cometd.AckExtension=function(){function d(b,c){a._debug(b,c)}var a,b=!1,c=-1;this.registered=function(b,c){a=c,d("AckExtension: executing registration callback")},this.unregistered=function(){d("AckExtension: executing unregistration callback"),a=null},this.incoming=function(a){var e=a.channel;if(e=="/meta/handshake")b=a.ext&&a.ext.ack,d("AckExtension: server supports acks",b);else if(b&&e=="/meta/connect"&&a.successful){var f=a.ext;f&&typeof f.ack==="number"&&(c=f.ack,d("AckExtension: server sent ack id",c))}return a},this.outgoing=function(e){var f=e.channel;f=="/meta/handshake"?(e.ext||(e.ext={}),e.ext.ack=a&&a.ackEnabled!==!1,c=-1):b&&f=="/meta/connect"&&(e.ext||(e.ext={}),e.ext.ack=c,d("AckExtension: client sending ack id",c));return e}};return org.cometd})