#!/usr/bin/python
import random
import strings

import pstats, cProfile

import pyximport
pyximport.install()

import cfuzzyset

checks = [''.join(random.choice(strings.lowercase) for _ in range(5))
          for _ in range(200)]

def run_profile():
    f = cfuzzyset.FuzzySet()
    with gzip.GzipFile(os.path.join(here, '..', 'cities.gz')) as input_file:
        for line in input_file:
            f.add(line.rstrip())
    cProfile.runctx("profiler(f)", globals(), locals(), "Profile.prof")

def profiler(f):
    for val in checks:
        f.get(val)

def build_structures():
    opts = (
        #('a', 'FuzzySet (bigram)', fuzzyset.FuzzySet(gram_size = 2)),
        #('b', 'FuzzySet (trigram)', fuzzyset.FuzzySet(gram_size = 3)),
        #('c', 'cFuzzySet (bigram)', cfuzzyset.cFuzzySet(gram_size = 2)),
        #('d', 'cFuzzySet (trigram)', cfuzzyset.cFuzzySet(gram_size = 3)),
        ('e', 'cFuzzySet (bigram, no leven)', cfuzzyset.cFuzzySet(gram_size = 2, use_levenshtein=False)),
        ('f', 'cFuzzySet (trigram, no leven)', cfuzzyset.cFuzzySet(gram_size = 3, use_levenshtein=False)),
        )
    ref = {}
            line = line.rstrip()
            for _, _, structure in opts:
                structure.add(line)
            ref[line] = line

    return opts + (('ref', 'reference (dict)', ref),)



if __name__ == '__main__':
    run_profile()
