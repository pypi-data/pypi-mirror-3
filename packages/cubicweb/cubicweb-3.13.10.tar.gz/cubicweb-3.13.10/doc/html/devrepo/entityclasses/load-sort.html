<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4.5. Loaded attributes and default sorting management &mdash; CubicWeb 3.13.5</title>
    <link rel="stylesheet" href="../../_static/lglb-sphinx-doc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.13.5',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="CubicWeb 3.13.5" href="../../index.html" />
    <link rel="up" title="4. Data as objects" href="index.html" />
    <link rel="next" title="4.6. Interfaces and Adapters" href="adapters.html" />
    <link rel="prev" title="4.1. Access to persistent data" href="data-as-objects.html" /> 
  </head>
  <body>
<div class="header">
 <a href="http://www.cubicweb.org">
  <img alt="cubicweb logo" src="../../_static/cubicweb.png"/>
 </a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="adapters.html" title="4.6. Interfaces and Adapters"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="data-as-objects.html" title="4.1. Access to persistent data"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">CubicWeb 3.13.5</a> &raquo;</li>
          <li><a href="../index.html" >Repository development</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">4. Data as objects</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h4>Previous topic</h4>
            <p class="topless"><a href="data-as-objects.html"
                                  title="previous chapter">4.1. Access to persistent data</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="adapters.html"
                                  title="next chapter">4.6. Interfaces and Adapters</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../_sources/devrepo/entityclasses/load-sort.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="loaded-attributes-and-default-sorting-management">
<span id="fetchattrs"></span><h1>4.5. Loaded attributes and default sorting management<a class="headerlink" href="#loaded-attributes-and-default-sorting-management" title="Permalink to this headline">Â¶</a></h1>
<ul>
<li><p class="first">The class attribute <cite>fetch_attrs</cite> allows to define in an entity class a list
of names of attributes or relations that should be automatically loaded when
entities of this type are fetched from the database. In the case of relations,
we are limited to <em>subject of cardinality `?` or `1`</em> relations.</p>
</li>
<li><p class="first">The class method <cite>fetch_order(attr, var)</cite> expects an attribute (or relation)
name as a parameter and a variable name, and it should return a string
to use in the requirement <cite>ORDERBY</cite> of an RQL query to automatically
sort the list of entities of such type according to this attribute, or
<cite>None</cite> if we do not want to sort on the attribute given in the parameter.
By default, the entities are sorted according to their creation date.</p>
</li>
<li><p class="first">The class method <cite>fetch_unrelated_order(attr, var)</cite> is similar to
the method <cite>fetch_order</cite> except that it is essentially used to
control the sorting of drop-down lists enabling relations creation
in the editing view of an entity. The default implementation uses
the modification date. Here&#8217;s how to adapt it for one entity (sort
on the name attribute):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyEntity</span><span class="p">(</span><span class="n">AnyEntity</span><span class="p">):</span>
    <span class="n">__regid__</span> <span class="o">=</span> <span class="s">&#39;MyEntity&#39;</span>
    <span class="n">fetch_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;modification_date&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">fetch_unrelated_order</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&#39;name&#39;</span><span class="p">:</span>
           <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> ASC&#39;</span> <span class="o">%</span> <span class="n">var</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>
</div>
</li>
</ul>
<p>The function <cite>fetch_config(fetchattrs, mainattr=None)</cite> simplifies the
definition of the attributes to load and the sorting by returning a
list of attributes to pre-load (considering automatically the
attributes of <cite>AnyEntity</cite>) and a sorting function based on the main
attribute (the second parameter if specified, otherwise the first
attribute from the list <cite>fetchattrs</cite>). This function is defined in
<cite>cubicweb.entities</cite>.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Transition</span><span class="p">(</span><span class="n">AnyEntity</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;...&quot;&quot;&quot;</span>
  <span class="n">__regid__</span> <span class="o">=</span> <span class="s">&#39;Transition&#39;</span>
  <span class="n">fetch_attrs</span><span class="p">,</span> <span class="n">fetch_order</span> <span class="o">=</span> <span class="n">fetch_config</span><span class="p">([</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Indicates that for the entity type &#8220;Transition&#8221;, you have to pre-load
the attribute <cite>name</cite> and sort by default on this attribute.</p>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="adapters.html" title="4.6. Interfaces and Adapters"
             >next</a> |</li>
        <li class="right" >
          <a href="data-as-objects.html" title="4.1. Access to persistent data"
             >previous</a> |</li>
        <li><a href="../../index.html">CubicWeb 3.13.5</a> &raquo;</li>
          <li><a href="../index.html" >Repository development</a> &raquo;</li>
          <li><a href="index.html" >4. Data as objects</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2001-2010, Logilab.
      Last updated on Sep 08, 2011.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.6.
    </div>
  </body>
</html>