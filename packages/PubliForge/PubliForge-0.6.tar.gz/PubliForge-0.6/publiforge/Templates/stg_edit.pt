<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="base">
<head><title></title></head>
<body>
<div id="mainPanel" metal:fill-slot="main">
  ${form.begin(request.current_route_path(_query=paging and {'paging_id': paging.paging_id} or {}))}
  <!-- ............................... Buttons ............................ -->
  <div id="buttons">
    <div class="first">
      ${request.breadcrumbs.back_button()}
    </div>
    <div class="last" tal:switch="storage is None">
      <div tal:case="True" tal:omit-tag="">
        ${form.submit('sav!.x', _('Create'), class_='buttonMain')}
        ${form.button(route('storage_admin'), _('Cancel'))}
      </div>
      <div tal:case="False" tal:omit-tag="">
        ${form.submit('sav!.x', _('Save'), class_='buttonMain')}
        ${form.button(route('storage_view', storage_id=storage.storage_id), _('Cancel'))}
      </div>
    </div>
    <hr class="hidden"/>
  </div>
  <div id="main">
    <h2 id="subtitle" class="storage" title="${_('Storage settings')}">${storage and storage.label}</h2>
    <!-- ............................. Flash .............................. -->
    <div tal:define="flash load: flash.macro.pt" metal:use-macro="flash"/>
    <!-- ........................... Members to add ....................... -->
    <div tal:define="mbr_paging load: mbr_paging.macro.pt" metal:use-macro="mbr_paging"/>
    <div tal:define="mbr_groups_paging load: mbr_groups_paging.macro.pt" metal:use-macro="mbr_groups_paging"/>
    <!-- ................................ Tabs ............................ -->
    <div id="tabSet">
      ${tab_set.toc('tabStorage')}
      <!-- ..... Description ...... -->
      ${tab_set.tab_begin(0, 'd')}
      ${form.grid_select('access', _('Access:'), STORAGE_ACCESS.items(), required=True)}
      <div tal:switch="storage is None" tal:omit-tag="">
        <div tal:case="True" tal:omit-tag="">
          ${form.grid_text('storage_id', _('Identifier:'), required=True)}
        </div>
        <div tal:case="False" tal:omit-tag="">
          ${form.grid_item(None, _('Identifier:'), storage.storage_id, class_='')}
        </div>
      </div>
      ${form.grid_text('label', _('Label:'), required=True)}
      ${form.grid_text('description', _('Description:'))}
      <div tal:switch="storage is None" tal:omit-tag="">
        <div tal:case="True" tal:omit-tag="">
          ${form.grid_select('vcs_engine', _('Version control:'), vcs_engines.items(), required=True)}
        </div>
        <div tal:case="False" tal:omit-tag="">
          ${form.grid_item(None, _('Version control:'),
            _(vcs_engines.get(storage.vcs_engine, storage.vcs_engine)).partition(u'â€“')[2], class_='')}
        </div>
      </div>
      <div tal:condition="not storage or storage.vcs_engine not in ('none', 'local')"
           id="vcsParams">
        ${form.grid_text('vcs_url', _('Source URL:'))}
        ${form.grid_text('vcs_user', _('Default user:'))}
        ${form.grid_password('password', _('Password:'))}
      </div>
      ${form.grid_select('refresh', _('Synchronization:'), REFRESH.items())}
      <div tal:condition="not storage or storage.vcs_engine in ('none', 'local')"
           id="stgURL">
        ${form.grid_text('public_url', _('Public URL:'))}
      </div>
      ${tab_set.tab_end()}
      <!-- ....... Members ........ -->
      ${tab_set.tab_begin(1, 'u')}
      <div tal:condition="storage" tal:omit-tag="">
        <div tal:define="mbr_edit load: mbr_edit.macro.pt" metal:use-macro="mbr_edit"/>
      </div>
      <div tal:condition="not storage">${_('Create storage before adding authorized users.')}</div>
      ${tab_set.tab_end()}
      <!-- .... Member groups ..... -->
      ${tab_set.tab_begin(2, 'g')}
      <div tal:condition="storage" tal:omit-tag="">
        <div tal:define="mbr_groups_edit load: mbr_groups_edit.macro.pt" metal:use-macro="mbr_groups_edit"/>
      </div>
      <div tal:condition="not storage">${_('Create storage before adding authorized groups.')}</div>
      ${tab_set.tab_end()}
    </div>
  </div>
  ${form.end()}
</div>  
</body>
</html>