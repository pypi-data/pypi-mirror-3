function handle_listing(f){f.preventDefault();$(this).blur();var h=[];var e=0;var d=$(this).attr("title");var c=$("#toaddr").attr("title").split(",");var a=$(this).attr("id");var g=c[0];if($(this).attr("id")=="whitelist"){var b=1}else{var b=2}h[e++]='<div id="confirm-listing">';h[e++]='<div id="confirm-listing-info">';h[e++]="This will "+$(this).attr("id")+" mail from ";h[e++]='<span id="listby">'+$(this).attr("title")+"</span>";h[e++]=" to "+g;h[e++]="</div>";h[e++]='<div id="confirm-listing-buttons">';h[e++]=gettext("List by IP address")+' <input type="checkbox" id="byip" />';h[e++]="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "+gettext("Do you want to continue ?")+" ";h[e++]='<input type="button" id="yes_list" value="'+gettext("Yes")+'"/>';h[e++]='<input type="button" id="no" value="'+gettext("No")+'"/>';h[e++]="</div>";h[e++]="</div>";if($("#confirm-listing").length){$("#confirm-listing").remove()}if($("#filter-error").length){clearTimeout(timeout);$("#filter-error").empty().remove()}$("#fromaddr").after(h.join("\n"));$("#byip").bind("click",function(i){if($("#byip").is(":checked")){$("#listby").empty().append($("#clientip").text())}else{$("#listby").empty().append(d)}});$("#no").bind("click",function(i){i.preventDefault();$("#confirm-listing").remove()});$("#yes_list").bind("click",function(j){j.preventDefault();$("#yes_list").attr({disabled:"disabled",value:gettext("Submitting")});if($("#listing").attr("title")=="1"||$("#listing").attr("title")=="2"){var i=g.split("@");var k={user_part:i[0],to_address:i[1],from_address:$("#listby").text(),list_type:b}}else{var k={to_address:g,from_address:$("#listby").text(),list_type:b}}ajax_target=2;$.post("/lists/add/",k,function(l,n,m){if(l.success){$(".Grid_content").before('<div id="in-progress">'+$("#listby").text()+gettext(" has been added to your ")+a+".</div>");$("#in-progress").append('<div id="dismiss"><a href="#">'+gettext("Dismiss")+"</a></div>");$("#dismiss a").click(function(o){o.preventDefault();clearTimeout(ip);$("#in-progress").empty().remove()});$("#confirm-listing").remove();ip=setTimeout(function(){$("#in-progress").empty().remove()},15050);window.scroll(0,0)}else{$("#confirm-listing").remove();$("#fromaddr").after('<div id="filter-error">'+gettext("Error adding to ")+a+": "+l.error_msg+"</div>");$("#filter-error").append('<div id="dismiss"><a href="#">'+gettext("Dismiss")+"</a></div>");timeout=setTimeout(function(){$("#filter-error").remove()},15050);$("#dismiss a").click(function(o){o.preventDefault();clearTimeout(timeout);$("#filter-error").empty().remove()})}$("#yes_list").removeAttr("disabled").attr({value:gettext("Yes")})},"json")})}function handle_ajax(){$("#my-spinner").ajaxStart(function(){$(this).empty().append("&nbsp;"+gettext("Processing...")).show()}).ajaxStop(function(){if(!$(".ajax_error").length){$(this).hide()}}).ajaxError(function(c,b,a){$(this).hide();if(b.status==200){if(ajax_target==1){if($("#filter-ajax").length){$("#filter-ajax").remove()}$("#submit_q_request").removeAttr("disabled");$("#qheading").after('<div id="filter-error">'+gettext("Empty server response")+"</div>")}else{$("#confirm-listing").remove();$("#fromaddr").after('<div id="filter-error">'+gettext("Empty server response")+"</div>")}$("#filter-error").append('<div id="dismiss"><a href="#">'+gettext("Dismiss")+"</a></div>");timeout=setTimeout(function(){$("#filter-error").remove()},15050);$("#dismiss a").click(function(d){d.preventDefault();clearTimeout(timeout);$("#filter-error").empty().remove()})}else{if($("#filter-error").length){clearTimeout(timeout);$("#filter-error").remove()}if(ajax_target==1){if($("#filter-ajax").length){$("#filter-ajax").remove()}$("#submit_q_request").removeAttr("disabled");$("#qheading").after('<div id="filter-error">'+gettext("Error connecting to server. check network!")+"</div>")}else{$("#confirm-listing").remove();$("#fromaddr").after('<div id="filter-error">'+gettext("Error connecting to server. check network!")+"</div>")}$("#filter-error").append('<div id="dismiss"><a href="#">'+gettext("Dismiss")+"</a></div>");timeout=setTimeout(function(){$("#filter-error").remove()},15050);$("#dismiss a").click(function(d){d.preventDefault();clearTimeout(timeout);$("#filter-error").empty().remove()})}})}function do_quarantine_release(e){$("#submit_q_request").attr("disabled","disabled");if($("#filter-error").length){clearTimeout(timeout);$("#filter-error").remove()}if($("#info-msg").length){clearTimeout(timeout);$("#info-msg").remove()}$("#qheading").after('<div id="filter-ajax">'+gettext("Processing request.............")+"</div>");var a=0;var d=0;var h=0;var f=0;e.preventDefault();if($("#id_release").is(":checked")){a=1}if($("#id_todelete").is(":checked")){d=1}if($("#id_learn").is(":checked")){h=1}if($("#id_use_alt").is(":checked")){f=1}var c={release:a,todelete:d,learn:h,salearn_as:$("#id_salearn_as").val(),use_alt:f,altrecipients:$("#id_altrecipients").val(),message_id:$("#id_message_id").val()};ajax_target=1;var b=$("#qform").attr("action");var g=b.indexOf("#");b=b.slice(0,g);$.post(b,c,function(i){$("#filter-ajax").remove();if(i.success){if($("#info-msg").length){clearTimeout(timeout);$("#info-msg").remove()}$("#qheading").after('<div id="info-msg">'+i.html+"</div>");$("#info-msg").append('<div id="dismiss"><a href="#">'+gettext("Dismiss")+"</a></div>");timeout=setTimeout(function(){$("#info-msg").remove()},15050);$("#dismiss a").click(function(j){j.preventDefault();clearTimeout(timeout);$("#info-msg").empty().remove()})}else{if($("#filter-error").length){clearTimeout(timeout);$("#filter-error").remove()}$("#qheading").after('<div id="filter-error">'+i.html+"</div>");$("#filter-error").append('<div id="dismiss"><a href="#">'+gettext("Dismiss")+"</a></div>");timeout=setTimeout(function(){$("#filter-error").remove()},15050);$("#dismiss a").click(function(j){j.preventDefault();clearTimeout(timeout);$("#filter-error").empty().remove()})}$("#submit_q_request").removeAttr("disabled")},"json")}var ajax_target=1;$(document).ready(function(){handle_ajax();mh=$("#mail-headers");mh.hide();mh.after($("<a/>").attr({href:"#",id:"header-toggle",innerHTML:'<img src="'+media_url+'imgs/maximize.png" alt="&darr;">&nbsp;'+gettext("Show headers")}));$("#header-toggle").bind("click",function(a){a.preventDefault();if($("#mail-headers").css("display")=="block"){$("#mail-headers").css({display:"none"});$(this).blur().html('<img src="'+media_url+'imgs/maximize.png" alt="&darr;">&nbsp;'+gettext("Show headers"));window.scroll(0,50)}else{$("#mail-headers").css({display:"block"});$(this).blur().html('<img src="'+media_url+'imgs/minimize.png" alt="&uarr;">&nbsp;'+gettext("Hide headers"))}});$("#qform").submit(do_quarantine_release);$("#listing a").bind("click",handle_listing)});