<div metal:define-macro="build_processing" tal:omit-tag=""
     xmlns:tal="http://xml.zope.org/namespaces/tal"
     xmlns:metal="http://xml.zope.org/namespaces/metal">
  <div id="toolTip" tal:condition="description">${description}</div>
  <div class="formItem">
    <label for="processing"><em>${_('Processing:')}</em></label>
    <div id="processing">
      <h3><a href="${route('processing_view', project_id=project['project_id'],
                   processing_id=processing.processing_id)}">${processing.label}</a></h3>
    </div>
  </div>
  <div class="formItem" tal:condition="len(variables)">
    <label for="variables"><em>${_('Variables:')}</em></label>
    <div id="variables">
      <table class="list smallList" tal:define="local_text import: publiforge.lib.xml.local_text">
        <caption>${_('Variables')}</caption>
        <thead>
          <tr>
            <th colspan="2">${_('Label')}</th>
            <th></th>
            <th>${_('Value')}</th>
            <th class="last">${_('Action')}</th>
          </tr>
        </thead>
        <tbody tal:repeat="group groups" class="group">
          <tr>
            <th colspan="5">${local_text(group, 'label', request)}</th>
          </tr>
          <tr tal:repeat="var [k for k in group.findall('var') if k.get('name') in variables]">
            <td class="checkbox"></td>
            <td>${local_text(var, 'label', request, default=var.get('name'))}</td>
            <td>=</td>
            <td tal:switch="var.get('type')">
              <div tal:case="'boolean'">${form.checkbox(var.get('name'))}</div>
              <div tal:case="'integer'">${form.text(var.get('name'))}</div>
              <div tal:case="'string'">${form.text(var.get('name'))}</div>
              <div tal:case="'select'">
                ${form.select(var.get('name'), None,
                  [(k.get('value', k.text), k.text) for k in var.findall('option')])}
              </div>
              <div tal:case="'regex'">${form.text(var.get('name'))}</div>
              <div class="error" tal:condition="form.has_error(var.get('name'))">
                ${form.error(var.get('name'))}
              </div>
            </td>
            <td class="last">
              ${form.submit_image('rst!%s' % var.get('name'),
                _('Reset to ') + '"' + (unicode(variables[var.get('name')][1]) or '') + '"',
                '/Static/Images/action_reset_one.png')}
              ${form.submit_image('des!%s' % var.get('name'),
                local_text(var, 'description', request).partition(' --')[0],
                '/Static/Images/action_help_one.png')}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>