#!/bin/bash -e

function make_distribution
{
    # check arguments
    USAGE="make_distribution <svn prefix> <name> <tar file> <dist dir>"
    SVN_PREFIX=${1?-$USAGE}
    NAME=${2?-$USAGE}
    DIST=${3?-$USAGE}
    DIST_DIR=${4?-$USAGE}

    # create clean directory
    TMP_DIR=/tmp/distribution/$NAME
    rm -rf $TMP_DIR
    mkdir -p $TMP_DIR
    cd $TMP_DIR

    # make distribution    
    svn co -q $SVN_PREFIX/$NAME
    tar czf $DIST --exclude=.svn $NAME
    # echo "$NAME distribution is in $TMP_DIR/$DIST"
	
	# copy to dist directory
	echo "Copying $TMP_DIR/$DIST to $DIST_DIR"
	cp $TMP_DIR/$DIST $DIST_DIR
}

# rst2html.py README.txt > README.html

( cd rst && make html )

DIST_DIR=$(pwd)/dist/
[ -d $DIST_DIR ]
REPOSITORY_ROOT=http://zemlinsky.mrc-bsu.cam.ac.uk/svn/johns
make_distribution $REPOSITORY_ROOT/MyProjects/trunk STEME steme.tar.gz $DIST_DIR
make_distribution $REPOSITORY_ROOT/MyProjects/trunk myrrh myrrh.tar.gz $DIST_DIR
make_distribution $REPOSITORY_ROOT/MyProjects/trunk/Bio hmm hmm.tar.gz $DIST_DIR
