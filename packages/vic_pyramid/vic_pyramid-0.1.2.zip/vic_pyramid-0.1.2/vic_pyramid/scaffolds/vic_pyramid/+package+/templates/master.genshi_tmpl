<!DOCTYPE HTML>
<html xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      py:strip=""
>

<head py:match="head" py:attrs="select('@*')">
    <meta content="text/html; charset=UTF-8" http-equiv="content-type" />

    <meta py:replace="select('*')"/>

    <link 
        rel="stylesheet" 
        href="${ request.static_url('{{package}}:static/css/style.css') }" 
        type="text/css" 
        media="screen" 
        charset="utf-8" 
    />  

</head>

<body py:match="body" py:attrs="select('@*')">

<?python

from {{package}} import flash

msgs = request.session.pop_flash()
flash_msgs = []
for msg in msgs:
    type_ = flash.DEFAULT_TYPE
    content = msg
    
    for t in flash.MSG_TYPES:
        if msg.startswith(t + ' '):
            type_ = t
            content = msg[len(t)+1:]
            break
        
    flash_msgs.append((type_, content))

?>

    <div id="login-frame">
        <py:if test="request.user_id is None">
            <a href="${ request.route_url('account.login') }">Login</a>
        </py:if>
        <py:if test="request.user_id is not None">
            Current user: ${ request.user.display_name or request.user.user_name } |
            <a href="${ request.route_url('account.logout') }">Logout</a>
        </py:if>
    </div>
    
    <div id="container">
    
        <div id="flash-msgs" py:if="flash_msgs">
            <div 
                py:for="type_, msg in flash_msgs" py:attrs="{'class': type_}"
            >
                ${ msg }
            </div>
        </div>
        
        <div py:replace="select('*|text()')"/>
    </div>

</body>
</html>
