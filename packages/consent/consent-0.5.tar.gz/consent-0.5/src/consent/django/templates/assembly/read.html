{% extends "assembly/master.html"%}

{% block title %}{{ assembly.getLabelValue|escape }}{% endblock %}

{% block content %}

<h2>{{ site.getLabelValue|escape }} {{ assembly.getLabelValue|escape }}
  {% if view.canUpdateAssembly %}
  <small><small>(<a href="{{uriPrefix}}/sites/{{site.id}}/assemblies/{{assembly.id}}/edit/">edit &raquo;</a>)</small></small>
  {% endif %}
</h2>

<h3>{{ assembly.starts|date }}</h3>

<p>{{ assembly.description|escape }}</p>

<h3>Proposals for Consensus
  {% if view.canCreateAssembly %}
  <small><small>(<a href="{{uriPrefix}}/sites/{{site.id}}/assemblies/{{ assembly.id }}/consensuses/create/">add &raquo;</a>)</small></small>
  {% endif %}
</h3>
  {% if assembly.consensuses.count %}
<table>
  <tr>
    <th class="span-4">Proposal</th>
    <th class="span-4">Result</th>
    <th class="span-12">Description</th>
    {% if view.canUpdateConsensus %}
    <th>Actions</th>
    {% endif %}
  </tr>
    {% for consensus in assembly.consensuses %}
  <tr>
    <td>
    <p><a href="{{uriPrefix}}/sites/{{ assembly.site.id }}/proposals/{{ consensus.proposal.id }}/" title="{{ consensus.proposal.getLabelValue|escape }}">#{{ consensus.proposal.id }} {{ consensus.proposal.getLabelValue|escape }}</a></p>
    </td>
    <td>{{ consensus.result.getLabelValue|escape }}</td>
    <td>
    {% if consensus.proposal.description %}
    <p>{{ consensus.proposal.description|escape }}</p>
    {% endif %}
    {% if consensus.proposal.actions %}
    <p>{{ consensus.proposal.actions|escape }}</p>
    {% endif %}

    </td>
    {% if view.canUpdateConsensus %}
    <td class="actions">
      <a href="{{uriPrefix}}/sites/{{assembly.site.id}}/assemblies/{{assembly.id}}/consensuses/{{consensus.proposal.id }}/update/"><img height="20" width="20" src="{{ consent_media_url }}/images/icon-edit.png" alt="Update" /></a>
      <a href="{{uriPrefix}}/sites/{{assembly.site.id}}/assemblies/{{assembly.id}}/consensuses/{{consensus.proposal.id }}/delete/"><img height="20" width="20" src="{{ consent_media_url }}/images/icon-delete.png" alt="Delete" /></a>
    </td>
    {% endif %}
  </tr>
    {% endfor %}
</table>

  {% else %}
     <p>There are no proposals for this assembly at this time.</p>
  {% endif %}
{% endblock %}

{% block assemblysidelinks%}
  <h2>{{assembly.getLabelValue}} </h2>
  <p>{{ assembly.consensuses.count }} scheduled proposals for consensus</p>
  <p>{{ assembly.starts|date }}</p>
  <ul>
  <li><a href="{{uriPrefix}}/sites/{{ site.id }}/assemblies/{{ assembly.id }}/">View assembly</a></li>
  {% if view.canCreateConsensus %}
  <li><a href="{{uriPrefix}}/sites/{{ site.id }}/assemblies/{{ assembly.id }}/consensuses/create/">Schedule proposal</a></li>
  {% endif %}
  {% if view.canUpdateAssembly %}
  <li><a href="{{uriPrefix}}/sites/{{ site.id }}/assemblies/{{ assembly.id }}/edit/">Edit assembly</a></li>
  {% endif %}
  {% if view.canDeleteAssembly %}
  <li><a href="{{uriPrefix}}/sites/{{ site.id }}/assemblies/{{ assembly.id }}/delete/">Delete assembly</a></li>
  {% endif %}
  </ul>
{% endblock %}


