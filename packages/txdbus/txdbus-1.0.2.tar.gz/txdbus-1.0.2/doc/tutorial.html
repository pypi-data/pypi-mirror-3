<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.3" />
<title>Tx DBus Tutorial</title>
<style type="text/css">
/* Sans-serif font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
div#toctitle,
span#author, span#revnumber, span#revdate, span#revremark,
div#footer {
  font-family: Arial,Helvetica,sans-serif;
}

/* Serif font. */
div.sectionbody {
  font-family: Georgia,"Times New Roman",Times,serif;
}

/* Monospace font. */
tt {
  font-size: inherit;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  font-size: inherit;
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
}

div#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  div#footer-badges { display: none; }
}

div#toc {
  margin-bottom: 2.5em;
}

div#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

/*
  pygmentize filter
*/
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f4f4f4; }
.highlight .c { color: #008800; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #AA22FF; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #008800; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #008800 } /* Comment.Preproc */
.highlight .c1 { color: #008800; font-style: italic } /* Comment.Single */
.highlight .cs { color: #008800; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #AA22FF; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #AA22FF; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #AA22FF; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #AA22FF } /* Keyword.Pseudo */
.highlight .kr { color: #AA22FF; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #00BB00; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BB4444 } /* Literal.String */
.highlight .na { color: #BB4444 } /* Name.Attribute */
.highlight .nb { color: #AA22FF } /* Name.Builtin */
.highlight .nc { color: #0000FF } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #00A000 } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #B8860B } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BB4444 } /* Literal.String.Backtick */
.highlight .sc { color: #BB4444 } /* Literal.String.Char */
.highlight .sd { color: #BB4444; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BB4444 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BB4444 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BB4444 } /* Literal.String.Single */
.highlight .ss { color: #B8860B } /* Literal.String.Symbol */
.highlight .bp { color: #AA22FF } /* Name.Builtin.Pseudo */
.highlight .vc { color: #B8860B } /* Name.Variable.Class */
.highlight .vg { color: #B8860B } /* Name.Variable.Global */
.highlight .vi { color: #B8860B } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */

</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){asciidoc.footnotes();}
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  var cont = document.getElementById("content");
  var noteholder = document.getElementById("footnotes");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      // Use [\s\S] in place of . so multi-line matches work.
      // Because JavaScript has no s (dotall) regex flag.
      note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      spans[i].innerHTML =
        "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
        "' title='View footnote' class='footnote'>" + n + "</a>]";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
}

}
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Tx DBus Tutorial</h1>
<span id="author">Tom Cocagne</span><br />
<span id="email"><tt>&lt;<a href="mailto:tom.cocagne@gmail.com">tom.cocagne@gmail.com</a>&gt;</tt></span><br />
<span id="revnumber">version 1.0,</span>
<span id="revdate">July 2012</span>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>Tx DBus is a native-python implementation of the DBus protocol on
top of the Twisted networking engine. The purpose of this tutorial is to
provide an introduction to the use of Tx DBus and demonstrate
the main APIs necessary to successfully incorproate it within Twisted
applications.</p></div>
<div class="paragraph"><p>This tutorial assumes a basic understanding of both Twisted
and DBus. The Twisted project provides excellent
<a href="http://twistedmatrix.com/documents/current/core/howto/index.html">documentation</a>
for quickly getting up to speed with the framework. As for DBus, several good
resources are available:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="dbus_overview.html">DBus Overview</a> (part of this project)
</p>
</li>
<li>
<p>
<a href="http://dbus.freedesktop.org/doc/dbus-tutorial.html">DBus Tutorial</a>
</p>
</li>
<li>
<p>
<a href="http://dbus.freedesktop.org/doc/dbus-specification.html">DBus Specification</a>
</p>
</li>
</ul></div>
<div class="sect2">
<h3 id="_inline_callbacks">Inline Callbacks</h3>
<div class="paragraph"><p>This tutorial leverages the <tt>defer.inlineCallbacks</tt> function decorator in
an attempt to improve readability of the example code. As inline callbacks
are not well described in the Twisted documentation, this section provides
a quick overview of the feature.</p></div>
<div class="paragraph"><p>Inline callbacks is an alternative callback mechanism that may be used in
Twisted applications running on Python 2.5+. They assist in writing
Deferred-using code that looks similar to a regular, sequential
function. Through the magic of Python&#8217;s generator mechanism, this
sequential-looking code is, in fact, fully asynchronous and functionally
equivalent to the traditional Deferred plus explicit callbacks and errbacks
mechanism. Although the inline callbacks mechanism is not quite as flexible as
explicit callbacks and errbacks, it often results in simpler and more compact
code.</p></div>
<div class="paragraph"><p>Aside from the use of the <tt>defer.inlineCallbacks</tt> function decorator, the key
to inline callbacks is to <tt>yield</tt> all deferreds. This will pause the generator
function at the point of the <tt>yield</tt> until the asynchronous operation
completes. On completion, the generator will be resumed and the result of the
operator will be returned from the <tt>yield</tt> statement. Alternatively, if the
operation resulted in an exception, the exception will be re-thrown from the
<tt>yield</tt> statement.</p></div>
<div class="paragraph"><p>The return value of functions decorated with <tt>defer.inlineCallbacks</tt> is a
deferred. Due to the nature of generator functions, inline callbacks methods
cannot use the traditional <tt>return</tt> keyword to return the result of the
asynchronous operation. Instead, they must use <tt>defer.returnValue()</tt> to
return the result. If <tt>defer.returnValue()</tt> is not used, the deferred
returned by the decorated function will result in <tt>None</tt></p></div>
<div class="listingblock">
<div class="title">Inline Callbacks Example</div>
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">defer</span><span class="p">,</span> <span class="n">utils</span>

<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">checkIPUsage</span><span class="p">(</span> <span class="n">ip_addr</span> <span class="p">):</span>
    <span class="n">ip_txt</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">utils</span><span class="o">.</span><span class="n">getProcessOutput</span><span class="p">(</span><span class="s">&#39;/sbin/ip&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;addr&#39;</span><span class="p">,</span> <span class="s">&#39;list&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">ip_addr</span> <span class="ow">in</span> <span class="n">ip_txt</span><span class="p">:</span>
        <span class="c"># True will become the result of the Deferred</span>
        <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span> <span class="bp">True</span> <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># Will trigger an errback</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;IP NOT FOUND&#39;</span><span class="p">)</span>
</pre></div></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quick_real_world_example_for_the_impatient">Quick Real-World Example for the Impatient</h2>
<div class="sectionbody">
<div class="paragraph"><p>The following example displays a notification popup on the desktop via the
the <tt>org.freedesktop.Notifications</tt> DBus API</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c">#!/usr/bin/python</span>

<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">defer</span>
<span class="kn">from</span> <span class="nn">txdbus</span> <span class="kn">import</span> <span class="n">error</span><span class="p">,</span> <span class="n">client</span>


<span class="k">def</span> <span class="nf">delay</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">Deferred</span><span class="p">()</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">callLater</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="k">lambda</span> <span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>


<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">show_desktop_notification</span><span class="p">(</span> <span class="n">duration</span><span class="p">,</span> <span class="n">message</span> <span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Shows the message as a desktop nofification for the specified</span>
<span class="sd">    number of seconds</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">con</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="s">&#39;session&#39;</span><span class="p">)</span>

    <span class="n">notifier</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">con</span><span class="o">.</span><span class="n">getRemoteObject</span><span class="p">(</span><span class="s">&#39;org.freedesktop.Notifications&#39;</span><span class="p">,</span>
                                         <span class="s">&#39;/org/freedesktop/Notifications&#39;</span><span class="p">)</span>

    <span class="n">nid</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">notifier</span><span class="o">.</span><span class="n">callRemote</span><span class="p">(</span><span class="s">&#39;Notify&#39;</span><span class="p">,</span>
                                    <span class="s">&#39;Example Application&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                    <span class="s">&#39;&#39;</span><span class="p">,</span>
                                    <span class="s">&#39;Example Notification Summary&#39;</span><span class="p">,</span>
                                    <span class="n">message</span><span class="p">,</span>
                                    <span class="p">[],</span> <span class="nb">dict</span><span class="p">(),</span>
                                    <span class="mi">10</span><span class="p">)</span>

    <span class="k">yield</span> <span class="n">delay</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">yield</span> <span class="n">notifier</span><span class="o">.</span><span class="n">callRemote</span><span class="p">(</span><span class="s">&#39;CloseNotification&#39;</span><span class="p">,</span> <span class="n">nid</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">show_desktop_notification</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&quot;Hello World!&quot;</span> <span class="p">)</span>

    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span> <span class="p">)</span>


<span class="n">reactor</span><span class="o">.</span><span class="n">callWhenRunning</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div></div></div>
</div>
</div>
<div class="sect1">
<h2 id="_dbus_connections">DBus Connections</h2>
<div class="sectionbody">
<div class="paragraph"><p>In order to make any use of DBus, a connection to the bus must first be
established. This is accomplished through the <tt>txdbus.client.connect(reactor,
busAddress="session")</tt> method which returns a Deferred to a
<tt>txdbus.client.DBusClientConnection</tt> instance. The <tt>busAddress</tt> parameter
supports two special-case addresses in addition to the standard server
addresses as defined by the DBus specification. If <em>session</em> (the default) or
<em>system</em> is passed, the client will attempt to connect to the local session or
system busses, respectively. For typical usage, these special-case addresses
will likely suffice.</p></div>
<div class="paragraph"><p>Tx DBus currently supports the <tt>unix</tt>, <tt>tcp</tt>, and <tt>nonce-tcp</tt> connection
types.</p></div>
<div class="listingblock">
<div class="title">Bus Connection</div>
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>
<span class="kn">from</span> <span class="nn">txdbus</span> <span class="kn">import</span> <span class="n">client</span>

<span class="k">def</span> <span class="nf">onConnected</span><span class="p">(</span><span class="n">cli</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;Connected to the session bus!&#39;</span>

<span class="n">dconnect</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reactor</span><span class="p">)</span>

<span class="n">dconnect</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">onConnected</span><span class="p">)</span>

<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div></div></div>
</div>
</div>
<div class="sect1">
<h2 id="_dbus_clients">DBus Clients</h2>
<div class="sectionbody">
<div class="paragraph"><p>Tx DBus provides two APIs for interacting with remote objects. The
generally preferred and significantly easier to use mechanism involves creating
local proxies to represent remote objects. Signal registration and remote
method invocation is then done by way of the proxy instances which hide
most of the low-level details. Alternatively, low-level APIs exist for
direct remote method invocation and message matching registration. Although
generally much less convenient, the low-level APIs provide full access to the
DBus internals.</p></div>
<div class="paragraph"><p>As with most dynamic language bindings, Tx DBus will automatically use the
DBus introspection mechanism to obtain interface definitions for remote objects
if they are not explicitly provided. While introspection is certainly a
convenient mechanism and appropriate for many use cases, there are some
advantages to explicitly specifying the interfaces. The primary benefit is that
it allows for signal registration and local proxy object creation irrespective
of whether or not the target bus name is currently in use.</p></div>
<div class="sect2">
<h3 id="remote_methods">Remote Methods</h3>
<div class="paragraph"><p>As there is a delay involved in remote method invocation, remote calls always
result in a Deferred instance. When the results eventually become available,
the deferred will be callbacked/errbacked with the returned value. The format
of the return value depends on the interface specification for the remote
method.</p></div>
<div class="paragraph"><p>If the interface does not specify any return values, the return value will be
<tt>None</tt>. If only one value is returned (structures and arrays are considered
single values), that value will be returned as the result. Otherwise, if
multiple values are returned, the result will be a Python list containing the
returned values in the order specified by the DBus signature.</p></div>
<div class="paragraph"><p>There are two mechanisms for invoking remote methods. The easier of the two
is to invoke the remote method through a local proxy object. This has the
advantage of hiding many of the low-level DBus details and provides a simpler
interface. Alternatively, the methods may be invoked directly without the use
of proxy objects. In this case, however, all required parameters for the
method invocation must be specified manually.</p></div>
<div class="paragraph"><p>Both mechanisms use a function called <tt>callRemote()</tt> to effect the remote
method invocation. The low-level <tt>callRemote()</tt> is provided by the
<tt>txdbus.client.DBusClientConnection</tt> class and requires a large number of
arguments.  The proxy object&#8217;s <tt>callRemote()</tt> method wraps the low-level method
and hides most of the details. In addition to accepting the name of the method
to invoke and a list of positional arguments, both interfaces also accept the
following optional keyword arguments that may be used to augment the remote
method invocation.</p></div>
<div class="tableblock">
<table rules="all"
width="90%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 1. callRemote() Optional Keyword Arguments</caption>
<col width="9%" />
<col width="90%" />
<thead>
<tr>
<th align="left" valign="top">Keyword </th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><tt>expectReply</tt></p></td>
<td align="left" valign="top"><p class="table">By default, the returned Deferred will callback/errback when
the result of the remote invocation becomes available. If this parameter
is set to <tt>True</tt> (defaults to <tt>False</tt>), defer.suceed(None) will be returned
immediately and no DBus MethodReturn message will be sent over the bus in
response to the invocation.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>autoStart</tt></p></td>
<td align="left" valign="top"><p class="table">If set to <tt>True</tt> (the default), the DBus daemon will attempt to auto-start a
service to handle the remote call if the service is not already running.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>timeout</tt></p></td>
<td align="left" valign="top"><p class="table">If specified, the returned Deferred will be errbacked with a <tt>txdbus.error.TimeOut</tt>
instance if the remote call does not return before the timeout elapses (defaults to
infinity).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><tt>interface</tt></p></td>
<td align="left" valign="top"><p class="table">If specified, the remote call will invoke the method on the named interface. If left
unspecified and more than one interface provides a method with the same name it is
"implementation" defined as to which will be invoked.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_proxy_objects">Proxy Objects</h3>
<div class="paragraph"><p>Remote DBus objects are generally interacted with by way of local proxy objects.
The following example demonstrates the creation of a proxy object and a remote
method invocation.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">defer</span>

<span class="kn">from</span> <span class="nn">txdbus</span> <span class="kn">import</span> <span class="n">client</span><span class="p">,</span> <span class="n">error</span>

<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cli</span>  <span class="o">=</span> <span class="k">yield</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reactor</span><span class="p">)</span>

        <span class="n">robj</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">cli</span><span class="o">.</span><span class="n">getRemoteObject</span><span class="p">(</span> <span class="s">&#39;org.example&#39;</span><span class="p">,</span> <span class="s">&#39;/MyObjPath&#39;</span> <span class="p">)</span>

        <span class="k">yield</span> <span class="n">robj</span><span class="o">.</span><span class="n">callRemote</span><span class="p">(</span><span class="s">&#39;Ping&#39;</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&#39;Ping Succeeded. org.example is available&#39;</span>

    <span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">DBusException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Ping Failed. org.example is not available&#39;</span>

    <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="n">reactor</span><span class="o">.</span><span class="n">callWhenRunning</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div></div></div>
<div class="paragraph"><p>The local proxy object uses the remote object&#8217;s interface definition to provide
a local representation of the remote object&#8217;s API. As no explicit interface
description was provided in the <tt>getRemoteObject()</tt> call, the interfaces must be
introspected prior to creation of the local proxy object.</p></div>
<div class="paragraph"><p>Remote method invocation on proxy objects is done through their <tt>callRemote()</tt>
method. The first argument is the name of the method to be invoked and the
subsequent positional arguments are the arguments to be passed to the remote
method. The optional keyword arguments described in the <a href="#remote_methods">Remote Methods</a> section may be used to augment the call as desired.</p></div>
</div>
<div class="sect2">
<h3 id="_low_level_method_invocation">Low Level Method Invocation</h3>
<div class="paragraph"><p>In addition to method invocation through proxy objects, the
<tt>txdbus.client.DBusClientConnection</tt> class provides a low-level <tt>callRemote()</tt>
function that may be used to directly invoke remote methods. However, all
parameters typically hidden by the proxy objects such as signature strings,
destination bus addresses, and the like must be explicitly specified. As with
the proxy object&#8217;s <tt>callRemote()</tt>, this method also accepts the optional
keyword arguments listed in the <a href="#remote_methods">Remote Methods</a> section.</p></div>
<div class="paragraph"><p>The following example is equivalent to the previous one but uses the low-level
API to invoke the <tt>Ping</tt> method without the use of a proxy object.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">defer</span>

<span class="kn">from</span> <span class="nn">txdbus</span> <span class="kn">import</span> <span class="n">client</span><span class="p">,</span> <span class="n">error</span>

<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cli</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reactor</span><span class="p">)</span>

        <span class="k">yield</span> <span class="n">cli</span><span class="o">.</span><span class="n">callRemote</span><span class="p">(</span> <span class="s">&#39;/AnyValidObjPath&#39;</span><span class="p">,</span> <span class="s">&#39;Ping&#39;</span><span class="p">,</span>
                              <span class="n">interface</span>   <span class="o">=</span> <span class="s">&#39;org.freedesktop.DBus.Peer&#39;</span><span class="p">,</span>
                              <span class="n">destination</span> <span class="o">=</span> <span class="s">&#39;org.example&#39;</span> <span class="p">)</span>

        <span class="k">print</span> <span class="s">&#39;Ping Succeeded. org.example is available&#39;</span>

    <span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">DBusException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Ping Failed. org.example is not available&#39;</span>

    <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="n">reactor</span><span class="o">.</span><span class="n">callWhenRunning</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The <tt>Ping</tt> function is used here because it&#8217;s a standard interface that&#8217;s
guaranteed to exist. However, it&#8217;s worth mentioning that <tt>Ping</tt> is handled
specially and can be somewhat misleading. Although it would appear the remote
object referred to by the object path is the target of the <tt>Ping</tt> function, it
is in fact just the bus name that is being pinged. The object path is
ignored. Consequently, this function cannot be used to test for the
availability of a specific object.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_explicit_interface_specification">Explicit Interface Specification</h3>
<div class="paragraph"><p>The following example extends the previous two by demonstrating explicit
interface specification for a remote object.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">defer</span>

<span class="kn">from</span> <span class="nn">txdbus</span>           <span class="kn">import</span> <span class="n">client</span><span class="p">,</span> <span class="n">error</span>
<span class="kn">from</span> <span class="nn">txdbus.interface</span> <span class="kn">import</span> <span class="n">DBusInterface</span><span class="p">,</span> <span class="n">Method</span>

<span class="n">peer_iface</span> <span class="o">=</span> <span class="n">DBusInterface</span><span class="p">(</span> <span class="s">&#39;org.freedesktop.DBus.Peer&#39;</span><span class="p">,</span>
                            <span class="n">Method</span><span class="p">(</span><span class="s">&#39;Ping&#39;</span><span class="p">)</span>
                          <span class="p">)</span>

<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cli</span>  <span class="o">=</span> <span class="k">yield</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reactor</span><span class="p">)</span>

        <span class="n">robj</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">cli</span><span class="o">.</span><span class="n">getRemoteObject</span><span class="p">(</span> <span class="s">&#39;org.example&#39;</span><span class="p">,</span> <span class="s">&#39;/MyObjPath&#39;</span><span class="p">,</span> <span class="n">peer_iface</span> <span class="p">)</span>

        <span class="k">yield</span> <span class="n">robj</span><span class="o">.</span><span class="n">callRemote</span><span class="p">(</span><span class="s">&#39;Ping&#39;</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&#39;Ping Succeeded. org.example is available&#39;</span>

    <span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">DBusException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Ping Failed. org.example is not available&#39;</span>

    <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="n">reactor</span><span class="o">.</span><span class="n">callWhenRunning</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div></div></div>
<div class="paragraph"><p>Of course, the <tt>org.freedesktop.DBus.Peer</tt> interface is rather simplistic. To
better demonstrate DBus interface definition, consider the following code</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">txdbus.interface</span> <span class="kn">import</span> <span class="n">DBusInterface</span><span class="p">,</span> <span class="n">Method</span><span class="p">,</span> <span class="n">Signal</span>

<span class="c"># Method( method_name, arguments=&#39;&#39;, returns=&#39;&#39;)</span>
<span class="c"># Signal( signal_name, arguments=&#39;&#39; )</span>
<span class="c">#</span>
<span class="c"># The arguments and returns parameters must be empty strings for</span>
<span class="c"># no arguments/return values or a valid DBus signature string</span>
<span class="c">#</span>
<span class="n">iface</span> <span class="o">=</span> <span class="n">DBusInterface</span><span class="p">(</span> <span class="s">&#39;org.example&#39;</span><span class="p">,</span>
                       <span class="n">Method</span><span class="p">(</span><span class="s">&#39;simple&#39;</span><span class="p">),</span>
                       <span class="n">Method</span><span class="p">(</span><span class="s">&#39;full&#39;</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="s">&#39;i&#39;</span><span class="p">),</span>
                       <span class="n">Method</span><span class="p">(</span><span class="s">&#39;retOnly&#39;</span><span class="p">,</span> <span class="n">returns</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">),</span>
                       <span class="n">Method</span><span class="p">(</span><span class="s">&#39;argOnly&#39;</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">),</span>
                       <span class="n">Signal</span><span class="p">(</span><span class="s">&#39;noDataSignal&#39;</span><span class="p">),</span>
                       <span class="n">Signal</span><span class="p">(</span><span class="s">&#39;DataSignal&#39;</span><span class="p">,</span> <span class="s">&#39;as&#39;</span><span class="p">)</span> <span class="p">)</span>
</pre></div></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exporting_objects_over_dbus">Exporting Objects Over DBus</h2>
<div class="sectionbody">
<div class="paragraph"><p>In order to export an object over DBus, it must support the
<tt>txdbus.objects.IDBusObject</tt> interface. While this interface may be directly
supported by applications, it will typically be easier to derive from the
default implementation provided by the <tt>txdbus.objects.DBusObject</tt> class. The
easiest way to explain its use is by way of example. The following code
demonstrates a simple object exported over DBus.</p></div>
<div class="listingblock">
<div class="title">Example Exported Object</div>
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">defer</span>

<span class="kn">from</span> <span class="nn">txdbus</span>           <span class="kn">import</span> <span class="n">client</span><span class="p">,</span> <span class="n">objects</span><span class="p">,</span> <span class="n">error</span>
<span class="kn">from</span> <span class="nn">txdbus.interface</span> <span class="kn">import</span> <span class="n">DBusInterface</span><span class="p">,</span> <span class="n">Method</span>


<span class="k">class</span> <span class="nc">MyObj</span> <span class="p">(</span><span class="n">objects</span><span class="o">.</span><span class="n">DBusObject</span><span class="p">):</span>

    <span class="n">iface</span> <span class="o">=</span> <span class="n">DBusInterface</span><span class="p">(</span><span class="s">&#39;org.example.MyIFace&#39;</span><span class="p">,</span>
                          <span class="n">Method</span><span class="p">(</span><span class="s">&#39;exampleMethod&#39;</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="n">returns</span><span class="o">=</span><span class="s">&#39;s&#39;</span> <span class="p">))</span>

    <span class="n">dbusInterfaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">iface</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objectPath</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyObj</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">objectPath</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">dbus_exampleMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&#39;Received remote call. Argument: &#39;</span><span class="p">,</span> <span class="n">arg</span>
        <span class="k">return</span> <span class="s">&#39;You sent (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">arg</span>


<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reactor</span><span class="p">)</span>

        <span class="n">conn</span><span class="o">.</span><span class="n">exportObject</span><span class="p">(</span> <span class="n">MyObj</span><span class="p">(</span><span class="s">&#39;/MyObjPath&#39;</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">yield</span> <span class="n">conn</span><span class="o">.</span><span class="n">requestBusName</span><span class="p">(</span><span class="s">&#39;org.example&#39;</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&#39;Object exported on bus name &quot;org.example&quot; with path /MyObjPath&#39;</span>

    <span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">DBusException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Failed to export object: &#39;</span><span class="p">,</span> <span class="n">e</span>
        <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="n">reactor</span><span class="o">.</span><span class="n">callWhenRunning</span><span class="p">(</span> <span class="n">main</span> <span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div></div></div>
<div class="paragraph"><p>This example demonstrates several key issues for subclasses of <tt>DBusObject</tt>.
The DBus interfaces supported by an object are declared by way of a class-level
variable named <tt>dbusInterfaces</tt>. This variable contains a list of
<tt>DBusInterface</tt> instances which define an interface&#8217;s API. When class
inheritance is used, the <tt>dbusInterfaces</tt> variables of all superclasses are
conjoined to determine the full set of APIs supported by the object.</p></div>
<div class="paragraph"><p>Supporting the methods declared in the DBus interfaces is as simple as creating
methods named <tt>dbus_&lt;DBusMethodName&gt;</tt>. These methods may return Deferreds to
the final results if those results are not immediately available.</p></div>
<div class="paragraph"><p>The following code demonstrates the use of the exported object.</p></div>
<div class="listingblock">
<div class="title">Use of the Exported Object</div>
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">defer</span>

<span class="kn">from</span> <span class="nn">txdbus</span> <span class="kn">import</span> <span class="n">client</span><span class="p">,</span> <span class="n">error</span>


<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cli</span>   <span class="o">=</span> <span class="k">yield</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reactor</span><span class="p">)</span>

        <span class="n">robj</span>  <span class="o">=</span> <span class="k">yield</span> <span class="n">cli</span><span class="o">.</span><span class="n">getRemoteObject</span><span class="p">(</span> <span class="s">&#39;org.example&#39;</span><span class="p">,</span> <span class="s">&#39;/MyObjPath&#39;</span> <span class="p">)</span>

        <span class="n">reply</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">robj</span><span class="o">.</span><span class="n">callRemote</span><span class="p">(</span><span class="s">&#39;exampleMethod&#39;</span><span class="p">,</span> <span class="s">&#39;Hello World!&#39;</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&#39;Reply from server: &#39;</span><span class="p">,</span> <span class="n">reply</span>

    <span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">DBusException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;DBus Error:&#39;</span><span class="p">,</span> <span class="n">e</span>

    <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="n">reactor</span><span class="o">.</span><span class="n">callWhenRunning</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div></div></div>
<div class="sect2">
<h3 id="_dbus_properties">DBus Properties</h3>
<div class="paragraph"><p>Tx DBus supports DBus Properties through the
<tt>txdbus.objects.DBusProperty</tt> class. This class leverages Python&#8217;s
descriptor capabilities to provide near-transparent support for
DBus Properties.</p></div>
<div class="paragraph"><p>If the <tt>Property</tt> in the <tt>DBusInterface</tt> class set <tt>emitsOnChanged</tt> to
<tt>True</tt>, an <tt>org.freedesktop.DBus.Properties.PropertiesChanged</tt> signal
will be generated each time the value is assigned to (defaults to True).</p></div>
<div class="listingblock">
<div class="title">Server Properties Example</div>
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">defer</span>

<span class="kn">from</span> <span class="nn">txdbus</span>           <span class="kn">import</span> <span class="n">client</span><span class="p">,</span> <span class="n">objects</span><span class="p">,</span> <span class="n">error</span>
<span class="kn">from</span> <span class="nn">txdbus.interface</span> <span class="kn">import</span> <span class="n">DBusInterface</span><span class="p">,</span> <span class="n">Property</span>
<span class="kn">from</span> <span class="nn">txdbus.objects</span>   <span class="kn">import</span> <span class="n">DBusProperty</span>


<span class="k">class</span> <span class="nc">MyObj</span> <span class="p">(</span><span class="n">objects</span><span class="o">.</span><span class="n">DBusObject</span><span class="p">):</span>

    <span class="n">iface</span> <span class="o">=</span> <span class="n">DBusInterface</span><span class="p">(</span><span class="s">&#39;org.example.MyIFace&#39;</span><span class="p">,</span>
                          <span class="n">Property</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="n">writeable</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

    <span class="n">dbusInterfaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">iface</span><span class="p">]</span>

    <span class="n">foo</span> <span class="o">=</span> <span class="n">DBusProperty</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objectPath</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyObj</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">objectPath</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="s">&#39;bar&#39;</span>


<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reactor</span><span class="p">)</span>

        <span class="n">conn</span><span class="o">.</span><span class="n">exportObject</span><span class="p">(</span> <span class="n">MyObj</span><span class="p">(</span><span class="s">&#39;/MyObjPath&#39;</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">yield</span> <span class="n">conn</span><span class="o">.</span><span class="n">requestBusName</span><span class="p">(</span><span class="s">&#39;org.example&#39;</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&#39;Object exported on bus name &quot;org.example&quot; with path /MyObjPath&#39;</span>

    <span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">DBusException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Failed to export object: &#39;</span><span class="p">,</span> <span class="n">e</span>
        <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="n">reactor</span><span class="o">.</span><span class="n">callWhenRunning</span><span class="p">(</span> <span class="n">main</span> <span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div></div></div>
<div class="paragraph"><p>Client-side property use:</p></div>
<div class="listingblock">
<div class="title">Client-side Properties Example</div>
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">defer</span>

<span class="kn">from</span> <span class="nn">txdbus</span> <span class="kn">import</span> <span class="n">client</span><span class="p">,</span> <span class="n">error</span>


<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cli</span>   <span class="o">=</span> <span class="k">yield</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reactor</span><span class="p">)</span>

        <span class="n">robj</span>  <span class="o">=</span> <span class="k">yield</span> <span class="n">cli</span><span class="o">.</span><span class="n">getRemoteObject</span><span class="p">(</span> <span class="s">&#39;org.example&#39;</span><span class="p">,</span> <span class="s">&#39;/MyObjPath&#39;</span> <span class="p">)</span>

        <span class="c"># Use the standard org.freedesktop.DBus.Properties.Get function to</span>
        <span class="c"># obtain the value of &#39;foo&#39;. Only one interface on the remote object</span>
        <span class="c"># declares &#39;foo&#39; so the interface name (the second function argument)</span>
        <span class="c"># may be omitted.</span>
        <span class="n">foo</span>   <span class="o">=</span> <span class="k">yield</span> <span class="n">robj</span><span class="o">.</span><span class="n">callRemote</span><span class="p">(</span><span class="s">&#39;Get&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>

        <span class="c"># prints &quot;bar&quot;</span>
        <span class="k">print</span> <span class="n">foo</span>

        <span class="k">yield</span> <span class="n">robj</span><span class="o">.</span><span class="n">callRemote</span><span class="p">(</span><span class="s">&#39;Set&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;baz&#39;</span><span class="p">)</span>

        <span class="n">foo</span>   <span class="o">=</span> <span class="k">yield</span> <span class="n">robj</span><span class="o">.</span><span class="n">callRemote</span><span class="p">(</span><span class="s">&#39;Get&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">)</span>

        <span class="c"># prints &quot;baz&quot;</span>
        <span class="k">print</span> <span class="n">foo</span>


    <span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">DBusException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;DBus Error:&#39;</span><span class="p">,</span> <span class="n">e</span>

    <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="n">reactor</span><span class="o">.</span><span class="n">callWhenRunning</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_caller_identity">Caller Identity</h3>
<div class="paragraph"><p>The identity of the calling DBus connection can be reliably determined
in DBus. Methods wishing to know the identity of the connection invoking
them may add a <tt>dbusCaller=None</tt> key-word argument. Methods supporting
this argument will be supplied with the unique bus name of the calling
connection.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">dbus_identityExample</span><span class="p">(</span><span class="n">dbusCaller</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&#39;Calling connection: &#39;</span><span class="p">,</span> <span class="n">dbusCaller</span>
</pre></div></div></div>
<div class="paragraph"><p>Although the unique bus name of the caller is often not very useful
in and of itself it can be reliably converted into a Unix user id
with the <tt>getConnectionUnixUser()</tt> method of
<tt>txdbus.client.DBusClientConnection</tt>:</p></div>
<div class="listingblock">
<div class="title">Determining Unix User Id of the caller</div>
<div class="content"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">dbus_identityExample</span><span class="p">(</span><span class="n">dbusCaller</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConnection</span><span class="p">()</span><span class="o">.</span><span class="n">getConnectionUnixUser</span><span class="p">(</span> <span class="n">dbusCaller</span> <span class="p">)</span>

        <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">uid</span> <span class="p">:</span> <span class="s">&#39;Your Unix User Id is: </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">uid</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">d</span>
</pre></div></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resolving_conflicting_interface_declarations">Resolving Conflicting Interface Declarations</h2>
<div class="sectionbody">
<div class="paragraph"><p>Mapping DBus method calls to methods named <tt>dbus_&lt;DBusMethodName&gt;</tt> is generally
a convenient mechanism. However, it can result in confusion when multiple
supported interfaces define methods with the same name.  To resolve this
situation, the <tt>dbusMethod()</tt> decorator may be used to explicitly bind a method
to the desired interface.</p></div>
<div class="listingblock">
<div class="title">Resolving Conflicting Interface Method Declarations - Server Side</div>
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">defer</span>

<span class="kn">from</span> <span class="nn">txdbus</span>           <span class="kn">import</span> <span class="n">client</span><span class="p">,</span> <span class="n">objects</span><span class="p">,</span> <span class="n">error</span>
<span class="kn">from</span> <span class="nn">txdbus.interface</span> <span class="kn">import</span> <span class="n">DBusInterface</span><span class="p">,</span> <span class="n">Method</span>
<span class="kn">from</span> <span class="nn">txdbus.objects</span>   <span class="kn">import</span> <span class="n">dbusMethod</span>


<span class="k">class</span> <span class="nc">MyObj</span> <span class="p">(</span><span class="n">objects</span><span class="o">.</span><span class="n">DBusObject</span><span class="p">):</span>

    <span class="n">iface1</span> <span class="o">=</span> <span class="n">DBusInterface</span><span class="p">(</span><span class="s">&#39;org.example.MyIFace1&#39;</span><span class="p">,</span>
                           <span class="n">Method</span><span class="p">(</span><span class="s">&#39;common&#39;</span><span class="p">))</span>

    <span class="n">iface2</span> <span class="o">=</span> <span class="n">DBusInterface</span><span class="p">(</span><span class="s">&#39;org.example.MyIFace2&#39;</span><span class="p">,</span>
                           <span class="n">Method</span><span class="p">(</span><span class="s">&#39;common&#39;</span><span class="p">))</span>

    <span class="n">dbusInterfaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">iface1</span><span class="p">,</span> <span class="n">iface2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objectPath</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyObj</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">objectPath</span><span class="p">)</span>

    <span class="nd">@dbusMethod</span><span class="p">(</span><span class="s">&#39;org.example.MyIFace1&#39;</span><span class="p">,</span> <span class="s">&#39;common&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">dbus_common1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&#39;iface1 common called!&#39;</span>

    <span class="nd">@dbusMethod</span><span class="p">(</span><span class="s">&#39;org.example.MyIFace2&#39;</span><span class="p">,</span> <span class="s">&#39;common&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">dbus_common2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&#39;iface2 common called!&#39;</span>


<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reactor</span><span class="p">)</span>

        <span class="n">conn</span><span class="o">.</span><span class="n">exportObject</span><span class="p">(</span> <span class="n">MyObj</span><span class="p">(</span><span class="s">&#39;/MultiInterfaceObject&#39;</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">yield</span> <span class="n">conn</span><span class="o">.</span><span class="n">requestBusName</span><span class="p">(</span><span class="s">&#39;org.example&#39;</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&#39;Object exported on bus name &quot;org.example&quot; with path /MultiInterfaceObject&#39;</span>

    <span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">DBusException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Failed to export object: &#39;</span><span class="p">,</span> <span class="n">e</span>
        <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="n">reactor</span><span class="o">.</span><span class="n">callWhenRunning</span><span class="p">(</span> <span class="n">main</span> <span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div></div></div>
<div class="paragraph"><p>Similarly, action must be taken on the client side to ensure that the
appropriate function is executed when multiple interfaces support methods of
the same name. The <tt>interface</tt> key-word argument to the <tt>callRemote()</tt> function
may be used to identify the desired interface.  If the <tt>interfaces</tt> argument is
not used in this situation, it is "implementation defined" as to which
interface&#8217;s method will be invoked.</p></div>
<div class="listingblock">
<div class="title">Resolving Conflicting Interface Method Declarations - Client Side</div>
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">defer</span>

<span class="kn">from</span> <span class="nn">txdbus</span> <span class="kn">import</span> <span class="n">client</span><span class="p">,</span> <span class="n">error</span>


<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cli</span>   <span class="o">=</span> <span class="k">yield</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reactor</span><span class="p">)</span>

        <span class="n">robj</span>  <span class="o">=</span> <span class="k">yield</span> <span class="n">cli</span><span class="o">.</span><span class="n">getRemoteObject</span><span class="p">(</span> <span class="s">&#39;org.example&#39;</span><span class="p">,</span> <span class="s">&#39;/MultiInterfaceObject&#39;</span> <span class="p">)</span>

        <span class="k">yield</span> <span class="n">robj</span><span class="o">.</span><span class="n">callRemote</span><span class="p">(</span><span class="s">&#39;common&#39;</span><span class="p">,</span> <span class="n">interface</span><span class="o">=</span><span class="s">&#39;org.example.MyIFace1&#39;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">robj</span><span class="o">.</span><span class="n">callRemote</span><span class="p">(</span><span class="s">&#39;common&#39;</span><span class="p">,</span> <span class="n">interface</span><span class="o">=</span><span class="s">&#39;org.example.MyIFace2&#39;</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">DBusException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;DBus Error:&#39;</span><span class="p">,</span> <span class="n">e</span>

    <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="n">reactor</span><span class="o">.</span><span class="n">callWhenRunning</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div></div></div>
</div>
</div>
<div class="sect1">
<h2 id="_signals">Signals</h2>
<div class="sectionbody">
<div class="paragraph"><p>Signals are emitted by subclasses of <tt>DBusObject</tt> using the <tt>emitSignal()</tt> method</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">defer</span>

<span class="kn">from</span> <span class="nn">txdbus</span>           <span class="kn">import</span> <span class="n">client</span><span class="p">,</span> <span class="n">objects</span><span class="p">,</span> <span class="n">error</span>
<span class="kn">from</span> <span class="nn">txdbus.interface</span> <span class="kn">import</span> <span class="n">DBusInterface</span><span class="p">,</span> <span class="n">Signal</span>


<span class="k">class</span> <span class="nc">SignalSender</span> <span class="p">(</span><span class="n">objects</span><span class="o">.</span><span class="n">DBusObject</span><span class="p">):</span>

    <span class="n">iface</span> <span class="o">=</span> <span class="n">DBusInterface</span><span class="p">(</span> <span class="s">&#39;org.example.SignalSender&#39;</span><span class="p">,</span>
                           <span class="n">Signal</span><span class="p">(</span><span class="s">&#39;tick&#39;</span><span class="p">,</span> <span class="s">&#39;u&#39;</span><span class="p">)</span>
                         <span class="p">)</span>

    <span class="n">dbusInterfaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">iface</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objectPath</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SignalSender</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">objectPath</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>


    <span class="k">def</span> <span class="nf">sendTick</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emitSignal</span><span class="p">(</span><span class="s">&#39;tick&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">reactor</span><span class="o">.</span><span class="n">callLater</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sendTick</span><span class="p">)</span>


<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reactor</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">SignalSender</span><span class="p">(</span><span class="s">&#39;/Signaller&#39;</span><span class="p">)</span>

        <span class="n">conn</span><span class="o">.</span><span class="n">exportObject</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span>

        <span class="k">yield</span> <span class="n">conn</span><span class="o">.</span><span class="n">requestBusName</span><span class="p">(</span><span class="s">&#39;org.example&#39;</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&#39;Object exported on bus name &quot;org.example&quot; with path /Signaller&#39;</span>
        <span class="k">print</span> <span class="s">&#39;Emitting &quot;tick&quot; signals every second&#39;</span>

        <span class="n">s</span><span class="o">.</span><span class="n">sendTick</span><span class="p">()</span> <span class="c"># begin looping</span>

    <span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">DBusException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Failed to export object: &#39;</span><span class="p">,</span> <span class="n">e</span>
        <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="n">reactor</span><span class="o">.</span><span class="n">callWhenRunning</span><span class="p">(</span> <span class="n">main</span> <span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div></div></div>
<div class="paragraph"><p>The corresponding client code to receive the emitted signals is:</p></div>
<div class="listingblock">
<div class="title">Signal Reception Example</div>
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">defer</span>

<span class="kn">from</span> <span class="nn">txdbus</span> <span class="kn">import</span> <span class="n">client</span><span class="p">,</span> <span class="n">error</span>


<span class="k">def</span> <span class="nf">onSignal</span><span class="p">(</span> <span class="n">tickCount</span> <span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;Got tick signal: &#39;</span><span class="p">,</span> <span class="n">tickCount</span>


<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cli</span>   <span class="o">=</span> <span class="k">yield</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reactor</span><span class="p">)</span>

        <span class="n">robj</span>  <span class="o">=</span> <span class="k">yield</span> <span class="n">cli</span><span class="o">.</span><span class="n">getRemoteObject</span><span class="p">(</span> <span class="s">&#39;org.example&#39;</span><span class="p">,</span> <span class="s">&#39;/Signaller&#39;</span> <span class="p">)</span>

        <span class="n">robj</span><span class="o">.</span><span class="n">notifyOnSignal</span><span class="p">(</span> <span class="s">&#39;tick&#39;</span><span class="p">,</span> <span class="n">onSignal</span> <span class="p">)</span>

    <span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">DBusException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;DBus Error:&#39;</span><span class="p">,</span> <span class="n">e</span>


<span class="n">reactor</span><span class="o">.</span><span class="n">callWhenRunning</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that this client code uses introspection to obtain the API of the
remote object emitting the signals. Consequently, the server application must
be up and running when the client application starts or an error will be thrown
from <tt>getRemoteObject()</tt> when the introspection fails. Were the interface
specified explicitly, the signal registration would succeed even if the
emitting application were entirely disconnected from the bus. The following
code can be run at any time and, if launched before the signal-emitting
application, it will never miss any messages.</p></div>
<div class="listingblock">
<div class="title">Signal Reception With Explicit Interface Specification</div>
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">defer</span>

<span class="kn">from</span> <span class="nn">txdbus</span>           <span class="kn">import</span> <span class="n">client</span><span class="p">,</span> <span class="n">error</span>
<span class="kn">from</span> <span class="nn">txdbus.interface</span> <span class="kn">import</span> <span class="n">DBusInterface</span><span class="p">,</span> <span class="n">Signal</span>

<span class="n">signal_iface</span> <span class="o">=</span> <span class="n">DBusInterface</span><span class="p">(</span> <span class="s">&#39;org.example.SignalSender&#39;</span><span class="p">,</span>
                              <span class="n">Signal</span><span class="p">(</span><span class="s">&#39;tick&#39;</span><span class="p">,</span> <span class="s">&#39;u&#39;</span><span class="p">)</span>
                              <span class="p">)</span>

<span class="k">def</span> <span class="nf">onSignal</span><span class="p">(</span> <span class="n">tickCount</span> <span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;Got tick signal: &#39;</span><span class="p">,</span> <span class="n">tickCount</span>


<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cli</span>   <span class="o">=</span> <span class="k">yield</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reactor</span><span class="p">)</span>

        <span class="n">robj</span>  <span class="o">=</span> <span class="k">yield</span> <span class="n">cli</span><span class="o">.</span><span class="n">getRemoteObject</span><span class="p">(</span> <span class="s">&#39;org.example&#39;</span><span class="p">,</span> <span class="s">&#39;/Signaller&#39;</span><span class="p">,</span> <span class="n">signal_iface</span> <span class="p">)</span>

        <span class="n">robj</span><span class="o">.</span><span class="n">notifyOnSignal</span><span class="p">(</span> <span class="s">&#39;tick&#39;</span><span class="p">,</span> <span class="n">onSignal</span> <span class="p">)</span>

    <span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">DBusException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;DBus Error:&#39;</span><span class="p">,</span> <span class="n">e</span>


<span class="n">reactor</span><span class="o">.</span><span class="n">callWhenRunning</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div></div></div>
</div>
</div>
<div class="sect1">
<h2 id="_dbus_structure_handling_and_object_serialization">DBus Structure Handling and Object Serialization</h2>
<div class="sectionbody">
<div class="paragraph"><p>When calling methods that accept structures as arguments, such as
<tt>(si)</tt> (a structure containing a string and 32-bit signed integer)
the argument passed to the callRemote() method should be 2-element
list containing the desired string and integer</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>    <span class="c"># -- Server Snippet --</span>
    <span class="o">...</span>
    <span class="n">Method</span><span class="p">(</span><span class="s">&#39;structArg&#39;</span><span class="p">,</span> <span class="s">&#39;(si)&#39;</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">dbus_structArg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;You sent (</span><span class="si">%s</span><span class="s">, </span><span class="si">%d</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c"># -- Client Snippet --</span>
    <span class="n">remoteObj</span><span class="o">.</span><span class="n">callRemote</span><span class="p">(</span><span class="s">&#39;structArg&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;Foobar&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div></div></div>
<div class="paragraph"><p>It is also possible to pass Python objects instead of lists to arguments
requiring a structure type. If the object contains a <tt>dbusOrder</tt> member
variable, it will be used as an ordered list of attribute names by the
serialization process. For example, the client portion of the previous code
snippet could be equivalently written as</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>    <span class="k">class</span> <span class="nc">DBSerializeable</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
       <span class="n">dbusOrder</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;text&#39;</span><span class="p">,</span> <span class="s">&#39;number&#39;</span><span class="p">]</span>
       <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">text</span>   <span class="o">=</span> <span class="n">txt</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">num</span>

    <span class="n">serialObj</span> <span class="o">=</span> <span class="n">DBSerializeable</span><span class="p">(</span> <span class="s">&#39;Foobar&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>

    <span class="n">remoteObj</span><span class="o">.</span><span class="n">callRemote</span><span class="p">(</span><span class="s">&#39;structArg&#39;</span><span class="p">,</span> <span class="n">serialObj</span><span class="p">)</span>
</pre></div></div></div>
</div>
</div>
<div class="sect1">
<h2 id="_error_handling">Error Handling</h2>
<div class="sectionbody">
<div class="paragraph"><p>DBus reports errors with dedicated error messages. Some of these messages
are generated by the bus itself, such as when a remote method call is sent
to bus name that does not exist, others are generated within client
applications, such as when invalid argument values are detected.</p></div>
<div class="paragraph"><p>Any exception raised during the invocation of a <tt>dbus_*</tt> method will be
converted into a proper DBus error message. The name of the DBus error message
will default to <tt>org.txdbus.PythonException.&lt;CLASS_NAME&gt;</tt>. If the
exception object has a <tt>dbusErrorName</tt> member variable, that value will be used
instead. All error messages sent by this implementation include a single string
parameter that is obtained by converting the exception instance to a string.</p></div>
<div class="listingblock">
<div class="title">Error Generation Example</div>
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">defer</span>

<span class="kn">from</span> <span class="nn">txdbus</span>           <span class="kn">import</span> <span class="n">client</span><span class="p">,</span> <span class="n">objects</span><span class="p">,</span> <span class="n">error</span>
<span class="kn">from</span> <span class="nn">txdbus.interface</span> <span class="kn">import</span> <span class="n">DBusInterface</span><span class="p">,</span> <span class="n">Method</span>

<span class="k">class</span> <span class="nc">ExampleException</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="n">dbusErrorName</span> <span class="o">=</span> <span class="s">&#39;org.example.ExampleException&#39;</span>

<span class="k">class</span> <span class="nc">ErrObj</span> <span class="p">(</span><span class="n">objects</span><span class="o">.</span><span class="n">DBusObject</span><span class="p">):</span>

    <span class="n">iface</span> <span class="o">=</span> <span class="n">DBusInterface</span><span class="p">(</span><span class="s">&#39;org.example.ErrorExample&#39;</span><span class="p">,</span>
                          <span class="n">Method</span><span class="p">(</span><span class="s">&#39;throwError&#39;</span><span class="p">))</span>


    <span class="n">dbusInterfaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">iface</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objectPath</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ErrObj</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">objectPath</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">dbus_throwError</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ExampleException</span><span class="p">(</span><span class="s">&#39;Uh oh&#39;</span><span class="p">)</span>


<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reactor</span><span class="p">)</span>

        <span class="n">conn</span><span class="o">.</span><span class="n">exportObject</span><span class="p">(</span> <span class="n">ErrObj</span><span class="p">(</span><span class="s">&#39;/ErrorObject&#39;</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">yield</span> <span class="n">conn</span><span class="o">.</span><span class="n">requestBusName</span><span class="p">(</span><span class="s">&#39;org.example&#39;</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&#39;Object exported on bus name &quot;org.example&quot; with path /ErrorObject&#39;</span>

    <span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">DBusException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Failed to export object: &#39;</span><span class="p">,</span> <span class="n">e</span>
        <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="n">reactor</span><span class="o">.</span><span class="n">callWhenRunning</span><span class="p">(</span> <span class="n">main</span> <span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div></div></div>
<div class="paragraph"><p>Failures occuring during remote method invocation are reported to the calling
code as instances of <tt>txdbus.error.RemoteError</tt>. Instances of this object have
two fields <tt>errName</tt> which is the textual name of the DBus error and an
optional <tt>message</tt>. DBus does not formally define the content of error
messages. However, if the DBus error message contains a single string parameter
(which is often the case in practice), it will be assigned to the <tt>message</tt>
field of the <tt>RemoteError</tt> instance.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span><span class="p">,</span> <span class="n">defer</span>

<span class="kn">from</span> <span class="nn">txdbus</span> <span class="kn">import</span> <span class="n">client</span><span class="p">,</span> <span class="n">error</span>


<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cli</span>   <span class="o">=</span> <span class="k">yield</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">reactor</span><span class="p">)</span>

        <span class="n">robj</span>  <span class="o">=</span> <span class="k">yield</span> <span class="n">cli</span><span class="o">.</span><span class="n">getRemoteObject</span><span class="p">(</span> <span class="s">&#39;org.example&#39;</span><span class="p">,</span> <span class="s">&#39;/ErrorObject&#39;</span> <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">robj</span><span class="o">.</span><span class="n">callRemote</span><span class="p">(</span><span class="s">&#39;throwError&#39;</span><span class="p">)</span>

            <span class="k">print</span> <span class="s">&#39;Not Reached&#39;</span>

        <span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">RemoteError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Client threw an error named: &#39;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">errName</span>
            <span class="k">print</span> <span class="s">&#39;Error message: &#39;</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">message</span>


    <span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">DBusException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;DBus Error:&#39;</span><span class="p">,</span> <span class="n">e</span>

    <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="n">reactor</span><span class="o">.</span><span class="n">callWhenRunning</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
<span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div></div></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Version 1.0<br />
Last updated 2012-07-03 12:38:53 CDT
</div>
</div>
</body>
</html>
