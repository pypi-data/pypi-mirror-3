<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionledger">

  <metal:border fill-slot="top_slot">
    <tal:border define="dummy python:request.set('enable_border',1)" />
  </metal:border>
 
<body>
<script type="text/javascript">
<!--
isSelected = false;

function toggleSelect() {
  if (isSelected == false) {
    for (i = 0; i < document.labels.length; i++)
      if (document.labels.elements[i].name == "ids:list")
          document.labels.elements[i].checked = true ;
    isSelected = true;
    document.labels.selectButton.value = "Deselect All";
  }
  else {
    for (i = 0; i < document.labels.length; i++)
      if (document.labels.elements[i].name == "ids:list") 
         document.labels.elements[i].checked = false ;
    isSelected = false;
    document.labels.selectButton.value = "Select All";
  }
  return isSelected;
}
//-->
</script>
 
    <div metal:fill-slot="main" 
         tal:define="status request/status | string:unsent;
                     utool context/@@plone_portal_state/portal_url;
                     entries python: context.dispatcher.objectsForStatus(status)">

      <h1><img src="" alt="" tal:define="icon python:context.getIcon(1)" 
               tal:attributes="src string:${utool}/${icon}">&nbsp;
          <span tal:replace="context/Title | context/getId"/></h1>

      <a href=""
           class="link-parent"
           tal:define="parent_url python:context.navigationParent(context, template.getId())"
           tal:condition="parent_url"
           tal:attributes="href parent_url"
           i18n:translate="go_to_parent_url">Up one level</a>

      <fieldset>

          <legend i18n:translate="legend_dispatch_query">Show</legend>

          <form name="statuses" action="" method="post">
             <table summary="" width="100%" >
                <tr>
                   <td class="field">
                       <input type="radio" name="status" value="unsent" onclick="document.statuses.submit()"
                              tal:attributes="checked python: test(status=='unsent', 1, 0)">Unsent
                   </td>
                   <td class="field">
                       <input type="radio" name="status" value="delivering" onclick="document.statuses.submit()"
                              tal:attributes="checked python: test(status=='delivering', 1, 0)">Dispatched
                   </td>
                   <td class="field">
                        <input type="radio" name="status" value="delivered"  onclick="document.statuses.submit()"
                               tal:attributes="checked python: test(status=='delivered', 1, 0)">Delivered</td>
                   <td class="field">
                        <input type="radio" name="status" value="cancelled"  onclick="document.statuses.submit()"
                               tal:attributes="checked python: test(status=='cancelled', 1, 0)">Cancelled</td>
                 </tr>
              </table>
          </form>

        </fieldset>

        <input type="hidden" name="form.submitted" value="1" />

       <form name="labels" action="" method="post" 
             tal:attributes="action string:${context/getId}/${template/getId}"
             tal:condition="entries">

          <table summary="" class="listing">
            <tr>
               <th>&nbsp;</th>
               <th>&nbsp;</th>
               <th>Request</th>
               <th>Order</th>
               <th>Address</th>
               <th tal:condition="python: status == 'unsent'">Label Pos</th>
            </tr>
            <tr class="odd" tal:repeat="req entries"
                tal:attributes="class python: test(repeat['req'].even, 'even', 'odd')">
               <td valign="top">
                   <input type="checkbox" name="ids:list" value="" tal:attributes="value req/id">
               </td>
               <tal:block tal:define="order req/order">
                  <td valign="top">
                     <a href="" tal:attributes="href string:${order/absolute_url}">
                        <img src="" alt="" border="0" tal:define="icon python:order.getIcon(1)" 
                             tal:attributes="src string:${utool}/${icon}"/>
                     </a>
                  </td>
                  <td  valign="top">
                     <a href="" tal:attributes="href string:${req/absolute_url}" tal:content="req/id"/>
                  </td>
                  <td  valign="top">
                      <a href="" tal:attributes="href order/absolute_url"
                         tal:content="order/contact | order/title_or_id"/>
                  </td>
                  <td  valign="top">
                    <textarea name="shiptoaddr" rows="4" cols="30" 
                              tal:content="order/shiptoaddress"/>
                  </td>
               </tal:block>
               <td  valign="top" class="" tal:condition="python: status == 'unsent'">
                   <table summary="" border="0" cellpadding="0" cellspacing="0" class="">
                     <tr tal:repeat="row python:range(0,context.dispatcher.label_rows)" class="">
                        <td tal:repeat="col python:range(0,context.dispatcher.label_cols)" class="">
                           <input type="radio" name="labelpos:list" value=""  class=""
                                  tal:define="pos python:row * context.dispatcher.label_cols + col"
                                  tal:attributes="value string:${req/id},${pos};
                                                  name  string:labelpos${repeat/req/index};
                                                  checked python: repeat['req'].index == pos"/>
                        </td>
                     </tr>
                   </table>
               </td>
            </tr>
           </table>

            <input class="context"
                   
                   type="submit"
                   name="form.button.Cancel"
                   value="Cancel"
                   i18n:attributes="value"
                   tal:condition="python: status != 'cancelled'"
                   tal:attributes="disabled python:test(isLocked, 'disabled', None);" />
            <input class="context"
                   
                   type="submit"
                   name="form.button.Dispatch"
                   value="Dispatch"
                   tal:condition="python: status == 'unsent'"
                   i18n:attributes="value"
                   tal:attributes="disabled python:test(isLocked, 'disabled', None);" />
            <input class="context"
                   
                   type="submit"
                   name="form.button.Label"
                   value="Labels"
                   i18n:attributes="value" 
                   tal:condition="python: status == 'unsent'" />

             <input type="hidden" name="form.submitted" value="1" />
       </form>

       <div class="formHelp" tal:condition="not: entries">Nothing dispatched for this criteria</div>

       <div tal:replace="structure provider:plone.documentactions">
           Document actions (print, sendto etc)
       </div>

    </div>
 
</body>
</html>
