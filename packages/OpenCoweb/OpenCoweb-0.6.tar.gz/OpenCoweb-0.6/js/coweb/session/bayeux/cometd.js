define(["coweb/util/xhr","org/cometd"],function(a,b){b.JSON.toJSON=JSON.stringify,b.JSON.fromJSON=JSON.parse;var c=new b.Cometd,d=function(){var c=new b.LongPollingTransport,d=b.Transport.derive(c);d.xhrSend=function(b){b.method="POST",b.headers=b.headers||{},b.headers["Content-Type"]="application/json;charset=UTF-8";var c=a.send(b);c.then(function(a){b.onSuccess(a.xhr.responseText)},function(a){var c=new Error("failed loading "+a.url+" status: "+a.xhr.status);b.onError(a.xhr.statusText,c)});return c.xhr};return d};c.registerTransport("long-polling",new d),c.registerExtension("ack",new b.AckExtension);return c})