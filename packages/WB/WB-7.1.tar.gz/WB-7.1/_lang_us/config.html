<table width="100%" cellpadding=5><tr>
<td bgcolor=#5555ff width=45><a href=about.html><img src=../_img/wb.png></a></td>
<td bgcolor=#ccccff><h3> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
Configuring WB</h3></td></tr></table>

<p>
<center>
Luca Fini (<i>lfini@arcetri.astro.it</i>). September 2006
</center>
<p>
<table width="100%" border=1><tr>
<th width="16%"><a href=about.html>About</a></th>
<th width="16%"><a href=install.html>Install</a></th>
<th width="16%">Config</th>
<th width="16%"><a href=help.html>Usage</a></th>
<th width="16%"><a href=copyright.html>Copyright</a></th>
<th width="16%"><a href=wbfaq.html>F.A.Q.</a></th></tr>
</table>



<h3> Defining a new billboard</h3>

In the following we will often refer to the <i>billboard
root</i> directory. That's the directory you created at <a
href=install.html>installation</a> and where you put all
the <b>WB</b> auxiliary files and directories. Let's assume it was called
<tt>/var/www/http/BillBoards</tt>.  <p> To define a new billboard you
may point your browser to the billboard management page:
<blockquote>
<tt>http://url.to.your.cgi/wb.py</tt>
</blockquote>

to get the following:
<p>
<img src=../_img/mgmt.jpg>
<p>
 Where you can select the "Create new billboard" operation.
<center> <table width=80% border=1 cellpadding=4> <tr><td bgcolor=#dddddd> <font size=-1>
<b>Note:</b> System administrator tasks (such as defining a new billboard) require
that the user logging in is an "administrative user", i.e.: either <tt>admin</tt> or
<tt>administrator</tt>, or <tt>root</tt>, so that the login id field is actually
a menu of choices.
</font> </td></tr></table> </center>
<p>

You must then choose a proper name for your billboard.

<center> <table width=80% border=1 cellpadding=4> <tr><td bgcolor=#dddddd> <font size=-1>
<b>Note:</b> You can use any name for your billboards, except for names beginning
with either '.' or '_', which are reserved for special actions.
</font> </td></tr></table> </center>
<p>

After successful creation, you will find a new subdirectory, named as the billboard name,
in the <i> billboard root</i> directory. The created subdirectory
will contain an initialization file named <tt>wb.ini</tt> copied from
the default language directory.
<p>
Now your billboard is up and running and you might start to use it,
but you might want to customize it a little bit to adapt it to your needs.

<h3> Billboard customization</h3>

In order to modify customizable items for your billboard you may use the
link "configure billboard". This will open a page with the content of 
the billboard <tt>wb.ini</tt> filke which you can modify to suit your needs.

<p> Most items are self explaining or their purpose may be undestood by
reading comments in the file, a few items deserve some more discussion.

<blockquote>
<b><tt>index_header</tt></b>,&nbsp;
<b><tt>index_item</tt></b>,&nbsp;
<b><tt>index_footer</tt></b>,&nbsp;
<b><tt>doc_header</tt></b>,&nbsp;
<b><tt>doc_footer</tt></b>
</blockquote>

These variables may be used to customize the document index and the 
document display pages generated by <b>WB</b>.  
Each
variable is an array of strings and each element will generate a line of
HTML code after being processed as detailed below.  

<p> The document
index will be generated as an HTML document as follows:

<blockquote>
<ol>
<li> Text generated by <tt>index_header</tt>.
<li> for each document, a block generated by <tt>index_item</tt>
<li> Text generated by <tt>index_footer</tt>.
</ol>
</blockquote>

The document display page, instead, is generated as:

<blockquote>
<ol>
<li> Text generated by <tt>doc_header</tt>.
<li> Document body
<li> List of links to attachments (if any)
<li> Text generated by <tt>doc_footer</tt>.
</ol>
</blockquote>

To generate text the definition strings are processed to apply string substitution
so that some "variables" are substituted with their values.
<p>
E.g.: the default values of the five items are:<pre>
index_header = ['&lt;h3&gt;Index for billboard: &lt;i&gt;%(BBOARD)s&lt;/i&gt;&lt;/h3&gt;&lt;blockquote&gt;&lt;ul&gt;']
index_item   = ['&lt;p&gt;&lt;li&gt; %(DATE)s %(EXPIR)s',
                '&lt;br&gt;&lt;a href=%(HREF)s&gt;%(TITLE)s&lt;/a&gt;']
index_footer = ['&lt;/ul&gt;&lt;/blockquote&gt;']
doc_header   = ['%(DATE)s %(EXPIR)s', '&lt;h3&gt;%(TITLE)s&lt;/h3&gt;']
doc_footer   = []

</pre>
As you may see the lines resemble HTML code except for the special symbols: <tt>%(VAR)s</tt>
which indicate variable substitution, i.e.: the symbol in parentheses will be substituted with the
value of the named variable.
<p>
<center> <table width=80% border=1 cellpadding=4> <tr><td bgcolor=#dddddd> <font size=-1>
<b>Note:</b> You need to know a little bit of Python syntax to write customization strings.
Here's a very short resume: 1) Comment lines begin with "#"; 2) strings are enclosed in either
double quote (") or single quote ('). When using double quotes, if you need to put a
literal double quote character into the string you must escape it with backslash (E.g.: \").
The same happens when enclosing in single quote. 3) arrays are enclosed in brackets: [&nbsp;],
elements in arrays are separated by commas; 4) it is safe to start a new line after a comma.

</font> </td></tr></table> </center>

<p>
The following variables are defined and can be used for index generation:
<center>
Table 1: Variables to be used in substitutions<br>
<table border=1 cellpadding=2>
<tr><th>         </th><th>                      </th><th colspan=6> Where it can be used </th><tr>
<tr><th> Var name</th><th> Meaning              </th><th>index<br>header</t><th>index<br>item</th><th>index<br>footer</th><th>doc<br>header</th><th>doc<br>footer</th><th>mail<br>body</th><tr>
<tr><td><b>AUTHOR</b></td><td>Document author's name</td><td>  NO  </td><td>  YES  </td><td>  NO  </td><td>  YES  </td><td>  YES  </td> <td>  YES  </td> </tr>
<tr><td><b>BBOARD</b></td><td>Current billboard name</td><td>  YES  </td><td>  YES  </td><td>  YES  </td><td>  YES  </td><td>  YES  </td> <td>  YES  </td> </tr>
<tr><td><b>DATE</b></td><td>Document date           </td><td>  NO   </td><td>  YES  </td><td>  NO   </td><td>  YES  </td><td>  YES  </td><td>  YES  </td> </tr>
<tr><td><b>EXPIR</b></td><td>Document expiration 
                                   date<sup>1</sup> </td><td>  NO   </td><td>  YES  </td><td>  NO   </td><td>  YES  </td><td>  YES  </td><td>  YES  </td> </tr>
<tr><td><b>HREF</b></td><td>URL pointing to document </td><td>  NO   </td><td>  YES  </td><td>  NO   </td><td>  YES  </td><td>  YES  </td><td>  YES  </td> </tr>
<tr><td><b>IF_AUTHOR<sup>*</sup></b></td><td>Document author's string. Format is defined in <b>author_fmt</b>; empty, if no author specified</td><td>  NO  </td><td>  YES  </td><td>  NO  </td><td>  YES  </td><td>  YES  </td> <td>  YES  </td> </tr>
<tr><td><b>N_ITEMS</b></td><td>Number of items in list</td><td>  YES  </td><td>  YES  </td><td>  YES  </td><td>  NO   </td><td>  NO   </td><td>  NO   </td> </tr>
<tr><td><b>TITLE</b></td><td>Document title</td><td>            NO   </td><td>  YES  </td><td>  NO   </td><td>  YES  </td><td>  YES  </td><td>  YES  </td> </tr>
<tr><td><b>SEARCH</b></td><td>HTML code to insert a search form.
                The content of the string is defined by variable <b>search_fmt</b>;
                It may be empty, if no search form is desired. </td><td>      YES   </td><td>  NO   </td><td>  YES   </td><td>  NO   </td><td>  NO   </td><td>  NO  </td> </tr>
</table>
<font size=-1>
</center>
1. The expiration date is a string as follows: "<tt>(Expiration:&nbsp;dd/mm/yyyy)</tt>",
 and the word "Expiration" is generated by using the current language. The string is
 empty if no expiration date is defined for the given document.</font>
<p>
<b>Beware</b>: if a variable is mispelled or not defined an error will result and no
               index will be displayed.

<h3>Testing the configuration file</h3>
After creating the configuration file you must ensure it doesn't contain syntax errors.
You may do so by running python on it:

<blockquote>
<tt>&gt; python /var/www/http/BillBoards/News/wb.ini</tt>
</blockquote>
No output should result.
<p>
Now you are ready to start putting documents into your billboard, or maybe to define a new
billboard.

<h3> Refining billboard customization</h3>

More items can be found in the 
<a href=wb.ini><tt>wb.ini</tt></a> file provided in the distribution.
Comments should be
enough to understand how to customize other items. You may be interested
in:

<dl>
<dt> <b>allowed_users </b>
<dd> A list of usernames who are authorized to add and modify documents in the
     billboard. Note that any access to the billboard for an opperation
     is subject to authentication against the server's password file. After
     the user is authenticated his/her username is checked against the allowed users list.
     Il the list is empty, all authenticated users will be allowed to perform
     operations on the billboard.
<p>
<dt> <b>delete_expired </b>
<dd>  Specifies wether expired documents must be deleted or moved to a suitable directory.
      If true (any non zero integer value) the maintenance command will move expired documents (and related attachments)
      to the directory <tt>deleted</tt> under the billboard directory. Otherwise expired files will be deleted.
<p>
<dt> <b>language </b>
<dd>  Language (possibly different from the default language) to be used for this billboard.
      The value is the two-letter standard country name (e.g.: 'us', 'uk', 'it'). It must correspond
      to a laguage directory in the <i>billboard root</i> such as: <tt>_lang_us</tt>, <tt>_lang_it</tt>, etc. <br>
      If the language you need is not defined, you might
      consider to write the vocabulary by yourself (its a matter of half an hour of work, see below).
<p>
<dt> <b>mail_to </b>
<dd> A list of e-mail adresses to which notification is mailed whenever something
     is changed in the billboard.
<p>
<dt> <b>mail_new</b>
<dd> The string used to generate the mail message text, used when a new document
     is added to the billboard. The string may contain
     variables to be substituted (see also Table 1 above).

<p>
<dt> <b>mail_update</b>
<dd> The string used to generate the mail message text, used when a document
     n the billboard is updated. The string may contain
     variables to be substituted (see also Table 1 above).

<p>
<dt> <b>sort_order </b>
<dd> Flags specifying how items in the document list should be sorted. It is a string containing a combination
     of words specifying the ordering rules:
<blockquote> date expir ascending descending
</blockquote>
Words are separated by spaces in the string and may be written in any order. If
conflicting words  are specified one will prevail at random.
</dl>

<h3> Supporting a new language</h3>

Available vocabularies and values for each term in them, can be shown by
selecting the related command from the maintenance page.
<p>
In order to support various languages,
language dependent items are contained in "language directories" in the
<i>billboard root</i>. Subdirectories are named: <tt>_lang_it</tt>, <tt>_lang_us</tt>, end so on,
and must contain the following files:
<p>
<table cellspacing=4>
<tr><td>voc.ini </td><td>  Vocabulary file          </td></tr>
<tr><td>about.html </td><td> Brief introduction          </td></tr>
<tr><td>config.html </td><td> Configuration manual          </td></tr>
<tr><td>copyright.html </td><td>  Copyright statement          </td></tr>
<tr><td>help.html </td><td>  User help          </td></tr>
<tr><td>install.html </td><td> Installation notes          </td></tr>
<tr><td>usage.html </td><td> Administrator help          </td></tr>
<tr><td>wbfaq.html </td><td>  F.A.Q          </td></tr>
</table>
<p>
In order to support a new language you must create a proper directory; e.g.:
<blockquote>
<tt>&gt; python /var/www/http/BillBoards/_lang_uk</tt>
</blockquote>
and copy into it the set of files from an existing language directory of your choice.
<p>
Then you must provide proper translations
(please, if you do so consider to send them to me
to be added in the next distribution of <b>WB</b>).
<p>
The most important file is <tt>voc.ini</tt> which contains messages displayed to the user.
<p>
After providing the transalted version you may select your preferred language as default
by editing the file <tt>wb.py</tt> (different language can be selected for each billboard
by editing the specific <tt>wb.ini</tt>).

<h3> Translating help files</h3>

If you want to translate help file, consider that only <tt>help.html</tt> will be
necessary for the generic user, all other files are provided for the system administrator
(may be you?) and you may decide to leave them as they are.
