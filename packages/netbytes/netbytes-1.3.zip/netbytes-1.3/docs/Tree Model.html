

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. Tree Model &mdash; netbytes 1.3b documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.3b',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="netbytes 1.3b documentation" href="index.html" />
    <link rel="next" title="4. 4. Handlers and Encoders" href="Handlers and encoders.html" />
    <link rel="prev" title="2. Actions Tree" href="Actions tree.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Handlers and encoders.html" title="4. 4. Handlers and Encoders"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Actions tree.html" title="2. Actions Tree"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">netbytes 1.3b documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tree-model">
<h1>3. Tree Model<a class="headerlink" href="#tree-model" title="Permalink to this headline">¶</a></h1>
<p>A tree model is a string of multiple lines used to represent the actions tree. It is then passed to the function <a class="reference internal" href="References.html#build" title="build"><tt class="xref py py-func docutils literal"><span class="pre">build()</span></tt></a> which will return a <tt class="xref py py-class docutils literal"><span class="pre">ActionTree</span></tt> instance.</p>
<dl class="docutils">
<dt>A tree model has only two simple rules to be know, aside the naming rules :</dt>
<dd><ul class="first last simple">
<li>the parenting logic is based upon identation</li>
<li>the first line containg a node must have an identation of 0</li>
</ul>
</dd>
</dl>
<p>The identation may be done with spaces or <tt class="docutils literal"><span class="pre">\t</span></tt> (tabulations), just beware to not mix them up ; just like python.</p>
<p>Now, let&#8217;s convert the following abstract actions tree into a suitable model :</p>
<div class="line-block">
<div class="line">Tree</div>
<div class="line-block">
<div class="line">client</div>
<div class="line-block">
<div class="line">message</div>
<div class="line-block">
<div class="line">private</div>
<div class="line">public</div>
</div>
</div>
<div class="line">server</div>
<div class="line-block">
<div class="line">message</div>
</div>
</div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">model</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">client</span>
<span class="s">    message</span>
<span class="s">        private</span>
<span class="s">        public</span>

<span class="s">server</span>
<span class="s">    message&#39;&#39;&#39;</span>
</pre></div>
</div>
<p>And that&#8217;s it ! Your model is now built and ready for the function <a class="reference internal" href="References.html#build" title="build"><tt class="xref py py-func docutils literal"><span class="pre">build()</span></tt></a></p>
<div class="section" id="the-naming-rules">
<h2>3.1. The naming rules<a class="headerlink" href="#the-naming-rules" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>As the children of a <tt class="xref py py-class docutils literal"><span class="pre">Node</span></tt> are attributes of this <tt class="xref py py-class docutils literal"><span class="pre">Node</span></tt>, the naming rules are almost the same as the python&#8217;s ones, but there are little differences :</dt>
<dd><ol class="first last arabic simple">
<li>the first character must be a lowercase letter</li>
<li>the name must be at least three characters</li>
<li>underscores (<tt class="docutils literal"><span class="pre">'_'</span></tt>) are prohibited</li>
</ol>
</dd>
</dl>
</div>
<div class="section" id="the-comments">
<h2>3.2. The comments<a class="headerlink" href="#the-comments" title="Permalink to this headline">¶</a></h2>
<p>Comments are a part of line ignored by the parsing. Everything after a node name is considered comment, and a name stops as soon as a character invalid for naming is encountered. Let&#8217;s see few examples :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">model</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">client</span>
<span class="s">    message</span>
<span class="s">        private(reciever:str, msg:str) - comments started at &#39;(&#39;</span>
<span class="s">        public comments started at &#39; &#39; after &#39;public&#39; &#39;&#39;&#39;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">it is strongly recommended to place in comment the arguments names and types that will be encoded/decoded by the handlers and decoders.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">As a rule of thumb : if you feel the need to add a description of the action, something&#8217;s wrong. Consider redesign your model, or change some node names.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The only exception to the last tip, is in the case of long node names : make it shorter, abreviated, and add as comment its long form.</p>
</div>
</div>
<div class="section" id="the-bytecode-size">
<h2>3.3. The bytecode size<a class="headerlink" href="#the-bytecode-size" title="Permalink to this headline">¶</a></h2>
<p>Most of the time, you won&#8217;t have to bother with it, but you remember that each <tt class="xref py py-class docutils literal"><span class="pre">Node</span></tt> instances (except the <em>root</em>) hold a bytecode that serves as an identifier. Because it is represented by one byte, this means it can have up to 255 (0xff) brothers. This is why when you know that a node will have over than 256 childs, you must specify the bytecode size of its children.</p>
<p>Let&#8217;s take back our example above, and assume that the <em>client.message</em> node will have over 256 children, the model should looks like this :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">model</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">client</span>
<span class="s">    2 message</span>
<span class="s">        private</span>
<span class="s">        public</span>
<span class="s">        [...]</span>
<span class="s">        action500</span>
<span class="s">server</span>
<span class="s">    message&#39;&#39;&#39;</span>
</pre></div>
</div>
<p>Once the tree will be built, the nodes <em>private</em>, <em>public</em> and <em>action500</em> will be represented by a bytecode of 2 bytes</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tree</span> <span class="o">=</span> <span class="n">netbytes</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tree</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">public</span><span class="o">.</span><span class="n">_bytecode</span>
<span class="go">&#39;\x01\x00&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">tree</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">action500</span><span class="o">.</span><span class="n">_bytecode</span>
<span class="go">&#39;\xf4\x01&#39;</span>
</pre></div>
</div>
<p>You may wonder how the direct&#8217;s children of the <em>root</em> <tt class="xref py py-class docutils literal"><span class="pre">Node</span></tt> (here, the nodes <em>client</em> and <em>server</em>) can be encoded on two bytes (or more)... this is specified as an optional argument of the functions <a class="reference internal" href="References.html#build" title="build"><tt class="xref py py-func docutils literal"><span class="pre">build()</span></tt></a> and <a class="reference internal" href="References.html#p_build" title="p_build"><tt class="xref py py-func docutils literal"><span class="pre">p_build()</span></tt></a> :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tree</span> <span class="o">=</span> <span class="n">netbytes</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="bytecode-size-rules">
<h3>3.3.1. Bytecode size rules<a class="headerlink" href="#bytecode-size-rules" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>it must be 1 digit</li>
<li>it must start at the correct identation level</li>
<li>it must be followed by one space, then by the name</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="building-a-tree-from-a-model">
<h2>3.4. Building a tree from a model<a class="headerlink" href="#building-a-tree-from-a-model" title="Permalink to this headline">¶</a></h2>
<p>Once your model is done, the logical thing to do is to parse it and to build an actions tree. <a class="reference internal" href="index.html#module-netbytes" title="netbytes: manages the bytes exchanged beetween server and clients"><tt class="xref py py-mod docutils literal"><span class="pre">netbytes</span></tt></a> provides two functions to achieve it : <a class="reference internal" href="References.html#build" title="build"><tt class="xref py py-func docutils literal"><span class="pre">build()</span></tt></a> and <a class="reference internal" href="References.html#p_build" title="p_build"><tt class="xref py py-func docutils literal"><span class="pre">p_build()</span></tt></a>. The both return a tree. The big difference is that <a class="reference internal" href="References.html#p_build" title="p_build"><tt class="xref py py-func docutils literal"><span class="pre">p_build()</span></tt></a> actualy build the given model only if needed : an optional argument <em>filename</em> - defaulting to &#8216;.actions_tree&#8217; - can be provided. <a class="reference internal" href="References.html#p_build" title="p_build"><tt class="xref py py-func docutils literal"><span class="pre">p_build()</span></tt></a> will check if the file exists and if the SHA512 checksum strored in it is the same as the SHA512 checksum of the model, if it does it loads the stored tree and returns it ; otherwise it will parse &amp; build the model and create/replace the file. The <em>p</em> in <em>p_build</em> stand for <tt class="xref py py-mod docutils literal"><span class="pre">pickle</span></tt> as this is what it uses to store the tree.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3. Tree Model</a><ul>
<li><a class="reference internal" href="#the-naming-rules">3.1. The naming rules</a></li>
<li><a class="reference internal" href="#the-comments">3.2. The comments</a></li>
<li><a class="reference internal" href="#the-bytecode-size">3.3. The bytecode size</a><ul>
<li><a class="reference internal" href="#bytecode-size-rules">3.3.1. Bytecode size rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#building-a-tree-from-a-model">3.4. Building a tree from a model</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="Actions tree.html"
                        title="previous chapter">2. Actions Tree</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Handlers and encoders.html"
                        title="next chapter">4. 4. Handlers and Encoders</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/Tree Model.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Handlers and encoders.html" title="4. 4. Handlers and Encoders"
             >next</a> |</li>
        <li class="right" >
          <a href="Actions tree.html" title="2. Actions Tree"
             >previous</a> |</li>
        <li><a href="index.html">netbytes 1.3b documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Nicolas DAVID.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>