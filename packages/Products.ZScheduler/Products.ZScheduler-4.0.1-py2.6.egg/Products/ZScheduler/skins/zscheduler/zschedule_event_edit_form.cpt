<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="zscheduler">
 
<body>
 
    <div metal:fill-slot="main"
         tal:define="errors options/state/getErrors;
                     member context/@@plone_portal_state/member;
                     editor python:member.getProperty('wysiwyg_editor','None');
                     wysiwyg python:test(editor and editor!='None', editor, 'None');
                     lockable python:hasattr(here, 'wl_isLocked');
                     isLocked python:lockable and here.wl_isLocked();">


      <h1><img src="" tal:attributes="src here/icon">&nbsp;<span tal:replace="here/title_or_id"/></h1>

      <a href=""
           class="link-parent"
           tal:define="parent_url python:here.navigationParent(here, template.getId())"
           tal:condition="parent_url"
           tal:attributes="href parent_url"
           i18n:translate="go_to_parent_url">Up one level</a>

      <div tal:replace="structure provider:plone.belowcontenttitle">
        Get the byline - contains details about author and modification date.
      </div>

      <form name="edit_form"  action="."  method="post"
            tal:attributes="action string:${here/getId}/${template/getId}" >

      <metal:status define-macro="status">

        <fieldset>
          <legend i18n:translate="legend_status">Schedule Event Status</legend>

          <div class="error" tal:define="scheduled here/nextEventTime">

            <label for="title" i18n:translate="label_next_scheduled">Next Scheduled</label>
          
            <div tal:content="scheduled"/>

          </div>

          <div class="field">
             <label>Now</label>
             <div tal:content="python: DateTime(context.tz)"/>
          </div>

          <div class="field" tal:define="last_executed context/last_executed" 
               tal:condition="last_executed">
             <label>Last Run</label>
             <div tal:content="last_executed"/>
          </div>

          <div class="formControls">

            <input class="standalone" tal:condition="not: here/active"
                   type="submit"
                   name="form.button.Activate"
                   value="Activate"
                   i18n:attributes="value" />
            <input class="standalone" tal:condition="here/active"
                   type="submit"
                   name="form.button.Inactivate"
                   value="Inactivate"
                   i18n:attributes="value" />

          </div>
        </fieldset>
      </metal:status>
  
        <table>
          <tr>
            <td valign="top">

        <fieldset>

          <legend i18n:translate="legend_document_details">Schedule Event Details</legend>

          <div class="field"
               tal:define="error errors/title|nothing;
                           Title request/title | here/Title;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="title" i18n:translate="label_title">Title</label>

            <div tal:content="error">Validation error output</div>

            <input type="text" id="title" name="title" value="" size="40"
                   tal:attributes="value Title;"/>

          </div>


          <div class="field" 
               tal:define="error errors/callable_id|nothing;
                           edit_callable python: context.meta_type == 'ZScheduleEvent';
                           CallableId request/callable_id | here/callable_id;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label>Callable</label>

            <span class="fieldRequired" title="Required"
                  i18n:attributes="number"
                  i18n:translate="label_required">(Required)</span>

            <div tal:content="error">Validation error output</div>

            <input type="text" id="callable_id" name="callable_id" value="" size="20"
                   tal:condition="edit_callable"
                   tal:attributes="value CallableId;"/>

            <span tal:condition="not: edit_callable" tal:content="CallableId"/>

          </div>

        <metal:crontab define-macro="crontab">
          <div class="formHelp">
             <p>The following time specification fields all expect to be comprised of numbers 
                from within the range specified. Unix users may note that the time 
                specifications are fully compliant with the crontab utility, meaning you may 
                combine any of the following to create very granular intervals:</p>

                <table>
                  <tr><td><b>Feature</b></td><td><b>Symbol</b></td><td><b>Example</b></td> <td><b>Indicates</b></td></tr>
                  <tr><td>Ranges</td><td align="center">-</td><td>1-4</td><td>1,2,3,4</td></tr>
  	          <tr><td>Explicit Values</td><td align="center">,</td><td>1,2,12</td><td>1,2,12</td></tr>
  	          <tr><td>Increments</td><td align="center">/</td><td>0-12/3</td><td>0,3,6,9,12</td></tr>
                </table>

             <p>The wildcard, * means to include all possible values for this parameter. You cannot 
                set both the Day of Month value and the Day of Week Value.</p>
          </div>

          <div class="field"
               tal:define="error errors/zse_minute|nothing;
                           Minute request/zse_minute | here/minute;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="type" i18n:translate="label_minute">Minute</label>

            <span class="fieldRequired" title="Required"
                  i18n:attributes="type"
                  i18n:translate="label_required">(Required)</span>

            <div tal:content="error">Validation error output</div>
            <div class="formHelp">[0-59]</div>
            <input type="text" name="zse_minute" value="" size="10"
                         tal:attributes="value Minute"/>
           </div>

          <div class="field"
               tal:define="error errors/zse_hour|nothing;
                           Hour request/zse_hour | here/hour;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="type" i18n:translate="label_day">Hour</label>

            <span class="fieldRequired" title="Required"
                  i18n:attributes="type"
                  i18n:translate="label_required">(Required)</span>

            <div tal:content="error">Validation error output</div>

            <div class="formHelp">[0-23]</div>
            <input type="text" name="zse_hour" value="" size="10"
                         tal:attributes="value Hour"/>
           </div>

          <div class="field"
               tal:define="error errors/zse_day_of_month|nothing;
                           Day request/zse_day_of_month | here/day_of_month;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="type" i18n:translate="label_day">Day of Month</label>

            <span class="fieldRequired" title="Required"
                  i18n:attributes="type"
                  i18n:translate="label_required">(Required)</span>

            <div tal:content="error">Validation error output</div>

            <div class="formHelp">[1-31]</div>
            <input type="text" name="zse_day_of_month" value="" size="10"
                         tal:attributes="value Day"/>
           </div>


          <div class="field"
               tal:define="error errors/zse_day_of_week|nothing;
                           Day request/zse_day_of_week | here/day_of_week;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="type" i18n:translate="label_day_of_week">Day of Week</label>

            <span class="fieldRequired" title="Required"
                  i18n:attributes="type"
                  i18n:translate="label_required">(Required)</span>

            <div tal:content="error">Validation error output</div>

            <div class="formHelp">[0-7] 0 and 7 are Sunday</div>
            <input type="text" name="zse_day_of_week" value="" size="10"
                         tal:attributes="value Day"/>
           </div>

          <div class="field"
               tal:define="error errors/month|nothing;
                           Month request/zse_month | here/month;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="type" i18n:translate="label_month">Month</label>

            <span class="fieldRequired" title="Required"
                  i18n:attributes="type"
                  i18n:translate="label_required">(Required)</span>

            <div tal:content="error">Validation error output</div>

            <div class="formHelp">[1-12]</div>
            <input type="text" name="zse_month" value="" size="10"
                         tal:attributes="value Month"/>
           </div>

          <div class="field"
               tal:define="error errors/zse_tz|nothing;
                           TimeZone request/zse_tz | here/tz;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="type" i18n:translate="label_tz">Time Zone</label>

            <span class="fieldRequired" title="Required"
                  i18n:attributes="type"
                  i18n:translate="label_required">(Required)</span>

            <div tal:content="error">Validation error output</div>

            <div class="formHelp">Our system time may not be yours ...</div>
            <select name="zse_tz">
                <option tal:repeat="tz here/timezones"
                        tal:content="tz"
                        tal:attributes="selected python: test(tz==TimeZone, 1, 0)"/>
            </select>
           </div>

        </metal:crontab>

          <div class="formControls"
               tal:define="process_creation request/process_creation|nothing;">

            <img src="" class="context"
                   tal:define="portal context/portal_url/getPortalObject; locked portal/lock_icon.gif;"
                   tal:condition="isLocked"
                   tal:replace="structure python:locked.tag(title='This item is locked')"
                   alt="Object locked"
                   i18n:attributes="alt"/>

            <input class="context"
                   type="submit"
                   name="form.button.Save"
                   value="Save"
                   i18n:attributes="value"
                   tal:attributes="disabled python:test(isLocked, 'disabled', None);" />

          </div>
        </fieldset>
      </td>
      <td valign="top">

       <metal:test define-macro="test">

         <fieldset tal:define="Start request/test_start | python:DateTime(context.tz);
                               Size request/test_size | python:10;">
             <legend>Scheduling calculator</legend>

             <p class="formHelp">Because scheduling is important, we've provided this useful 
                little calculator so you can be assured you have properly configured your 
                event timing.</p>

             <div class="field"
                  tal:define="error errors/test_start|nothing"
                  tal:attributes="class python:test(error, 'field error', 'field')">

                <label for="type" i18n:translate="label_start">Starting</label>

                <span class="fieldRequired" title="Required"
                      i18n:attributes="type"
                      i18n:translate="label_required">(Required)</span>

                <div tal:content="error">Validation error output</div>

                <input type="text" name="test_start:date" value="" size="25"
                       tal:attributes="value Start"/>
              </div>

              <div class="field"
                  tal:define="error errors/test_size|nothing"
                  tal:attributes="class python:test(error, 'field error', 'field')">

                <label for="type" i18n:translate="label_size">Show Next</label>

                <span class="fieldRequired" title="Required"
                      i18n:attributes="type"
                      i18n:translate="label_required">(Required)</span>

                <div tal:content="error">Validation error output</div>

                <input type="text" name="test_size:int" value="" size="2" maxlength="2"
                       tal:attributes="value Size"/>
              </div>

              <table align="center" summary="">
                  <tr>
                      <td class="label">Next Scheduled Time</td>
                  </tr>
                  <tr tal:repeat="time python: context.test_schedule(Start, Size)"
                      tal:attributes="class python: test(repeat['time'].odd, 'odd', 'even')">
                       <td tal:content="time"/>
                  </tr>
              </table>

              <input class="standalone"
                     type="submit"
                     name="form.button.Test"
                     value="Test"
                     i18n:attributes="value" />


         </fieldset>

        </metal:test>
      </td>
    </tr>
  </table>
     

        <input type="hidden" name="form.submitted" value="1" />

      </form>

    </div>
 
</body>
</html>
