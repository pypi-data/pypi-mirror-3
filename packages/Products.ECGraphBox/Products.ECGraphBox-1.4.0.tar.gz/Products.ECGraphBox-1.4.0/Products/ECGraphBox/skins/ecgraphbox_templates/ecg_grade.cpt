<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
                      "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="eduComponents">

  <body>
    <metal:block fill-slot="css_slot">
      <style type="text/css" media="screen"
          tal:content="string: @import url($portal_url/ecabstyles.css);" />
    </metal:block>

    <metal:main fill-slot="main">
      <tal:main-macro metal:define-macro="main"
          tal:define="template_id    template/getId;
                      wtool          context/portal_workflow;
                      putils         context/plone_utils;
                      errors         options/state/getErrors | nothing;
                      readFieldNames here/getGradeModeReadFieldNames;
                      editFieldNames here/getGradeModeEditFieldNames;">
  
        <!-- show header information -->
        <metal:use use-macro="here/base_macros/macros/eca_view_head" />
    
    <!--  
        <!-- print all readonly fields     
        <tal:fields repeat="fieldName readFieldNames">

          <tal:field define="field python:here.getField(fieldName);">
            <metal:use use-macro="here/base_macros/macros/base_view" />
          </tal:field>
        </tal:fields>
    -->
    
    	<div class="field ArchetypesField-FileField" id="archetypes-fieldname-file">
			<label class="formQuestion"><span>Antwort</span>:</label><br/>
			
			<canvas id="canvas"  width="913" height="600" style=" position:relative; width: 913; height: 600;" oncontextmenu="return false;"></canvas><br/>

			<label class="formQuestion"><span>Notizen</span>:</label><br/>
			<pre id="ecgb_note" name='ecgb_note'></pre>
		
		
			<!-- Textarea -->
			<textarea id="ecg_answer" style="visibility: hidden; height: 0px; width: 0px;" tal:content="here/file" readonly></textarea>
			
			<script>			
				var canvas = document.getElementById('canvas');			
				var canvaslayer = document.getElementById('canvasLayer');			
				var textarea = document.getElementById('ecg_answer');			
				var ecgb_noteTextarea = document.getElementById('ecgb_note');
				init(true);
				
				//---------------------------- xml parsen begin	
				text = textarea.value;
				//Text passend machen 
				text = text.replace(/&lt;/g, "Hallo");
				text = text.replace(/&gt;/g, ">");
				
				textarea.value = text;
				if(text != undefined){
					xmlDoc = loadXMLString(text);
				}	
	
				//-----------------------------xml parsen end
				//toolBoxHolderDiv.onmousedown = function(e){
				//	toolboxdrag = true;
				//}
				
				init(true); 
				makeGraph(xmlDoc); 
				ecgb_displayNotes(xmlDoc);
			</script>
		</div>
    
    
        <!-- print a form with all editable fields -->
        <form name="edit_form"
            method="post"
            enctype="multipart/form-data"
            class="enableUnloadProtection"
            action="eca_grade"
            tal:attributes="action string:${here/absolute_url}/${template/getId}">

          <!-- all editable fields -->    
          <tal:fields repeat="fieldName editFieldNames">
            <metal:use use-macro="python:here.widget(fieldName, mode='edit', use_label=1)" />
          </tal:fields>

          <!-- submit button -->
          <div class="formControls" i18n:domain="plone">
            <input class="context"
                type="submit"
                name="form.button.Submit"
                value="Save"
                i18n:domain="plone"
                i18n:attributes="value" />

            <input class="standalone"
                type="submit"
                name="form.button.Cancel"
                i18n:domain="plone"
                value="Cancel"
                i18n:attributes="value" />
          </div>

          <input type="hidden" name="form.submitted" value="1" />
        </form>

        <div tal:replace="structure provider:plone.belowcontenttitle" />

      </tal:main-macro>
    </metal:main>

  </body>
</html>