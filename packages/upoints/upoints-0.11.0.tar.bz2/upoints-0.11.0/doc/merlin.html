<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4: http://docutils.sourceforge.net/" />
<title>The MERLIN system</title>
<link rel="stylesheet" href="docutils.css" type="text/css" />
</head>
<body>
<div class="document" id="the-merlin-system">
<h1 class="title">The MERLIN system</h1>
<div class="section">
<h1><a id="introduction" name="introduction">Introduction</a></h1>
<p><a class="reference" href="http://www.merlin.ac.uk/">MERLIN</a>, the Multi-Element Radio Linked Interferometer Network, radio
telescope array that is spread throughout central England and Wales.
The interesting aspect of MERLIN for our uses is high-quality, minimally
diverse location identifiers are available publicly.  They make
a reasonably useful test case for <tt class="docutils literal"><span class="pre">upoints</span></tt> objects across small
geographic distances.</p>
<p>According to the official MERLIN documentation the locations of
the array elements are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="38%" />
<col width="39%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Name</th>
<th class="head">Latitude</th>
<th class="head">Longitude</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Cambridge</td>
<td>52°10′06.48″N</td>
<td>000°02′23.25″E</td>
</tr>
<tr><td>Darnhall</td>
<td>53°08′38.40″N</td>
<td>002°32′45.57″W</td>
</tr>
<tr><td>Defford</td>
<td>52°05′27.61″N</td>
<td>002°08′09.62″W</td>
</tr>
<tr><td>Knocking</td>
<td>52°46′40.83″N</td>
<td>003°00′39.55″W</td>
</tr>
<tr><td>Lovell Telescope</td>
<td>53°14′10.50″N</td>
<td>002°18′25.74″W</td>
</tr>
<tr><td>Mark II</td>
<td>53°13′51.62″N</td>
<td>002°18′34.16″W</td>
</tr>
<tr><td>Pickmere</td>
<td>53°16′44.42″N</td>
<td>002°26′41.98″W</td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1><a id="using-upoints-s-point-objects" name="using-upoints-s-point-objects">Using <tt class="docutils literal"><span class="pre">upoints</span></tt>'s <tt class="docutils literal"><span class="pre">Point</span></tt> objects</a></h1>
<p>We can create a Python dictionary containing the locations of the array
very simply:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">from</span> <span class="nn">upoints.point</span> <span class="k">import</span> <span class="p">(</span><span class="n">Point</span><span class="p">,</span> <span class="n">KeyedPoints</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">from</span> <span class="nn">upoints</span> <span class="k">import</span> <span class="n">utils</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MERLIN</span> <span class="o">=</span> <span class="n">KeyedPoints</span><span class="p">({</span>
<span class="gp">... </span>    <span class="s">&#39;Cambridge&#39;</span><span class="p">:</span> <span class="n">Point</span><span class="p">((</span><span class="mf">52</span><span class="p">,</span> <span class="mf">10</span><span class="p">,</span> <span class="mf">6.48</span><span class="p">),</span> <span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">2</span><span class="p">,</span> <span class="mf">23.25</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="s">&#39;Darnhall&#39;</span><span class="p">:</span> <span class="n">Point</span><span class="p">((</span><span class="mf">53</span><span class="p">,</span> <span class="mf">8</span><span class="p">,</span> <span class="mf">38.4</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">32</span><span class="p">,</span> <span class="o">-</span><span class="mf">45.57</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="s">&#39;Defford&#39;</span><span class="p">:</span> <span class="n">Point</span><span class="p">((</span><span class="mf">52</span><span class="p">,</span> <span class="mf">5</span><span class="p">,</span> <span class="mf">27.61</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">8</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.62</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="s">&#39;Knocking&#39;</span><span class="p">:</span> <span class="n">Point</span><span class="p">((</span><span class="mf">52</span><span class="p">,</span> <span class="mf">46</span><span class="p">,</span> <span class="mf">40.83</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">39.55</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="s">&#39;Lovell Telescope&#39;</span><span class="p">:</span> <span class="n">Point</span><span class="p">((</span><span class="mf">53</span><span class="p">,</span> <span class="mf">14</span><span class="p">,</span> <span class="mf">10.5</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">18</span><span class="p">,</span> <span class="o">-</span><span class="mf">25.74</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="s">&#39;Mark II&#39;</span><span class="p">:</span> <span class="n">Point</span><span class="p">((</span><span class="mf">53</span><span class="p">,</span> <span class="mf">13</span><span class="p">,</span> <span class="mf">51.62</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">18</span><span class="p">,</span> <span class="o">-</span><span class="mf">34.16</span><span class="p">)),</span>
<span class="gp">... </span>    <span class="s">&#39;Pickmere&#39;</span><span class="p">:</span> <span class="n">Point</span><span class="p">((</span><span class="mf">53</span><span class="p">,</span> <span class="mf">16</span><span class="p">,</span> <span class="mf">44.42</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">26</span><span class="p">,</span> <span class="o">-</span><span class="mf">41.98</span><span class="p">)),</span>
<span class="gp">... </span><span class="p">})</span>
</pre></div>
<p>As a simple smoke test the MERLIN website contains a <a class="reference" href="http://www.merlin.ac.uk/user_guide/OnlineMUG/newch0-node62.html">location
page</a> which states the longest baseline in the array is Cambridge to
Knocking at 217 kM, and also that the shortest baseline is between the
Jodrell Bank site and Pickmere at 11.2 kM.  The <tt class="docutils literal"><span class="pre">Point</span></tt> object's
<tt class="docutils literal"><span class="pre">distance</span></tt> method can calculate these distances for us quite simply:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&quot;</span><span class="si">%.3f</span><span class="s"> kM&quot;</span> <span class="o">%</span> <span class="n">MERLIN</span><span class="p">[</span><span class="s">&#39;Cambridge&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">MERLIN</span><span class="p">[</span><span class="s">&#39;Knocking&#39;</span><span class="p">])</span>
<span class="go">&#39;217.312 kM&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&quot;</span><span class="si">%.3f</span><span class="s"> kM&quot;</span> <span class="o">%</span> <span class="n">MERLIN</span><span class="p">[</span><span class="s">&#39;Lovell Telescope&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">MERLIN</span><span class="p">[</span><span class="s">&#39;Pickmere&#39;</span><span class="p">])</span>
<span class="go">&#39;10.322 kM&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&quot;</span><span class="si">%.3f</span><span class="s"> kM&quot;</span> <span class="o">%</span> <span class="n">MERLIN</span><span class="p">[</span><span class="s">&#39;Mark II&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">MERLIN</span><span class="p">[</span><span class="s">&#39;Pickmere&#39;</span><span class="p">])</span>
<span class="go">&#39;10.469 kM&#39;</span>
</pre></div>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">The web page gives the shortest baseline as the distance from
Pickmere to Jodrell Bank, but doesn't give a location for Jodrell
Bank.  However, as can be seen from the example above the two array
elements based at Jodrell Bank(Lovell Telescope and the Mark II) are
giving a plausible value.</p>
</div>
</div>
<div class="section">
<h1><a id="using-utils-dump-xearth-markers" name="using-utils-dump-xearth-markers">Using <tt class="docutils literal"><span class="pre">utils.dump_xearth_markers</span></tt></a></h1>
<p>The MERLIN website also contains a <a class="reference" href="http://www.merlin.ac.uk/about/layman/merlin.html">layman description page</a>
that has a nice map showing the locations of the array elements, we can
create a similar image with <a class="reference" href="http://xplanet.sourceforge.net/">xplanet</a> or <a class="reference" href="http://www.cs.colorado.edu/~tuna/xearth/">xearth</a>:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">dump_xearth_markers</span><span class="p">(</span><span class="n">MERLIN</span><span class="p">)))</span>
<span class="go">52.168467 0.039792 &quot;Cambridge&quot;</span>
<span class="go">53.144000 -2.545992 &quot;Darnhall&quot;</span>
<span class="go">52.091003 -2.136006 &quot;Defford&quot;</span>
<span class="go">52.778008 -3.010986 &quot;Knocking&quot;</span>
<span class="go">53.236250 -2.307150 &quot;Lovell Telescope&quot;</span>
<span class="go">53.231006 -2.309489 &quot;Mark II&quot;</span>
<span class="go">53.279006 -2.444994 &quot;Pickmere&quot;</span>
</pre></div>
<p>The map on the website contains a few more locations presumably to help
the viewer with orientation, but the image below is useful as a good
approximation.  And, of course, the locations could be supplemented
either by hand, or by using one of the other <tt class="docutils literal"><span class="pre">upoints</span></tt> supported
databases.</p>
<img alt="xearth displaying array locations" src="http://www.jnrowe.ukfsn.org/graphics/merlin_xearth.png" style="width: 256px; height: 256px;" />
</div>
<div class="section">
<h1><a id="examining-local-solar-time" name="examining-local-solar-time">Examining local solar time</a></h1>
<p>Imagine the contrived example that we were allowed access to each of the
locations and we're hoping to catch the end of an imaginary partial
eclipse occurring at 05:45 UTC on 2007-09-20 we can find the best
location to view from quite simply.  Clearly, the most important factor
is whether the Sun will be visible at the given time and this can be
calculated very easily:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">import</span> <span class="nn">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">rise</span> <span class="ow">in</span> <span class="n">MERLIN</span><span class="o">.</span><span class="n">sunrise</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mf">2007</span><span class="p">,</span> <span class="mf">9</span><span class="p">,</span> <span class="mf">20</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">rise</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mf">5</span><span class="p">,</span> <span class="mf">45</span><span class="p">):</span> <span class="k">continue</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;     - sunrise @ </span><span class="si">%s</span><span class="s"> UTC&quot;</span> <span class="o">%</span> <span class="n">rise</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%H:%M&quot;</span><span class="p">))</span>
<span class="go">Cambridge</span>
<span class="go">     - sunrise @ 05:41 UTC</span>
</pre></div>
<p>This simple code snippet shows us that we should set up our equipment at
the Cambridge site, which lucky for me is only a short trip up the road:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Home</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mf">52.015</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.221</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%i</span><span class="s"> kM&quot;</span> <span class="o">%</span> <span class="n">Home</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">MERLIN</span><span class="p">[</span><span class="s">&#39;Cambridge&#39;</span><span class="p">]))</span>
<span class="go">24 kM</span>
</pre></div>
</div>
<div class="section">
<h1><a id="comparisons-with-other-point-type-objects" name="comparisons-with-other-point-type-objects">Comparisons with other <tt class="docutils literal"><span class="pre">Point</span></tt>-type objects</a></h1>
<p>In our contrived example above we may wish to travel only if the weather
will be warm enough that we're unlikely to freeze to death(that risk is
only acceptable for a full eclipse), and we can use the other
<tt class="docutils literal"><span class="pre">upoints</span></tt> tools to find closest weather station quite easily:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">from</span> <span class="nn">upoints</span> <span class="k">import</span> <span class="n">weather_stations</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ICAO_stations_database</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">&quot;http://weather.noaa.gov/data/nsd_cccc.txt&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ICAO_stations</span> <span class="o">=</span> <span class="n">weather_stations</span><span class="o">.</span><span class="n">Stations</span><span class="p">(</span><span class="n">ICAO_stations_database</span><span class="p">,</span> <span class="s">&quot;ICAO&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">calc_distance</span> <span class="o">=</span> <span class="k">lambda</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span> <span class="n">MERLIN</span><span class="p">[</span><span class="s">&#39;Cambridge&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">station_id</span><span class="p">,</span> <span class="n">station_data</span> <span class="o">=</span> <span class="n">sorted</span><span class="p">(</span><span class="n">ICAO_stations</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">calc_distance</span><span class="p">)[</span><span class="mf">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">station_data</span><span class="p">)</span>
<span class="go">Cambridge (N52.200°; E000.183°)</span>
</pre></div>
<p>The <tt class="docutils literal"><span class="pre">calc_distance</span></tt> function simply returns the distance from the
Cambridge MERLIN station to the provided station, and we use it
as the sorting method to discover the closest weather station from the
<a class="reference" href="http://weather.noaa.gov/">NOAA</a> database.  The <tt class="docutils literal"><span class="pre">station_id</span></tt> and <tt class="docutils literal"><span class="pre">station_data</span></tt> variables are
set to the first result from the sorted list of station distances, which
thanks to the <tt class="docutils literal"><span class="pre">calc_distance</span></tt> sorting method are the details of the
closest weather station.</p>
<p>As we're already using <a class="reference" href="http://www.python.org/">Python</a> we may as well use Python to fetch the
weather data for the station using the ever useful <a class="reference" href="http://www.schwarzvogel.de/software-pymetar.shtml">pymetar</a> library.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">report</span> <span class="o">=</span> <span class="n">pymetar</span><span class="o">.</span><span class="n">ReportFetcher</span><span class="p">(</span><span class="n">station_id</span><span class="p">)</span><span class="o">.</span><span class="n">FetchReport</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">report_decoded</span> <span class="o">=</span> <span class="n">pymetar</span><span class="o">.</span><span class="n">ReportParser</span><span class="p">()</span><span class="o">.</span><span class="n">ParseReport</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%i</span><span class="s">°C @ </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">report_decoded</span><span class="o">.</span><span class="n">getTemperatureCelsius</span><span class="p">(),</span>
<span class="gp">... </span>                     <span class="n">report_decoded</span><span class="o">.</span><span class="n">getISOTime</span><span class="p">()))</span>
<span class="go">10°C @ 2007-11-28 19:20:00Z</span>
</pre></div>
<!-- :vim: set ft=rst ts=2 sw=2 et: -->
</div>
</div>
<div class="footer">
<hr class="footer" />
<a class="reference" href="merlin.txt">View document source</a>.
Generated by <a class="reference" href="http://docutils.sourceforge.net/">Docutils</a> from <a class="reference" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> source.

</div>
</body>
</html>
