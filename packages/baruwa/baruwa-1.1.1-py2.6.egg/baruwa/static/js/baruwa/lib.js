function wordwrap(f,b,a,e){a=a||"<br/>\n";b=b||75;e=e||false;if(!f){return f}var d=".{1,"+b+"}(\\s|$)"+(e?"|.{"+b+"}|.+$":"|\\S+?(\\s|$)");return f.match(RegExp(d,"g")).join(a)}function stripHTML(a){if(a){return a.replace(/<(.|\n)*?>/g,"")}else{return""}}function lastupdatetime(){var e=new Date();var h,g,b,a,d,f,i;h=e.getFullYear();g=e.getMonth()+1;if(g<10){g="0"+g}b=e.getDate();a=e.getHours();d=e.getMinutes();f=e.getSeconds();if(f<10){f="0"+f}if(d<10){d="0"+d}i=h+"-"+g+"-"+b+" "+a+":"+d+":"+f;return i}function filesizeformat(a){var b=["bytes","KB","MB","GB","TB","PB"];var d=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(d))).toFixed(1)+" "+b[d]}function stringtonum(a){return(typeof(a)=="number")?new Number(a):NaN}function json2html(f){if(f){rj=f.paginator;if(f.items.length){last_ts=f.items[0].timestamp}var g;var e;rows=[];len=f.items.length;len--;count=0;$("#smailtotal").empty().append(f.status.baruwa_mail_total);$("#sspamtotal").empty().append(f.status.baruwa_spam_total);$("#svirustotal").empty().append(f.status.baruwa_virus_total);$("#inq").empty().append(f.status.baruwa_in_queue);$("#outq").empty().append(f.status.baruwa_out_queue);if(f.status.baruwa_status){simg="active.png";alt="OK"}else{simg="inactive.png";alt="FAULTY"}var b=media_url+"imgs/"+simg;$("#statusimg").attr("src",b).attr("alt",alt);$.each(f.items,function(j,l){g="";c="LightBlue";e=l.to_address.split(",");for(itr=0;itr<e.length;itr++){g+=e[itr]+"<br />"}if(l.from_address.length>30){var k=l.from_address.substring(0,29)+"..."}else{var k=l.from_address}s=stripHTML(l.subject);if(s.length>38){re=/\s/g;if(re.test(s)){subject=wordwrap(s,55)}else{subject=s.substring(0,44)+"..."}}else{subject=s}var h="";if(l.spam&&!(l.virusinfected)&&!(l.nameinfected)&&!(l.otherinfected)){h=gettext("Spam");if(l.highspam){c="highspam"}else{c="spam"}}if(l.virusinfected||l.nameinfected||l.otherinfected){h=gettext("Infected");c="infected"}if(!(l.spam)&&!(l.virusinfected)&&!(l.nameinfected)&&!(l.otherinfected)){h=gettext("Clean")}if(l.whitelisted&&!(l.virusinfected)&&!(l.nameinfected)&&!(l.otherinfected)){h="WL";c="whitelisted"}if(l.blacklisted){h="BL";c="blacklisted"}if(!l.scaned){h="NS";c="LightGray"}if(f.paginator){if(f.paginator.view_type=="archive"){view="archive"}else{view="view"}}else{view="view"}rows[count++]='<div class="'+stripHTML(c)+'_div">';rows[count++]='<div class="Date_Time"><a href="/messages/'+view+"/"+l.id+'/">'+l.timestamp+"</a></div>";rows[count++]='<div class="From_row"><a href="/messages/'+view+"/"+l.id+'/">'+k+"</a></div>";rows[count++]='<div class="To_row"><a href="/messages/'+view+"/"+l.id+'/">'+g+"</a></div>";rows[count++]='<div class="Subject_row"><a href="/messages/'+view+"/"+l.id+'/">'+subject+"</a></div>";rows[count++]='<div class="Size_row"><a href="/messages/'+view+"/"+l.id+'/">'+filesizeformat(l.size)+"</a></div>";rows[count++]='<div class="Score_row"><a href="/messages/'+view+"/"+l.id+'/">'+l.sascore+"</a></div>";rows[count++]='<div class="Status_row"><a href="/messages/'+view+"/"+l.id+'/">'+h+"</a></div>";rows[count++]="</div>"});if(!rows.length){if(full_messages_listing){rows='<div class="spanrow">'+gettext("No records returned")+"</div>";$("div.Grid_heading ~ div").remove();$("div.Grid_heading").after(rows)}}else{if(full_messages_listing){$("div.Grid_heading ~ div").remove();$("div.Grid_heading").after(rows.join(""))}else{var d=(baruwa_num_recent_messages-1);var a=(baruwa_num_recent_messages-2);if(len==d){$("div.Grid_heading ~ div").remove();$("div.Grid_heading").after(rows.join(""))}else{remove_rows=(a-len);$("div.Grid_heading ~ div:gt("+remove_rows+")").remove();$("div.Grid_heading").after(rows.join(""))}}}}else{$("#my-spinner").empty().append(gettext("Empty response from server. check network!"))}};