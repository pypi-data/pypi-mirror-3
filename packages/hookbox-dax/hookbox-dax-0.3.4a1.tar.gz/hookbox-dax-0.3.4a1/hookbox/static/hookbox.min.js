(function(){function r(b,c){var a=Array.prototype.slice.call(arguments,2);return function(){c="string"==typeof c?b[c]:c;return c.apply(b,a.concat(Array.prototype.slice.call(arguments,0)))}}function A(){var b=require("fs"),c=require("sys");this.global=GLOBAL;this.getCwd=process.cwd;this.log=function(){var a;try{c.error(a=Array.prototype.map.call(arguments,function(a){return a instanceof Error&&a.message?"Error:"+a.message+"\nStack:"+a.stack+"\nArguments:"+a.arguments:"string"==typeof a?a:JSON.stringify(a)}).join(" "))}catch(b){c.error(a=
Array.prototype.join.call(arguments," ")+"\n")}return a};this.getPath=function(){var a=__filename.split("/");a.pop();return a.join("/")||"."};this.eval=process.compile;this.findModule=function(a){for(var c=0,e;e=a[c];++c)try{return e.src=b.readFileSync(e.filePath),e}catch(n){}return!1};this.require=require;this.include=include}function B(){var b=window.XMLHttpRequest||function(){return new ActiveXObject("Msxml2.XMLHTTP")},c=Array.prototype.slice,a=null,d=null;this.global=window;this.global.jsio=jsio;
this.log=function(){var a=c.call(arguments,0);"undefined"!=typeof console&&console.log&&(console.log.apply?console.log.apply(console,arguments):console.log(a));return a.join(" ")};this.getCwd=function(){if(!a){var b=window.location.toString().split("#")[0];a=b.substring(0,b.lastIndexOf("/")+1)}return a};this.getPath=function(){if(!d){try{for(var a=RegExp("(.*?)"+jsio.__filename+"(\\?.*)?$"),b=document.getElementsByTagName("script"),c=0,e;e=b[c];++c){var h=e.src.match(a);if(h){d=h[1];/^[A-Za-z]*:\/\//.test(d)&&
(d=s(d,this.getCwd()));break}}}catch(l){}d||(d=".")}return d};var l="undefined"==typeof eval("(function(){})")?function(a){return(new Function("return "+a))()}:function(a,b){return window.eval(a+"\n//@ sourceURL="+b)};this.eval=function(a,b){try{return l(a,b)}catch(c){if(c instanceof SyntaxError){c.message="a syntax error is preventing execution of "+b;c.type="syntax_error";try{var d=function(){var a=document.createElement("iframe");a.style.cssText="position:absolute;top:-999px;left:-999px;width:1px;height:1px;visibility:hidden";
a.src='javascript:document.open();document.write("<scr"+"ipt src=\''+b+'\'></scr"+"ipt>")';setTimeout(function(){try{document.body.appendChild(a)}catch(b){}},0)};document.body?d():window.addEventListener("load",d,!1)}catch(e){}}throw c;}};this.findModule=function(a){for(var c=0,d;d=a[c];++c){var g=new b;try{g.open("GET",d.filePath,!1),g.send(null)}catch(h){e.log("e:",h);continue}if(!(404==g.status||-1100==g.status))return d.src=g.responseText,d}return!1}}function D(b,c){var a=e.eval("(function(_){with(_){delete _;(function(){"+
c.src+"\n}).call(this)}})",c.filePath);try{a.call(b.exports,b)}catch(d){if("syntax_error"==d.type)throw Error("error importing module: "+d.message);d.jsioLogged||(d.jsioLogged=!0,"stack_overflow"==d.type?e.log("Stack overflow in",c.filePath,":",d):e.log("ERROR LOADING",c.filePath,":",d));throw d;}}function o(b,c,a){if(!c||(a=a||".")!=b.charAt(0))return b;for(var d=1;b.charAt(d)==a;)++d;c=c.split(a).slice(0,-d);c.length&&(c=c.join(a),c.charAt(c.length-1)!=a&&(c+=a));return c+b.substring(d)}function F(b,
c){var a,d=[];if(a=c.match(/^(from|external)\s+([\w.$]+)\s+import\s+(.*)$/))d[0]={from:o(a[2],b),external:"external"==a[1],"import":{}},a[3].replace(/\s*([\w.$*]+)(?:\s+as\s+([\w.$]+))?/g,function(a,b,c){d[0]["import"][b]=c||b});else if(a=c.match(/^import\s+(.*)$/))a[1].replace(/\s*([\w.$]+)(?:\s+as\s+([\w.$]+))?,?/g,function(a,c,e){fullPkg=o(c,b);d[d.length]=e?{from:fullPkg,as:e}:{from:fullPkg,as:c}});else if(a=c.match(/[\w.0-9$\/]/)){a=a[0];var e="/"==a.charAt(0);a=a.replace(/^\//,"").replace(/\.\.?\//g,
".").replace(/\//g,".");d[0]={from:e?a:o(a,b),as:a}}else throw a="Invalid jsio request: jsio('"+c+"')",SyntaxError?new SyntaxError(a):Error(a);return d}function G(b,c){var a={exports:{},global:e.global},d=e.getCwd(),l=c.lastIndexOf("/"),n=0<l;a.require=a.jsio=r(this,w,a,b);a.module={id:b};"base"!=b&&(a.jsio("from base import *"),a.logging.__create(b,a));a.jsio.__jsio=jsio;a.jsio.__env=jsio.__env;a.jsio.__dir=n?s(c.substring(0,l),d):"";a.jsio.__filename=n?c.substring(l):c;a.jsio.__path=b;return a}
function s(b,c){var a=b.match("^"+c);return a&&a[0]==c?b.slice(c.length+("/"==b[c.length]?1:0)):b}function w(b,c,a,d){for(var b=d||b||e.global,d=F(c,a),l=d.length,n=1<l?{}:null,o=0;o<l;++o){var i=d[o],g=i.from,h=jsio.modules;if(!(g in h)){try{var p;if(!(p=C[g])){var k=g,t;var f=k;if("."==f.charAt(0)){for(var j=0;"."==f.charAt(j+1);)++j;var x;x=e.getCwd().replace(/\/$/,"");j&&(x=x.split("/").slice(0,-j).join("/"));t=[{filePath:x+"/"+f.substring(j+1).split(".").join("/")+".js"}]}else{var r=f.split("."),
u=r[0],s=r.join("/");if(u in jsio.path)t=[{filePath:(jsio.path[u].length&&jsio.path[u].replace(/([^\/])$/,"$1/")||jsio.path[u])+s+".js"}];else{for(var f=[],y="string"==typeof jsio.path.__default__?[jsio.path.__default__]:jsio.path.__default__,j=0,w=y.length;j<w;++j){var E=y[j].length&&y[j].replace(/([^\/])$/,"$1/")||y[j];f.push({filePath:E+s+".js",baseMod:u,basePath:E})}t=f}}var v=e.findModule(t);if(!v){b=[];p=0;for(j=void 0;j=t[p];++p)b.push(j.filePath);throw Error("Module not found: "+k+" (looked in "+
b.join(", ")+")");}v.baseMod in jsio.path||(jsio.path[v.baseMod]=v.basePath);p=v}k=p}catch(A){throw e.log("\nError executing '",a,"': could not load module",g,"\n\tpath:",c,"\n\trequest:",a,"\n"),A;}if(i.external){var f=h[g]={},q;for(q in i["import"])f[q]=void 0;D(f,k);for(q in i["import"])void 0===f[q]&&(f[q]=e.global[q])}else f=G(g,k.filePath),h[g]=f.exports,D(f,k),h[g]=f.exports}k=h[g];1==l&&(n=k);if(i.as){for(var g=i.as.match(/^\.*(.*?)\.*$/)[1],i=g.split("."),h=i.length-1,f=b,m=0;m<h;++m){var z=
i[m];z&&(f[z]||(f[z]={}),f=f[z])}f[i[h]]=k;1<l&&(n[g]=k)}else if(i["import"])if(i["import"]["*"])for(m in h[g])b[m]=k[m];else try{for(m in i["import"])b[i["import"][m]]=k[m]}catch(B){throw e.log("module: ",h),B;}}return n}var e,C={"net.protocols.delimited":{src:'jsio("import net.interfaces");\nexports.DelimitedProtocol=Class(net.interfaces.Protocol,function(){this.init=function(a){a||(a="\\r\\n");this.delimiter=a;this.buffer=""};this.connectionMade=function(){logger.debug("connectionMade")};this.dataReceived=function(a){if(a){logger.debug("dataReceived:("+a.length+")",a);logger.debug("last 2:",a.slice(a.length-2));this.buffer+=a;for(logger.debug("index",this.buffer.indexOf(this.delimiter));-1!=(a=this.buffer.indexOf(this.delimiter));){var b=this.buffer.slice(0,a);this.buffer=this.buffer.slice(a+\nthis.delimiter.length);this.lineReceived(b)}}};this.lineReceived=function(a){logger.debug("Not implemented, lineReceived:",a)};this.sendLine=function(a){logger.debug("WRITE:",a+this.delimiter);this.transport.write(a+this.delimiter)};this.connectionLost=function(){logger.debug("connectionLost")}});\n',
filePath:"jsio/net/protocols/delimited.js"},"net.env":{src:'function getObj(c,a,b){try{jsio("from .env."+(b||jsio.__env.name)+"."+a+" import "+c+" as result")}catch(d){throw logger.error("Invalid transport (",a,") or environment (",b,")");}return result}exports.getListener=bind(this,getObj,"Listener");exports.getConnector=bind(this,getObj,"Connector");\n',filePath:"jsio/net/env.js"},"std.base64":{src:'for(var alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",pad="=",padChar=alphabet.charAt(alphabet.length-1),shorten=function(a,b){for(var d=b;0<d;d--)a.pop()},decode_map={},i=0,n=alphabet.length;i<n;i++)decode_map[alphabet.charAt(i)]=i;var alphabet_inverse=RegExp("[^"+alphabet.replace("-","\\\\-")+"]"),Base64CodecError=exports.Base64CodecError=function(a){this.message=a};\nBase64CodecError.prototype.toString=function(){return"Base64CodecError"+(this.message?": "+this.message:"")};var assertOrBadInput=function(a,b){if(!a)throw new Base64CodecError(b);};\nexports.encode=function(a){assertOrBadInput(!/[^\\x00-\\xFF]/.test(a),"Input contains out-of-range characters.");for(var b="\\x00\\x00\\x00".slice(a.length%3||3),a=a+b,d=[],c=0,f=a.length;c<f;c+=3){var e=(a.charCodeAt(c)<<16)+(a.charCodeAt(c+1)<<8)+a.charCodeAt(c+2);d.push(alphabet.charAt(e>>18&63),alphabet.charAt(e>>12&63),alphabet.charAt(e>>6&63),alphabet.charAt(e&63))}shorten(d,b.length);return d.join("")};\nexports.decode=function(a){logger.debug("decode",a);for(var a=a.replace(/\\s/g,""),b=a.length;a.charAt(--b)===pad;);a=a.slice(0,b+1);assertOrBadInput(!alphabet_inverse.test(a),"Input contains out-of-range characters.");for(var d=Array(5-(a.length%4||4)).join(padChar),a=a+d,c=[],b=0,f=a.length;b<f;b+=4)newchars=(decode_map[a.charAt(b)]<<18)+(decode_map[a.charAt(b+1)]<<12)+(decode_map[a.charAt(b+2)]<<6)+decode_map[a.charAt(b+3)],c.push(newchars>>16&255,newchars>>8&255,newchars&255);shorten(c,d.length);\na=String.fromCharCode.apply(String,c);logger.debug("decoded",a);return a};\n',
filePath:"jsio/std/base64.js"},"lib.Enum":{src:'exports=function(){if(1==arguments.length){if("object"==typeof arguments[0]){var b=arguments[0],a;for(a in b)b[a]in b||(b[b[a]]=a);return b}"string"!=typeof arguments[0]&&(c=arguments[0])}if(!c)var c=arguments;b={};a=0;for(var d=c.length;a<d;++a)c[a]&&(b[c[a]]=a+1),b[a+1]=c[a];return b};\n',filePath:"jsio/lib/Enum.js"},"net.errors":{src:'var makeErrorClass=function(b){var c=function(a){"string"==typeof a?this.message=a:this.data=a};c.prototype={type:b,toString:function(){return b+(this.message?": "+this.message:"")}};return c};exports.ReadyStateError=makeErrorClass("ReadyStateError");exports.InvalidEncodingError=makeErrorClass("InvalidEncodingError");exports.ExpiredSession=makeErrorClass("ExpiredSession");exports.ServerUnreachable=makeErrorClass("ServerUnreachable",100);\nexports.ConnectionTimeout=makeErrorClass("ConnectionTimeout",101);exports.ServerProtocolError=makeErrorClass("ServerProtocolError",200);exports.ServerClosedConnection=makeErrorClass("ServerClosedConnection",301);exports.ConnectionClosedCleanly=makeErrorClass("ConnectionClosedCleanly",300);\n',
filePath:"jsio/net/errors.js"},"net.env.browser.csp":{src:'jsio("import net.interfaces");jsio("from net.csp.client import CometSession");jsio("import std.utf8 as utf8");\nexports.Connector=Class(net.interfaces.Connector,function(){this.connect=function(){this._state=net.interfaces.STATE.CONNECTING;var a=new CometSession;a.onconnect=bind(this,"cometSessionOnConnect",a);a.ondisconnect=bind(this,"onDisconnect");logger.debug("opening the connection");this._opts.encoding="plain";var b=this._opts.url;delete this._opts.url;a.connect(b,this._opts)};this.cometSessionOnConnect=function(a){logger.debug("conn has opened");this.onConnect(new Transport(a))}});\nvar Transport=Class(net.interfaces.Transport,function(){this.init=function(a){this._conn=a};this.makeConnection=function(a){this._conn.onread=bind(a,"dataReceived")};this.write=function(a){this._conn.write("utf8"==this._encoding?utf8.encode(a):a)};this.loseConnection=function(){this._conn.close()}});\n',
filePath:"jsio/net/env/browser/csp.js"},"std.JSON":{src:'exports.createGlobal=function(){"undefined"==typeof JSON&&(JSON={});"function"!==typeof JSON.stringify&&(JSON.stringify=exports.stringify);"function"!==typeof JSON.parse&&(JSON.parse=exports.parse)};\n(function(){function n(a){o.lastIndex=0;return o.test(a)?\'"\'+a.replace(o,function(a){var c=q[a];return"string"===typeof c?c:"\\\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+\'"\':\'"\'+a+\'"\'}function m(a,j){var c=e,b=j[a];b&&"object"===typeof b&&"function"===typeof b.toJSON&&(b=b.toJSON(a));"function"===typeof k&&(b=k.call(j,a,b));switch(typeof b){case "string":return n(b);case "number":return isFinite(b)?""+b:"null";case "boolean":return""+b;case "object":if(null===b)return"null";if(b.constructor===\nDate)return exports.stringifyDate(b);e+=l;var g=[];if(b.constructor===Array){for(var i=b.length,d=0;d<i;d+=1)g[d]=m(d,b)||"null";var h=0===g.length?"[]":e?"[\\n"+e+g.join(",\\n"+e)+"\\n"+c+"]":"["+g.join(",")+"]";e=c;return h}if(k&&"object"===typeof k){i=k.length;for(d=0;d<i;d+=1){var f=k[d];"string"===typeof f&&(h=m(f,b))&&g.push(n(f)+(e?": ":":")+h)}}else for(f in b)Object.hasOwnProperty.call(b,f)&&(h=m(f,b))&&g.push(n(f)+(e?": ":":")+h);h=0===g.length?"{}":e?"{\\n"+e+g.join(",\\n"+e)+"\\n"+c+"}":"{"+\ng.join(",")+"}";e=c;return h}}var p=/[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,o=/[\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,e,l,q={"\\u0008":"\\\\b","\\t":"\\\\t","\\n":"\\\\n","\\u000c":"\\\\f","\\r":"\\\\r",\'"\':\'\\\\"\',"\\\\":"\\\\\\\\"},k;exports.stringify=function(a,j,c){l=e="";if("number"===typeof c)for(var b=0;b<c;b+=1)l+=" ";else"string"===typeof c&&(l=c);if((k=j)&&"function"!==\ntypeof j&&("object"!==typeof j||"number"!==typeof j.length))throw Error("JSON stringify: invalid replacer");return m("",{"":a})};exports.stringifyDate=function(a){var e=a.getUTCFullYear(),c=a.getUTCMonth()+1,b=a.getUTCDate(),g=a.getUTCHours(),i=a.getUTCMinutes(),d=a.getUTCSeconds(),a=a.getUTCMilliseconds();10>c&&(c="0"+c);10>b&&(b="0"+b);10>g&&(g="0"+g);10>i&&(i="0"+i);10>d&&(d="0"+d);10>a?a="00"+a:100>a&&(a="0"+a);return\'"\'+e+"-"+c+"-"+b+"T"+g+":"+i+":"+d+"."+a+\'Z"\'};exports.parse=function(a,e){p.lastIndex=\n0;p.test(a)&&(a=a.replace(p,function(a){return"\\\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\\],:{}\\s]*$/.test(a.replace(/\\\\(?:["\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\\\\n\\r]*"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g,"]").replace(/(?:^|:|,)(?:\\s*\\[)+/g,""))){var c=eval("("+a+")");if(e){var b=function(a,c){var d,h,f=a[c];if(f&&"object"===typeof f)for(d in f)Object.hasOwnProperty.call(f,d)&&(h=b(f,d),void 0!==h?f[d]=h:delete f[d]);return e.call(a,c,f)};return b({"":c},\n"")}return c}throw new SyntaxError("JSON.parse");}})();\n',
filePath:"jsio/std/JSON.js"},"net.env.browser.websocket":{src:'jsio("import net.interfaces");jsio("import std.utf8 as utf8");jsio("import net.errors as Errors");\nexports.Connector=Class(net.interfaces.Connector,function(){this.connect=function(){this._state=net.interfaces.STATE.CONNECTING;var a=this._opts.url,b=this._opts.wsConstructor||window.WebSocket;logger.info("this._opts",this._opts);a=new b(a);a.onopen=bind(this,"webSocketOnOpen",a);a.onclose=bind(this,"webSocketOnClose",a)};this.webSocketOnOpen=function(a){this.onConnect(new Transport(a))};this.webSocketOnClose=function(a,b){var c;c={rawError:b,webSocket:a};c=b.wasClean?new Errors.ServerClosedConnection("WebSocket Connection Closed",\nc):this._state==net.interfaces.STATE.CONNECTED?new Errors.ConnectionTimeout("WebSocket Connection Timed Out",c):new Errors.ServerUnreachable("WebSocket Connection Failed",c);logger.debug("conn closed",c);this.onDisconnect(c)}});\nvar Transport=Class(net.interfaces.Transport,function(){this.init=function(a){this._ws=a};this.makeConnection=function(a){this._ws.onmessage=function(b){b=utf8.encode(b.data);a.dataReceived(b)}};this.write=function(a){"plain"==this._encoding&&(result=utf8.decode(a),a=result[0]);this._ws.send(a)};this.loseConnection=function(){this._ws.close()}});\n',
filePath:"jsio/net/env/browser/websocket.js"},"net.protocols.rtjp":{src:'jsio("import net.interfaces");jsio("from net.protocols.delimited import DelimitedProtocol");\nexports.RTJPProtocol=Class(DelimitedProtocol,function(c){this.init=function(){c(this,"init",["\\r\\n"]);this.frameId=0};this.connectionMade=function(){logger.debug("connectionMade")};this.frameReceived=function(){};this.sendFrame=function(b,a){a||(a={});logger.debug("sendFrame",b,a);this.sendLine(JSON.stringify([++this.frameId,b,a]));return this.frameId};this.lineReceived=function(b){try{var a=JSON.parse(b);3!=a.length?logger.error("Invalid frame length"):"number"!=typeof a[0]?logger.error("Invalid frame id"):\n"string"!=typeof a[1]?logger.error("Invalid frame name"):(logger.debug("frameReceived:",a[0],a[1],a[2]),this.frameReceived(a[0],a[1],a[2]))}catch(c){logger.error(c)}};this.connectionLost=function(){logger.debug("conn lost")}});\n',
filePath:"jsio/net/protocols/rtjp.js"},"net.csp.client":{src:'jsio("import std.base64 as base64");jsio("import std.utf8 as utf8");jsio("import std.uri as uri");jsio("import net.errors as errors");jsio("import .transports");jsio("import lib.Enum as Enum");var READYSTATE=exports.READYSTATE=Enum({INITIAL:0,CONNECTING:1,CONNECTED:2,DISCONNECTING:3,DISCONNECTED:4});\nexports.CometSession=Class(function(){var d=0;this.init=function(){this._id=++d;this._url=null;this.readyState=READYSTATE.INITIAL;this._options=this._transport=this._sessionKey=null;this._writeBuffer=this._utf8ReadBuffer="";this._handshakeLater=this._lastSentId=this._lastEventId=this._packetsInFlight=null;this._handshakeBackoff=50;this._timeoutTimer=this._handshakeTimeoutTimer=this._handshakeRetryTimer=null;this._cometBackoff=this._writeBackoff=50;this._nullReceived=this._nullSent=this._nullInFlight=\nthis._nullInBuffer=!1};this.setEncoding=function(a){if(a!=this._options.encoding){if("utf8"!=a&&"plain"!=a)throw new errors.InvalidEncodingError;if("plain"==a&&this._buffer){var b=this._utf8ReadBuffer;this._utf8ReadBuffer="";this._doOnRead(b)}this._options.encoding=a}};this.connect=function(a,b){this._url=a.replace(/\\/$/,"");this._options=b||{};this._options.encoding=this._options.encoding||"utf8";this.setEncoding(this._options.encoding);this._options.connectTimeout=this._options.connectTimeout||\n1E4;this._transport=new (transports.chooseTransport(a,this._options));this._transport.handshakeFailure=bind(this,this._handshakeFailure);this._transport.handshakeSuccess=bind(this,this._handshakeSuccess);this._transport.cometFailure=bind(this,this._cometFailure);this._transport.cometSuccess=bind(this,this._cometSuccess);this._transport.sendFailure=bind(this,this._writeFailure);this._transport.sendSuccess=bind(this,this._writeSuccess);this.readyState=READYSTATE.CONNECTING;this._transport.handshake(this._url,\nthis._options);this._handshakeTimeoutTimer=$setTimeout(bind(this,this._handshakeTimeout),this._options.connectTimeout)};this.write=function(a,b){if(this.readyState!=READYSTATE.CONNECTED)throw new errors.ReadyStateError;b=b||this._options.encoding||"utf8";"utf8"==b&&(a=utf8.encode(a));this._writeBuffer+=a;this._doWrite()};this._protocolError=function(a){logger.debug("_protocolError",a);this.readyState=READYSTATE.DISCONNECTED;this._doWrite(!0);this._doOnDisconnect(new errors.ServerProtocolError(a))};\nthis._receivedNullPacket=function(){logger.debug("_receivedNullPacket");this._receivedNull=!0;!this._nullInFlight&&!this._nullInBuffer&&!this._nullSent?(this.readyState=READYSTATE.DISCONNECTING,this._doWrite(!0)):this.readyState=READYSTATE.DISCONNECTED;this._doOnDisconnect(new errors.ConnectionClosedCleanly)};this._sentNullPacket=function(){logger.debug("_sentNullPacket");if((this._nullSent=!0)&&this._nullReceived)this.readyState=READYSTATE.DISCONNECTED};this.close=function(a){logger.debug("close called",\na,"readyState",this.readyState);switch(this.readyState){case READYSTATE.CONNECTING:clearTimeout(this._handshakeRetryTimer);clearTimeout(this._handshakeTimeoutTimer);this.readyState=READYSTATE.DISCONNECTED;this._doOnDisconnect(a);break;case READYSTATE.CONNECTED:this.readyState=READYSTATE.DISCONNECTING;this._doWrite(!0);clearTimeout(this._timeoutTimer);break;case READYSTATE.DISCONNECTED:throw new errors.ReadyStateError("Session is already disconnected");}this._sessionKey=null;this._opened=!1;this.readyState=\nREADYSTATE.DISCONNECTED;this._doOnDisconnect(a)};this._handshakeTimeout=function(){logger.debug("handshake timeout");this._handshakeTimeoutTimer=null;this._doOnDisconnect(new errors.ServerUnreachable)};this._handshakeSuccess=function(a){logger.debug("handshake success",a);this.readyState!=READYSTATE.CONNECTING?logger.debug("received handshake success in invalid readyState:",this.readyState):(clearTimeout(this._handshakeTimeoutTimer),this._handshakeTimeoutTimer=null,this._sessionKey=a.response.session,\nthis._opened=!0,this.readyState=READYSTATE.CONNECTED,this._doOnConnect(),this._doConnectComet())};this._handshakeFailure=function(a){logger.debug("handshake failure",a);if(this.readyState==READYSTATE.CONNECTING){if(404==a.status)return clearTimeout(this._handshakeTimeoutTimer),this._doOnDisconnect(new errors.ServerUnreachable);logger.debug("trying again in ",this._handshakeBackoff);this._handshakeRetryTimer=$setTimeout(bind(this,function(){this._handshakeRetryTimer=null;this._transport.handshake(this._url,\nthis._options)}),this._handshakeBackoff);this._handshakeBackoff*=2}};this._writeSuccess=function(){if(!(this.readyState!=READYSTATE.CONNECTED&&this.readyState!=READYSTATE.DISCONNECTING)){if(this._nullInFlight)return this._sentNullPacket();this._resetTimeoutTimer();this.writeBackoff=50;this._packetsInFlight=null;(this._writeBuffer||this._nullInBuffer)&&this._doWrite(this._nullInBuffer)}};this._writeFailure=function(){this.readyState!=READYSTATE.CONNECTED&&this.READYSTATE!=READYSTATE.DISCONNECTING||\n(this._writeTimer=$setTimeout(bind(this,function(){this._writeTimer=null;this.__doWrite(this._nullInBuffer)}),this._writeBackoff),this._writeBackoff*=2)};this._doWrite=function(a){this._packetsInFlight?a&&(this._nullInBuffer=!0):this.__doWrite(a)};this.__doWrite=function(a){logger.debug("_writeBuffer:",this._writeBuffer);!this._packetsInFlight&&this._writeBuffer&&(this._packetsInFlight=[this._transport.encodePacket(++this._lastSentId,this._writeBuffer,this._options)],this._writeBuffer="");a&&!this._writeBuffer&&\n(this._packetsInFlight||(this._packetsInFlight=[]),this._packetsInFlight.push([++this._lastSentId,0,null]),this._nullInFlight=!0);this._packetsInFlight?(logger.debug("sending packets:",JSON.stringify(this._packetsInFlight)),this._transport.send(this._url,this._sessionKey,this._lastEventId||0,JSON.stringify(this._packetsInFlight),this._options)):logger.debug("no packets to send")};this._doConnectComet=function(){logger.debug("_doConnectComet");this._transport.comet(this._url,this._sessionKey,this._lastEventId||\n0,this._options)};this._cometFailure=function(a){if(this.readyState==READYSTATE.CONNECTED){if(404==a.status&&"Session not found"==a.response)return this.close(new errors.ExpiredSession(a));this._cometTimer=$setTimeout(bind(this,function(){this._doConnectComet()}),this._cometBackoff);this._cometBackoff*=2}};this._cometSuccess=function(a){if(!(this.readyState!=READYSTATE.CONNECTED&&this.readyState!=READYSTATE.DISCONNECTING)){logger.debug("comet Success:",a);this._cometBackoff=50;this._resetTimeoutTimer();\nfor(var b=a.response,e=0,c;(c=b[e])||e<b.length;e++){logger.debug("process packet:",c);if(null===c)return this.close(new errors.ServerProtocolError(a));logger.debug("process packet",c);var f=c[0],d=c[1],a=c[2];if(!("number"==typeof this._lastEventId&&f<=this._lastEventId)){if("number"==typeof this._lastEventId&&f!=this._lastEventId+1)return this._protocolError("Ack id too high");this._lastEventId=f;if(null==a)return this._receivedNullPacket();if(1==d)try{logger.debug("before base64 decode:",a),a=\nbase64.decode(a),logger.debug("after base64 decode:",a)}catch(h){return this._protocolError("Unable to decode base64 payload")}"utf8"==this._options.encoding&&(this._utf8ReadBuffer+=a,logger.debug("before utf8 decode, _utf8ReadBuffer:",this._utf8ReadBuffer),c=utf8.decode(this._utf8ReadBuffer),a=c[0],this._utf8ReadBuffer=this._utf8ReadBuffer.slice(c[1]),logger.debug("after utf8 decode, _utf8ReadBuffer:",this._utf8ReadBuffer,"data:",a));logger.debug("dispatching data:",a);try{this._doOnRead(a)}catch(g){logger.error("application code threw an error. (re-throwing in timeout):",\ng),setTimeout(function(){logger.debug("timeout fired, throwing error",g);throw g;},0)}}}this._doConnectComet()}};this._doOnRead=function(a){"function"==typeof this.onread?(logger.debug("call onread function",a),this.onread(a)):logger.debug("skipping onread callback (function missing)")};this._doOnDisconnect=function(a){"function"==typeof this.ondisconnect?(logger.debug("call ondisconnect function",a),this.ondisconnect(a)):logger.debug("skipping ondisconnect callback (function missing)")};this._doOnConnect=\nfunction(){if("function"==typeof this.onconnect){logger.debug("call onconnect function");try{this.onconnect()}catch(a){logger.debug("onconnect caused errror",a),setTimeout(function(){throw a;},0)}}else logger.debug("skipping onconnect callback (function missing)")};this._resetTimeoutTimer=function(){clearTimeout(this._timeoutTimer);this._timeoutTimer=$setTimeout(bind(this,function(){logger.debug("connection timeout expired");this.close(new errors.ConnectionTimeout)}),this._getTimeoutInterval())};\nthis._getTimeoutInterval=function(){return 45E3}});\n',
filePath:"jsio/net/csp/client.js"},"net.interfaces":{src:'jsio("import net");jsio("import lib.Enum as Enum");var ctx=jsio.__env.global;exports.Protocol=Class(function(){this.connectionMade=function(){};this.dataReceived=function(){};this.connectionLost=function(){}});exports.Client=Class(function(){this.init=function(a){this._protocol=a};this.connect=function(a,b){this._remote=new this._protocol;this._remote._client=this;net.connect(this._remote,a,b)}});\nexports.Server=Class(function(){this.init=function(a){this._protocolClass=a};this.buildProtocol=function(){return new this._protocolClass};this.listen=function(a,b){return net.listen(this,a,b)}});exports.Transport=Class(function(){this._encoding="plain";this.write=function(){throw Error("Not implemented");};this.getPeer=function(){throw Error("Not implemented");};this.setEncoding=function(a){this._encoding=a};this.getEncoding=function(){return this._encoding}});\nexports.Listener=Class(function(){this.init=function(a,b){this._server=a;this._opts=b||{}};this.onConnect=function(a){var b=this._server.buildProtocol();b.transport=a;b.server=this._server;a.protocol=b;a.makeConnection(b);b.connectionMade()};this.listen=function(){throw Error("Abstract class");};this.stop=function(){}});exports.STATE=Enum("INITIAL","DISCONNECTED","CONNECTING","CONNECTED");\nexports.Connector=Class(function(){this.init=function(a,b){this._protocol=a;this._opts=b;this._state=exports.STATE.INITIAL};this.onConnect=function(a){this._state=exports.STATE.CONNECTED;a.makeConnection(this._protocol);this._protocol.transport=a;try{this._protocol.connectionMade()}catch(b){throw logger.error(b);}};this.onDisconnect=function(a){var b=this._state==exports.STATE.CONNECTED;this._state=exports.STATE.DISCONNECTED;try{this._protocol.connectionLost(a,b)}catch(c){throw logger.error(c);}};\nthis.getProtocol=function(){return this._protocol}});\n',
filePath:"jsio/net/interfaces.js"},base:{src:'exports.log=jsio.__env.log;exports.GLOBAL=jsio.__env.global;\nexports.bind=function(a,b){if(2<arguments.length){var c=Array.prototype.slice.call(arguments,2);return"string"==typeof b?function(){if(a[b])return a[b].apply(a,c.concat(Array.prototype.slice.call(arguments,0)));throw logger.error("No method:",b,"for context",a);}:function(){return b.apply(a,c.concat(Array.prototype.slice.call(arguments,0)))}}return"string"==typeof b?function(){if(a[b])return a[b].apply(a,arguments);throw logger.error("No method:",b,"for context",a);}:function(){return b.apply(a,arguments)}};\nexports.Class=function(a,b){if(!a)throw Error("parent or prototype not provided");if(b)if(a instanceof Array){b.prototype={};for(var c=0,d;d=a[c];++c)for(var e in d.prototype)e in b.prototype||(b.prototype[e]=d.prototype[e]);a=a[0]}else b.prototype=a.prototype;else b=a,a=null;c=function(){if(this.init)return this.init.apply(this,arguments)};c.prototype=new b(a?function(a,e,c){for(var c=c||[],d=b;d=d.prototype;)if(d[e])return d[e].apply(a,c);throw Error("method "+e+" does not exist");}:null);return c.prototype.constructor=\nc};exports.$setTimeout=function(a,b){var c=Array.prototype.slice.call(arguments,2);return setTimeout(function(){try{a.apply(this,c)}catch(b){}},b)};exports.$setInterval=function(a,b){var c=Array.prototype.slice.call(arguments,2);return setInterval(function(){try{a.apply(this,c)}catch(b){}},b)};exports.$clearTimeout=function(a){return a?clearTimeout(a):null};exports.$clearInterval=function(a){return a?clearInterval(a):null};\nexports.logging=function(){var a={DEBUG:1,LOG:2,INFO:3,WARN:4,ERROR:5},b={},c=!1;a.setProduction=function(a){c=!!a};a.get=function(a){return b.hasOwnProperty(a)?b[a]:b[a]=new d(a)};a.set=function(a,c){b[a]=c};a.getAll=function(){return b};a.__create=function(b,c){c.logger=a.get(b)};var d=exports.Class(function(){function b(a,e){return function(){return!c&&a>=this._level?this._listener.apply(this._listener,[e,this._name].concat(d.call(arguments))):arguments[0]}}this.init=function(b,c){this._name=b;\nthis._level=c||a.LOG;this._listener=exports.log};this.setLevel=function(a){this._level=a};var d=Array.prototype.slice;this.setListener=function(a){log=a};this.debug=b(a.DEBUG,"DEBUG");this.log=b(a.LOG,"LOG");this.info=b(a.INFO,"INFO");this.warn=b(a.WARN,"WARN");this.error=b(a.ERROR,"ERROR")});return a}();var logger=exports.logging.get("jsiocore");\n',
filePath:"jsio/base.js"},hookbox:{src:'jsio("from net import connect as jsioConnect");jsio("from net.protocols.rtjp import RTJPProtocol");exports.__jsio=jsio.__jsio;exports.logging=logging;logger.setLevel(0);exports.connect=function(d,a,c){d.match("/$")||(d+="/");a=new HookBoxProtocol(d,a,c);window.WebSocket?(jsioConnect(a,"websocket",{url:d.replace("http://","ws://")+"ws"}),a.connectionLost=bind(a,"_connectionLost","websocket")):(jsioConnect(a,"csp",{url:d+"csp"}),a.connectionLost=bind(a,"_connectionLost","csp"));return a};\nvar Subscription=Class(function(){this.init=function(d,a){this.channelName=a.channel_name;this.history=a.history;this.historySize=a.history_size;this.state=a.state;this.presence=a.presence;this.canceled=!1;this.publish=bind(d,"publish",this.channelName)};this.onPublish=function(){};this.onSubscribe=function(){};this.onUnsubscribe=function(){};this.onState=function(){};this.frame=function(d,a){switch(d){case "PUBLISH":if(this.historySize)for(this.history.push(["PUBLISH",{user:a.user,payload:a.payload}]);this.history.length>\nthis.historySize;)this.history.shift();this.onPublish(a);break;case "UNSUBSCRIBE":if(this.historySize)for(this.history.push(["UNSUBSCRIBE",{user:a.user}]);this.history.length>this.historySize;)this.history.shift();for(var c=0,b;b=this.presence[c];++c)if(b==a.user){this.presence.splice(c,1);break}this.onUnsubscribe(a);break;case "SUBSCRIBE":if(this.historySize)for(this.history.push(["SUBSCRIBE",{user:a.user}]);this.history.length>this.historySize;)this.history.shift();this.presence.push(a.user);this.onSubscribe(a);\nbreak;case "STATE_UPDATE":for(c=0;b=a.deletes[c];++c)delete this.state[b];for(b in a.updates)this.state[b]=a.updates[b];this.onState(a)}};this.cancel=function(){this.canceled||(logger.debug("calling this._onCancel()"),this._onCancel())};this._onCancel=function(){}});\nHookBoxProtocol=Class([RTJPProtocol],function(d){this.onOpen=function(){};this.onClose=function(){};this.onConnectionLost=function(){};this.onError=function(){};this.onSubscribed=function(){};this.onUnsubscribed=function(){};this.onMessaged=function(){};this.init=function(a,c,b){d(this,"init",[]);this.url=a;try{this.cookieString=b||document.cookie}catch(e){this.cookieString=""}this.connected=!1;this._subscriptions={};this._buffered_subs=[];this._publishes=[];this._messages=[];this._errors={};this._connectPayload=\nc;this.username=null};this.subscribe=function(a){this.connected?this.sendFrame("SUBSCRIBE",{channel_name:a}):this._buffered_subs.push(a)};this.publish=function(a,c){this.connected?this.sendFrame("PUBLISH",{channel_name:a,payload:JSON.stringify(c)}):this._publishes.push([a,c])};this.message=function(a,c){this.connected?this.sendFrame("MESSAGE",{name:a,payload:JSON.stringify(c)}):this._messages.push([a,c])};this.connectionMade=function(){logger.debug("connectionMade");this.transport.setEncoding("utf8");\n""===this.cookieString?void 0===this._connectPayload?this.sendFrame("CONNECT",{cookie_string:"",payload:this._connectPayload}):this.sendFrame("CONNECT",{cookie_string:"",payload:JSON.stringify(this._connectPayload)}):this.sendFrame("CONNECT",{cookie_string:this.cookieString,payload:JSON.stringify(this._connectPayload)})};this.frameReceived=function(a,c,b){logger.debug("received frame",c,b);switch(c){case "MESSAGE":this.onMessaged(b);break;case "CONNECTED":this.connected=!0;for(this.username=b.name;this._buffered_subs.length;)this.sendFrame("SUBSCRIBE",\n{channel_name:this._buffered_subs.shift()});for(;this._publishes.length;)this.publish.apply(this,this._publishes.splice(0,1)[0]);for(;this._messages.length;)this.message.apply(this,this._messages.splice(0,1)[0]);this.onOpen(b);break;case "SUBSCRIBE":b.user==this.username?(c=new Subscription(this,b),this._subscriptions[b.channel_name]=c,c._onCancel=bind(this,function(){this.sendFrame("UNSUBSCRIBE",{channel_name:b.channel_name})}),this.onSubscribed(b.channel_name,c,b),K=c):this._subscriptions[b.channel_name].frame(c,\nb);break;case "STATE_UPDATE":case "PUBLISH":a=this._subscriptions[b.channel_name];a.frame(c,b);break;case "UNSUBSCRIBE":a=this._subscriptions[b.channel_name];a.canceled=!0;a.frame(c,b);b.user==this.username&&(delete this._subscriptions[b.channel_name],this.onUnsubscribed(a,b));break;case "ERROR":this.onError(b);break;case "SET_COOKIE":document.cookie=b.cookie}};this._connectionLost=function(a,c,b){if(b)if(logger.debug("connectionLost"),this.connected=!1,"string"==typeof c.type&&("ServerUnreachable"==\nc.type||"ConnectionTimeout"==c.type))this.onConnectionLost(c.type);else this.onClose();else logger.debug("connectionFailed",a),"websocket"==a&&(logger.debug("retry with csp"),this.connectionLost=bind(this,"_connectionLost","csp"),jsioConnect(this,"csp",{url:this.url+"csp"}))};this.disconnect=function(){this.transport.loseConnection()}});\n',
filePath:"hookbox.js"},"std.uri":{src:'var attrs="source,protocol,authority,userInfo,user,password,host,port,relative,path,directory,file,query,anchor".split(",");\nexports.Uri=Class(function(){this.init=function(b,a){var e=exports.parse(b,a);for(c in e)this["_"+c]=e[c]};for(var a=0,c;c=attrs[a];++a)(function(b){var a=b.charAt(0).toUpperCase()+b.slice(1);this["get"+a]=function(){return this["_"+b]};this["set"+a]=function(a){this["_"+b]=a}}).call(this,c);this.toString=this.render=function(){return(this._protocol?this._protocol+"://":"")+(this._host?this._host+(80==(this._port||80)?"":":"+this._port):"")+this._path+(this._query?"?"+this._query:"")+(this._anchor?\n"#"+this._anchor:"")}});exports.buildQuery=function(a){var c=[];for(key in a)c.push(encodeURIComponent(key)+"="+encodeURIComponent(a[key]));return c.join("&")};exports.parseQuery=function(a){for(var a=a.split("&"),c=a.length,b={},d=0;d<c;++d){var e=a[d].split("="),f=decodeURIComponent(e[0]);f&&(b[f]=decodeURIComponent(e[1]))}return b};\nvar strictRegex=/^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,looseRegex=/^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/,queryStringRegex=/(?:^|&)([^&=]*)=?([^&]*)/g;\nexports.parse=function(a,c){for(var b={},d=(c?strictRegex:looseRegex).exec(a),e=0,f;f=attrs[e];++e)b[f]=d[e]||"";var g=b.queryKey={};b.query.replace(queryStringRegex,function(a,b,c){a&&(g[b]=c)});return b};exports.isSameDomain=function(a,c){var b=exports.parse(a),d=exports.parse(c);return b.port==d.port&&b.host==d.host&&b.protocol==d.protocol};\n',
filePath:"jsio/std/uri.js"},"net.csp.transports":{src:'jsio("import std.uri as uri");jsio("import std.base64 as base64");jsio("from util.browserdetect import BrowserDetect");\n(function(){var a;exports.getDoc=function(){if(a)return a;try{if(a=window.ActiveXObject&&new ActiveXObject("htmlfile"))a.open().write("<html></html>"),a.close(),window.attachEvent("onunload",function(){try{a.body.innerHTML=""}catch(b){}a=null})}catch(b){}a||(a=document);return a};exports.XHR=function(){var a=window;exports.getDoc();return new (exports.XHR=a.XMLHttpRequest?a.XMLHttpRequest:function(){return a.ActiveXObject&&new a.ActiveXObject("Msxml2.XMLHTTP")||null})};exports.createXHR=function(){return new exports.XHR}})();\nfunction isLocalFile(a){return/^file:\\/\\//.test(a)}function isWindowDomain(a){return uri.isSameDomain(a,window.location.href)}function canUseXHR(a){if(isLocalFile(a))return!1;var b=new exports.XHR;if(!b)return!1;if(isWindowDomain(a)||window.XMLHttpRequest&&(b.__proto__==XMLHttpRequest.prototype||b instanceof window.XMLHttpRequest)&&void 0!==b.withCredentials||window.XDomainRequest&&b instanceof window.XDomainRequest)return!0}var transports=exports.transports={};\nexports.chooseTransport=function(a,b){switch(b.preferredTransport){case "jsonp":return transports.jsonp;default:return canUseXHR(a)?transports.xhr:transports.jsonp}};var PARAMS={xhrstream:{is:"1",bs:"\\n"},xhrpoll:{du:"0"},xhrlongpoll:{},sselongpoll:{bp:"data: ",bs:"\\r\\n",se:"1"},ssestream:{bp:"data: ",bs:"\\r\\n",se:"1",is:"1"}};\nexports.Transport=Class(function(){this.handshake=function(){throw Error("handshake Not Implemented");};this.comet=function(){throw Error("comet Not Implemented");};this.send=function(){throw Error("send Not Implemented");};this.encodePacket=function(){throw Error("encodePacket Not Implemented");};this.abort=function(){throw Error("abort Not Implemented");}});\nvar baseTransport=Class(exports.Transport,function(){this.init=function(){this._aborted=!1;this._handshakeArgs={d:"{}",ct:"application/javascript"}};this.handshake=function(a,b){logger.debug("handshake:",a,b);this._makeRequest("send",a+"/handshake",this._handshakeArgs,this.handshakeSuccess,this.handshakeFailure)};this.comet=function(a,b,i,e){logger.debug("comet:",a,b,i,e);args={s:b,a:i};this._makeRequest("comet",a+"/comet",args,this.cometSuccess,this.cometFailure)};this.send=function(a,b,i,e,d){logger.debug("send:",\na,b,e,d);args={d:e,s:b,a:i};this._makeRequest("send",a+"/send",args,this.sendSuccess,this.sendFailure)}});\ntransports.xhr=Class(baseTransport,function(a){this.init=function(){a(this,"init");this._xhr={send:new exports.XHR,comet:new exports.XHR}};this.abort=function(){this._aborted=!0;for(var a in this._xhr)this._xhr.hasOwnProperty(a)&&this._abortXHR(a)};this._abortXHR=function(a){logger.debug("aborting XHR");var e=this._xhr[a];try{"onload"in e?e.onload=e.onerror=e.ontimeout=null:"onreadystatechange"in e&&(e.onreadystatechange=null),e.abort&&e.abort()}catch(b){logger.debug("error aborting xhr",b)}this._xhr[a]=\nnew exports.XHR};var b=!exports.createXHR().sendAsBinary;this.encodePacket=function(a,e){return b?[a,1,base64.encode(e)]:[a,0,e]};this._onReadyStateChange=function(a,b,d){var h=this._xhr[a];try{var g={status:h.status}}catch(f){d({response:"Could not access status"})}try{if(4!=h.readyState)return;g.response=eval(h.responseText);if(200!=g.status){logger.debug("XHR failed with status ",h.status);d(g);return}logger.debug("XHR data received")}catch(j){logger.debug("Error in XHR::onReadyStateChange",j);\nd(g);this._abortXHR(a);logger.debug("done handling XHR error");return}b(g)};this._makeRequest=function(a,b,d,h,g){if(!this._aborted){var f=this._xhr[a],j=d.d||null;"d"in d&&delete d.d;f.open("POST",b+"?"+uri.buildQuery(d));f.setRequestHeader("Content-Type","text/plain");"onload"in f?(f.onload=bind(this,"_onReadyStateChange",a,h,g),f.onerror=f.ontimeout=g):"onreadystatechange"in f&&(f.onreadystatechange=bind(this,"_onReadyStateChange",a,h,g));setTimeout(bind(f,f.sendAsBinary?"sendAsBinary":"send",\nj),0)}}});var EMPTY_FUNCTION=function(){},SLICE=Array.prototype.slice;\ntransports.jsonp=Class(baseTransport,function(a){function b(a,c){logger.debug("successful: ",a.url,c);a.completed=!0;logger.debug("calling the cb");a.cb.call(GLOBAL,{status:200,response:c});logger.debug("cb called")}function i(a,c){c&&"loaded"!=c.readyState||(c.onreadystatechange=function(){},e.call(this,a))}function e(a,c){h(this._ifr[a.type]);if(!a.completed){var b={status:c?200:404,response:c||"Unable to load resouce"};logger.debug("error making request:",a.url,b);logger.debug("calling eb");a.eb.call(GLOBAL,\nb)}}var d=function(){var a=exports.getDoc();if(!a.body)return!1;var c=a.createElement("iframe");with(c.style)display="block",width=height=border=margin=padding="0",overflow=visibility="hidden",position="absolute",top=left="-999px";c.cbId=0;a.body.appendChild(c);c.src=\'javascript:var d=document;d.open();d.write("<html><body></body></html>");d.close();\';return c},h=function(a){var c=a.contentWindow,b=c.document;logger.debug("removing script tags");for(var e=b.getElementsByTagName("script"),f=e.length-\n1;0<=f;--f)b.body.removeChild(e[f]);logger.debug("deleting iframe callbacks");c["cb"+a.cbId]=c["eb"+a.cbId]=EMPTY_FUNCTION},g=function(a){$setTimeout(function(){a&&a.parentNode&&a.parentNode.removeChild(a)},6E4)};this.init=function(){a(this,"init");this._onReady=[];this._isReady=!1;this._createIframes()};this._createIframes=function(){this._ifr={send:d(),comet:d()};if(!1===this._ifr.send)return $setTimeout(bind(this,"_createIframes"),100);this._isReady=!0;var a=this._onReady;this._onReady=[];for(var c=\n0,b;b=a[c];++c)this._makeRequest.apply(this,b)};this.encodePacket=function(a,c){return[a,1,base64.encode(c)]};this.abort=function(){this._aborted=!0;for(var a in this._ifr)if(this._ifr.hasOwnProperty(a)){var c=this._ifr[a];h(c);g(c)}};this._makeRequest=function(a,c,b,e,f){if(!this._isReady)return this._onReady.push(arguments);var d=++this._ifr[a].cbId,d={type:a,id:d,cb:e,eb:f,cbName:"cb"+d,ebName:"eb"+d,completed:!1};b.n=Math.random();switch(a){case "send":b.rs=";";b.rp=d.cbName;break;case "comet":b.bs=\n";",b.bp=d.cbName}d.url=c+"?"+uri.buildQuery(b);$setTimeout(bind(this,"_request",d),0)};this._request=function(a){var c=this._ifr[a.type].contentWindow,d=c.document,g=d.body;c[a.ebName]=bind(this,e,a);c[a.cbName]=bind(this,b,a);BrowserDetect.isWebKit?(d.open(),d.write(\'<script src="\'+a.url+\'"><\\/script><script>\'+ebName+"(false)<\\/script>"),d.close()):(c=d.createElement("script"),c.src=a.url,null===c.onreadystatechange&&(c.onreadystatechange=bind(this,i,a,c)),g.appendChild(c),BrowserDetect.isIE||(c=\nd.createElement("script"),c.innerHTML=a.ebName+"(false)",g.appendChild(c)));f()};var f=BrowserDetect.isFirefox?function(){var a=document.body;a&&(f.iframe||(f.iframe=document.createElement("iframe")),a.insertBefore(f.iframe,a.firstChild),a.removeChild(f.iframe))}:function(){}});\n',
filePath:"jsio/net/csp/transports.js"},net:{src:'jsio("import net.env");jsio("import std.JSON as JSON");JSON.createGlobal();exports.listen=function(a,b,c){if(!b)throw logger.error("No transport provided for net.listen");a=new (net.env.getListener(b))(a,c);a.listen();return a};exports.connect=function(a,b,c){a=new (net.env.getConnector(b))(a,c);a.connect();return a};exports.quickServer=function(a){jsio("import net.interfaces");return new net.interfaces.Server(a)};\n',filePath:"jsio/net.js"},"util.browserdetect":{src:'exports.BrowserDetect=new function(){function b(f){for(var c=0,a;a=f[c];c++){var b=a.string,d=a.prop;a.identity=a.identity||a.subString;e=a.versionSearch||a.identity;if(b){if(-1!=b.indexOf(a.subString))return a.identity}else if(d)return a.identity}}function d(b){var c=b.indexOf(e);return-1==c?void 0:parseFloat(b.substring(c+e.length+1))}var e,g=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac"},{string:navigator.userAgent,subString:"iPhone",\nidentity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux"}];this.browser=b([{string:navigator.userAgent,subString:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox"},{string:navigator.vendor,\nsubString:"Camino"},{string:navigator.userAgent,subString:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"IE",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}])||"unknown";this.version=d(navigator.userAgent)||d(navigator.appVersion)||"unknown";this.OS=b(g)||"unknown";this.isWebKit=/ AppleWebKit\\//.test(navigator.userAgent);this["is"+\nthis.browser]=this.version};\n',
filePath:"jsio/util/browserdetect.js"},"std.utf8":{src:'exports.UnicodeCodecError=function(a){this.message=a};var UnicodeCodecError=exports.UnicodeCodecError;UnicodeCodecError.prototype.toString=function(){return"UnicodeCodecError"+(this.message?": "+this.message:"")};exports.encode=function(a){try{return unescape(encodeURIComponent(a))}catch(b){throw new UnicodeCodecError("invalid input string");}};\nexports.decode=function(a){if(/[^\\x00-\\xFF]/.test(a))throw new UnicodeCodecError("invalid utf-8 bytes");var b,c;b=c=a.length;if(128<=a.charCodeAt(b-1)){for(var d=1;3>=d;d++)if(192<=a.charCodeAt(b-d)){c=b-d;break}try{decodeURIComponent(escape(a.slice(c))),c=b}catch(e){}}try{return[decodeURIComponent(escape(a.slice(0,c))),c]}catch(f){throw new UnicodeCodecError("invalid utf-8 bytes");}};\n',
filePath:"jsio/std/utf8.js"}};jsio=r(this,w,null,"");jsio.__filename="jsio.js";jsio.modules=[];jsio.setCachedSrc=function(b,c,a){C[b]={filePath:c,src:a}};jsio.getCachedSrc=function(b){return C[b]};jsio.path={};jsio.setPath=function(b){jsio.path.__default__="string"==typeof b?[b]:b};jsio.setEnv=function(b){if(!e||!(b==e||b==e.name)){if("string"==typeof b){switch(b){case "node":e=new A;break;default:e=new B}e.name=b}else e=b;jsio.__env=e;jsio.__dir=e.getCwd();jsio.path.__default__||jsio.setPath(e.getPath())}};
"undefined"!==typeof process&&process.version?jsio.setEnv("node"):("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof ActiveXObject)&&jsio.setEnv("browser")})();jsio("import hookbox as hookbox");
