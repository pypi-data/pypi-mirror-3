(function(a){a.ZBlog.form={check:function(c){a.ZBlog.ajax.check(a.fn.ajaxSubmit,"/--static--/ztfy.jqueryui/js/jquery-form.min.js",c)},hideStatus:function(){a("FORM DIV.status").animate({opacity:0,height:0,"margin-top":0,"margin-bottom":0,"padding-top":0,"padding-bottom":0},2000,function(){a(this).remove()})},reset:function(c){c.reset();a("input:first",c).focus()},add:function(d,c,e){a.ZBlog.form.check(function(){a.ZBlog.form._add(d,c,e)});return false},_add:function(d,c,f){if(typeof(tinyMCE)!="undefined"){tinyMCE.triggerSave()}var e={};if(c){e.parent=c}a(a.ZBlog.form).data("add_action",a(d).attr("action"));a.ZBlog.ajax.submit(d,a(d).attr("action")+"/@@ajax/ajaxCreate",e,f||a.ZBlog.form._addCallback,null,"json")},_addCallback:function(c,d){if(d=="success"){output=c.output;if(output=="ERRORS"){var g=a.ZBlog.dialog.getCurrent();a("DIV.status",g).remove();a("DIV.error",g).remove();var d=a("<div></div>").addClass("status");a("<div></div>").addClass("summary").text(c.errors.status).appendTo(d);var k=a("<ul></ul>").appendTo(d);for(var f=0;f<c.errors.errors.length;f++){var e=c.errors.errors[f];if(e.widget){a("<li></li>").text(e.widget+" : "+e.message).appendTo(k);var h=a("[id="+e.id+"]",g).parents("DIV.widget");var j=a(h).parents("DIV.row");h=h.clone(true);a("DIV.widget",j).remove();a("DIV.error",j).remove();a("<div></div>").addClass("error").append(a("<div></div>").addClass("error").text(e.message)).appendTo(j);h.appendTo(j)}else{a("<li></li>").text(e.message).appendTo(k)}}a("FORM",g).before(d)}else{if(output=="RELOAD"){window.location.reload()}else{if(output&&output.startsWith("<!-- OK -->")){a.ZBlog.dialog.close();a("DIV.form").replaceWith(output)}else{var g=a.ZBlog.dialog.getCurrent();a("DIV.dialog",g).replaceWith(output);a("FORM",g).attr("action",a(a.ZBlog.form).data("add_action"));a("#form-buttons-add",g).bind("click",function(i){a.ZBlog.form.add(this.form,c.parent)});a("#form-buttons-cancel",g).bind("click",function(i){a.ZBlog.dialog.close()});a("#tabforms UL.tabs",g).tabs(a(g).selector+" DIV.panes > DIV")}}}}},edit:function(c,d,e){a.ZBlog.form.check(function(){a.ZBlog.form._edit(c,d,e)});return false},_edit:function(c,d,e){if(typeof(tinyMCE)!="undefined"){tinyMCE.triggerSave()}a(a.ZBlog.form).data("edit_action",a(c).attr("action"));a.ZBlog.ajax.submit(c,a(c).attr("action")+"/@@ajax/ajaxEdit",{},e||a.ZBlog.form._editCallback,null,"json")},_editCallback:function(m,e){if(e=="success"){var d=m.output;if(d=="RELOAD"){window.location.reload()}else{if(d=="REDIRECT"){a.ZBlog.dialog.close();window.location.href=m.target}else{if(d=="OK"){a.ZBlog.dialog.close();a("DIV.status").remove();a("DIV.required-info").after('<div class="status"><div class="summary">'+a.ZBlog.I18n.DATA_UPDATED+"</div></div>")}else{if(d=="NONE"){a.ZBlog.dialog.close();a("DIV.status").remove();a("DIV.required-info").after('<div class="status"><div class="summary">'+a.ZBlog.I18n.NO_UPDATE+"</div></div>")}else{if(d=="ERRORS"){var h=a.ZBlog.dialog.getCurrent();a("DIV.status",h).remove();a("DIV.error",h).remove();var e=a("<div></div>").addClass("status");a("<div></div>").addClass("summary").text(m.errors.status).appendTo(e);var k=a("<ul></ul>").appendTo(e);for(var f=0;f<m.errors.errors.length;f++){var j=m.errors.errors[f];if(j.widget){a("<li></li>").text(j.widget+" : "+j.message).appendTo(k);var g=a("[id="+j.id+"]",h).parents("DIV.widget");var l=a(g).parents("DIV.row");g=g.clone(true);a("DIV.widget",l).remove();a("DIV.error",l).remove();a("<div></div>").addClass("error").append(a("<div></div>").addClass("error").text(j.message)).appendTo(l);g.appendTo(l)}else{a("<li></li>").text(j.message).appendTo(k)}}a("FORM",h).before(e)}else{if(d&&d.startsWith("<!-- OK -->")){a.ZBlog.dialog.close();a("DIV.form").replaceWith(d)}else{var h=a.ZBlog.dialog.getCurrent();a("DIV.dialog",h).replaceWith(d);var c=a("FORM",h);c.attr("action",a(a.ZBlog.form).data("edit_action"));a("#"+c.attr("id")+"-buttons-dialog_submit",h).bind("click",function(i){a.ZBlog.form.edit(this.form)});a("#"+c.attr("id")+"form-buttons-dialog_cancel",h).bind("click",function(i){a.ZBlog.dialog.close()});a("#tabforms UL.tabs",h).tabs(a(h).selector+" DIV.panes > DIV")}}}}}}setTimeout("$.ZBlog.form.hideStatus();",2000)}},remove:function(c,d,e){jConfirm(a.ZBlog.I18n.CONFIRM_REMOVE,a.ZBlog.I18n.CONFIRM,function(g){if(g){var f={id:c};a.ZBlog.form.ajax_source=d;a.ZBlog.ajax.post(window.location.href+"/@@ajax/ajaxRemove",f,e||a.ZBlog.form._removeCallback,null,"text")}})},_removeCallback:function(c,d){if((d=="success")&&(c=="OK")){a(a.ZBlog.form.ajax_source).parents("TR").remove()}},update:function(c,d){a.ZBlog.form.check(function(){a.ZBlog.form._update(c,d)});return false},_update:function(c,e){if(typeof(tinyMCE)!="undefined"){tinyMCE.triggerSave()}var d=a(c).formToArray(true);a.ZBlog.ajax.post(a(c).attr("action")+"/@@ajax/ajaxUpdate",d,e||a.ZBlog.form._updateCallback,null,"text")},_updateCallback:function(c,d){if((d=="success")&&(c=="OK")){a("DIV.status").remove();a("LEGEND").after('<div class="status"><div class="summary">Data successfully updated.</div></div>')}}};a.ZBlog.container={remove:function(d,e){var c={_source:e,url:a.ZBlog.json.getAddr(),type:"POST",method:"remove",params:{id:d},success:function(g,f){a(this._source).parents("TR").remove()},error:function(h,f,g){jAlert(h.responseText,a.ZBlog.I18n.ERROR_OCCURED,window.location.reload)}};jConfirm(a.ZBlog.I18n.CONFIRM_REMOVE,a.ZBlog.I18n.CONFIRM,function(f){if(f){a.jsonRpc(c)}})}};a.ZBlog.sortable={options:{handle:"IMG.handler",axis:"y",containment:"parent",placeholder:"sorting-holder",stop:function(d,f){var c=new Array();a("TABLE.orderable TD.id").each(function(g){c[c.length]=a(this).text()});var e={ids:c};a.ZBlog.ajax.post(window.location.href+"/@@ajax/ajaxUpdateOrder",e,null,function(i,g,h){jAlert(i.responseText,a.ZBlog.I18n.ERROR_OCCURED,window.location.reload)})}}};a.ZBlog.treeview={changeParent:function(d,f){var h=a(f.draggable.parents("TR"));if(h.appendBranchTo(this)){var e=h.attr("id").substr("node-".length);var g=a(this).attr("id").substr("node-".length);var c={url:a.ZBlog.json.getAddr(),type:"POST",method:"changeParent",params:{source:parseInt(e),target:parseInt(g)},error:function(k,i,j){jAlert(k.responseText,a.ZBlog.I18n.ERROR_OCCURED,window.location.reload)}};a.jsonRpc(c)}}};a.ZBlog.reference={activate:function(c){a("INPUT[name="+c+"]").attr("readonly","").val("").focus();a("INPUT[name="+c+"]").prev().val("")},keyPressed:function(c){if(c.which==13){a.ZBlog.reference.search(this);return false}},search:function(d){a.ZBlog.reference.source=d;var c=a(d).parents("FORM");a.ZBlog.ajax.post(c.attr("action")+"/@@ajax/ajaxSearch",{title:a(d).val()},a.ZBlog.reference._searchCallback,null,"json")},_searchCallback:function(d,e){if(e=="success"){if(d.length==1){a.ZBlog.reference.select(d[0].oid,d[0].title)}else{if(d.length>1){var h=a("#selector");if(h.length==0){h=a('<div id="selector"></div>')}h.empty();for(var f=0;f<d.length;f++){var g=d[f].oid;var j=d[f].title;a("<div onclick=\"return $.ZBlog.reference.select('"+g+"','"+j+"');\"></div>").addClass("reference").text(j).appendTo(h)}var k=a(a.ZBlog.reference.source);var c=k.position();h.css("width",k.width()-10).appendTo(k.parents("DIV.overlay")).overlay({expose:"transparent",api:true,oneInstance:false,closeOnClick:false,closeOnEsc:false,top:c.top+k.height(),left:c.left+30,absolute:true,onBeforeLoad:function(){if(a.browser.msie&&(a.browser.version<7)){a("select").css("visibility","hidden")}},onClose:function(){if(a.browser.msie&&(a.browser.version<7)){a("select").css("visibility","visible")}}}).load()}}}},select:function(c,e){var d=a.ZBlog.reference.source;a(d).prev().val(c);a(d).val(e+" (OID: "+c+")").attr("readonly","readonly");a("#selector").overlay().close();a("#selector").remove();return false}};a.ZBlog.topic={remove:function(c){a.ZBlog.ajax.post(a(c).attr("action")+"/@@ajax/ajaxDelete",{},a.ZBlog.topic.removeCallback,null,"json");return false},removeCallback:function(c,d){if(d=="success"){window.location=c.url}}};var b=a("HTML").attr("lang")||a("HTML").attr("xml:lang");a.getScript("/--static--/ztfy.blog/js/i18n/"+b+".js");if(a.browser.safari){a.support.opacity=true}if(a.fn.fancybox){a(document).ready(function(){a("DIV.download-link IMG").parents("A").fancybox({type:"image",titleShow:false,hideOnContentClick:true})})}})(jQuery);