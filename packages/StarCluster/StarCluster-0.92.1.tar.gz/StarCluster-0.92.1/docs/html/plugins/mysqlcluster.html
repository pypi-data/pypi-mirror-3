
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MySQL Cluster Plugin &mdash; StarCluster v0.92.1 documentation</title>
    <link rel="stylesheet" href="../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.92.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="StarCluster v0.92.1 documentation" href="../index.html" />
    <link rel="up" title="Plugin Documentation" href="index.html" />
    <link rel="next" title="Frequently Asked Questions" href="../faq.html" />
    <link rel="prev" title="IPython Cluster Plugin" href="ipython.html" />
<link rel="stylesheet" href="../_static/nobile.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../_static/neuton.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../_static/starcluster.ico"/>

  </head>
  <body>
<div class="header-small">
	
	<div class="logo-small">
		<a href="../index.html">
      		<img class="logo" src="../_static/logo-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../faq.html" title="Frequently Asked Questions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ipython.html" title="IPython Cluster Plugin"
             accesskey="P">previous</a> |</li>
    	<li><a href="../index.html">Home</a> &raquo;</li>
          <li><a href="../contents.html" >Master Table of Contents</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Plugin Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="mysql-cluster-plugin">
<h1>MySQL Cluster Plugin<a class="headerlink" href="#mysql-cluster-plugin" title="Permalink to this headline">¶</a></h1>
<p>This plugin automates the configuration and startup of MySQL Cluster on Ubuntu
10.04 Lucid Lynx. The mysql-cluster-server package suffers from an
<a class="reference external" href="https://bugs.launchpad.net/ubuntu/+source/mysql-cluster-7.0/+bug/579732">installation bug</a> as of 7/21/10. This plugin works its way around that bug
and results in an operational MySQL Cluster on initialization of the cluster.</p>
<div class="section" id="configuration-options">
<h2>Configuration Options<a class="headerlink" href="#configuration-options" title="Permalink to this headline">¶</a></h2>
<p>Here is an example of the mysqlcluster plugin section of the StarCluster config
file:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[plugin mysqlcluster]</span>
<span class="na">SETUP_CLASS</span> <span class="o">=</span> <span class="s">mysqlcluster.MysqlCluster</span>
<span class="na">NUM_REPLICAS</span> <span class="o">=</span> <span class="s">2</span>
<span class="na">DATA_MEMORY</span> <span class="o">=</span> <span class="s">80M</span>
<span class="na">INDEX_MEMORY</span> <span class="o">=</span> <span class="s">18M</span>
<span class="na">DATA_DIR</span> <span class="o">=</span> <span class="s">/var/lib/mysqlcluster</span>
<span class="na">BACKUP_DATA_DIR</span> <span class="o">=</span> <span class="s">/var/lib/mysqlcluster/</span>
<span class="na">DEDICATED_QUERY</span> <span class="o">=</span> <span class="s">True</span>
<span class="na">NUM_DATA_NODES</span> <span class="o">=</span> <span class="s">2</span>
</pre></div>
</div>
<p><strong>NUM_REPLICAS</strong>: Specifies number of replicas for each table in the cluster,
as well as the number of node groups. The maximum value is 4, and only values 1
and 2 are currently supported by MySQL. A value of 1 would indicate that that
there is only one copy of your data. The loss of a single data note would
therefore cause your cluster to fail, as there are no additional copies of that
data. The number of replicas must also divide evenly into the number of data
nodes. &#8216;2&#8217; is both the recommended and default setting for this parameter.</p>
<p><strong>DATA_MEMORY</strong>: Amount of space (in bytes) available for storing database
records.  Suffixes K, M, and G can be used to indicated Kilobytes, Megabytes,
or Gigabytes. Default value is 80M, minimum is 1M.</p>
<p><strong>INDEX_MEMORY</strong>: Amount of storage used for hash indexes in the MySQL Cluster.
Default value is 18M, minimum is 1M.</p>
<p><strong>DATA_DIR</strong>: Specifies the directory where metadata, REDO logs, UNDO logs (for
Disk Data tables), data files, trace files, log files, pid files and error logs
are placed.</p>
<p><strong>BACKUP_DATA_DIR</strong>: Specifies the directory in which to put the BACKUP
directory. Defaults to DATA_DIR.</p>
<p><strong>DEDICATED_QUERY</strong>: True indicates that the data nodes do not also function as
query nodes, and there are instead dedicated nodes to accept queries. False
indicates that all data nodes will also accept queries.</p>
<p><strong>NUM_DATA_NODES</strong>: Number of data nodes if DEDICATED_QUERY is set to True. The
remaining nodes in the cluster will be MySQL query nodes.</p>
</div>
<div class="section" id="what-this-plugin-does">
<h2>What This Plugin Does<a class="headerlink" href="#what-this-plugin-does" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Creates data and backup directories, changes ownership to mysql user</li>
<li>Generates /etc/mysql/ndb_mgmd.cnf configuration file on master.</li>
<li>Generates /etc/mysql/my.cnf configuration file on all nodes.</li>
<li>Kills mysql processes on all nodes.</li>
<li>Starts Management Client on master.</li>
<li>Starts mysql on query nodes</li>
<li>Starts mysql-ndb on data nodes.</li>
</ol>
</div>
<div class="section" id="creating-a-replicated-table">
<h2>Creating a Replicated Table<a class="headerlink" href="#creating-a-replicated-table" title="Permalink to this headline">¶</a></h2>
<p>Here is an example of how to create a table that is replicated across
the cluster. Do this on one of the data nodes:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">database</span> <span class="n">testdb</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="nf">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">use</span> <span class="n">testcluster</span><span class="p">;</span>
<span class="k">Database</span> <span class="n">changed</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">table</span> <span class="nf">testtable</span> <span class="p">(</span><span class="n">i</span> <span class="kt">int</span><span class="p">)</span> <span class="kp">engine</span><span class="o">=</span><span class="n">ndbcluster</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="n">rows</span> <span class="nf">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">71</span> <span class="n">sec</span><span class="p">)</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">testtable</span> <span class="k">values</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="nf">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">05</span> <span class="n">sec</span><span class="p">)</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">testtable</span><span class="p">;</span>
<span class="o">+------+</span>
<span class="o">|</span> <span class="n">i</span>    <span class="o">|</span>
<span class="o">+------+</span>
<span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>
<span class="o">+------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">03</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that &#8216;engine=ndbcluster&#8217; is what indicates that the table should be
created in a cluster configuration. If it is not used, the table will not be
replicated.</p>
<p>On another data node:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">use</span> <span class="n">testdb</span><span class="p">;</span>
<span class="k">Database</span> <span class="n">changed</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">testtable</span><span class="p">;</span>
<span class="o">+------+</span>
<span class="o">|</span> <span class="n">i</span>    <span class="o">|</span>
<span class="o">+------+</span>
<span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>
<span class="o">+------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">04</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>The table has been replicated, and the cluster is working.</p>
</div>
<div class="section" id="recommendations-for-use">
<h2>Recommendations for Use<a class="headerlink" href="#recommendations-for-use" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Clusters should have three nodes at the very least.</li>
<li>NUM_REPLICAS should probably stay at 2. Consequently, there should be an even
number of data nodes.</li>
<li>Set DATA_DIR and BACKUP_DATA_DIR to an EBS volume if you want the data to
persist.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">MySQL Cluster Plugin</a><ul>
<li><a class="reference internal" href="#configuration-options">Configuration Options</a></li>
<li><a class="reference internal" href="#what-this-plugin-does">What This Plugin Does</a></li>
<li><a class="reference internal" href="#creating-a-replicated-table">Creating a Replicated Table</a></li>
<li><a class="reference internal" href="#recommendations-for-use">Recommendations for Use</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ipython.html"
                        title="previous chapter">IPython Cluster Plugin</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../faq.html"
                        title="next chapter">Frequently Asked Questions</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../faq.html" title="Frequently Asked Questions"
             >next</a> |</li>
        <li class="right" >
          <a href="ipython.html" title="IPython Cluster Plugin"
             >previous</a> |</li>
    	<li><a href="../index.html">Home</a> &raquo;</li>
          <li><a href="../contents.html" >Master Table of Contents</a> &raquo;</li>
          <li><a href="index.html" >Plugin Documentation</a> &raquo;</li> 
      </ul>
    </div>


    <div class="footer">
        &copy; Copyright 2011, Software Tools for Academics and Researchers.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>


<script type="text/javascript">
//<![CDATA[
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    //]]>
    </script><script type="text/javascript">
//<![CDATA[
    try{
        var pageTracker = _gat._getTracker("UA-1048253-12");
        pageTracker._trackPageview();
    } catch(err) {}
    //]]>
    </script>

  </body>
</html>