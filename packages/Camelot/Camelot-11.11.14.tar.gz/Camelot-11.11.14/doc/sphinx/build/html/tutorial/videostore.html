

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Creating a Movie Database Application &mdash; Camelot  documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="Camelot  documentation" href="../index.html" />
    <link rel="up" title="Tutorials" href="index.html" />
    <link rel="next" title="Creating a Report with Camelot" href="reporting.html" />
    <link rel="prev" title="Tutorials" href="index.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2652891-3']);
  _gaq.push(['_trackPageview']);
</script>

  </head>
  <body>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="reporting.html" title="Creating a Report with Camelot"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Tutorials"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Camelot  documentation</a> &raquo;</li>
          <li><a href="../contents.html" >Camelot Documentation contents</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Tutorials</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="creating-a-movie-database-application">
<span id="tutorial-videostore"></span><h1>Creating a Movie Database Application<a class="headerlink" href="#creating-a-movie-database-application" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial we will create a fully functional movie database application
with Camelot. We assume Camelot is properly <a class="reference internal" href="../doc/install.html#doc-install"><em>installed</em></a>.
An all in one installer for Windows is available as an SDK to develop Camelot
applications <a class="reference external" href="http://www.conceptive.be/python-sdk.html">(Python SDK)</a>.</p>
<div class="section" id="starting-a-new-project">
<h2>Starting a New Project<a class="headerlink" href="#starting-a-new-project" title="Permalink to this headline">¶</a></h2>
<p>We begin with the creation of a new project. Open your favourite command prompt
(or shell) and go to the directory in which the new project should be created.
Typing the following command:</p>
<div class="highlight-python"><pre>python -m camelot.bin.camelot_admin</pre>
</div>
<p>A dialog appears where the basic information of the application can be
filled in.</p>
<img alt="../_images/change_object.png" src="../_images/change_object.png" />
<p>Press <cite>OK</cite> to generate the source code of the project.</p>
<p>The folder <tt class="file docutils literal"><span class="pre">videostore</span></tt> should appear in your the directory you are
working in. We will be working the Python modules created and put inside this
directory.</p>
</div>
<div class="section" id="main-window-and-views">
<h2>Main Window and Views<a class="headerlink" href="#main-window-and-views" title="Permalink to this headline">¶</a></h2>
<p><em class="xref std std-option">camelot_admin</em> created some modules for us. Let&#8217;s focus on the
one called <tt class="file docutils literal"><span class="pre">main.py</span></tt> which contains the entry point of your Camelot
application. If you launch it:</p>
<div class="highlight-python"><pre>set PYTHONPATH=.
python main.py</pre>
</div>
<p>your <a class="reference external" href="http://www.riverbankcomputing.co.uk/software/pyqt/intro">PyQt</a>
<abbr>Graphical User Interface &lt;GUI&gt;</abbr> should look like the one we show in the
picture below:</p>
<img alt="../_images/picture1.png" src="../_images/picture1.png" />
<p>The application has menus, a toolbar, a left navigation pane, and a central
area on which nothing is currently displayed.</p>
<p>The navigation pane has its first button selected. Select any other button by
clicking on it, and see the nagivation tree fill itself with new entries.
These are <cite>entities</cite>, and we will talk about them later.  (Generally speaking,
an <cite>entity</cite> represents a single table in a database.)</p>
<img alt="../_images/picture2.png" src="../_images/picture2.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Camelot uses <cite>sections</cite> to group <cite>models</cite>.  Each button in the navigation
pane represents a <cite>section</cite>, and each entry of the navigation tree is part
of this section.</p>
</div>
<p>Notice that the application disables most of the menus and the toolbar
buttons. When we click on an entity, more options become available.
So let&#8217;s click on the entity <tt class="docutils literal"><span class="pre">Persons</span></tt> of the section <tt class="docutils literal"><span class="pre">Relations</span></tt>.</p>
<p>A child window appears in the previously empty area and is maximized by
default: this is the table view of the entity.</p>
<img alt="../_images/picture3.png" src="../_images/picture3.png" />
<p>Each row is a record with some fields that we can edit (others might not be
editable). Let&#8217;s now add a new row by clicking on the new icon (next to the
trash bin icon; which removes a row).</p>
<img alt="../_images/picture4.png" src="../_images/picture4.png" />
<p>We now see a form view with additional fields. Forms are not maximized by
default. Forms label <strong>required</strong> fields in bold.</p>
<img alt="../_images/picture5.png" src="../_images/picture5.png" />
<p>Fill in a first and last name, and close the form. Camelot will automatically
validate and echo the changes to the database. We can reopen the form by
clicking on the blue icon in the first column of each row of the table. Notice
also that there is now an entry in our table.</p>
<img alt="../_images/picture6.png" src="../_images/picture6.png" />
<p>That&#8217;s it for basic usages of the interface. Next we will write code for our
database model.</p>
</div>
<div class="section" id="creating-the-movie-model">
<h2>Creating the Movie Model<a class="headerlink" href="#creating-the-movie-model" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s first take a look at the <tt class="file docutils literal"><span class="pre">settings.py</span></tt> in our project directory.
There is an attribute, <tt class="docutils literal"><span class="pre">ENGINE</span></tt>, an anonymous function, which returns a
<abbr>Uniform Resource Identifier URI</abbr>. That&#8217;s the database your Camelot
application will be connecting too. Camelot provides a default <tt class="docutils literal"><span class="pre">sqlite</span></tt> URI
scheme. But you can set your own.</p>
<p>If you set a database file that does not exist it will be created in the
directory from which the application is <em>launched</em>.</p>
<p>Now we can look at <tt class="file docutils literal"><span class="pre">model.py</span></tt>. Camelot has already imported some classes
for us. They are used to create our entities. Let&#8217;s say we want a movie entity
with a <tt class="docutils literal"><span class="pre">title</span></tt>, a short <tt class="docutils literal"><span class="pre">description</span></tt>, a <tt class="docutils literal"><span class="pre">release</span> <span class="pre">date</span></tt>, and a
<tt class="docutils literal"><span class="pre">genre</span></tt>.</p>
<p>The aforementioned specifications translate into the following Python code,
that we add to our model.py module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Unicode</span><span class="p">,</span> <span class="n">Date</span>
<span class="kn">from</span> <span class="nn">elixir</span> <span class="kn">import</span> <span class="n">Entity</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">using_options</span>
<span class="kn">from</span> <span class="nn">camelot.admin.entity_admin</span> <span class="kn">import</span> <span class="n">EntityAdmin</span>

<span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
  <span class="n">using_options</span><span class="p">(</span><span class="n">tablename</span><span class="o">=</span><span class="s">&#39;movie&#39;</span><span class="p">)</span>
  <span class="n">title</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">short_description</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">512</span><span class="p">))</span>
  <span class="n">release_date</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Date</span><span class="p">)</span>
  <span class="n">genre</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The complete source code of this tutorial can be found in the
example folder of the Camelot source code.</p>
</div>
<p><tt class="docutils literal"><span class="pre">Movie</span></tt> inherits <tt class="docutils literal"><span class="pre">Entity</span></tt> from the <a class="reference external" href="http://elixir.ematia.de/trac/wiki">Elixir</a>
library. We use <tt class="docutils literal"><span class="pre">using_options()</span></tt> to name the table ourselves. Elixir would
have used the location of our module to generate a name in the form
<em>package_model_entity</em>, as described <a class="reference external" href="http://elixir.ematia.de/apidocs/elixir.options.html">in Elixir documentation</a>.</p>
<p>Our entity holds four fields.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">title</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">title</span></tt> holds up to 60 unicode characters, and is required:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">short_description</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">512</span><span class="p">))</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">short_description</span></tt> can hold up to 512 characters:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">release_date</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Date</span><span class="p">)</span>
<span class="n">genre</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">release_date</span></tt> holds a date, and <tt class="docutils literal"><span class="pre">genre</span></tt> up to 15 unicode characters:</p>
<p>For more information about defining fields, refer to
<a class="reference external" href="http://elixir.ematia.de/apidocs/elixir.fields.html">this page</a>. The
different <a class="reference external" href="http://www.sqlalchemy.org">SQLAlchemy</a> types used by Elixir
are described <a class="reference external" href="http://www.sqlalchemy.org/docs/04/types.html">here</a>.
Finally, Camelot fields are documented in the API.</p>
<p>Let&#8217;s now create an <tt class="docutils literal"><span class="pre">EntityAdmin</span></tt> subclass</p>
</div>
<div class="section" id="the-entityadmin-subclass">
<h2>The EntityAdmin Subclass<a class="headerlink" href="#the-entityadmin-subclass" title="Permalink to this headline">¶</a></h2>
<p>We have to tell Camelot about our entities, so they show up in the <abbr>GUI</abbr>.
This is one of the purposes of <tt class="docutils literal"><span class="pre">EntityAdmin</span></tt> subclasses. After adding the
<tt class="docutils literal"><span class="pre">EntityAdmin</span></tt> subclass, our <tt class="docutils literal"><span class="pre">Movie</span></tt> class now looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
  <span class="n">using_options</span><span class="p">(</span><span class="n">tablename</span><span class="o">=</span><span class="s">&#39;movie&#39;</span><span class="p">)</span>

  <span class="n">title</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">short_description</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">512</span><span class="p">))</span>
  <span class="n">release_date</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Date</span><span class="p">)</span>
  <span class="n">genre</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>

  <span class="k">class</span> <span class="nc">Admin</span><span class="p">(</span><span class="n">EntityAdmin</span><span class="p">):</span>
    <span class="n">verbose_name</span> <span class="o">=</span> <span class="s">&#39;Movie&#39;</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;short_description&#39;</span><span class="p">,</span> <span class="s">&#39;release_date&#39;</span><span class="p">,</span> <span class="s">&#39;genre&#39;</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="s">&#39;untitled movie&#39;</span>
</pre></div>
</div>
<p>We made <tt class="docutils literal"><span class="pre">Admin</span></tt> an inner class to strengthen the link between it and the
<tt class="docutils literal"><span class="pre">Entity</span></tt> subclass. Camelot does not force us. <tt class="docutils literal"><span class="pre">Admin</span></tt> holds three
attributes.</p>
<p><tt class="docutils literal"><span class="pre">verbose_name</span></tt> will be the label used in navigation trees.</p>
<p>The last attribute is interesting; it holds a list containing the fields we
have defined above. As the name suggests, <tt class="docutils literal"><span class="pre">list_display</span></tt> tells Camelot to
only show the fields specified in the list. <tt class="docutils literal"><span class="pre">list_display</span></tt> does not affect
forms.</p>
<p>In our case we want to display four fields: <tt class="docutils literal"><span class="pre">title</span></tt>, <tt class="docutils literal"><span class="pre">short_description</span></tt>,
<tt class="docutils literal"><span class="pre">release_date</span></tt>, and <tt class="docutils literal"><span class="pre">genre</span></tt> (that is, all of them.)</p>
<p>We also add a <tt class="docutils literal"><span class="pre">__unicode__()</span></tt> method that will return either the title of the
movie entity or <tt class="docutils literal"><span class="pre">'untitled</span> <span class="pre">movie'</span></tt> if title is empty. This is a good
programming practice.</p>
<p>Let&#8217;s move onto the last piece of the puzzle.</p>
</div>
<div class="section" id="configuring-the-application">
<h2>Configuring the Application<a class="headerlink" href="#configuring-the-application" title="Permalink to this headline">¶</a></h2>
<p>We are now working with <tt class="file docutils literal"><span class="pre">application_admin.py</span></tt>.  One of
the tasks of <tt class="file docutils literal"><span class="pre">application_admin.py</span></tt> is to specify the sections in
the left pane of the main window.</p>
<p>Camelot defined a class, <tt class="docutils literal"><span class="pre">MyApplicationAdmin</span></tt>, for us. This class is a
subclass of <tt class="docutils literal"><span class="pre">ApplicationAdmin</span></tt>, which is used to control the overall look
and feel of every Camelot application.</p>
<p>To change sections in the left pane of the main window, simply overwrite the
<tt class="docutils literal"><span class="pre">get_sections</span></tt> method, to return a list of the desired sections.  By default
this method contains:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">get_sections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="kn">from</span> <span class="nn">camelot.model.memento</span> <span class="kn">import</span> <span class="n">Memento</span>
  <span class="kn">from</span> <span class="nn">camelot.model.authentication</span> <span class="kn">import</span> <span class="n">Person</span><span class="p">,</span> <span class="n">Organization</span>
  <span class="kn">from</span> <span class="nn">camelot.model.i18n</span> <span class="kn">import</span> <span class="n">Translation</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">Section</span><span class="p">(</span><span class="s">&#39;Relation&#39;</span><span class="p">,</span>
                  <span class="bp">self</span><span class="p">,</span>
                  <span class="n">Icon</span><span class="p">(</span><span class="s">&#39;tango/22x22/apps/system-users.png&#39;</span><span class="p">),</span>
                  <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Person</span><span class="p">,</span> <span class="n">Organization</span><span class="p">]),</span>
          <span class="n">Section</span><span class="p">(</span><span class="s">&#39;Configuration&#39;</span><span class="p">,</span>
                  <span class="bp">self</span><span class="p">,</span>
                  <span class="n">Icon</span><span class="p">(</span><span class="s">&#39;tango/22x22/categories/preferences-system.png&#39;</span><span class="p">),</span>
                  <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Memento</span><span class="p">,</span> <span class="n">Translation</span><span class="p">])</span>
          <span class="p">]</span>
</pre></div>
</div>
<p>which will display two buttons in the navigation pane, labelled <tt class="docutils literal"><span class="pre">'Relations'</span></tt>
and <tt class="docutils literal"><span class="pre">'Configurations'</span></tt>, with the specified icon next to each label. And yes,
the order matters.</p>
<p>We need to add a new section for our <tt class="docutils literal"><span class="pre">Movie</span></tt> entity, this is done by
extending the list of sections returned by the <tt class="docutils literal"><span class="pre">get_sections</span></tt> method with a
Movie section:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Section</span><span class="p">(</span><span class="s">&#39;Movies&#39;</span><span class="p">,</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">Icon</span><span class="p">(</span><span class="s">&#39;tango/22x22/mimetypes/x-office-presentation.png&#39;</span><span class="p">),</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Movie</span><span class="p">])</span>
</pre></div>
</div>
<p>The constructor of a section object takes the name of the section, a reference
to the application admin object, the icon to be used and the items in the
section.  The items is a list of the entities for which a table view should
shown.</p>
<p>Camelot comes with the <a class="reference external" href="http://tango.freedesktop.org/Tango_Icon_Library">Tango</a>
icon collection; we use a suitable icon for our movie section.</p>
<p>The resulting method now becomes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">get_sections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="kn">from</span> <span class="nn">camelot.model.memento</span> <span class="kn">import</span> <span class="n">Memento</span>
  <span class="kn">from</span> <span class="nn">camelot.model.authentication</span> <span class="kn">import</span> <span class="n">Person</span><span class="p">,</span> <span class="n">Organization</span>
  <span class="kn">from</span> <span class="nn">camelot.model.i18n</span> <span class="kn">import</span> <span class="n">Translation</span>
  <span class="kn">from</span> <span class="nn">model</span> <span class="kn">import</span> <span class="n">Movie</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">Section</span><span class="p">(</span><span class="s">&#39;Movies&#39;</span><span class="p">,</span>
                  <span class="bp">self</span><span class="p">,</span>
                  <span class="n">Icon</span><span class="p">(</span><span class="s">&#39;tango/22x22/mimetypes/x-office-presentation.png&#39;</span><span class="p">),</span>
                  <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Movie</span><span class="p">]),</span>
          <span class="n">Section</span><span class="p">(</span><span class="s">&#39;Relation&#39;</span><span class="p">,</span>
                  <span class="bp">self</span><span class="p">,</span>
                  <span class="n">Icon</span><span class="p">(</span><span class="s">&#39;tango/22x22/apps/system-users.png&#39;</span><span class="p">),</span>
                  <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Person</span><span class="p">,</span> <span class="n">Organization</span><span class="p">]),</span>
          <span class="n">Section</span><span class="p">(</span><span class="s">&#39;Configuration&#39;</span><span class="p">,</span>
                  <span class="bp">self</span><span class="p">,</span>
                  <span class="n">Icon</span><span class="p">(</span><span class="s">&#39;tango/22x22/categories/preferences-system.png&#39;</span><span class="p">),</span>
                  <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Memento</span><span class="p">,</span> <span class="n">Translation</span><span class="p">])</span>
          <span class="p">]</span>
</pre></div>
</div>
<p>We can now try our application.</p>
<p>We see a new button the navigation pane labelled <cite>&#8216;Movies&#8217;</cite>. Clicking on it
fills the navigation tree with the only entity in the movies&#8217;s section.
Clicking on this tree entry opens the table view. And if we click on the blue
folder of each record, a form view appears as shown below.</p>
<img alt="../_images/picture7.png" src="../_images/picture7.png" />
<p>That&#8217;s it for the basics of defining an entity and setting it for display in
Camelot. Next we look at relationships between entities.</p>
</div>
<div class="section" id="relationships">
<h2>Relationships<a class="headerlink" href="#relationships" title="Permalink to this headline">¶</a></h2>
<p>We will be using Elixir&#8217;s special fields <tt class="docutils literal"><span class="pre">ManyToOne</span></tt> and <tt class="docutils literal"><span class="pre">OneToMany</span></tt> to
specify relationships between entities. But first we need a <tt class="docutils literal"><span class="pre">Director</span></tt>
entity. We define it as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">elixir</span> <span class="kn">import</span> <span class="n">ManyToOne</span><span class="p">,</span> <span class="n">OneToMany</span>

<span class="k">class</span> <span class="nc">Director</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
  <span class="n">using_options</span><span class="p">(</span><span class="n">tablename</span><span class="o">=</span><span class="s">&#39;director&#39;</span><span class="p">)</span>

  <span class="n">name</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">60</span><span class="p">))</span>
  <span class="n">movies</span> <span class="o">=</span> <span class="n">OneToMany</span><span class="p">(</span><span class="s">&#39;Movie&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Once again, we name the table ourselves. What&#8217;s new here is <tt class="docutils literal"><span class="pre">OneToMany</span></tt>.</p>
<p>In Elixir, <tt class="docutils literal"><span class="pre">OneToMany</span></tt> is a relationship; it takes as parameter the related
class&#8217;s name. Behind the scenes, Elixir creates a director id column in the
table represented by the entity <tt class="docutils literal"><span class="pre">Movie</span></tt> and set a foreign key constraint on
this column.</p>
<p>Elixir requires that we add an inverse relationship <tt class="docutils literal"><span class="pre">ManyToOne</span></tt> to our
<tt class="docutils literal"><span class="pre">Movie</span></tt> entity. It ends up looking as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
  <span class="n">using_options</span><span class="p">(</span><span class="n">tablename</span><span class="o">=</span><span class="s">&#39;movie&#39;</span><span class="p">)</span>

  <span class="n">title</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">short_description</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">512</span><span class="p">))</span>
  <span class="n">release_date</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Date</span><span class="p">)</span>
  <span class="n">genre</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
  <span class="n">director</span> <span class="o">=</span> <span class="n">ManyToOne</span><span class="p">(</span><span class="s">&#39;Director&#39;</span><span class="p">)</span>

  <span class="k">class</span> <span class="nc">Admin</span><span class="p">(</span><span class="n">EntityAdmin</span><span class="p">):</span>
    <span class="n">verbose_name</span> <span class="o">=</span> <span class="s">&#39;Movie&#39;</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">,</span>
                    <span class="s">&#39;short_description&#39;</span><span class="p">,</span>
                    <span class="s">&#39;release_date&#39;</span><span class="p">,</span>
                    <span class="s">&#39;genre&#39;</span><span class="p">,</span>
                    <span class="s">&#39;director&#39;</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="s">&#39;untitled movie&#39;</span>
</pre></div>
</div>
<p>We also inserted <tt class="docutils literal"><span class="pre">'director'</span></tt> in <tt class="docutils literal"><span class="pre">list_display</span></tt>.</p>
<p>Our <tt class="docutils literal"><span class="pre">Director</span></tt> entity needs an administration class, which will adds the
entity to the section <tt class="docutils literal"><span class="pre">'movies'</span></tt>. We will also add <tt class="docutils literal"><span class="pre">__unicode__()</span></tt> method
as suggested above. The entity now looks as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Director</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
  <span class="n">using_options</span><span class="p">(</span><span class="n">tablename</span><span class="o">=</span><span class="s">&#39;director&#39;</span><span class="p">)</span>

  <span class="n">name</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">60</span><span class="p">))</span>
  <span class="n">movies</span> <span class="o">=</span> <span class="n">OneToMany</span><span class="p">(</span><span class="s">&#39;Movie&#39;</span><span class="p">)</span>

  <span class="k">class</span> <span class="nc">Admin</span><span class="p">(</span><span class="n">EntityAdmin</span><span class="p">):</span>
    <span class="n">verbose_name</span> <span class="o">=</span> <span class="s">&#39;Director&#39;</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s">&#39;unknown director&#39;</span>
</pre></div>
</div>
<p>For completeness the two entities are once again listed below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
  <span class="n">using_options</span><span class="p">(</span><span class="n">tablename</span><span class="o">=</span><span class="s">&#39;movie&#39;</span><span class="p">)</span>

  <span class="n">title</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">short_description</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">512</span><span class="p">))</span>
  <span class="n">release_date</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Date</span><span class="p">)</span>
  <span class="n">genre</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
  <span class="n">director</span> <span class="o">=</span> <span class="n">ManyToOne</span><span class="p">(</span><span class="s">&#39;Director&#39;</span><span class="p">)</span>

  <span class="k">class</span> <span class="nc">Admin</span><span class="p">(</span><span class="n">EntityAdmin</span><span class="p">):</span>
    <span class="n">verbose_name</span> <span class="o">=</span> <span class="s">&#39;Movie&#39;</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">,</span>
                    <span class="s">&#39;short_description&#39;</span><span class="p">,</span>
                    <span class="s">&#39;release_date&#39;</span><span class="p">,</span>
                    <span class="s">&#39;genre&#39;</span><span class="p">,</span>
                    <span class="s">&#39;director&#39;</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="s">&#39;untitled movie&#39;</span>


<span class="k">class</span> <span class="nc">Director</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
  <span class="n">using_options</span><span class="p">(</span><span class="n">tablename</span><span class="o">=</span><span class="s">&#39;director&#39;</span><span class="p">)</span>

  <span class="n">name</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">60</span><span class="p">))</span>
  <span class="n">movies</span> <span class="o">=</span> <span class="n">OneToMany</span><span class="p">(</span><span class="s">&#39;Movie&#39;</span><span class="p">)</span>

  <span class="k">class</span> <span class="nc">Admin</span><span class="p">(</span><span class="n">EntityAdmin</span><span class="p">):</span>
    <span class="n">verbose_name</span> <span class="o">=</span> <span class="s">&#39;Director&#39;</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s">&#39;unknown director&#39;</span>
</pre></div>
</div>
<p>The last step is to fix <tt class="file docutils literal"><span class="pre">application_admin.py</span></tt> by adding the following
lines to the Director entity to the Movie section:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Section</span><span class="p">(</span><span class="s">&#39;Movies&#39;</span><span class="p">,</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">Icon</span><span class="p">(</span><span class="s">&#39;tango/22x22/mimetypes/x-office-presentation.png&#39;</span><span class="p">),</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Movie</span><span class="p">,</span> <span class="n">Director</span><span class="p">])</span>
</pre></div>
</div>
<p>This takes care of the relationship between our two entities. Below is the new
look of our video store application.</p>
<img alt="../_images/picture8.png" src="../_images/picture8.png" />
<p>We have just learned the basics of Camelot, and have a nice movie database
application we can play with. In another tutorial, we will learn more advanced
features of Camelot.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Creating a Movie Database Application</a><ul>
<li><a class="reference internal" href="#starting-a-new-project">Starting a New Project</a></li>
<li><a class="reference internal" href="#main-window-and-views">Main Window and Views</a></li>
<li><a class="reference internal" href="#creating-the-movie-model">Creating the Movie Model</a></li>
<li><a class="reference internal" href="#the-entityadmin-subclass">The EntityAdmin Subclass</a></li>
<li><a class="reference internal" href="#configuring-the-application">Configuring the Application</a></li>
<li><a class="reference internal" href="#relationships">Relationships</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Tutorials</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="reporting.html"
                        title="next chapter">Creating a Report with Camelot</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/tutorial/videostore.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="reporting.html" title="Creating a Report with Camelot"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Tutorials"
             >previous</a> |</li>
        <li><a href="../index.html">Camelot  documentation</a> &raquo;</li>
          <li><a href="../contents.html" >Camelot Documentation contents</a> &raquo;</li>
          <li><a href="index.html" >Tutorials</a> &raquo;</li> 
      </ul>
    </div>

<br/>
<a href="http://example.com/my_article.html#disqus_thread">Comments</a>
<br/>

<div id="disqus_thread"></div>
<script type="text/javascript">
  /**
    * var disqus_identifier; [Optional but recommended: Define a unique identifier (e.g. post id or slug) for this thread] 
    */

  /** var disqus_developer = 1 **/

  (function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = 'http://camelot.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=camelot">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




    <div class="footer">
        &copy; <a href="../copyright.html">Copyright</a> 2009 - 2011, Conceptive Engineering.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.
    </div>
<div class="footer">
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

<script type="text/javascript">
var disqus_shortname = 'camelot';
(function () {
  var s = document.createElement('script'); s.async = true;
  s.src = 'http://disqus.com/forums/camelot/count.js';
  (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



  </body>
</html>