

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>FMS tutorial &mdash; FMS 0.1.9 Documentation</title>
    
    <link rel="stylesheet" href="_static/jcb.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="FMS 0.1.9 Documentation" href="index.html" />
    <link rel="next" title="startfms" href="startfms.html" />
    <link rel="prev" title="FMS download and installation" href="install.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="startfms.html" title="startfms"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="install.html" title="FMS download and installation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">FMS 0.1.9 Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
<h1 id="haut"><span>FMS</span>, an agent-based Financial Market Simulator</h1>
	
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="fms-tutorial">
<span id="tutorial"></span><span id="index-0"></span><h1>FMS tutorial<a class="headerlink" href="#fms-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Make sure you installed FMS properly before following this tutorial, see
<a class="reference internal" href="install.html#install"><em>FMS download and installation</em></a>.</p>
</div>
<p>FMS is a command line application and as such, is rather self-documented. To get
a summary of the various commands and options, cd to the directory where you
installed FMS and simply run:</p>
<div class="highlight-python"><pre>python startfms.py --help</pre>
</div>
<p>You should get something like:</p>
<div class="highlight-python"><pre>Usage: startfms.py [options] [command] simulationconffile

runs a Financial Market Simulator simulation

Options:
  -h, --help            show this help message and exit
  -v, --verbose         set logging level to 'info'. Overrided by --loglevel.
  -L LEVEL, --loglevel=LEVEL
                        set logging level to LEVEL: debug, info, warning,
                        error, critical.</pre>
</div>
<p>As you might see, you just used the first option, <tt class="docutils literal"><span class="pre">--help</span></tt>.</p>
<p>For further details about commands and options, an unix-style manpage is
provided in the <tt class="docutils literal"><span class="pre">docs</span></tt> directory of your FMS installation.</p>
<p>&#8220;Running&#8221; FMS means feeding it with information about which kind of agents (and
how many of them) trade on which kind of market in which kind of world, for how
many periods of time. In addition, the market may follow different rules of
clearing, depending on the &#8220;period&#8221; of the day (pre-opening, fixing, continuous
trading, etc.). Such a complete description is called an &#8220;experiment&#8221; and is
conveniently stored in a flat file (see <a class="reference internal" href="config.html#config"><em>FMS experiments configuration</em></a> for details about this
file). Once FMS read and checked the configuration file, the experiment is run,
producing transaction data (date, transaction number, price, volume) either on
the console or in a file.</p>
<p>Before going deeper in the nuts and bolts of FMS, you should understand what
world, engines, markets and agents mean in FMS&#8217;s vocabulary.</p>
<div class="section" id="the-fms-model">
<h2>The FMS model<a class="headerlink" href="#the-fms-model" title="Permalink to this headline">¶</a></h2>
<div class="section" id="world">
<h3>World<a class="headerlink" href="#world" title="Permalink to this headline">¶</a></h3>
<p>This is a &#8220;global environment&#8221; class, providing agents with so called exogenous
information on request. Such information might typically be the level of
interest rates, or energy price, for an example. Any world class keeps track of time.</p>
<p>A <tt class="docutils literal"><span class="pre">NullWorld</span></tt> class is provided with FMS, it does not provide any special
information.</p>
</div>
<div class="section" id="engines-markets">
<h3>Engines/markets<a class="headerlink" href="#engines-markets" title="Permalink to this headline">¶</a></h3>
<p>The engines/markets tuples describe what you would simply call &#8220;the market&#8221; in
the real world. Engines are the &#8220;traffic controlers&#8221; : they give speak to the
agents in a (simulated) synchronous or asynchronous manner, choosing which
agents speak and when at will. For an example, FMS provides with an
<tt class="docutils literal"><span class="pre">AsynchronousRandWReplace</span></tt> engine class, which is asynchronous (market
clearing is required as soon as an agent spoke) and chooses agents randomly,
with replacement. Markets basically are responsible for recording the orders,
and doing the clearing (for an example, auction style &#8220;fixing&#8221; clearing once in
a while, or continuous book based clearing). FMS provides with two basic market
classes, <tt class="docutils literal"><span class="pre">ContinuousOrderDriven</span></tt> and <tt class="docutils literal"><span class="pre">HighestQtyFixing</span></tt>.</p>
</div>
<div class="section" id="agents">
<h3>Agents<a class="headerlink" href="#agents" title="Permalink to this headline">¶</a></h3>
<p>Agents act when the engines give them speak. Acting is either do nothing, or
place an order. Order should at least have a direction (buy or sell) but may in
addition specify price and/or quantity. A <tt class="docutils literal"><span class="pre">ZeroIntelligenceTrader</span></tt> class is
provided: this agent takes fully random decisions.</p>
<p>As all this probably sounds rather theoretical at the moment, let&#8217;s try a first
experiment to help you make sense out of it.</p>
</div>
</div>
<div class="section" id="configuring-an-experiment">
<h2>Configuring an experiment<a class="headerlink" href="#configuring-an-experiment" title="Permalink to this headline">¶</a></h2>
<p>To keep your system clean, start by creating a new directory for your
experiments somewhere in your <tt class="docutils literal"><span class="pre">home</span></tt> directory (the <tt class="docutils literal"><span class="pre">My</span> <span class="pre">documents</span></tt> directory
if you use Windows).</p>
<p>If you use Linux or a BSD, make sure that the <tt class="docutils literal"><span class="pre">startfms.py</span></tt> script is on your
path, or symlink or copy it in the newly created &#8220;experiments&#8221; directory.</p>
<p>If you use Windows, copy the <tt class="docutils literal"><span class="pre">startfms.py</span></tt> (it is very small, so copying it is
not a problem) in the newly created &#8220;experiments&#8221; directory. Remember that
<tt class="docutils literal"><span class="pre">startfms.py</span></tt> is located in your Python installation <tt class="docutils literal"><span class="pre">Scripts</span></tt> directory,
something like <tt class="docutils literal"><span class="pre">C:\Python26\Scripts\</span></tt>.</p>
<p id="index-1">Open your favorite text editor, and copy the text below:</p>
<div class="highlight-python"><pre>--- # My first experiment

world:
      classname: NullWorld

engines:
    - classname: AsynchronousRandWReplace
      market:
          classname: ContinuousOrderDriven
      daylength: 20

agents:
    - classname: ZeroIntelligenceTrader
      number: 1000
      money: 10000
      stocks: 1000
      args: [1000, 100]</pre>
</div>
<p>Then save it in the &#8220;experiments&#8221; directory under the name &#8220;exp1.yml&#8221; or
whatever name you may think of (and remember), provided you keep the &#8221;.yml&#8221;
extension. This extension is necessary because it tells FMS that the
configuration file is a <a class="reference external" href="http://www.yaml.org/">YAML</a> one. YAML (Yet Another Markup Language) is nothing
more than some kind of syntax, and this one was designed to be as human friendly
as possible, so don&#8217;t be scared even if you have no previous experience of
manually written config files.</p>
<p>Before trying to run this first experiment, you deserve a few words of explanation.</p>
<p>As said before, the full description of the experiment should be in the
config file <a class="footnote-reference" href="#id4" id="id1">[1]</a>. Because you read carefully the previous section, you know that to define an experiment, you should (at least) provide:</p>
<ul class="simple">
<li>a world class</li>
<li>an engine/market tuple</li>
<li>an agent class</li>
</ul>
<p>As you probably noticed, this is exactly what you just copied in the
configuration file. As any YAML file, this file contains &#8220;documents&#8221;. The
three dashes on the first line mark the beginning of the only document in our
configuration file:</p>
<div class="highlight-python"><pre>--- # My first experiment</pre>
</div>
<p>Anything following the # on this line (and any other) is a comment.</p>
<p>Then we describe three &#8220;objects&#8221;: any non-indented line looking like:</p>
<div class="highlight-python"><pre>object:</pre>
</div>
<p>starts the description of a new object. The idented lines below this one define
this object&#8217;s various attributes. We thus defined exactly three objects, namely
<tt class="docutils literal"><span class="pre">world</span></tt>, <tt class="docutils literal"><span class="pre">engines</span></tt> and <tt class="docutils literal"><span class="pre">agents</span></tt>. More objects are possible, see
<a class="reference internal" href="config.html#config"><em>FMS experiments configuration</em></a> to learn about those.</p>
<p>As the three kind of objects we described here are the bare minimum to get a
valid experiment, let&#8217;s get acquainted with any of them.</p>
<div class="section" id="the-world-object-and-its-attributes">
<span id="index-2"></span><h3>The <tt class="docutils literal"><span class="pre">world</span></tt> object and its attributes<a class="headerlink" href="#the-world-object-and-its-attributes" title="Permalink to this headline">¶</a></h3>
<p>The simple world we use in this experiment is fully described with these two
lines:</p>
<div class="highlight-python"><pre>world:
      classname: NullWorld</pre>
</div>
<p>This means that the only necessary attribute for the <tt class="docutils literal"><span class="pre">world</span></tt> object is
<tt class="docutils literal"><span class="pre">classname</span></tt>, that is the kind (class) of world you want to use in your
experiment. Here, the <tt class="docutils literal"><span class="pre">classname</span></tt> is NullWorld, and actually you read above in
<a class="reference internal" href="#the-fms-model">The FMS model</a> that FMS is provided with a very simple world class, which name
is NullWorld.</p>
<p>The term <tt class="docutils literal"><span class="pre">class</span></tt> is a technical one, refering to something very precise in the
Python programming language. If you feel curious about that, get a command
prompt and <tt class="docutils literal"><span class="pre">cd</span></tt> to the <tt class="docutils literal"><span class="pre">fms</span></tt> directory, which is probably in the
<tt class="docutils literal"><span class="pre">site-packages</span></tt> directory of your Python installation. In this <tt class="docutils literal"><span class="pre">fms</span></tt>
directory you see subdirectories, conveniently named <tt class="docutils literal"><span class="pre">worlds</span></tt>, <tt class="docutils literal"><span class="pre">agents</span></tt>,
and so on. Now <tt class="docutils literal"><span class="pre">cd</span></tt> to the <tt class="docutils literal"><span class="pre">worlds</span></tt> directory: you should see a bunch of files, and among those, a <tt class="docutils literal"><span class="pre">nullworld.py</span></tt> file. This is where FMS will look for the NullWorld class when it will need it, i.e. when we will run our first experiment.</p>
<p>Then we have a world, time to think about running a market. This is the
engines&#8217; job.</p>
</div>
<div class="section" id="the-engines-object-and-its-attributes">
<span id="index-3"></span><h3>The <tt class="docutils literal"><span class="pre">engines</span></tt> object and its attributes<a class="headerlink" href="#the-engines-object-and-its-attributes" title="Permalink to this headline">¶</a></h3>
<p>As you read above, what we call a &#8220;market&#8221; in the real life is a tuple
engine/market on FMS. This design decision helps following the &#8220;don&#8217;t repeat
yourself&#8221; programming rule, and should not bother you too much.</p>
<p>Did you notice the plural in &#8220;engines&#8221; ? Yes, you may use more than one
engine/market tuple for an experiment. This allows for an example to mimic some markets where a pre-opening period finishes with the determination of a fixing price, and then continuous trading. But you may of course imagine whatever combination fits your (research) needs.</p>
<p>Here is the part of the config file related to engines and markets:</p>
<div class="highlight-python"><pre>engines:
    - classname: AsynchronousRandWReplace
      market:
          classname: ContinuousOrderDriven
      daylength: 20</pre>
</div>
<p>As you may have more than one engine/market tuples, the class names of the
engines is in a list. This is why the <tt class="docutils literal"><span class="pre">classname</span></tt> block is preceded by a dash.
The dash says &#8220;this is an item in a list&#8221;.</p>
<p>So, we only have one engine here. What are the engine&#8217;s attributes ? For the
same reason why the <tt class="docutils literal"><span class="pre">world</span></tt> needed a <tt class="docutils literal"><span class="pre">classname</span></tt> attribute, so does the
<tt class="docutils literal"><span class="pre">engines</span></tt>, and will the <tt class="docutils literal"><span class="pre">market</span></tt> and the <tt class="docutils literal"><span class="pre">agents</span></tt>. The <tt class="docutils literal"><span class="pre">classname</span></tt> says
&#8220;use this kind of engine&#8221;. As any engine is associated with a market in a tuple,
the <tt class="docutils literal"><span class="pre">classname</span></tt> attribute is followed by a <tt class="docutils literal"><span class="pre">market</span></tt> attribute. The market
itself is an object, and (guess what) gets a <tt class="docutils literal"><span class="pre">classname</span></tt> attribute.</p>
<p>Finally, this precise engine, which <tt class="docutils literal"><span class="pre">classname</span></tt> is
<tt class="docutils literal"><span class="pre">AsynchronousRandWReplace</span></tt> will run 20 times, as the <tt class="docutils literal"><span class="pre">daylength</span></tt> attribute
value is 20. Note that this attribute is optional, but the default value is 1,
which is not much. This attribute is not the number of transactions you will get
in the output, but the number of times the engine will give speak to an agent.
When an agent &#8220;speaks&#8221;, she may decide to do nothing, or place an order which
does not necessarily trigger a transaction, depending on the market model.
Thus, the number of times the engine give speak to the agents is not the number
of transactions of the experiment.</p>
</div>
<div class="section" id="the-agents-object-and-its-attributes">
<span id="index-4"></span><h3>The <tt class="docutils literal"><span class="pre">agents</span></tt> object and its attributes<a class="headerlink" href="#the-agents-object-and-its-attributes" title="Permalink to this headline">¶</a></h3>
<p>The last object we put in the config file is the <tt class="docutils literal"><span class="pre">agents</span></tt> one. Its description
is as follows:</p>
<div class="highlight-python"><pre>agents:
    - classname: ZeroIntelligenceTrader
      number: 1000
      money: 10000
      stocks: 1000
      args: [1000, 100]</pre>
</div>
<p>We have here the same kind of block structure than the one we had with
<tt class="docutils literal"><span class="pre">engines</span></tt>. An experiment may use different kind of agents (random,
fundamentalists, ...), thus the <tt class="docutils literal"><span class="pre">classname</span></tt> is preceded by a dash, telling us
that other agent classes might follow in the configuration file.</p>
<p>Here we use only one class of agents, namely <tt class="docutils literal"><span class="pre">ZeroIntelligenceTrader</span></tt>. This
agent always take random decisions. The attributes block starts with <tt class="docutils literal"><span class="pre">number</span></tt>,
which, as you guessed, gives the number of individual agents of that class you
need.</p>
<p>Then come <tt class="docutils literal"><span class="pre">money</span></tt> and <tt class="docutils literal"><span class="pre">stocks</span></tt>, which describe the initial portfolio of the
agent, in cash and stocks.</p>
<p><tt class="docutils literal"><span class="pre">number</span></tt>, <tt class="docutils literal"><span class="pre">money</span></tt> and <tt class="docutils literal"><span class="pre">stocks</span></tt> are compulsory attributes, whatever the
agent class you choosed.</p>
<p>The last attribute, <tt class="docutils literal"><span class="pre">args</span></tt>, is a list of optional attributes, the meaning of
which depends on the agent class. For the <tt class="docutils literal"><span class="pre">ZeroIntelligenceTrader</span></tt> class, the
attributes are the maximum price and quantity an agent is allowed to use in an
order, i.e. these are limits for the random process generating the orders.</p>
</div>
</div>
<div class="section" id="running-the-experiment">
<h2>Running the experiment<a class="headerlink" href="#running-the-experiment" title="Permalink to this headline">¶</a></h2>
<div class="section" id="check-that-all-is-ready">
<h3>Check that all is ready<a class="headerlink" href="#check-that-all-is-ready" title="Permalink to this headline">¶</a></h3>
<p>Your experiment is configured, it is now time to check that everything is ok.
Again, cd to the &#8220;experiment&#8221; directory and run:</p>
<div class="highlight-python"><pre>python startfms.py -v check name-of-the-config-file.yml</pre>
</div>
<p>(Replace <tt class="docutils literal"><span class="pre">name-of-the-config-file</span></tt> with the name of  your config file).</p>
<p id="index-5">The <tt class="docutils literal"><span class="pre">-v</span></tt> option stands for &#8220;verbose&#8221;, as we want FMS to tell us everything it
does. The output should be:</p>
<div class="highlight-python"><pre>INFO - fms.utils - Reading config file name-of-the-config-file.yml
INFO - fms.utils - == name-of-the-config-file.yml experiment ==
INFO - fms.utils - Output file : sys.stdout
INFO - fms.utils - World : NullWorld
INFO - fms.utils - Engines :
INFO - fms.utils -  AsynchronousRandWReplace : 1 days of 20 instants on ContinuousOrderDriven market
INFO - fms.utils - Agents :
INFO - fms.utils -  1000 ZeroIntelligenceTrader with $10000.00 and 1000 stocks, [1000, 100]
# name-of-the-config-file.yml experiment
time;transaction;price;volume
INFO - fms.utils - Config file name-of-the-config-file.yml parsed.
INFO - fms - Created world fms.worlds.nullworld.NullWorld world 162324140
INFO - fms - Created engine-market  fms.engines.asynchronousrandwreplace.AsynchronousRandWReplace engine 162308012 - fms.markets.continuousorderdriven.ContinuousOrderDriven market 162320972
INFO - fms - Created  1000 instances of agent fms.agents.zerointelligencetrader.ZeroIntelligenceTrader</pre>
</div>
<p>As expected because we choose the &#8220;verbose&#8221; option, the output is copious.
Actually, all the lines starting with <tt class="docutils literal"><span class="pre">INFO</span></tt> would not be here without the
<tt class="docutils literal"><span class="pre">-v</span></tt>. Try it:</p>
<div class="highlight-python"><pre>python startfms.py -v check name-of-the-config-file.yml</pre>
</div>
<p>You should get:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># name-of-the-config-file.yml experiment</span>
<span class="n">time</span><span class="p">;</span><span class="n">transaction</span><span class="p">;</span><span class="n">price</span><span class="p">;</span><span class="n">volume</span>
</pre></div>
</div>
<p>This is the only &#8220;real&#8221; output, that is, the header of the transaction file,
because no actual transaction occured. That is because we used the <tt class="docutils literal"><span class="pre">check</span></tt>
command, which is a dry-run: it does everything a real run would do (including
the output of a header, thus checking that writing on the output device, console
or file, is possible), but stops just before starting the (first) engine.</p>
<p>Read carefully the <tt class="docutils literal"><span class="pre">INFO</span></tt> lines in the output above: FMS first informs you that it reads your experiment configuration file. Then, it tells you what it understood from what you write there, one item at a time. You know when the file is completely parsed, and this is the moment FMS tries to create all the objects needed to complete your experiment. You can read about these operations too : what it created, and how many of these objects.</p>
</div>
<div class="section" id="trying-to-fool-the-system">
<h3>Trying to fool the system<a class="headerlink" href="#trying-to-fool-the-system" title="Permalink to this headline">¶</a></h3>
<p>Ok, here all went well, we could run the experiment and see the output right
now. But wait, what if we did a mistake in the configuration file ?</p>
<p>Edit the configuration file again, and change the fourth line so that the
<tt class="docutils literal"><span class="pre">world</span></tt> block is now:</p>
<div class="highlight-python"><pre>world:
      classname: OtherWorld</pre>
</div>
<p>Save, and run the check again (you know how to do this, don&#8217;t you ?). The output
(without the verbose option) should be:</p>
<div class="highlight-python"><pre># name-of-the-config-file.yml experiment
time;transaction;price;volume
CRITICAL - fms - Unknown fms.worlds class: OtherWorld</pre>
</div>
<p>FMS read the config file, output the result header, then tried to create an
<tt class="docutils literal"><span class="pre">OtherWorld</span></tt> world. As this class does not exist so far, it failed, and as a
<tt class="docutils literal"><span class="pre">world</span></tt> class is necessary for the experiment to run, this is a critical
situation. FMS thus stops immediately, and informs you about this, even if you
did not choose the verbose option.</p>
<p>Let us try something nastier. Edit again the <tt class="docutils literal"><span class="pre">world</span></tt> block in the configuration file, correct the class name but change the attribute name:</p>
<div class="highlight-python"><pre>world:
      theclassname: NullWorld</pre>
</div>
<p>Save, check. You should get something like:</p>
<div class="highlight-python"><pre>ERROR - fms.utils.exceptions - Missing parameter: world classname
None
Traceback (most recent call last):
  File "startfms.py", line 161, in &lt;module&gt;
    sys.exit(main())
  File "startfms.py", line 147, in main
    params = YamlParamsParser(simconffile)
  File "fms/utils/__init__.py", line 336, in __init__
    raise MissingParameter, 'world classname'
fms.utils.exceptions.MissingParameter: world classname</pre>
</div>
<p>Ouch, this looks scary. But look again and see the first line: FMS is kind
enough to tell you something understandable before crashing:</p>
<div class="highlight-python"><pre>ERROR - fms.utils.exceptions - Missing parameter: world classname</pre>
</div>
<p>And this exactly the problem. We created a <tt class="docutils literal"><span class="pre">theclassname</span></tt> attribute to the
<tt class="docutils literal"><span class="pre">world</span></tt> object, and there is nothing wrong with this (well, it is useless, but
harmless too). But there is no <tt class="docutils literal"><span class="pre">classname</span></tt> attribute, and FMS needs a
<tt class="docutils literal"><span class="pre">world</span></tt> <tt class="docutils literal"><span class="pre">classname</span></tt> as a parameter for the experiment. The missing parameter
triggers an error, and FMS reports about the error (and actually does not crash,
but stops, outputting complete exception information in case someone needs it).</p>
<p>Now you learned that:</p>
<ul class="simple">
<li>it is always a good idea to check an experiment file before using it</li>
<li>as far as possible, simple error messages will be output in case something
went wrong during the check.</li>
</ul>
</div>
<div class="section" id="outputting-the-transactions">
<h3>Outputting the transactions<a class="headerlink" href="#outputting-the-transactions" title="Permalink to this headline">¶</a></h3>
<p>Now that we checked that the experiment configuration file is correct, we may
run the experiment for real. This is simply done by entering the <tt class="docutils literal"><span class="pre">run</span></tt> command
instead of the <tt class="docutils literal"><span class="pre">check</span></tt> one we used so far:</p>
<div class="highlight-python"><pre>python startfms.py run name-of-the-config-file.yml</pre>
</div>
<p>Here is the output on my computer:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># name-of-the-config-file.yml experiment</span>
<span class="n">time</span><span class="p">;</span><span class="n">transaction</span><span class="p">;</span><span class="n">price</span><span class="p">;</span><span class="n">volume</span>
<span class="mi">1</span><span class="p">;</span><span class="mi">1</span><span class="p">;</span><span class="mf">900.68</span><span class="p">;</span><span class="mi">21</span>
<span class="mi">5</span><span class="p">;</span><span class="mi">2</span><span class="p">;</span><span class="mf">216.18</span><span class="p">;</span><span class="mi">14</span>
<span class="mi">5</span><span class="p">;</span><span class="mi">3</span><span class="p">;</span><span class="mf">643.92</span><span class="p">;</span><span class="mi">61</span>
<span class="mi">8</span><span class="p">;</span><span class="mi">4</span><span class="p">;</span><span class="mf">137.74</span><span class="p">;</span><span class="mi">26</span>
<span class="mi">8</span><span class="p">;</span><span class="mi">5</span><span class="p">;</span><span class="mf">218.66</span><span class="p">;</span><span class="mi">51</span>
<span class="mi">9</span><span class="p">;</span><span class="mi">6</span><span class="p">;</span><span class="mf">218.66</span><span class="p">;</span><span class="mi">62</span>
<span class="mi">14</span><span class="p">;</span><span class="mi">7</span><span class="p">;</span><span class="mf">218.13</span><span class="p">;</span><span class="mi">25</span>
<span class="mi">15</span><span class="p">;</span><span class="mi">8</span><span class="p">;</span><span class="mf">218.13</span><span class="p">;</span><span class="mi">28</span>
<span class="mi">16</span><span class="p">;</span><span class="mi">9</span><span class="p">;</span><span class="mf">218.13</span><span class="p">;</span><span class="mi">27</span>
<span class="mi">17</span><span class="p">;</span><span class="mi">10</span><span class="p">;</span><span class="mf">218.13</span><span class="p">;</span><span class="mi">35</span>
</pre></div>
</div>
<p>The output you get will probably be different: this is because this experiment
uses a pseudo-random number generator, and we did not feed it with a seed. In
this situation, the seed is &#8220;chosen&#8221; by the system, and the result is
unpredictable, depending on the OS you use, the time you ran the experiment, and
many other parameters. If you prefer to choose the seed yourself, you may add a
<tt class="docutils literal"><span class="pre">randomseed</span></tt> object to the configuration file, giving it whichever value you
want (as usual, see <a class="reference internal" href="config.html#config"><em>FMS experiments configuration</em></a> for a complete description of what you may put
in the configuration file).</p>
<p>Should you need details about the pseudo-random number generator, see the <a class="reference external" href="http://docs.python.org/library/random.html">Python
language library documentation</a>.</p>
<p>What did we get as an output ? Hopefully this is transaction data. Each line
(except the two header ones, that is) describes a transaction as semicolon
separated numerical values. As described on the second header line, you get:</p>
<ul class="simple">
<li>the &#8220;time&#8221; the transaction occured (remember that we put a <tt class="docutils literal"><span class="pre">daylength</span></tt> value
of 20 &#8220;instants&#8221; in the config file)</li>
<li>the sequential id of the transaction</li>
<li>the price at which the transaction took place</li>
<li>the volume, i.e. the number of assets exchanged.</li>
</ul>
<p>Again, the experiment lasted 20 turns, that is the engine class gave speak to a
randomly chosen agent 20 times before stopping. More precisely, what happened
twenty times is:</p>
<ul class="simple">
<li>the engine choosed an agent randomly among the 1000 that were created upon
initialization</li>
<li>as the agent class is purely random, the chosen agent put a random order (either
sell or buy, a price and a quantity)</li>
<li>the order was collected in the related book (sellbook or buybook)</li>
<li>the clearing method ran on the books, comparing the best limits and triggering
transactions if necessary</li>
</ul>
<p>Given the random value chosen, this resulted in the 10 transactions above.</p>
<p>Naturally you will probably use far more data for your research, asking for
many more turns. Notice that, in addition to <tt class="docutils literal"><span class="pre">daylength</span></tt> you may specify a
<tt class="docutils literal"><span class="pre">days</span></tt> object, that is the number of days of daylength you want to run. You
would then get a <tt class="docutils literal"><span class="pre">days</span> <span class="pre">*</span> <span class="pre">daylength</span></tt> turns experiment. This allows for fine
tuning the experiment: some engines would for an example flush the order books
at the end of any day, starting again with empty ones on the next day. By the
way, this behaviour is so common that it is the default one.</p>
<p>Note that we did not ask FMS to be verbose here: this is because the output goes
to the console (we did not put the name of an output file in the configuration),
and I did not want to mix it with the information reported by FMS about what is
going on when running the experiment. But as you will later use the transaction
data to produce graphics or statistics or whatever you may imagine, it is
convenient to store it in a file. The <tt class="docutils literal"><span class="pre">outputfilename</span></tt> object in the config file lets you give the name of the file storing the results of the experiment.</p>
<p>Let us try it. Edit again the configuration file and add this line somewhere it
would not interfere with the other parameters (i.e., not right in the middle of
another object&#8217;s block):</p>
<div class="highlight-python"><pre>outputfilename: experiment-one.csv</pre>
</div>
<p>Then run the experiment again:</p>
<div class="highlight-python"><pre>python startfms.py run name-of-the-config-file.yml</pre>
</div>
<p>You should get no output at all: we did not ask FMS to be verbose, and all the
transaction data went to the <tt class="docutils literal"><span class="pre">experiment-one.csv</span></tt> file (in the current
directory if you did not give a different path). Open this file with a text
editor, and you should see the transaction data (a different set, because the
random seed was different), each transaction described on a line exactly as it
was output on the console in the previous run.</p>
</div>
<div class="section" id="replaying-an-experiment">
<h3>Replaying an experiment<a class="headerlink" href="#replaying-an-experiment" title="Permalink to this headline">¶</a></h3>
<p>As we explained above, the transaction data on the second run is different from
the one we got on the first run. This is because the randomly chosen random seed
was different, thus resulting in a completely different sequence of orders.</p>
<p>Nonetheless, it may sometimes prove useful to &#8220;replay&#8221; an experiment, that is,
having the same agents put the same orders at the same time. I use it a lot for
testing purposes, for an example.</p>
<p>Because we used random agents in our experiment, this could be achieved
by choosing the random seed ourselves, as a given random seed will always result
in the same pseudo-random sequence of numbers. But this trick would not do for
non-random agents. In addition, it might be useful to store the sequence of
orders put by the agents, too. Thus, FMS is provided with the necessary set of
tools to achieve both results:</p>
<ul class="simple">
<li>store the orders sequence in a file</li>
<li>make it possible to &#8220;replay&#8221; the orders file.</li>
</ul>
<p>The first step is achieved by another configuration item, namely
<tt class="docutils literal"><span class="pre">orderslogfilename</span></tt>. As with <tt class="docutils literal"><span class="pre">ouputfilename</span></tt>, you simply provide a file
name, and FMS will gently store the orders put by the agents in it.</p>
<p>The second step involves using a special agent class, <tt class="docutils literal"><span class="pre">PlayOrderLogFile</span></tt>:
instead of speaking randomly, or being a fundamentalist, or whichever scheme we
may imagine, this agent &#8220;reads&#8221; class the orders from the <tt class="docutils literal"><span class="pre">orderslogfilename</span></tt>,
in sequence. In addition, to make sure the sequence is correct whatever the
number of instances of this agent you ask for, each instance will actually be
the same agent <a class="footnote-reference" href="#id5" id="id2">[2]</a> (thus &#8220;remembering&#8221; which line of the file it just read, for
an example).</p>
<p>To try this, we first need to play the experiment again, this time storing the
orders the agents emitted. We will then replay the experiment and check that
the output transactions are actually the same.</p>
<p>Edit your config file again, and add an <tt class="docutils literal"><span class="pre">orderslogfilename</span></tt> item:</p>
<div class="highlight-python"><pre>orderslogfilename: myorders.txt</pre>
</div>
<p>Run the experiment again, and check that there is a <tt class="docutils literal"><span class="pre">myorders.txt</span></tt> file in the
current directory (or whichever path you choosed). Open this file with your
editor and check its contents. You may notice that it contains exactly 20 order
lines, as you asked for a <tt class="docutils literal"><span class="pre">daylength</span></tt> of 20. Close the file, and be careful
not to change anything in it (do not save).</p>
<p>Then, change the configuration file again. There is a little bit of work to do
here (you might prefer to copy the original configuration file, and modify the
copy):</p>
<ul class="simple">
<li>give a new name to the output file (in order to be able to compare it against
the one we just created)</li>
<li>delete the <tt class="docutils literal"><span class="pre">orderslogfilename</span></tt> line (as we already have the orders file)</li>
<li>change the agent class name to <tt class="docutils literal"><span class="pre">PlayOrderLogFile</span></tt></li>
<li>change the agent <tt class="docutils literal"><span class="pre">args</span></tt> parameter, deleting the numbers here and putting the
orders log file name instead: the agent has to know which file it is supposed
to play.</li>
</ul>
<p>The resulting file contents should be like:</p>
<div class="highlight-python"><pre>--- # My first experiment

world:
      worldclassname: NullWorld
      classname: NullWorld

engines:
    - classname: AsynchronousRandWReplace
      market:
          classname: ContinuousOrderDriven
      daylength: 20

agents:
    - classname: PlayOrderLogFile
      number: 1000
      money: 10000
      stocks: 1000
      args: ['myorders.txt']

outputfilename: experiment-replayed.csv</pre>
</div>
<p>Then run the experiment against the new configuration file. If you did not
choose to pass the <tt class="docutils literal"><span class="pre">verbose</span></tt> options, you should get no output. Compare the
contents of the original output file (<tt class="docutils literal"><span class="pre">experiment-one.csv</span></tt>) with the one
resulting from the replay of the experiment (<tt class="docutils literal"><span class="pre">experiment-replayed.csv</span></tt>). If
all went well (and there is no reason it did not), they should be identical.
If your system is an unix-based one, you may try:</p>
<div class="highlight-python"><pre>diff experiment-one.csv experiment-replayed.csv</pre>
</div>
<p>As the <tt class="docutils literal"><span class="pre">diff</span></tt> comment produces no output at all <a class="footnote-reference" href="#id6" id="id3">[3]</a>, the two files contents are
the same.</p>
</div>
</div>
<div class="section" id="a-word-of-conclusion">
<h2>A word of conclusion<a class="headerlink" href="#a-word-of-conclusion" title="Permalink to this headline">¶</a></h2>
<p>Congratulations ! You managed to go through this long tutorial, and are now
ready to start playing with FMS on your own. Remember to read the rest of the
documentation, it will help you master the fine-tuning aspects of FMS, getting
the results you need for your research.</p>
<p>Happy number crunching !</p>
<hr class="docutils" />
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>A future release of FMS might allow to pass all the parameters as
options, for people loving long and convoluted command lines...</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Technically, this kind of class is called a &#8220;Borg&#8221;, after a fictional
pseudo-race of cyborgs depicted in the &#8220;Star Trek&#8221; series. The Borgs have some
kind of collective mind, as our agents share the same state.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>Actually it may produce output if you changed the experiment
configuration file name, as it is used to produce the first line of header.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">FMS tutorial</a><ul>
<li><a class="reference internal" href="#the-fms-model">The FMS model</a><ul>
<li><a class="reference internal" href="#world">World</a></li>
<li><a class="reference internal" href="#engines-markets">Engines/markets</a></li>
<li><a class="reference internal" href="#agents">Agents</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-an-experiment">Configuring an experiment</a><ul>
<li><a class="reference internal" href="#the-world-object-and-its-attributes">The <tt class="docutils literal"><span class="pre">world</span></tt> object and its attributes</a></li>
<li><a class="reference internal" href="#the-engines-object-and-its-attributes">The <tt class="docutils literal"><span class="pre">engines</span></tt> object and its attributes</a></li>
<li><a class="reference internal" href="#the-agents-object-and-its-attributes">The <tt class="docutils literal"><span class="pre">agents</span></tt> object and its attributes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-the-experiment">Running the experiment</a><ul>
<li><a class="reference internal" href="#check-that-all-is-ready">Check that all is ready</a></li>
<li><a class="reference internal" href="#trying-to-fool-the-system">Trying to fool the system</a></li>
<li><a class="reference internal" href="#outputting-the-transactions">Outputting the transactions</a></li>
<li><a class="reference internal" href="#replaying-an-experiment">Replaying an experiment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-word-of-conclusion">A word of conclusion</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="install.html"
                        title="previous chapter">FMS download and installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="startfms.html"
                        title="next chapter">startfms</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="startfms.html" title="startfms"
             >next</a> |</li>
        <li class="right" >
          <a href="install.html" title="FMS download and installation"
             >previous</a> |</li>
        <li><a href="index.html">FMS 0.1.9 Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2008-2012, Jean-Charles Bagneris.
      Last updated on Mar 01, 2012.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>