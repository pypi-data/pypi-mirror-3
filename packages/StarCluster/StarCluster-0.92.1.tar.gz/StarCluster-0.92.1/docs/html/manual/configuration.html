
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>StarCluster Configuration File &mdash; StarCluster v0.92.1 documentation</title>
    <link rel="stylesheet" href="../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.92.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="StarCluster v0.92.1 documentation" href="../index.html" />
    <link rel="up" title="StarCluster User Manual" href="index.html" />
    <link rel="next" title="Using EBS Volumes for Persistent Storage" href="volumes.html" />
    <link rel="prev" title="StarCluster User Manual" href="index.html" />
<link rel="stylesheet" href="../_static/nobile.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../_static/neuton.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../_static/starcluster.ico"/>

  </head>
  <body>
<div class="header-small">
	
	<div class="logo-small">
		<a href="../index.html">
      		<img class="logo" src="../_static/logo-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="volumes.html" title="Using EBS Volumes for Persistent Storage"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="StarCluster User Manual"
             accesskey="P">previous</a> |</li>
    	<li><a href="../index.html">Home</a> &raquo;</li>
          <li><a href="../contents.html" >Master Table of Contents</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">StarCluster User Manual</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="starcluster-configuration-file">
<h1>StarCluster Configuration File<a class="headerlink" href="#starcluster-configuration-file" title="Permalink to this headline">¶</a></h1>
<p>The StarCluster configuration file uses <a class="reference external" href="http://en.wikipedia.org/wiki/INI_file">ini formatting</a>. It is made up of various sections
which are described here in detail. This document explains how to configure the
three required sections <strong>[aws info]</strong>, <strong>[keypair]</strong>, and <strong>[cluster]</strong> as
well as optional <strong>[global]</strong>, <strong>[volume]</strong>, <strong>[permission]</strong>, and <strong>[plugin]</strong>
sections.</p>
<div class="section" id="creating-the-configuration-file">
<h2>Creating the configuration file<a class="headerlink" href="#creating-the-configuration-file" title="Permalink to this headline">¶</a></h2>
<p>The default starcluster config lives in <tt class="docutils literal"><span class="pre">~/.starcluster/config</span></tt>. You can
either create this file manually or have starcluster create it for you with an
example configuration template (recommended).</p>
<p>To have StarCluster generate an example configuration file at the default
config location (<tt class="docutils literal"><span class="pre">~/.starcluster/config</span></tt>), simply run &#8220;starcluster help&#8221; at
the command-line.  Provided that the configuration file does not exist, you
will see the following:</p>
<div class="highlight-python"><pre>$ starcluster help
StarCluster - (http://web.mit.edu/starcluster)
Software Tools for Academics and Researchers (STAR)
Please submit bug reports to starcluster@mit.edu

cli.py:475 - ERROR - Config file /home/user/.starcluster/config does not exist

Options:
--------
[1] Show the StarCluster config template
[2] Write config template to /home/user/.starcluster/config
[q] Quit

Please enter your selection:</pre>
</div>
<p>Selecting 1 will print the example configuration file template to standard
output.</p>
<p>Selecting 2 will write the configuration file template to ~/.starcluster/config</p>
<p>The configuration template provided by StarCluster should be ready to go
out-of-the-box after filling in your Amazon Web Services credentials and
setting up a keypair. This example config provides a simple <em>cluster template</em>
called <tt class="docutils literal"><span class="pre">smallcluster</span></tt> that is set as the default <em>cluster template</em>.</p>
<div class="section" id="storing-the-config-in-an-alternate-location">
<h3>Storing the config in an alternate location<a class="headerlink" href="#storing-the-config-in-an-alternate-location" title="Permalink to this headline">¶</a></h3>
<p>If you wish to store your StarCluster config in a location other than the
default (<tt class="docutils literal"><span class="pre">~/.starcluster/config</span></tt>) you will need to specify the global
<tt class="docutils literal"><span class="pre">--config</span></tt> (<tt class="docutils literal"><span class="pre">-c</span></tt>) option with every StarCluster command you use. For
example:</p>
<div class="highlight-python"><pre>$ starcluster -c /path/to/starcluster/config listclusters</pre>
</div>
<p>In the above example, if the config didn&#8217;t exist at the specified path you
would be prompted with the same menu above offering to generate a template at
the specified path:</p>
<div class="highlight-python"><pre>$ starcluster -c /path/to/nonexistent/config listclusters
StarCluster - (http://web.mit.edu/starcluster)
Software Tools for Academics and Researchers (STAR)
Please submit bug reports to starcluster@mit.edu

cli.py:475 - ERROR - Config file /path/to/nonexistent/config does not exist

Options:
--------
[1] Show the StarCluster config template
[2] Write config template to /path/to/nonexistent/config
[q] Quit

Please enter your selection:</pre>
</div>
</div>
<div class="section" id="loading-the-config-from-the-web">
<h3>Loading the config from the web<a class="headerlink" href="#loading-the-config-from-the-web" title="Permalink to this headline">¶</a></h3>
<p>The config can also be loaded from a web url, however, if you choose to do so
you should be <em>very</em> careful not to publicly host AWS credentials, keys, and
other private information:</p>
<div class="highlight-python"><pre>$ starcluster -c http://localhost/starcluster.cfg listclusters</pre>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also: <a class="reference internal" href="#splitting-the-config"><em>Splitting the Config into Multiple Files</em></a></p>
</div>
</div>
</div>
<div class="section" id="amazon-web-services-credentials">
<h2>Amazon Web Services Credentials<a class="headerlink" href="#amazon-web-services-credentials" title="Permalink to this headline">¶</a></h2>
<p>The first required section in the configuration file is <strong>[aws info]</strong>. This
section specifies all of your AWS credentials. The following settings are
required:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[aws info]</span>
<span class="c"># replace these with your AWS keys (required)</span>
<span class="na">aws_access_key_id</span> <span class="o">=</span> <span class="s">#your_aws_access_key_id</span>
<span class="na">aws_secret_access_key</span> <span class="o">=</span> <span class="s">#your_secret_access_key</span>
<span class="c"># these settings are optional and only used for creating new AMIs</span>
<span class="na">aws_user_id</span><span class="o">=</span> <span class="s">#your userid</span>
<span class="na">ec2_cert</span> <span class="o">=</span> <span class="s">/path/to/your/ec2_cert.pem</span>
<span class="na">ec2_private_key</span> <span class="o">=</span> <span class="s">/path/to/your/ec2_pk.pem</span>
</pre></div>
</div>
</div>
<div class="section" id="amazon-ec2-regions">
<h2>Amazon EC2 Regions<a class="headerlink" href="#amazon-ec2-regions" title="Permalink to this headline">¶</a></h2>
<p>StarCluster uses the us-east-1 EC2 region by default. If you wish to
permanently use a different EC2 region you will need to specify the following
additional settings in your <strong>[aws info]</strong> section:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[aws info]</span>
<span class="na">aws_region_name</span> <span class="o">=</span> <span class="s">eu-west-1</span>
<span class="na">aws_region_host</span> <span class="o">=</span> <span class="s">ec2.eu-west-1.amazonaws.com</span>
</pre></div>
</div>
<p>Here <tt class="docutils literal"><span class="pre">aws_region_name</span></tt> is the name of the region you wish to use and
<tt class="docutils literal"><span class="pre">aws_region_host</span></tt> is the region-specific EC2 endpoint host. Below is a table of
EC2 region-specific endpoints:</p>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">aws_region_name</th>
<th class="head">aws_region_host</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>us-east-1</td>
<td>ec2.us-east-1.amazonaws.com</td>
</tr>
<tr><td>us-west-1</td>
<td>ec2.us-west-1.amazonaws.com</td>
</tr>
<tr><td>eu-west-1</td>
<td>ec2.eu-west-1.amazonaws.com</td>
</tr>
<tr><td>ap-southeast-1</td>
<td>ec2.ap-southeast-1.amazonaws.com</td>
</tr>
<tr><td>ap-northeast-1</td>
<td>ec2.ap-northeast-1.amazonaws.com</td>
</tr>
</tbody>
</table>
<p>The above table is only for convenience. In practice you should use the
official <a class="reference external" href="http://docs.amazonwebservices.com/general/latest/gr/rande.html#ec2_region">list from Amazon</a> instead.</p>
<div class="section" id="switching-regions-via-command-line">
<h3>Switching Regions via Command Line<a class="headerlink" href="#switching-regions-via-command-line" title="Permalink to this headline">¶</a></h3>
<p>StarCluster also supports quickly switching between EC2 regions via the command
line without having to change your config. To switch regions at the command
line use the global <em>-r</em> (<em>&#8211;region</em>) option:</p>
<div class="highlight-python"><pre>$ starcluster -r us-west-1 listpublic</pre>
</div>
<p>The above example runs the <strong>listpublic</strong> command in the <tt class="docutils literal"><span class="pre">us-west-1</span></tt> region.
Similarly, you will need to pass the global <em>-r</em> option to all of StarCluster&#8217;s
commands in order to switch regions via the command line.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See also: <a class="reference internal" href="#tips-for-switching-regions"><em>Tips for Switching Regions</em></a></p>
</div>
</div>
</div>
<div class="section" id="amazon-s3-region-specific-endpoints">
<h2>Amazon S3 Region-Specific Endpoints<a class="headerlink" href="#amazon-s3-region-specific-endpoints" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Switching S3 endpoints is usually not necessary. From <a class="reference external" href="http://aws.amazon.com/articles/3912">amazon</a>: Switching to
a region-specific S3 endpoint is completely optional.  The main advantage of
doing so is to reduce the temporary latency you might experience immediately
after creating a bucket in a specific region.  This temporary latency
typically lasts less than one hour.</p>
</div>
<p>StarCluster uses s3.amazonaws.com as the S3 endpoint by default. If you&#8217;d like
to switch S3 endpoints you can do so by specifying an additional
<tt class="docutils literal"><span class="pre">aws_s3_host</span></tt> setting in your <strong>[aws info]</strong> section:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[aws info]</span>
<span class="na">aws_region_name</span> <span class="o">=</span> <span class="s">us-west-1</span>
<span class="na">aws_region_name</span> <span class="o">=</span> <span class="s">ec2.us-west-1.amazonaws.com</span>
<span class="na">aws_s3_host</span> <span class="o">=</span> <span class="s">s3-us-west-1.amazonaws.com</span>
</pre></div>
</div>
<p>Below is a table of S3 region-specific endpoints:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Region</th>
<th class="head">aws_s3_host</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>us-east-1</td>
<td>s3.amazonaws.com</td>
</tr>
<tr><td>us-west-1</td>
<td>s3-us-west-1.amazonaws.com</td>
</tr>
<tr><td>eu-west-1</td>
<td>s3-eu-west-1.amazonaws.com</td>
</tr>
<tr><td>ap-southeast-1</td>
<td>s3-ap-southeast-1.amazonaws.com</td>
</tr>
<tr><td>ap-northeast-1</td>
<td>s3-ap-northeast-1.amazonaws.com</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="amazon-ec2-keypairs">
<h2>Amazon EC2 Keypairs<a class="headerlink" href="#amazon-ec2-keypairs" title="Permalink to this headline">¶</a></h2>
<p>In addition to supplying your <strong>[aws info]</strong> you must also define at least one
<strong>[keypair]</strong> section that represents one of your keypairs on Amazon EC2.
Amazon EC2 keypairs are used by StarCluster to connect and configure your
instances.</p>
<p>You should define a new <strong>[keypair]</strong> section for each Amazon EC2 keypair you
wish to use with StarCluster.  As an example, suppose we have two keypairs on
Amazon EC2 that we wish to use with StarCluster named <tt class="docutils literal"><span class="pre">mykeypair1</span></tt> and
<tt class="docutils literal"><span class="pre">mykeypair2</span></tt> on Amazon.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you do not know the name of your keypair(s), use StarCluster&#8217;s
<strong>listkeypairs</strong> command to obtain a list of your current EC2 keypairs. The
<strong>[keypair]</strong> section name <em>must</em> match the name of the keypair on Amazon
EC2.</p>
</div>
<p>To configure StarCluster for these keypairs we define a <strong>[keypair]</strong> section
for each of them in the configuration file:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[keypair mykeypair1]</span>
<span class="c"># this is the path to your openssh private key for mykeypair4</span>
<span class="na">key_location</span><span class="o">=</span><span class="s">/path/to/your/mykeypair1.rsa</span>

<span class="k">[keypair mykeypair3]</span>
<span class="c"># this is the path to your openssh private key for mykeypair2</span>
<span class="na">key_location</span><span class="o">=</span><span class="s">/path/to/your/mykeypair2.rsa</span>
</pre></div>
</div>
<p>These keypair sections can now be referenced in a <em>cluster template&#8217;s</em>
<strong>keyname</strong> setting as we&#8217;ll <a class="reference internal" href="#defining-cluster-templates"><em>show below</em></a> in
an example <em>cluster template</em>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In order for StarCluster to interact with <em>any</em> instances you have on EC2,
the keypair used to launch those instances <em>must</em> be defined in the
config. You can check what keypairs were used to launch an instance using
StarCluster&#8217;s <strong>listinstances</strong> command or the <a class="reference external" href="http://aws.amazon.com/console">AWS web console</a>.</p>
</div>
</div>
<div class="section" id="defining-cluster-templates">
<span id="id1"></span><h2>Defining Cluster Templates<a class="headerlink" href="#defining-cluster-templates" title="Permalink to this headline">¶</a></h2>
<p>In order to launch StarCluster(s) on Amazon EC2, you must first provide a
<em>cluster template</em> that contains all of the configuration for the cluster. A
<em>cluster template</em> is simply a <strong>[cluster]</strong> section in the config. Once a
<em>cluster template</em> has been defined, you can launch multiple StarClusters from
it. Below is an example <em>cluster template</em> called <tt class="docutils literal"><span class="pre">smallcluster</span></tt> which
defines a 2-node cluster using <tt class="docutils literal"><span class="pre">m1.small</span></tt> EC2 instances and the mykeypair1
keypair we defined above.</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="c"># Sections starting with &quot;cluster&quot; define your cluster templates</span>
<span class="c"># The section name is the name you give to your cluster template e.g.:</span>
<span class="k">[cluster smallcluster]</span>
<span class="c"># change this to the name of one of the keypair sections defined above</span>
<span class="c"># (see the EC2 getting started guide tutorial on using ec2-add-keypair to learn</span>
<span class="c"># how to create new keypairs)</span>
<span class="na">keyname</span> <span class="o">=</span> <span class="s">mykeypair1</span>

<span class="c"># number of ec2 instances to launch</span>
<span class="na">cluster_size</span> <span class="o">=</span> <span class="s">2</span>

<span class="c"># create the following user on the cluster</span>
<span class="na">cluster_user</span> <span class="o">=</span> <span class="s">sgeadmin</span>
<span class="c"># optionally specify shell (defaults to bash)</span>
<span class="c"># options: bash, zsh, csh, ksh, tcsh</span>
<span class="na">cluster_shell</span> <span class="o">=</span> <span class="s">bash</span>

<span class="c"># AMI for master node. Defaults to NODE_IMAGE_ID if not specified</span>
<span class="c"># The base i386 StarCluster AMI is ami-0330d16a</span>
<span class="c"># The base x86_64 StarCluster AMI is ami-0f30d166</span>
<span class="na">master_image_id</span> <span class="o">=</span> <span class="s">ami-0330d16a</span>

<span class="c"># instance type for master node.</span>
<span class="c"># defaults to NODE_INSTANCE_TYPE if not specified</span>
<span class="na">master_instance_type</span> <span class="o">=</span> <span class="s">m1.small</span>

<span class="c"># AMI for worker nodes.</span>
<span class="c"># Also used for the master node if MASTER_IMAGE_ID is not specified</span>
<span class="c"># The base i386 StarCluster AMI is ami-0330d16a</span>
<span class="c"># The base x86_64 StarCluster AMI is ami-0f30d166</span>
<span class="na">node_image_id</span> <span class="o">=</span> <span class="s">ami-0330d16a</span>

<span class="c"># instance type for worker nodes. Also used for the master node if</span>
<span class="c"># MASTER_INSTANCE_TYPE is not specified</span>
<span class="na">node_instance_type</span> <span class="o">=</span> <span class="s">m1.small</span>

<span class="c"># availability zone</span>
<span class="na">availability_zone</span> <span class="o">=</span> <span class="s">us-east-1c</span>
</pre></div>
</div>
</div>
<div class="section" id="defining-multiple-cluster-templates">
<h2>Defining Multiple Cluster Templates<a class="headerlink" href="#defining-multiple-cluster-templates" title="Permalink to this headline">¶</a></h2>
<p>You are not limited to defining just one <em>cluster template</em>. StarCluster allows
you to define multiple independent cluster templates by simply creating a new
<strong>[cluster]</strong> section with all of the same settings (different values of
course).</p>
<p>However, you may find that defining new <em>cluster templates</em> is some what
repetitive with respect to redefining the same settings over and over. To
remedy this situation, StarCluster allows <em>cluster templates</em> to extend other
<em>cluster templates</em>:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[cluster mediumcluster]</span>
<span class="c"># Declares that this cluster uses smallcluster&#39;s settings as defaults</span>
<span class="na">extends</span> <span class="o">=</span> <span class="s">smallcluster</span>
<span class="c"># this rest of this section is identical to smallcluster except for the following settings:</span>
<span class="na">keyname</span> <span class="o">=</span> <span class="s">mykeypair2</span>
<span class="na">node_instance_type</span> <span class="o">=</span> <span class="s">c1.xlarge</span>
<span class="na">cluster_size</span> <span class="o">=</span> <span class="s">8</span>
<span class="na">volumes</span> <span class="o">=</span> <span class="s">biodata2</span>
</pre></div>
</div>
<p>In the example above, <tt class="docutils literal"><span class="pre">mediumcluster</span></tt> will use all of <tt class="docutils literal"><span class="pre">smallcluster</span></tt>&#8216;s
settings as defaults. All other settings in the <tt class="docutils literal"><span class="pre">mediumcluster</span></tt> template
override these defaults. For the <tt class="docutils literal"><span class="pre">mediumcluster</span></tt> template above, we can see
that <tt class="docutils literal"><span class="pre">mediumcluster</span></tt> is the same as <tt class="docutils literal"><span class="pre">smallcluster</span></tt> except for its
<tt class="docutils literal"><span class="pre">keyname</span></tt>, <tt class="docutils literal"><span class="pre">node_instance_type</span></tt>, <tt class="docutils literal"><span class="pre">cluster_size</span></tt>, and <tt class="docutils literal"><span class="pre">volumes</span></tt>
settings.</p>
</div>
<div class="section" id="setting-the-default-cluster-template">
<h2>Setting the Default Cluster Template<a class="headerlink" href="#setting-the-default-cluster-template" title="Permalink to this headline">¶</a></h2>
<p>StarCluster allows you to specify a default <em>cluster template</em> to be used when
using the <strong>start</strong> command. This is useful for users that mostly use a single
<em>cluster template</em>. To define a default <em>cluster template</em>, define a
<strong>[global]</strong> section and configure the <strong>default_template</strong> setting:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[global]</span>
<span class="na">default_template</span> <span class="o">=</span> <span class="s">smallcluster</span>
</pre></div>
</div>
<p>The above example sets the <tt class="docutils literal"><span class="pre">smallcluster</span></tt> <em>cluster template</em> as the default.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you do not specify a default <em>cluster template</em> in the config you will
have to specify one at the command line using the <tt class="docutils literal"><span class="pre">--cluster-template</span></tt>
(<tt class="docutils literal"><span class="pre">-c</span></tt>) option.</p>
</div>
</div>
<div class="section" id="amazon-ebs-volumes">
<h2>Amazon EBS Volumes<a class="headerlink" href="#amazon-ebs-volumes" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Using EBS volumes with StarCluster is completely optional, however, if you
do not use an EBS volume with StarCluster, any data that you wish to keep
around after shutdown must be manually copied somewhere outside of the
cluster (e.g. download the data locally or move it to S3 manually).  This is
because local instance storage on EC2 is ephemeral and does not persist
after an instance has been terminated. The advantage of using EBS volumes
with StarCluster is that when you shutdown a particular cluster, any data
saved on an EBS volume attached to that cluster will be available the next
time the volume is attached to another cluster or EC2 instance.</p>
</div>
<p>StarCluster has the ability to use Amazon EBS volumes to provide persistent
data storage on a given cluster. If you wish to use EBS volumes with
StarCluster you will need to define a <strong>[volume]</strong> section in the configuration
file for each volume you wish to use with StarCluster and then add this
<strong>[volume]</strong> section name to a <em>cluster template</em>&#8216;s <strong>volumes</strong> setting.</p>
<p>To configure an EBS volume for use with Starcluster, define a new <strong>[volume]</strong>
section for each EBS volume. For example, suppose we have two volumes we&#8217;d like
to use: <tt class="docutils literal"><span class="pre">vol-c9999999</span></tt> and <tt class="docutils literal"><span class="pre">vol-c8888888</span></tt>. Below is an example configuration for
these volumes:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[volume myvoldata1]</span>
<span class="c"># this is the Amazon EBS volume id</span>
<span class="na">volume_id</span><span class="o">=</span><span class="s">vol-c9999999</span>
<span class="c"># the path to mount this EBS volume on</span>
<span class="c"># (this path will also be nfs shared to all nodes in the cluster)</span>
<span class="na">mount_path</span><span class="o">=</span><span class="s">/home</span>

<span class="k">[volume myvoldata2]</span>
<span class="na">volume_id</span><span class="o">=</span><span class="s">vol-c8888888</span>
<span class="na">mount_path</span><span class="o">=</span><span class="s">/scratch</span>

<span class="k">[volume myvoldata2-alternate]</span>
<span class="c"># same volume as myvoldata2 but uses 2nd partition instead of 1st</span>
<span class="na">volume_id</span><span class="o">=</span><span class="s">vol-c8888888</span>
<span class="na">mount_path</span><span class="o">=</span><span class="s">/scratch2</span>
<span class="na">partition</span><span class="o">=</span><span class="s">2</span>
</pre></div>
</div>
<p>StarCluster by default attempts to mount either the entire drive or the first
partition in the volume onto the master node. It is possible to use a different
partition by configuring a <strong>partition</strong> setting in your <strong>[volume]</strong> section
as in the <tt class="docutils literal"><span class="pre">myvoldata2-alternate</span></tt> example above.</p>
<p>After defining one or more <strong>[volume]</strong> sections, you then need to add them to
a <em>cluster template</em> in order to use them. To do this, specify the <strong>[volume]</strong>
section name(s) in the <strong>volumes</strong> setting in one or more of your <em>cluster
templates</em>. For example, to use both <tt class="docutils literal"><span class="pre">myvoldata1</span></tt> and <tt class="docutils literal"><span class="pre">myvoldata2</span></tt> from the
above example in a <em>cluster template</em> called <tt class="docutils literal"><span class="pre">smallcluster</span></tt>:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[cluster smallcluster]</span>
<span class="na">volumes</span> <span class="o">=</span> <span class="s">myvoldata1, myvoldata2</span>
</pre></div>
</div>
<p>Now any time a cluster is started using the <tt class="docutils literal"><span class="pre">smallcluster</span></tt> template,
<tt class="docutils literal"><span class="pre">myvoldata1</span></tt> will be mounted to <tt class="docutils literal"><span class="pre">/home</span></tt> on the master, <tt class="docutils literal"><span class="pre">myvoldata2</span></tt> will
be mounted to <tt class="docutils literal"><span class="pre">/scratch</span></tt> on the master, and both <tt class="docutils literal"><span class="pre">/home</span></tt> and <tt class="docutils literal"><span class="pre">/scratch</span></tt>
will be NFS-shared to the rest of the cluster nodes.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See the <a class="reference internal" href="volumes.html"><em>Using EBS Volumes for Persistent Storage</em></a> documentation to learn how to use StarCluster to
easily create, format, and configure new EBS volumes.</p>
</div>
</div>
<div class="section" id="amazon-security-group-permissions">
<span id="config-permissions"></span><h2>Amazon Security Group Permissions<a class="headerlink" href="#amazon-security-group-permissions" title="Permalink to this headline">¶</a></h2>
<p>When starting a cluster each node is added to a common security group. This
security group is created by StarCluster and has a name of the form
<tt class="docutils literal"><span class="pre">&#64;sc-&lt;cluster_tag&gt;</span></tt> where <tt class="docutils literal"><span class="pre">&lt;cluster_tag&gt;</span></tt> is the name you provided to the
<strong>start</strong> command.</p>
<p>By default, StarCluster adds a permission to this security group that allows
access to port 22 (ssh) from all IP addresses. This is needed so that
StarCluster can connect to the instances and configure them properly. If you
want to specify additional security group permissions to be set after starting
your cluster you can do so in the config by creating one or more
<strong>[permission]</strong> sections. These sections can then be specified in one or more
cluster templates. Here&#8217;s an example that opens port 80 (web server) to the
world for the <tt class="docutils literal"><span class="pre">smallcluster</span></tt> template:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[permission www]</span>
<span class="c"># open port 80 to the world</span>
<span class="na">from_port</span> <span class="o">=</span> <span class="s">80</span>
<span class="na">to_port</span> <span class="o">=</span> <span class="s">80</span>

<span class="k">[permission ftp]</span>
<span class="c"># open port 21 only to a single ip</span>
<span class="na">from_port</span> <span class="o">=</span> <span class="s">21</span>
<span class="na">to_port</span> <span class="o">=</span> <span class="s">21</span>
<span class="na">cidr_ip</span> <span class="o">=</span> <span class="s">66.249.90.104/32</span>

<span class="k">[permission myrange]</span>
<span class="c"># open all ports in the range 8000-9000 to the world</span>
<span class="na">from_port</span> <span class="o">=</span> <span class="s">8000</span>
<span class="na">to_port</span> <span class="o">=</span> <span class="s">9000</span>

<span class="k">[cluster smallcluster]</span>
<span class="na">permissions</span> <span class="o">=</span> <span class="s">www, ftp, myrange</span>
</pre></div>
</div>
<p>A permission section specifies a port range to open to a given network range
(cidr_ip). By default, the network range is set to <tt class="docutils literal"><span class="pre">0.0.0.0/0</span></tt> which
represents any ip address (ie the &#8220;world&#8221;). In the above example, we created a
permission section called <tt class="docutils literal"><span class="pre">www</span></tt> that opens port 80 to the &#8220;world&#8221; by setting
the from_port and to_port both to be 80.  You can restrict the ip addresses
that the rule applies to by specifying the proper cidr_ip setting. In the above
example, the <tt class="docutils literal"><span class="pre">ftp</span></tt> permission specifies that only <tt class="docutils literal"><span class="pre">66.249.90.104</span></tt> ip
address can access port 21 on the cluster nodes.</p>
</div>
<div class="section" id="defining-plugins">
<h2>Defining Plugins<a class="headerlink" href="#defining-plugins" title="Permalink to this headline">¶</a></h2>
<p>StarCluster also has support for user contributed plugins (see <a class="reference internal" href="plugins.html"><em>StarCluster Plugin System</em></a>).
To configure a <em>cluster template</em> to use a particular plugin, we must first
create a plugin section for each plugin we wish to use. For example, suppose we
have two plugins <tt class="docutils literal"><span class="pre">myplug1</span></tt> and <tt class="docutils literal"><span class="pre">myplug2</span></tt>:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[plugin myplug1]</span>
<span class="na">setup_class</span> <span class="o">=</span> <span class="s">myplug1.SetupClass</span>
<span class="na">myplug1_arg_one</span> <span class="o">=</span> <span class="s">2</span>

<span class="k">[plugin myplug2]</span>
<span class="na">setup_class</span> <span class="o">=</span> <span class="s">myplug2.SetupClass</span>
<span class="na">myplug2_arg_one</span> <span class="o">=</span> <span class="s">3</span>
</pre></div>
</div>
<p>In this example, <tt class="docutils literal"><span class="pre">myplug1_arg_one</span></tt> and <tt class="docutils literal"><span class="pre">myplug2_arg_one</span></tt> are arguments to
the plugin&#8217;s <em>setup_class</em>. The argument names were made up for this example.
The names of a plugin&#8217;s arguments in general depends on the plugin being used.
Some plugins may not even have arguments.</p>
<p>After you&#8217;ve defined some <strong>[plugin]</strong> sections, you can reference them in a
<em>cluster template</em> like so:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[cluster mediumcluster]</span>
<span class="c"># Declares that this cluster uses smallcluster&#39;s settings as defaults</span>
<span class="na">extends</span> <span class="o">=</span> <span class="s">smallcluster</span>
<span class="c"># the rest  is identical to smallcluster except for the following settings:</span>
<span class="na">keyname</span> <span class="o">=</span> <span class="s">mykeypair2</span>
<span class="na">node_instance_type</span> <span class="o">=</span> <span class="s">c1.xlarge</span>
<span class="na">cluster_size</span> <span class="o">=</span> <span class="s">8</span>
<span class="na">volumes</span> <span class="o">=</span> <span class="s">biodata2</span>
<span class="na">plugins</span> <span class="o">=</span> <span class="s">myplug1, myplug2</span>
</pre></div>
</div>
<p>Notice the added <tt class="docutils literal"><span class="pre">plugins</span></tt> setting for the <tt class="docutils literal"><span class="pre">mediumcluster</span></tt> template. This
setting instructs StarCluster to first run the <tt class="docutils literal"><span class="pre">myplug1</span></tt> plugin and then the
<tt class="docutils literal"><span class="pre">myplug2</span></tt> plugin afterwards. Reversing <tt class="docutils literal"><span class="pre">myplug1</span></tt>/<tt class="docutils literal"><span class="pre">myplug2</span></tt> in the plugins
setting in the above example would reverse the order of execution.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">Learn more about the <a class="reference internal" href="plugins.html"><em>StarCluster Plugin System</em></a></p>
</div>
</div>
<div class="section" id="splitting-the-config-into-multiple-files">
<span id="splitting-the-config"></span><h2>Splitting the Config into Multiple Files<a class="headerlink" href="#splitting-the-config-into-multiple-files" title="Permalink to this headline">¶</a></h2>
<p>In some cases you may wish to split your configuration file into separate files
for convenience. For example, you may wish to organize all keypairs, cluster
templates, permissions, volumes, etc. into separate files to make it easier to
access the relevant settings without browsing the entire config all at once. To
do this, simply create a new set of files and put the relevant config sections
into the files:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The following list of files are just examples. You are free to create any
number of files, name them anything you want, and distribute any of the
sections in the config to these files in any way you see fit. The only
exception is that the <strong>[global]</strong> section <em>must</em> live in either the
default config <tt class="docutils literal"><span class="pre">$HOME/.starcluster/config</span></tt> or the config specified by the
global <tt class="docutils literal"><span class="pre">--config</span></tt> (<tt class="docutils literal"><span class="pre">-c</span></tt>) command line option.</p>
</div>
<p><strong>File</strong>: <tt class="docutils literal"><span class="pre">$HOME/.starcluster/awskeys</span></tt></p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[aws info]</span>
<span class="na">aws_access_key_id</span> <span class="o">=</span> <span class="s">#your_aws_access_key_id</span>
<span class="na">aws_secret_access_key</span> <span class="o">=</span> <span class="s">#your_secret_access_key</span>

<span class="k">[key mykey1]</span>
<span class="na">key_location</span><span class="o">=</span><span class="s">/path/to/key1</span>

<span class="k">[key mykey2]</span>
<span class="na">key_location</span><span class="o">=</span><span class="s">/path/to/key2</span>
</pre></div>
</div>
<p><strong>File</strong>: <tt class="docutils literal"><span class="pre">$HOME/.starcluster/clusters</span></tt></p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[cluster smallcluster]</span>
<span class="na">cluster_size</span> <span class="o">=</span> <span class="s">5</span>
<span class="na">keyname</span> <span class="o">=</span> <span class="s">mykey1</span>
<span class="na">node_image_id</span> <span class="o">=</span> <span class="s">ami-99999999</span>

<span class="k">[cluster largecluster]</span>
<span class="na">extends</span> <span class="o">=</span> <span class="s">smallcluster</span>
<span class="na">cluster_size</span> <span class="o">=</span> <span class="s">50</span>
<span class="na">node_image_id</span> <span class="o">=</span> <span class="s">ami-88888888</span>
</pre></div>
</div>
<p><strong>File</strong>: <tt class="docutils literal"><span class="pre">$HOME/.starcluster/vols</span></tt></p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[key mykey]</span>
<span class="na">key_location</span><span class="o">=</span><span class="s">/path/to/key</span>
</pre></div>
</div>
<p>Then define the files in the config using the <em>include</em> setting in the
<strong>[global]</strong> section of the default StarCluster config
(<tt class="docutils literal"><span class="pre">~/.starcluster/config</span></tt>):</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[global]</span>
<span class="na">include</span> <span class="o">=</span> <span class="s">~/.starcluster/awskeys, ~/.starcluster/clusters, ~/.starcluster/vols</span>
</pre></div>
</div>
<div class="section" id="loading-configs-from-the-web">
<h3>Loading Configs from the Web<a class="headerlink" href="#loading-configs-from-the-web" title="Permalink to this headline">¶</a></h3>
<p>The files in the above example could also be loaded from the web. Let&#8217;s say
we&#8217;ve hosted, for example, the cluster templates in <tt class="docutils literal"><span class="pre">~/.starcluster/clusters</span></tt>
on an http server at the url: <tt class="docutils literal"><span class="pre">http://myhost/cluster.cfg</span></tt>. To load these
cluster templates from the web we just add the web address(es) to the list of
includes:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[global]</span>
<span class="na">include</span> <span class="o">=</span> <span class="s">~/.starcluster/keys, http://myhost/cluster.cfg, ~/.starcluster/vols</span>
</pre></div>
</div>
<p>Notice in the above example we only load the cluster templates from the web. The
aws credentials, keypairs, volumes, etc. will all be loaded locally in this case.</p>
<p>StarCluster also supports loading the default config containing the
<strong>[global]</strong> section from the web:</p>
<div class="highlight-python"><pre>$ starcluster -c http://myhost/sc.cfg listvolumes</pre>
</div>
<p>If you choose to load the default config from the web it&#8217;s recommended that
only a <strong>[global]</strong> section is defined that includes configs either locally,
from the web, or both. It&#8217;s also important</p>
</div>
</div>
<div class="section" id="tips-for-switching-regions">
<span id="id2"></span><h2>Tips for Switching Regions<a class="headerlink" href="#tips-for-switching-regions" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All examples in this section use <tt class="docutils literal"><span class="pre">us-west-1</span></tt> as the <em>target</em> region. You
should replace <tt class="docutils literal"><span class="pre">us-west-1</span></tt> in these examples with your target region.
Also, you do not need to pass the global <tt class="docutils literal"><span class="pre">--region</span></tt> (<tt class="docutils literal"><span class="pre">-r</span></tt>) flag if
you&#8217;ve configured your <strong>[aws info]</strong> section to permanently use the target
region.</p>
</div>
<p>In general, keypairs, AMIs, and EBS Volumes are all region-specific and must be
recreated or migrated before you can use them in an alternate region. To create
a new keypair in the target region, use the <strong>createkey</strong> command while passing
the global <tt class="docutils literal"><span class="pre">--region</span></tt> (<tt class="docutils literal"><span class="pre">-r</span></tt>) flag:</p>
<div class="highlight-python"><pre>$ starcluster -r us-west-1 createkey -o ~/.ssh/uswestkey.rsa myuswestkey</pre>
</div>
<p>The above example creates a new keypair called <em>myuswestkey</em> in the
<tt class="docutils literal"><span class="pre">us-west-1</span></tt> region and stores the key file in <em>~/.ssh/uswestkey.rsa</em>. Once
you&#8217;ve created a new keypair in the target region you must define the new
keypair in the config. For the above <tt class="docutils literal"><span class="pre">us-west-1</span></tt> example:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[key myuswestkey]</span>
<span class="na">KEY_LOCATION</span> <span class="o">=</span> <span class="s">~/.ssh/uswestkey.rsa</span>
</pre></div>
</div>
<p>Similarly you can obtain a list of available StarCluster AMIs in the target
region using:</p>
<div class="highlight-python"><pre>$ starcluster -r us-west-1 listpublic</pre>
</div>
<p>Finally, to (optionally) create new EBS volumes in the target region:</p>
<div class="highlight-python"><pre>$ starcluster -r us-west-1 createvolume -n myuswestvol 10 us-west-1a</pre>
</div>
<p>Given that a <em>cluster template</em> references these region-specific items you must
either override the relevant settings at the command line using the <em>start</em>
command&#8217;s option flags or create separate <em>cluster templates</em> configured for
each region you use. To override the releveant settings at the command line:</p>
<div class="highlight-python"><pre>$ starcluster -r us-west-1 start -k myuswestkey -n ami-99999999</pre>
</div>
<p>If you often use multiple regions you will most likely want to create separate
<em>cluster templates</em> for each region by extending a common template,
<em>smallcluster</em> for examle, and overriding the relevant settings:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[key myuswestkey]</span>
<span class="na">KEY_LOCATION</span> <span class="o">=</span> <span class="s">~/.ssh/uswestkey.rsa</span>

<span class="k">[volume myuswestvol]</span>
<span class="na">VOLUME_ID</span> <span class="o">=</span> <span class="s">vol-99999999</span>
<span class="na">MOUNT_PATH</span> <span class="o">=</span> <span class="s">/data</span>

<span class="k">[cluster uswest-cluster]</span>
<span class="na">EXTENDS</span> <span class="o">=</span> <span class="s">smallcluster</span>
<span class="na">KEYNAME</span> <span class="o">=</span> <span class="s">uswestkey</span>
<span class="c"># The AMI must live in the target region!</span>
<span class="na">NODE_IMAGE_ID</span> <span class="o">=</span> <span class="s">ami-9999999</span>
<span class="na">VOLUMES</span> <span class="o">=</span> <span class="s">myuswestvol</span>
</pre></div>
</div>
<p>The above example extends the default cluster template <em>smallcluster</em> and
overrides the relevant settings needed for the target region.</p>
<p>With the above template defined you can use the <em>start</em> command&#8217;s <em>-c</em>
(<em>&#8211;cluster-template</em>) option to use the new region-specific template to easily
create a new cluster in the target region:</p>
<div class="highlight-python"><pre>$ starcluster -r us-west-1 start -c uswest-cluster mywestcluster</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">StarCluster Configuration File</a><ul>
<li><a class="reference internal" href="#creating-the-configuration-file">Creating the configuration file</a><ul>
<li><a class="reference internal" href="#storing-the-config-in-an-alternate-location">Storing the config in an alternate location</a></li>
<li><a class="reference internal" href="#loading-the-config-from-the-web">Loading the config from the web</a></li>
</ul>
</li>
<li><a class="reference internal" href="#amazon-web-services-credentials">Amazon Web Services Credentials</a></li>
<li><a class="reference internal" href="#amazon-ec2-regions">Amazon EC2 Regions</a><ul>
<li><a class="reference internal" href="#switching-regions-via-command-line">Switching Regions via Command Line</a></li>
</ul>
</li>
<li><a class="reference internal" href="#amazon-s3-region-specific-endpoints">Amazon S3 Region-Specific Endpoints</a></li>
<li><a class="reference internal" href="#amazon-ec2-keypairs">Amazon EC2 Keypairs</a></li>
<li><a class="reference internal" href="#defining-cluster-templates">Defining Cluster Templates</a></li>
<li><a class="reference internal" href="#defining-multiple-cluster-templates">Defining Multiple Cluster Templates</a></li>
<li><a class="reference internal" href="#setting-the-default-cluster-template">Setting the Default Cluster Template</a></li>
<li><a class="reference internal" href="#amazon-ebs-volumes">Amazon EBS Volumes</a></li>
<li><a class="reference internal" href="#amazon-security-group-permissions">Amazon Security Group Permissions</a></li>
<li><a class="reference internal" href="#defining-plugins">Defining Plugins</a></li>
<li><a class="reference internal" href="#splitting-the-config-into-multiple-files">Splitting the Config into Multiple Files</a><ul>
<li><a class="reference internal" href="#loading-configs-from-the-web">Loading Configs from the Web</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tips-for-switching-regions">Tips for Switching Regions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">StarCluster User Manual</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="volumes.html"
                        title="next chapter">Using EBS Volumes for Persistent Storage</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="volumes.html" title="Using EBS Volumes for Persistent Storage"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="StarCluster User Manual"
             >previous</a> |</li>
    	<li><a href="../index.html">Home</a> &raquo;</li>
          <li><a href="../contents.html" >Master Table of Contents</a> &raquo;</li>
          <li><a href="index.html" >StarCluster User Manual</a> &raquo;</li> 
      </ul>
    </div>


    <div class="footer">
        &copy; Copyright 2011, Software Tools for Academics and Researchers.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>


<script type="text/javascript">
//<![CDATA[
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    //]]>
    </script><script type="text/javascript">
//<![CDATA[
    try{
        var pageTracker = _gat._getTracker("UA-1048253-12");
        pageTracker._trackPageview();
    } catch(err) {}
    //]]>
    </script>

  </body>
</html>