<script type="text/javascript">
function status_icon_span(st) {
    status_attrs = {
        pass: {
            color: "black",
            background_color: "lawngreen",
            symbol: "&#10003;"
        },
        fail: {
            color: "black",
            background_color: "red",
            symbol: "&#10007;"
        },
        unknown: {
            color: "black",
            background_color: "lightgray",
            symbol: "?"
        },
        increase: {
            color: "black",
            background_color: "cornflowerblue",
            symbol: "&#11014;"
        },
        decrease: {
            color: "black",
            background_color: "#EE6464",
            symbol: "&#11015;"
        },
        superincrease: {
            color: "black",
            background_color: "blue",
            symbol: "&#11014;<span style=\"margin: 0 0.2em 0 -0.2em\">!</span>"
        }
    };

    attr = status_attrs[st];
    span = "<span style=\"display: inline-block; width: 25px;" +
           "height: 25px; border-radius: 25px; font-size: 150%;" +
           "color: " + attr.color + "; " +
           "background-color: " + attr.background_color + ";\">" +
           attr.symbol + "</span>";

    return span
}

function build_td_elem(name, data) {
    var a = name.split(",");
    var tdElem = document.createElement("td");
    var tdTxtNode = null;
    var id = a[0];

    for (var n = 1; n < a.length; n++) {
        if (a[n].search("href:") == 0) {
            var aElem = document.createElement("a");
            var pattern = a[n].replace("href:", "");
            aElem.setAttribute("href", pattern.replace("%s", data[id]));
            tdTxtNode = document.createTextNode(data[id]);
            aElem.appendChild(tdTxtNode);
            tdElem.appendChild(aElem);
        }
        else if (a[n].search("center") == 0) {
            tdElem.setAttribute("align", "center");
        }
        else if (a[n].search("status_icon") == 0) {
            tdElem.innerHTML = status_icon_span(data[id]);
            tdTxtNode = 0;
        }
    }

    if (tdTxtNode == null)
        tdElem.appendChild(document.createTextNode(data[id]));

    return tdElem;
}

/*
 * Update a table with new data
 */
function update_table(table_id, tbody_id, data, vars) {
    var table = document.getElementById(table_id);
    var body = document.getElementById(tbody_id);

    // Create variable to hold the new table body
    var newBody = document.createElement("tbody");
    newBody.id = tbody_id;

    // Create a document fragment to hold body contents
    var docFragment = document.createDocumentFragment();

    // Fill in the the doc fragment
    for (var i = 0; i < data.length; i++) {
        var trElem = document.createElement("tr");
        for (var v = 0; v < vars.length; v++) {
            var tdElem = build_td_elem(vars[v], data[i]);
            trElem.appendChild(tdElem);
        }
        docFragment.appendChild(trElem);
    }

    // Use the new table body
    newBody.appendChild(docFragment);
    table.replaceChild(newBody, body);
}
</script>
