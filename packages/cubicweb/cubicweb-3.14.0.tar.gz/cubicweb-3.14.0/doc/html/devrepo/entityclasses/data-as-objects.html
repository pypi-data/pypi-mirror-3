<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4.1. Access to persistent data &mdash; CubicWeb 3.13.5</title>
    <link rel="stylesheet" href="../../_static/lglb-sphinx-doc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.13.5',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="CubicWeb 3.13.5" href="../../index.html" />
    <link rel="up" title="4. Data as objects" href="index.html" />
    <link rel="next" title="4.5. Loaded attributes and default sorting management" href="load-sort.html" />
    <link rel="prev" title="4. Data as objects" href="index.html" /> 
  </head>
  <body>
<div class="header">
 <a href="http://www.cubicweb.org">
  <img alt="cubicweb logo" src="../../_static/cubicweb.png"/>
 </a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="load-sort.html" title="4.5. Loaded attributes and default sorting management"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="4. Data as objects"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">CubicWeb 3.13.5</a> &raquo;</li>
          <li><a href="../index.html" >Repository development</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">4. Data as objects</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">4.1. Access to persistent data</a></li>
<li><a class="reference external" href="#the-anyentity-class">4.2. The <tt class="docutils literal"><span class="pre">AnyEntity</span></tt> class</a></li>
<li><a class="reference external" href="#inheritance">4.3. Inheritance</a></li>
<li><a class="reference external" href="#application-logic">4.4. Application logic</a></li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="index.html"
                                  title="previous chapter">4. Data as objects</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="load-sort.html"
                                  title="next chapter">4.5. Loaded attributes and default sorting management</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../_sources/devrepo/entityclasses/data-as-objects.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="access-to-persistent-data">
<h1>4.1. Access to persistent data<a class="headerlink" href="#access-to-persistent-data" title="Permalink to this headline">¶</a></h1>
<p>Python-level access to persistent data is provided by the
<tt class="xref docutils literal"><span class="pre">Entity</span></tt> class.</p>
<p>An entity class is bound to a schema entity type. Descriptors are added when
classes are registered in order to initialize the class according to its schema:</p>
<ul class="simple">
<li>the attributes defined in the schema appear as attributes of these classes</li>
<li>the relations defined in the schema appear as attributes of these classes,
but are lists of instances</li>
</ul>
<p><cite>Formatting and output generation</cite>:</p>
<ul class="simple">
<li><cite>view(__vid, __registry=&#8217;views&#8217;, **kwargs)</cite>, applies the given view to the entity
(and returns an unicode string)</li>
<li><cite>absolute_url(*args, **kwargs)</cite>, returns an absolute URL including the base-url</li>
<li><cite>rest_path()</cite>, returns a relative REST URL to get the entity</li>
<li><cite>printable_value(attr, value=_marker, attrtype=None, format=&#8217;text/html&#8217;, displaytime=True)</cite>,
returns a string enabling the display of an attribute value in a given format
(the value is automatically recovered if necessary)</li>
</ul>
<p><cite>Data handling</cite>:</p>
<ul class="simple">
<li><cite>as_rset()</cite>, converts the entity into an equivalent result set simulating the
request <cite>Any X WHERE X eid _eid_</cite></li>
<li><cite>complete(skip_bytes=True)</cite>, executes a request that recovers at
once all the missing attributes of an entity</li>
<li><cite>get_value(name)</cite>, returns the value associated to the attribute name given
in parameter</li>
<li><cite>related(rtype, role=&#8217;subject&#8217;, limit=None, entities=False)</cite>,
returns a list of entities related to the current entity by the
relation given in parameter</li>
<li><cite>unrelated(rtype, targettype, role=&#8217;subject&#8217;, limit=None)</cite>,
returns a result set corresponding to the entities not (yet)
related to the current entity by the relation given in parameter
and satisfying its constraints</li>
<li><cite>set_attributes(**kwargs)</cite>, updates the attributes list with the corresponding
values given named parameters</li>
<li><cite>set_relations(**kwargs)</cite>, add relations to the given object. To
set a relation where this entity is the object of the relation,
use <cite>reverse_&lt;relation&gt;</cite> as argument name.  Values may be an
entity, a list of entities, or None (meaning that all relations of
the given type from or to this object should be deleted).</li>
<li><cite>copy_relations(ceid)</cite>, copies the relations of the entities having the eid
given in the parameters on the current entity</li>
<li><cite>delete()</cite> allows to delete the entity</li>
</ul>
</div>
<div class="section" id="the-anyentity-class">
<h1>4.2. The <tt class="xref docutils literal"><span class="pre">AnyEntity</span></tt> class<a class="headerlink" href="#the-anyentity-class" title="Permalink to this headline">¶</a></h1>
<p>To provide a specific behavior for each entity, we can define a class
inheriting from <cite>cubicweb.entities.AnyEntity</cite>. In general, we define this class
in <cite>mycube.entities</cite> module (or in a submodule if we want to split code among
multiple files) so that it will be available on both server and client side.</p>
<p>The class <cite>AnyEntity</cite> is a sub-class of Entity that add methods to it,
and helps specializing (by further subclassing) the handling of a
given entity type.</p>
<p>Most methods defined for <cite>AnyEntity</cite>, in addition to <cite>Entity</cite>, add
support for the <a class="reference external" href="http://dublincore.org/">Dublin Core</a> metadata.</p>
<p><cite>Standard meta-data (Dublin Core)</cite>:</p>
<ul class="simple">
<li><cite>dc_title()</cite>, returns a unicode string corresponding to the
meta-data <cite>Title</cite> (used by default is the first non-meta attribute
of the entity schema)</li>
<li><cite>dc_long_title()</cite>, same as dc_title but can return a more
detailed title</li>
<li><cite>dc_description(format=&#8217;text/plain&#8217;)</cite>, returns a unicode string
corresponding to the meta-data <cite>Description</cite> (looks for a
description attribute by default)</li>
<li><cite>dc_authors()</cite>, returns a unicode string corresponding to the meta-data
<cite>Authors</cite> (owners by default)</li>
<li><cite>dc_creator()</cite>, returns a unicode string corresponding to the
creator of the entity</li>
<li><cite>dc_date(date_format=None)</cite>, returns a unicode string corresponding to
the meta-data <cite>Date</cite> (update date by default)</li>
<li><cite>dc_type(form=&#8217;&#8216;)</cite>, returns a string to display the entity type by
specifying the preferred form (<cite>plural</cite> for a plural form)</li>
<li><cite>dc_language()</cite>, returns the language used by the entity</li>
</ul>
<p><cite>Misc methods</cite>:</p>
<ul class="simple">
<li><cite>after_deletion_path</cite>, return (path, parameters) which should be
used as redirect information when this entity is being deleted</li>
<li><cite>pre_web_edit</cite>, callback called by the web editcontroller when an
entity will be created/modified, to let a chance to do some entity
specific stuff (does nothing by default)</li>
</ul>
</div>
<div class="section" id="inheritance">
<h1>4.3. Inheritance<a class="headerlink" href="#inheritance" title="Permalink to this headline">¶</a></h1>
<p>When describing a data model, entities can inherit from other entities as is
common in object-oriented programming.</p>
<p>You have the possibility to redefine whatever pleases you, as follow:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cubes.OTHER_CUBE</span> <span class="kn">import</span> <span class="n">entities</span>

<span class="k">class</span> <span class="nc">EntityExample</span><span class="p">(</span><span class="n">entities</span><span class="o">.</span><span class="n">EntityExample</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">dc_long_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
</pre></div>
</div>
<p>The most specific entity definition will always the one used by the
ORM. For instance, the new EntityExample above in mycube replaces the
one in OTHER_CUBE. These types are stored in the <cite>etype</cite> section of
the <cite>vregistry</cite>.</p>
<p>Notice this is different than yams schema inheritance, which is an
experimental undocumented feature.</p>
</div>
<div class="section" id="application-logic">
<h1>4.4. Application logic<a class="headerlink" href="#application-logic" title="Permalink to this headline">¶</a></h1>
<p>While a lot of custom behaviour and application logic can be
implemented using entity classes, the programmer must be aware that
adding new attributes and method on an entity class adds may shadow
schema-level attribute or relation definitions.</p>
<p>To keep entities clean (mostly data structures plus a few universal
methods such as listed above), one should use <cite>adapters</cite> (see
<a class="reference external" href="adapters.html#adapters"><em>Interfaces and Adapters</em></a>).</p>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="load-sort.html" title="4.5. Loaded attributes and default sorting management"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="4. Data as objects"
             >previous</a> |</li>
        <li><a href="../../index.html">CubicWeb 3.13.5</a> &raquo;</li>
          <li><a href="../index.html" >Repository development</a> &raquo;</li>
          <li><a href="index.html" >4. Data as objects</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2001-2010, Logilab.
      Last updated on Sep 08, 2011.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.6.
    </div>
  </body>
</html>