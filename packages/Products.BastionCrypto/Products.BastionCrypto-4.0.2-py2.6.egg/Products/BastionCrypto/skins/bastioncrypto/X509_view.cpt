<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="bastion">

  <metal:border fill-slot="top_slot">
    <tal:border define="dummy python:request.set('enable_border',1)" />
  </metal:border>

  <body>

    <div metal:fill-slot="main"
         tal:define="errors options/state/getErrors;">

      <h1 i18n:translate="heading_stats_item">
        <span i18n:name="itemtype">
          <span i18n:translate=""
                tal:content="python:here.getTypeInfo().Title()"
                tal:omit-tag="">Item type</span>
        </span>
 
      </h1>

      <div class="formHelp">

        <p>You are about to receive a tape archive, which can be unpacked using 
           popular compression tools such as pkzip and gzip. Depending upon the 
           output option you choose, it will contain at lease some of the following:</p>

        <ul>
          <li>x509.crt, x509.req, x509.key and x509.keydec</li>
          <li>x509.p12</li>
        </ul>

        <p>x509.crt is a PEM-encoded X509 certificate, x509.key is it's private key, 
           and x509.keydec is it's private key already decrypted. You should import 
           these into your secure server area and link them into your secure server. 
           For example, an Apache SSL server needs the SSLCertificateFile and the 
           SSLCertificateKeyFile directives to reference these files. Other TLS 
           servers will require similar configuration.</p>

        <p>x509.req is a certificate authority signing request for your certificate. 
           This is needed for a third party to verify and sign your certificate. You
           may use this file to submit your certificate to a BastionCertAuthority for 
           example.</p>

        <p>The x509.p12 file is a PKCS12 formatted file of your certificate suitable 
           for importing into the security feature of popular web browsers such as 
           Netscape, Explorer, and Outlook. You will need to supply a password to 
           create this file. This password will also be required for you to 
           successfully import the file into your client application.</p>

        <p>We will have automatically removed all traces of your key from our systems 
           before you have even completed downloading it.</p>
      </div>

      <form action="."
            method="post"
            tal:attributes="action template/getId" >

        <fieldset>
 
          <legend i18n:translate="legend_domain_details">X509 Certificate</legend>
 
          <div class="field"
               tal:define="error errors/passphrase1|nothing;
                           Passphrase1 request/passphrase1 | nothing;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="passphrase1" i18n:translate="label_passphrase1">Passphrase1</label>
                                                                                 
            <span class="fieldRequired" passphrase1="Required"
                  i18n:attributes="passphrase1"
                  i18n:translate="label_required">(Required)</span>
                                                                                 
            <div tal:content="error">Validation error output</div>
                                                                                 
            <input type="password" id="passphrase1" name="passphrase1" value="" size="40" 
                   tal:attributes="value Passphrase1;" />
                                                                                 
          </div>
                                                                                 
          <div class="field"
               tal:define="error errors/passphrase2|nothing;
                           Passphrase2 request/passphrase2 | nothing"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="passphrase2" i18n:translate="label_passphrase2">Passphrase2</label>
                                                                                 
            <span class="fieldRequired" passphrase2="Required"
                  i18n:attributes="passphrase2"
                  i18n:translate="label_required">(Required)</span>
                                                                                 
            <div tal:content="error">Validation error output</div>
                                                                                 
            <input type="password" id="passphrase2" name="passphrase2" value="" size="40" 
                   tal:attributes="value Passphrase2;" />
                                                                                 
          </div>
                                                                                 
          <div class="field"
               tal:define="error errors/city|nothing;
                           City request/city | nothing;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="city" i18n:translate="label_city">City</label>
                                                                                 
            <span class="fieldRequired" city="Required"
                  i18n:attributes="city"
                  i18n:translate="label_required">(Required)</span>
                                                                                 
            <div tal:content="error">Validation error output</div>
                                                                                 
            <input type="text" id="city" name="city" value="" size="40" 
                   tal:attributes="value City;" />
                                                                                 
          </div>
                                                                                 
          <div class="field"
               tal:define="error errors/state|nothing;
                           State request/state | nothing;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="state" i18n:translate="label_state">State</label>
                                                                                 
            <span class="fieldRequired" state="Required"
                  i18n:attributes="state"
                  i18n:translate="label_required">(Required)</span>
                                                                                 
            <div tal:content="error">Validation error output</div>
                                                                                 
            <input type="text" id="state" name="state" value="" size="40" 
                   tal:attributes="value State;" />
                                                                                 
          </div>
                                                                                 
          <div class="field"
               tal:define="error errors/country|nothing;
                           Country request/country | nothing;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="country" i18n:translate="label_country">Country</label>
                                                                                 
            <span class="fieldRequired" country="Required"
                  i18n:attributes="country"
                  i18n:translate="label_required">(Required)</span>
                                                                                 
            <div tal:content="error">Validation error output</div>
                                                                                 
            <input type="text" id="country" name="country" value="" size="40" 
                   tal:attributes="value Country;" />
                                                                                 
          </div>
                                                                                 
          <div class="field"
               tal:define="error errors/company|nothing;
                           Organisation request/company | nothing;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="organisation" i18n:translate="label_organisation">Organisation</label>
                                                                                 
            <span class="fieldRequired" company="Required"
                  i18n:attributes="company"
                  i18n:translate="label_required">(Required)</span>
                                                                                 
            <div tal:content="error">Validation error output</div>
                                                                                 
            <input type="text" id="company" name="company" value="" size="40" 
                   tal:attributes="value Organisation;" />
                                                                                 
          </div>
                                                                                 
          <div class="field"
               tal:define="error errors/division|nothing;
                           Division request/division | nothing;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="division" i18n:translate="label_division">Division</label>
                                                                                 
            <span class="fieldRequired" division="Required"
                  i18n:attributes="division"
                  i18n:translate="label_required">(Required)</span>
                                                                                 
            <div tal:content="error">Validation error output</div>
                                                                                 
            <input type="text" id="division" name="division" value="" size="40" 
                   tal:attributes="value Division;" />
                                                                                 
          </div>
                                                                                 
          <div class="field"
               tal:define="error errors/email|nothing;
                           Email request/email | nothing;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="email" i18n:translate="label_email">Email</label>
                                                                                 
            <span class="fieldRequired" email="Required"
                  i18n:attributes="email"
                  i18n:translate="label_required">(Required)</span>
                                                                                 
            <div tal:content="error">Validation error output</div>
                                                                                 
            <input type="text" id="email" name="email" value="" size="40" 
                   tal:attributes="value Email;" />
                                                                                 
          </div>
                                                                                 
          <div class="field"
               tal:define="error errors/cn|nothing;
                           Cn request/cn | nothing;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="cn" i18n:translate="label_cn">Cn</label>
                                                                                 
            <span class="fieldRequired" cn="Required"
                  i18n:attributes="cn"
                  i18n:translate="label_required">(Required)</span>
                                                                                 
            <div tal:content="error">Validation error output</div>
                                                                                 
            <input type="text" id="cn" name="cn" value="" size="40" 
                   tal:attributes="value Cn;" />
                                                                                 
          </div>
                                                                                 
          <div class="field"
               tal:define="error errors/expires|nothing;
                           Expires request/expires | nothing;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="expires" i18n:translate="label_expires">Expires</label>
                                                                                 
            <span class="fieldRequired" expires="Required"
                  i18n:attributes="expires"
                  i18n:translate="label_required">(Required)</span>
                                                                                 
            <div tal:content="error">Validation error output</div>
                                                                                 
            <input type="text" id="expires" name="expires" value="" size="40" 
                   tal:attributes="value Expires;" />
                                                                                 
          </div>
                                                                                 
          <div class="field"
               tal:define="error errors/size|nothing;
                           Size request/size | nothing;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="size" i18n:translate="label_size">Size</label>
                                                                                 
            <span class="fieldRequired" size="Required"
                  i18n:attributes="size"
                  i18n:translate="label_required">(Required)</span>
                                                                                 
            <div tal:content="error">Validation error output</div>
            
	    <select name="size:int">
               <option tal:repeat="size python:(1024, 2048, 4096)"
                       tal:content="size"
                       tal:attributes="selected python: test(request.get('size', 0) == size, 1, 0);"/>
            </select>                                                         
          </div>
                                                                                 

        </fieldset>

        <fieldset>

          <legend i18n:translate="legend_domain_details">Download Options</legend>

          <div class="field"
               tal:define="error errors/output|nothing;
                           Output request/output | python: 1;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="size" i18n:translate="label_output_option">Output Option</label>
                                                                                 
            <span class="fieldRequired" size="Required"
                  i18n:attributes="size"
                  i18n:translate="label_required">(Required)</span>
                                                                                 
            <div tal:content="error">Validation error output</div>
            
                <select name="output">
                    <span tal:repeat="option python:(('All', 1), ('PEM Keys only', 2), ('PKCS12 only', 3))"
                          tal:omit-tag="">
                       <option  tal:content="python:option[0]" value="" 
                                tal:attributes="value python:option[1];
                                                selected python: test(Output == option[1], 1, 0)"/>
                        </span>
                     </select>
          </div>

          <p class="formHelp">The password is only needed for PKCS12 keys where you need to use this to
             complete the upload into your browser.</p>

          <div class="field"
               tal:define="error errors/pwd1|nothing;
                           Pwd1 request/pwd1 | nothing;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="password1" i18n:translate="label_password">Password</label>
                                                                                 
            <div tal:content="error">Validation error output</div>
                                                                                 
            <input type="text" id="pwd1" name="pwd1" type="password" value="" size="40" 
                   tal:attributes="value Pwd1;" />
                                                                                 
          </div>
                                                                                 
          <div class="field"
               tal:define="error errors/pwd2|nothing;
                           Pwd2 request/pwd2 | nothing;"
               tal:attributes="class python:test(error, 'field error', 'field')">

            <label for="password2" i18n:translate="label_password_again">Again ...</label>
                                                                                 
            <div tal:content="error">Validation error output</div>
                                                                                 
            <input type="text" id="pwd2" name="pwd2" type="password" value="" size="40" 
                   tal:attributes="value Pwd2;" />
                                                                                 
          </div>
                                                                                 
        </fieldset>

        <div class="formControls"
             tal:define="process_creation request/process_creation|nothing;">
            <input class="context"
                   type="submit"
                   name="form.button.Generate"
                   value="Generate"
                   i18n:attributes="value" />
        </div>

        <input type="hidden" name="form.submitted" value="1" />

      </form>
    </div>

  </body>
</html>

