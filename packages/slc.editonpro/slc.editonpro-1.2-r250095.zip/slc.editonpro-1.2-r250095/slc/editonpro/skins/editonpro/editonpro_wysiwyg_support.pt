<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
 
  <body>
 
    <div metal:define-macro="wysiwygEditorBox" 
         id="editonpro-editor" 
         tal:define="name fieldName|inputname;                 
                      editorid string:editonpro-editor-${name}" 
         xtal:attributes="id editorid">
       <script type="text/javascript" language="javascript" 
               tal:content="string:var inputname = '${inputname}';var editorid = '${editorid}'; var editorvar = 'eop_${inputname}'; var portal_url = '${portal_url}'; editonpro_field_registry[inputname] = editorvar;"></script>
       <script type="text/javascript" language="javascript" 
               tal:define="url_quote python:modules['Products.PythonScripts.standard'].url_quote;
                           skinname python:url_quote(here.getCurrentSkinName());                            
                           style_ids python:['%s/portal_css/%s/%s' % (portal_url, skinname, x.getId()) for x in here.portal_css.getEvaluatedResources(here)];"
               tal:content="string:var style_ids = ${style_ids};"></script>
 
 
 

        <textarea name="fieldName" 
                  tal:content="inputvalue" 
                  style="display:none;"
                  tal:attributes="name fieldName|inputname;                         
                                  id fieldName|inputname;                         
                                  onfocus onfocus|nothing;                         
                                  onblur onblur|nothing;                         
                                  rows rows|default;                         
                                  cols cols|default;">
        </textarea>

        <input type="hidden" name="text_format:default" 
               value="text/html" 
               tal:define="fieldName fieldName|inputname|nothing;                 
                           val python:fieldName and 'text/html' or 'html';                 
                           fieldName python:test(fieldName, fieldName+'_', '') + 'text_format:default';" 
                           tal:attributes="name fieldName;value val;"/>


       <div class="editonpro">
       <script type="text/javascript" language="javascript">
            var cmd = editorvar+" = new editOnPro('100%', 400, '"+editorid+"', '"+editorid+"', '"+editorvar+"');"
            eval(cmd);
            eval(editorvar+".setCodebase('"+portal_url+"/eopro');");
            eval(editorvar+".setBase(document.URL);");
            eval(editorvar+".setUIConfigURL('"+portal_url+"/eopro/uiconfig.xml');");
            eval(editorvar+".setConfigURL('"+portal_url+"/eopro/config.xml');");
            eval(editorvar+".setLocaleCode("+editorvar+".getLocaleFromBrowser());");
            
            // make sure the contents of the editor are written back to the hidden textarea before submitting the form
            eop_addEvent(document.getElementById(inputname).form, 'submit', eop_scriptForm_onsubmit, false);

            eval(editorvar+".setHiddenLoading(true);");
            eval(editorvar+".cacheContents(true);");
            
            // launch the editor                      
            eval(editorvar+".loadEditor();");

            // Load the styles
            for (i=0;i<style_ids.length; i++) {            
                cmd = editorvar+".setStyleSheetURL('"+style_ids[style_ids.length-i-1]+"');"
                eval(cmd);
                //document.write(portal_url+"/" + style_ids[i]+"\n<br>");
            }

            eval(editorvar+".setHTMLData(document.getElementById(inputname).value);");
            eval(editorvar+".pumpEvents();");

        </script>
        </div>

    </div>      
  </body>
</html>


