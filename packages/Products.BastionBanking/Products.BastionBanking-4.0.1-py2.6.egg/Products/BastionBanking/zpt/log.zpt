<html tal:replace="structure container/manage_page_header"/>

    <span tal:replace="structure here/manage_tabs"/>

<form method="get" action="">
  <input type="hidden" name="sort_on" value="date">
  <input type="hidden" name="sort_order" value="reverse">
  <table border="0" cellpadding="2" cellspacing="0" width="100%" bgcolor="silver" style="border: 1px outset;">
      <tr>
         <td>
            <table>
              <tr><td class="form-label">Date:</td>
                  <td class="form-label">From</td>
                  <td><input type="text" name="date:date:list" size="19" value="" maxlength="19"
                             tal:attributes="value python: request.SESSION.get('bbl', {}).get('date', [ DateTime(0) ])[0].strftime('%d/%m/%Y %H:%M:%S')"></td></tr>
              <tr><td>&nbsp;</td>
                  <td class="form-label">To</td>
                  <td><input type="text" name="date:date:list" size="19" value="" maxlength="19"
                             tal:attributes="value python: request.SESSION.get('bbl', {}).get('date', ['',DateTime()])[1].strftime('%d/%m/%Y %H:%M:%S')"></td></tr>
            </table>
         </td>
         <td>&nbsp;</td>
         <td>
            <span class="form-label">Level</span>&nbsp;
            <select name="level:list" multiple size="2">
               <option value="" selected=""
                  tal:repeat="level python: here.catalog.uniqueValuesFor('level')"
                  tal:attributes="value level;
                                  selected python: test(request.SESSION.get('bbl', {}).get('level', []).count(level) > 0, 1, 0)"
                  tal:content="level"/>
            </select>
         </td>
         <td>&nbsp;</td>
         <td>
            <span class="form-label">Subject</span>&nbsp;
            <textarea rows="2" cols="30" name="subject" wrap="soft" tal:content="request/form/subject | nothing"></textarea>
         </td>
         <td>&nbsp;</td>
         <td class="form-element">
            <input type="submit" name="do_search" value=" Search ">
         </td>
      </tr>
  </table>
</form>

<table cellspacing="0" cellpadding="2" width="100%" 
       tal:define="results python: here.catalog(REQUEST=request);
                   foo python: here.saveSearch(request);
                   results_start python:0;
                   results_start request/results_start | results_start;
                   Batch python:modules['ZTUtils'].Batch;
                   mq python:modules['ZTUtils'].make_query;
                   results_batch python:Batch(results, 10, results_start, orphan=2)">
   <tr class="list-header">
          <td class="list-item" width="40" tal:define="p results_batch/previous" align="left" nowrap>
                   <div tal:omit-tag="" tal:condition="p">
                      <a href=""
                         tal:define="qs python: mq(request.form, results_start=p.first)"
                         tal:attributes="href python: 'manage_main?%s' %  qs">
                      << Prev
                      </a>
                   </div>
                   <div tal:condition="not: p" tal:omit-tag="">&nbsp;</div>
          </td>
          <td class="list-item" width="20%">Date</td>
          <td class="list-item" width="10%">Level</td>
          <td class="list-item" width="50%">Subject</td>
          <td class="list-item" width="40" tal:define="n results_batch/next" align="right" nowrap>
                <div tal:omit-tag="" tal:condition="n">
                      <a href=""
                         tal:define="qs python: mq(request.form, results_start=n.first)"
                         tal:attributes="href python: 'manage_main?%s' % qs">
                        Next >>
                      </a>
                </div>
                   <div tal:condition="not: n" tal:omit-tag="">&nbsp;</div>
          </td>
       </tr>
       <tbody tal:condition="results">
         <tr  class=""
              tal:attributes="class python: test(repeat['brain'].index % 2, 'row-normal', 'row-hilite')"
              tal:repeat="brain results_batch">
            <td class="list-item">&nbsp;</td>
            <td valign="top" class="list-item">
                <a href=""
                   tal:attributes="href string:${brain/id}/manage_workspace"
                   tal:content="python: brain.date.strftime('%d %b %Y %H:%M:%S')"/>
            </td>
            <td valign="top" class="list-item" tal:content="brain/level"/>
            <td valign="top" class="list-item" tal:content="brain/subject"/>
            <td class="list-item">&nbsp;</td>
         </tr>
         <tr><td>&nbsp;</td></tr>
      </tbody>
  </table>

<html tal:replace="structure container/manage_page_footer"/>
