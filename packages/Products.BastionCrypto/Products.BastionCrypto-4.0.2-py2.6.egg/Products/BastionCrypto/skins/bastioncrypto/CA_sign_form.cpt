<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="bastion">

  <metal:border fill-slot="top_slot">
    <tal:border define="dummy python:request.set('enable_border',1)" />
  </metal:border>

  <body>

    <div metal:fill-slot="main"
         tal:define="errors options/state/getErrors;
                     utool context/@@plone_portal_state/portal_url;">

      <h1 i18n:translate="heading_stats_item">
        <img src="" tal:define="icon python: context.getIcon(1)"
             tal:attributes="src string:${utool}/${icon}">&nbsp;
        <span i18n:name="itemtype">
          <span i18n:translate=""
                tal:content="context/title_or_id"
                tal:omit-tag=""/>
        </span>
       </h1>

      <p>This Certification Authority will sign your certification request.  You
         must create a request file for us - if you can do this, then this shows you are in 
         full control of both the public and private aspects of your certificate.  This provides
         us with full assurance to sign your certificate.</p>

      <p class="formHelp" tal:condition="here/openssl_mode">If you are unsure about how to generate
           a certification request, then consider the following command from the 
          <a href="http://www.openssl.org">openssl</a> suite:<br>
           <code>openssl x509 -x509toreq -in &lt;x509.crt&gt; -signkey &lt;x509.keydec&gt; -out &lt;x509.req&gt;</code>.
      </p>

      <p class="formHelp" tal:condition="here/openssl_mode">If you used our BastionX509Generator to 
         create your certificate, then we included in this distribution, <code>x509.req</code>, which 
         you may use here for expressly this task.  Alternatively, follow the directions above - each
         of the files required is already in the correct PEM format.</p>


      <form action="."
	    name="form"
            method="post" enctype="multipart/form-data"
            tal:attributes="action template/getId" >

        <fieldset>
 
          <legend i18n:translate="legend_certificate_request">Your Certificate Signing Request</legend>

          <div class="field">
             <div class="label">Certificate Request File</div>
             <input type="file" size="50" name="keyfile"/>
          </div>

          <div class="field"><i>or</i></div>

          <div class="field">
             <div class="label">Certificate Request Text</div>
             <textarea name="keytext" rows="12"></textarea>
          </div>

          <div class="formControls">
            <input class="context"
                   type="submit"
                   name="form.button.Sign"
                   value="Sign"
                   i18n:attributes="value" />
          </div>
          <input type="hidden" name="form.submitted" value="1" />

       </fieldset>

      </form>
    </div>

  </body>
</html>

