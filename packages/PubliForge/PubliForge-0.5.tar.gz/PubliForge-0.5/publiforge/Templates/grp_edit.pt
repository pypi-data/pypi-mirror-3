<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="base">
<head><title></title></head>
<body>
<div id="mainPanel" metal:fill-slot="main">
  ${form.begin()}
  <!-- ............................... Buttons ............................ -->
  <div id="buttons">
    <div class="first">
      ${request.breadcrumbs.back_button()}
    </div>
    <div class="last" tal:switch="group is None">
      <div tal:case="True" tal:omit-tag="">
        ${form.submit('sav!.x', _('Create'), class_='buttonMain')}
        ${form.button(route('group_admin'), _('Cancel'))}
      </div>
      <div tal:case="False" tal:omit-tag="">
        ${form.submit('sav!.x', _('Save'), class_='buttonMain')}
        ${form.button(route('group_view', group_id=group.group_id), _('Cancel'))}
      </div>
    </div>
    <hr class="hidden"/>
  </div>
  <div id="main">
    <h2 id="subtitle" class="group" title="${_('Group settings')}">${group and group.label}</h2>
    <!-- ............................. Flash .............................. -->
    <div tal:define="flash load: flash.macro.pt" metal:use-macro="flash"/>
    <!-- ............................. Users to add ....................... -->
    <div tal:define="users_paging load: users_paging.macro.pt" metal:use-macro="users_paging"/>
    <!-- ................................ Tabs ............................ -->
    <div id="tabSet">
      ${tab_set.toc('tabGroup')}
      <!-- ..... Description ...... -->
      ${tab_set.tab_begin(0, 'd')}
      ${form.grid_text('label', _('Label:'), required=True)}
      ${form.grid_text('description', _('Description:'))}
      ${tab_set.tab_end()}
      <!-- ...... Permissions ..... -->
      ${tab_set.tab_begin(1, 'p')}
      <strong class="caption">${_('Permissions supplied by this group:')}</strong>
      <div tal:repeat="scope PERM_SCOPES" tal:omit-tag="">
        ${form.grid_select('perm_%s' % scope, _(PERM_SCOPES[scope]),
          [('', '')] + USER_PERMS.items())}
      </div>
      ${tab_set.tab_end()}
      <!-- ........ Members ....... -->
      ${tab_set.tab_begin(2, 'm')}
      <div tal:condition="group" tal:omit-tag="">
        <div class="listActions">
          <div class="first">
            <img src="/Static/Images/user22.png" alt="${_('Users')}"/>
          </div>
          <div class="last">
            ${form.submit_image('add?usr', _('Add user'), '/Static/Images/action_add.png')}
          </div>
        </div>
        <table class="list smallList">
          <caption>${_('Users')}</caption>
          <tr>
            <th>${_('Login')}</th>
            <th>${_('Name')}</th>
            <th class="last">${_('Action')}</th>
          </tr>
          <tr tal:repeat="user users">
            <td><a href="${route('user_view', user_id=user.user_id)}">${user.login}</a></td>
            <td><a href="${route('user_view', user_id=user.user_id)}">${user.name}</a></td>
            <td class="last" tal:switch="action == 'rmv?usr%d' % user.user_id">
              <span tal:case="True" tal:omit-tag="">
                ${form.submit('rmv!usr%d.x' % user.user_id, _('Confirm removal'), class_='button')}
                ${form.submit_cancel(_('Cancel'))}
              </span>
              <span tal:case="False" tal:omit-tag="">
                ${form.submit_image('rmv?usr%d' % user.user_id, _('Remove user'),
                '/Static/Images/action_remove_one.png')}
              </span>
            </td>
          </tr>
        </table>
      </div>
      <div tal:condition="not group">${_('Create group before adding members.')}</div>
      ${tab_set.tab_end()}
    </div>
  </div>
  ${form.end()}
</div>
</body>
</html>