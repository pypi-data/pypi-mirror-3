function prevent_interupt_refresh(a){if(ax_in_progress){a.preventDefault();if(!$("#in-progress").length){$(".Grid_content").before('<div id="in-progress">'+gettext("Content refresh in progress, please wait for it to complete")+"</div>");setTimeout(function(){$("#in-progress").remove()},15050);window.scroll(0,0)}}}function build_table_from_json(){if(!ax_in_progress){if(last_ts!=""){$.ajaxSetup({beforeSend:function(a){a.setRequestHeader("X-Last-Timestamp",last_ts)}})}$.getJSON("/messages/",json2html);if(auto_refresh){clearInterval(auto_refresh);clearTimeout(auto_refresh)}$("a").bind("click",prevent_interupt_refresh);setTimeout(build_table_from_json,60000)}}function do_table_sort(){full_messages_listing=false;$(".nojs").remove();ax_in_progress=false;$("#heading small").empty().append(gettext("[updated every 60 sec's]"));$("#my-spinner").ajaxSend(function(){$(this).empty().append("&nbsp;"+gettext("Refreshing...")).show();ax_error=false;ax_in_progress=true}).ajaxStop(function(){if(!ax_error){var a=lastupdatetime();$("#heading small").empty().append(gettext("[last update at ")+a+"]");$("#my-spinner").hide();ax_in_progress=false;if($("#in-progress").is(":visible")){$("#in-progress").hide()}}}).ajaxError(function(c,b,a){if(b.status==200){location.href=a.url}else{$(this).empty().append('<span class="ajax_error">'+gettext("Error connecting to server. check network!")+"</span>").show();ax_error=true;ax_in_progress=false;if($("#in-progress").is(":visible")){$("#in-progress").hide()}auto_refresh=setTimeout(build_table_from_json,60000)}});$("a").bind("click",prevent_interupt_refresh)}var auto_refresh=setInterval(build_table_from_json,60000);$(document).ready(do_table_sort);