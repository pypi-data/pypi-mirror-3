<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4.1: http://docutils.sourceforge.net/" />
<title>pb.recipes.pydev</title>
<style type="text/css">

/*
:Author: David Goodger
:Contact: goodger@users.sourceforge.net
:Date: $Date: 2005-12-18 01:56:14 +0100 (Sun, 18 Dec 2005) $
:Revision: $Revision: 4224 $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;
  background-color: #eeeeee }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

tt.docutils {
  background-color: #eeeeee }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="pb-recipes-pydev">
<h1 class="title">pb.recipes.pydev</h1>
<div class="contents topic">
<p class="topic-title first"><a id="contents" name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#overview" id="id1" name="id1">Overview</a></li>
<li><a class="reference" href="#how-it-works" id="id2" name="id2">How it works</a></li>
<li><a class="reference" href="#integration-strategies-and-plone" id="id3" name="id3">Integration strategies (and Plone)</a></li>
</ul>
</div>
<p>Author: Tiberiu Ichim, <a class="reference" href="mailto:tibi&#64;pixelblaster.ro">tibi&#64;pixelblaster.ro</a></p>
<div class="section">
<h1><a class="toc-backref" href="#id1" id="overview" name="overview">Overview</a></h1>
<p>This recipe is about modifying a <cite>.pydevproject</cite> file, which is used by Eclipse
and PyDev to hold a list of folders which hold Python packages (for code
completition, auto-import and so on). This recipe won't generate a new one!
If you're running the buildout directly in the PyDev project, you're all set,
otherwise you have to set the path to the .pydevproject file.</p>
<p>The idea is to fill this file with paths pointing to the used egg folders.
Although this recipe is written with a zope3 instance in mind, it can probably
be used for any other scenario (for Plone integration read at the end of the file.
After running the buildout you'll have to close and reopen the Eclipse project,
to regenerate the project's module indexes.</p>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id2" id="how-it-works" name="how-it-works">How it works</a></h1>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; import os
</pre>
</blockquote>
<p>A full recipe would include the following options:</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; write(sample_buildout, 'buildout.cfg',
... &quot;&quot;&quot;
... [buildout]
... parts = pydev
...
... [pydev]
... recipe = pb.recipes.pydev
... pydevproject_path = ${buildout:directory}/.pydevproject_test
... extra-paths = /something/else
... eggs = pb.recipes.pydev
... &quot;&quot;&quot;)
</pre>
</blockquote>
<p>We need a working .pydevproject file. This recipe won't generate a new one.
I'll use this project's project file for testing.</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; fc = &quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
... &lt;?eclipse-pydev version=&quot;1.0&quot;?&gt;
... &lt;pydev_project&gt;
... &lt;pydev_pathproperty name=&quot;org.python.pydev.PROJECT_SOURCE_PATH&quot;&gt;
... &lt;path&gt;/pb.recipes.pydev/src&lt;/path&gt;
... &lt;/pydev_pathproperty&gt;
... &lt;pydev_property name=&quot;org.python.pydev.PYTHON_PROJECT_VERSION&quot;&gt;python 2.4&lt;/pydev_property&gt;
... &lt;pydev_pathproperty name=&quot;org.python.pydev.PROJECT_EXTERNAL_SOURCE_PATH&quot;&gt;
... &lt;path&gt;/home/tibi/workspace3.3/pb.recipes.pydev/eggs/zc.buildout-1.0.0b31-py2.4.egg&lt;/path&gt;
... &lt;path&gt;/home/tibi/workspace3.3/pb.recipes.pydev/eggs/zc.recipe.egg-1.0.0-py2.4.egg&lt;/path&gt;
... &lt;/pydev_pathproperty&gt;
... &lt;/pydev_project&gt;&quot;&quot;&quot;
&gt;&gt;&gt; pf_path = os.path.join(sample_buildout, '.pydevproject_test')
&gt;&gt;&gt; f = open(pf_path, 'w')
&gt;&gt;&gt; f.write(fc)
&gt;&gt;&gt; f.close()
</pre>
</blockquote>
<p>Now we can run the buildout</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; print system(buildout) #doctest: +NORMALIZE_WHITESPACE
Installing pydev.
</pre>
</blockquote>
<p>With this recipe we only override the external source paths entry, so we'll only
check that:</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; import os
&gt;&gt;&gt; from xml.dom import minidom
&gt;&gt;&gt; document = minidom.parse(os.path.join(sample_buildout,
...                             '.pydevproject_test'))
&gt;&gt;&gt; nodes = document.getElementsByTagName('pydev_pathproperty')
&gt;&gt;&gt; paths_node = filter(lambda node: (node.getAttribute('name') ==
...                     'org.python.pydev.PROJECT_EXTERNAL_SOURCE_PATH'),
...                nodes
...             )[0]
&gt;&gt;&gt; data = paths_node.toxml()
</pre>
</blockquote>
<p>The paths should contain what we have specified in teh the <cite>extra-paths</cite> option:</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; '/something/else' in data
True
</pre>
</blockquote>
<p>In our sample buildout.cfg we have placed, in the <cite>eggs</cite> option, this recipe's
egg. In your projects, this can be anything, (and it should be your developing
application's egg name, as declared in your <cite>setup.py</cite>). The <cite>pb.recipes.pydev</cite>
egg depends on <cite>zc.recipe.egg</cite>, <cite>zc.buildout</cite> and <cite>setuptools</cite>, let's see if
all these were included.</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; 'zc.recipe.egg' in data
True
&gt;&gt;&gt; 'zc.buildout' in data
True
&gt;&gt;&gt; 'setuptools' in data
True
</pre>
</blockquote>
<p>Note: at this moment, the project's source path is also included, in theory it
shouldn't affect Eclipse.</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; code_path = __file__[:len(__file__) -
...                          len('/src/pb/recipes/pydev/README.txt')]
&gt;&gt;&gt; pydev_egg_src = os.path.join(code_path, 'src')
&gt;&gt;&gt; pydev_egg_src in data
True
</pre>
</blockquote>
<p>In version 0.2 the paths were added twice, let's check that this doesn't happen
anymore:</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; data.count('zc.recipe.egg')
1
</pre>
</blockquote>
<p>In version 0.3, the recipe would fail with a .pydevproject file with no external
source path node, let's check this doesn't happen anymore:</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; fc = &quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
... &lt;?eclipse-pydev version=&quot;1.0&quot;?&gt;
... &lt;pydev_project&gt;
... &lt;pydev_pathproperty name=&quot;org.python.pydev.PROJECT_SOURCE_PATH&quot;&gt;
... &lt;path&gt;/pb.recipes.pydev/src&lt;/path&gt;
... &lt;/pydev_pathproperty&gt;
... &lt;/pydev_project&gt;&quot;&quot;&quot;
&gt;&gt;&gt; pf_path = os.path.join(sample_buildout, '.pydevproject_test')
&gt;&gt;&gt; f = open(pf_path, 'w')
&gt;&gt;&gt; f.write(fc)
&gt;&gt;&gt; f.close()
&gt;&gt;&gt; print system(buildout) #doctest: +NORMALIZE_WHITESPACE
Updating pydev.
&gt;&gt;&gt; import os
&gt;&gt;&gt; from xml.dom import minidom
&gt;&gt;&gt; document = minidom.parse(os.path.join(sample_buildout,
...                             '.pydevproject_test'))
&gt;&gt;&gt; nodes = document.getElementsByTagName('pydev_pathproperty')
&gt;&gt;&gt; paths_node = filter(lambda node: (node.getAttribute('name') ==
...                     'org.python.pydev.PROJECT_EXTERNAL_SOURCE_PATH'),
...                nodes
...             )[0]
&gt;&gt;&gt; data = paths_node.toxml()
&gt;&gt;&gt; '/something/else' in data
True
&gt;&gt;&gt; 'zc.recipe.egg' in data
True
&gt;&gt;&gt; 'zc.buildout' in data
True
&gt;&gt;&gt; 'setuptools' in data
True
</pre>
</blockquote>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id3" id="integration-strategies-and-plone" name="integration-strategies-and-plone">Integration strategies (and Plone)</a></h1>
<p>Almost all options of this recipe for the buildout.cfg are optional. The only
one required is the <cite>eggs</cite> option. A sample zope3 instance buildout, with the
pydev recipe could be something like this:</p>
<pre class="literal-block">
[buildout]
develop = .
parts = instance pydev

[sample-app]
recipe = zc.zope3recipes:app
eggs = something [app, third_party]

[pydev]
recipe = pb.recipes.pydev
eggs = ${sample-app:eggs}
</pre>
<p>To integrate with Plone, follow the example posted by Silvio in this post on Product-Developers mailing list: <a class="reference" href="http://www.nabble.com/Re:--Product-Developers--buildout-and-eclipse-p16699863s20094.html">http://www.nabble.com/Re:--Product-Developers--buildout-and-eclipse-p16699863s20094.html</a>:</p>
<pre class="literal-block">
[make_pydev_init_files]
# we need this (a Products directory with symlinks to all plone products)
# to have completion of code in the Products namespace
recipe = iw.recipe.cmd:py
on_install=true
cmds =
      &gt;&gt;&gt; dirs = &quot;&quot;&quot;${instance:products}&quot;&quot;&quot;.split(&quot;\n&quot;)
      &gt;&gt;&gt; prodlinks = os.path.join(&quot;&quot;&quot;${buildout:directory}&quot;&quot;&quot;.strip() , 'prodlinks')
      &gt;&gt;&gt; Products = os.path.join(prodlinks,'Products')
      &gt;&gt;&gt; import os
      &gt;&gt;&gt; if not os.path.isdir(prodlinks): os.mkdir(prodlinks)
      &gt;&gt;&gt; if not os.path.isdir(Products): os.mkdir(Products)
      &gt;&gt;&gt; open(os.path.join(Products , '__init__.py'),'w').write('#')
      &gt;&gt;&gt; for dir in dirs:
      &gt;&gt;&gt;      if dir:
      &gt;&gt;&gt;           for product in [os.path.join(dir,a) for a in os.listdir(dir) if os.path.isdir(os.path.join(dir,a))]:
      &gt;&gt;&gt;               linkname = os.path.join(Products, os.path.basename(product))
      &gt;&gt;&gt;               if not os.path.islink(linkname): os.symlink(product,linkname)
</pre>
</div>
</div>
</body>
</html>
