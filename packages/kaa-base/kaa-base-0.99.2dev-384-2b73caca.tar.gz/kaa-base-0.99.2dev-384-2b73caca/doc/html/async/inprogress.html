

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>InProgress Objects &mdash; kaa.base v0.99.2dev-382-8399342e documentation</title>
    <link rel="stylesheet" href="../_static/kaa.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.99.2dev-382-8399342e',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="kaa.base v0.99.2dev-382-8399342e documentation" href="../index.html" />
    <link rel="next" title="Coroutines" href="coroutines.html" />
    <link rel="prev" title="Events and Event Handlers" href="../core/event.html" />
    <!-- link rel="stylesheet" href="../_static/kaa.css" type="text/css" /-->

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="coroutines.html" title="Coroutines"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../core/event.html" title="Events and Event Handlers"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">kaa.base v0.99.2dev-382-8399342e documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <span class="target" id="module-kaa.async"></span><div class="section" id="inprogress-objects">
<span id="inprogress"></span><h1>InProgress Objects<a class="headerlink" href="#inprogress-objects" title="Permalink to this headline">¶</a></h1>
<p>Throughout Kaa, when a function executes asynchronously (which is generally the
case for any function that may otherwise block on some resource), it returns an
InProgress object. The InProgress object is a <a class="reference internal" href="../core/signals.html#kaa.Signal" title="kaa.Signal"><tt class="xref py py-class docutils literal"><span class="pre">Signal</span></tt></a> that
callbacks can be connected to in order to handle its return value or any
exception raised during the asynchronous execution. When the InProgress object
is emitted, we say that it is &#8220;finished&#8221; (and the
<a class="reference internal" href="#kaa.InProgress.finished" title="kaa.InProgress.finished"><tt class="xref py py-attr docutils literal"><span class="pre">finished</span></tt></a> property is True).</p>
<p>InProgress objects are emitted (they are <a class="reference internal" href="../core/signals.html#kaa.Signal" title="kaa.Signal"><tt class="xref py py-class docutils literal"><span class="pre">Signal</span></tt></a> objects,
remember) when finished, so handlers can retrieve the return value of the
asynchronous task. There is also an <a class="reference internal" href="#kaa.InProgress.exception" title="kaa.InProgress.exception"><tt class="xref py py-attr docutils literal"><span class="pre">exception</span></tt></a> member,
which is itself a Signal, and is emitted when the asynchronous task raises an
exception. Exception handlers must accept three arguments: exception class,
exception instance, and traceback object.  (These three arguments correspond to
sys.exc_info())</p>
<p>The following example demonstrates how one might connect callbacks to an InProgress
in order to handle success result and exceptions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">kaa</span>

<span class="k">def</span> <span class="nf">handle_connect</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;Connected to remote site successfully&#39;</span>

<span class="k">def</span> <span class="nf">handle_exception</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;Connect failed:&#39;</span><span class="p">,</span> <span class="n">exc</span>

<span class="n">sock</span> <span class="o">=</span> <span class="n">kaa</span><span class="o">.</span><span class="n">Socket</span><span class="p">()</span>
<span class="n">inprogress</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;www.freevo.org:80&#39;</span><span class="p">)</span>
<span class="n">inprogress</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">handle_connect</span><span class="p">)</span>
<span class="n">inprogress</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">handle_exception</span><span class="p">)</span>
<span class="c"># Or a convenience function exists to replace the above 2 lines:</span>
<span class="c"># inprogress.connect_both(handle_connect, handle_exception)</span>
<span class="n">kaa</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Connecting callbacks to signals in this way is fairly standard and this
approach is used in many other frameworks.  For example, readers familiar
with the Twisted framework may find similarities with Twisted&#8217;s Deferreds.</p>
<p>However, InProgress objects can be used with <a class="reference internal" href="coroutines.html#coroutines"><em>coroutines</em></a>
(covered in more detail later), a more interesting and powerful approach which
allows you to handle the result of InProgress objects without the use of
callbacks.  The above example could be rewritten as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">kaa</span>

<span class="nd">@kaa.coroutine</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="n">site</span><span class="p">):</span>
    <span class="n">sock</span> <span class="o">=</span> <span class="n">kaa</span><span class="o">.</span><span class="n">Socket</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Connect failed:&#39;</span><span class="p">,</span> <span class="n">exc</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Connected to remote site successfully&#39;</span>

<span class="n">connect</span><span class="p">(</span><span class="s">&#39;www.freevo.org:80&#39;</span><span class="p">)</span>
<span class="n">kaa</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>As seen in the above snippet, with coroutines, InProgress objects are used
implicitly, where they function as a mechanism for message passing between
asynchronous tasks and the coroutine machinery built into the <a class="reference internal" href="../core/mainloop.html#notifier"><em>notifier</em></a>.</p>
<p>If an InProgress finishes with an exception (in which case the
<a class="reference internal" href="#kaa.InProgress.failed" title="kaa.InProgress.failed"><tt class="xref py py-attr docutils literal"><span class="pre">failed</span></tt></a> property is True) but it is not handled
by one of the above methods (either by connecting a callback to the
<em>exception</em> attribute, or by catching the exception raised by a yield
in a coroutine), the exception will be logged to stderr with the heading
&#8220;Unhandled asynchronous exception.&#8221;</p>
<p><dl class="class">
<dt id="kaa.InProgress">
<em class="property">class </em><tt class="descclassname">kaa.</tt><tt class="descname">InProgress</tt><big>(</big><em>abortable=False</em>, <em>frame=0</em><big>)</big><a class="headerlink" href="#kaa.InProgress" title="Permalink to this definition">¶</a></dt>
<dd><p>InProgress objects are returned from functions that require more time to
complete (because they are either blocked on some resource, are executing
in a thread, or perhaps simply because they yielded control back to the main
loop as a form of cooperative time slicing).</p>
<p>InProgress subclasses <a class="reference internal" href="../core/signals.html#kaa.Signal" title="kaa.Signal"><tt class="xref py py-class docutils literal"><span class="pre">Signal</span></tt></a>, which means InProgress objects are
themselves signals.  Callbacks connected to an InProgress receive a single
argument containing the result of the asynchronously executed task.</p>
<p>If the asynchronous task raises an exception, the
<a class="reference internal" href="#kaa.InProgress.exception" title="kaa.InProgress.exception"><tt class="xref py py-attr docutils literal"><span class="pre">exception</span></tt></a> member, which is a separate signal, is
emitted instead.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>abortable</strong> (<em>bool</em>) &#8211; see the <a class="reference internal" href="#kaa.InProgress.abortable" title="kaa.InProgress.abortable"><tt class="xref py py-attr docutils literal"><span class="pre">abortable</span></tt></a> property.  
(Default: False)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><h4>Synopsis</h4><div class="kaa synopsis">
<div class="heading">Class Hierarchy</div><p class="hierarchy"><tt class="xref py py-class docutils literal"><span class="pre">kaa.Object</span></tt><br /><a class="reference internal" href="../core/signals.html#kaa.Signal" title="kaa.Signal"><tt class="xref py py-class docutils literal"><span class="pre">kaa.Signal</span></tt></a><br />&#9492;&#9472; <tt class="xref docutils literal current">kaa.InProgress</tt><br /></p>
<div class="heading">Methods</div>
<table>
<tr><th><a class="reference internal" href="#kaa.InProgress.abort" title="kaa.InProgress.abort"><tt class="xref py py-meth docutils literal"><span class="pre">abort()</span></tt></a></th><td class="desc">Aborts the asynchronous task this InProgress represents.</td></tr>
<tr><th><tt class="xref py py-meth docutils literal"><span class="pre">connect()</span></tt></th><td class="desc">Connects a callback to be invoked when the InProgress has
returned normally (no exception raised).</td></tr>
<tr><th><a class="reference internal" href="#kaa.InProgress.connect_both" title="kaa.InProgress.connect_both"><tt class="xref py py-meth docutils literal"><span class="pre">connect_both()</span></tt></a></th><td class="desc">Convenience function that connects a callback (or callbacks) to both
the InProgress (for successful result) and exception signals.</td></tr>
<tr><th><a class="reference internal" href="#kaa.InProgress.execute" title="kaa.InProgress.execute"><tt class="xref py py-meth docutils literal"><span class="pre">execute()</span></tt></a></th><td class="desc">Execute the given function and finish the InProgress object with the
result or exception.</td></tr>
<tr><th><a class="reference internal" href="#kaa.InProgress.finish" title="kaa.InProgress.finish"><tt class="xref py py-meth docutils literal"><span class="pre">finish()</span></tt></a></th><td class="desc">This method should be called when the owner (creator) of the InProgress is
finished successfully (with no exception).</td></tr>
<tr><th><a class="reference internal" href="#kaa.InProgress.throw" title="kaa.InProgress.throw"><tt class="xref py py-meth docutils literal"><span class="pre">throw()</span></tt></a></th><td class="desc">This method should be called when the owner (creator) of the InProgress is
finished because it raised an exception.</td></tr>
<tr><th><a class="reference internal" href="#kaa.InProgress.timeout" title="kaa.InProgress.timeout"><tt class="xref py py-meth docutils literal"><span class="pre">timeout()</span></tt></a></th><td class="desc">Create a new InProgress object linked to this one that will throw
<a class="reference internal" href="#kaa.TimeoutException" title="kaa.TimeoutException"><tt class="xref py py-class docutils literal"><span class="pre">TimeoutException</span></tt></a> if this object is not finished by the
given timeout.</td></tr>
<tr><th><a class="reference internal" href="#kaa.InProgress.wait" title="kaa.InProgress.wait"><tt class="xref py py-meth docutils literal"><span class="pre">wait()</span></tt></a></th><td class="desc">Blocks until the InProgress is finished.</td></tr>
<tr><th><a class="reference internal" href="#kaa.InProgress.waitfor" title="kaa.InProgress.waitfor"><tt class="xref py py-meth docutils literal"><span class="pre">waitfor()</span></tt></a></th><td class="desc">Connects to another InProgress object (A) to self (B).  When A finishes
(or throws), B is finished with the result or exception.</td></tr>
</table>
<div class="heading">Properties</div>
<table>
<tr><th><a class="reference internal" href="#kaa.InProgress.abortable" title="kaa.InProgress.abortable"><tt class="xref py py-attr docutils literal"><span class="pre">abortable</span></tt></a></th><td>read/write</td><td class="desc">True if the asynchronous task this InProgress represents can be
aborted by a call to <a class="reference internal" href="#kaa.InProgress.abort" title="kaa.InProgress.abort"><tt class="xref py py-meth docutils literal"><span class="pre">abort()</span></tt></a>.</td></tr>
<tr><th><a class="reference internal" href="#kaa.InProgress.exception" title="kaa.InProgress.exception"><tt class="xref py py-attr docutils literal"><span class="pre">exception</span></tt></a></th><td>read-only</td><td class="desc">A <a class="reference internal" href="../core/signals.html#kaa.Signal" title="kaa.Signal"><tt class="xref py py-class docutils literal"><span class="pre">Signal</span></tt></a> emitted when the asynchronous task this InProgress
represents has raised an exception.</td></tr>
<tr><th><a class="reference internal" href="#kaa.InProgress.failed" title="kaa.InProgress.failed"><tt class="xref py py-attr docutils literal"><span class="pre">failed</span></tt></a></th><td>read-only</td><td class="desc">True if an exception was thrown to the InProgress, False if it was
finished without error or if it is not yet finished.</td></tr>
<tr><th><a class="reference internal" href="#kaa.InProgress.finished" title="kaa.InProgress.finished"><tt class="xref py py-attr docutils literal"><span class="pre">finished</span></tt></a></th><td>read-only</td><td class="desc">True if the InProgress is finished.</td></tr>
<tr><th><a class="reference internal" href="#kaa.InProgress.result" title="kaa.InProgress.result"><tt class="xref py py-attr docutils literal"><span class="pre">result</span></tt></a></th><td>read-only</td><td class="desc">The result the InProgress was finished with.  If an exception was thrown
to the InProgress, accessing this property will raise that exception.</td></tr>
</table>
<div class="heading">Signals</div>
<table>
<tr><th><a class="reference internal" href="#kaa.InProgress.signals.abort" title="kaa.InProgress.signals.abort"><tt class="xref py py-attr docutils literal"><span class="pre">abort</span></tt></a></th><td class="desc">Emitted when abort() is called.</td></tr>
</table>

</div>
<h4>Methods</h4><dl class="method">
<dt id="kaa.InProgress.abort">
<tt class="descname">abort</tt><big>(</big><em>exc=None</em><big>)</big><a class="headerlink" href="#kaa.InProgress.abort" title="Permalink to this definition">¶</a></dt>
<dd><p>Aborts the asynchronous task this InProgress represents.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>exc</strong> (<a class="reference internal" href="#kaa.InProgressAborted" title="kaa.InProgressAborted"><tt class="xref py py-class docutils literal"><span class="pre">InProgressAborted</span></tt></a>) &#8211; optional exception object with which to abort the InProgress; if
None is given, a general <a class="reference internal" href="#kaa.InProgressAborted" title="kaa.InProgressAborted"><tt class="xref py py-class docutils literal"><span class="pre">InProgressAborted</span></tt></a>
exception will be used.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Not all such tasks can be aborted.  If aborting is not supported, or if
the InProgress is already finished, a RuntimeError exception is raised.</p>
<p>If a coroutine is aborted, the CoroutineInProgress object returned by
the coroutine will be finished with <a class="reference internal" href="#kaa.InProgressAborted" title="kaa.InProgressAborted"><tt class="xref py py-class docutils literal"><span class="pre">InProgressAborted</span></tt></a>,
while the underlying generator used by the coroutine will have the
standard GeneratorExit raised inside it.</p>
</dd></dl>

<dl class="method">
<dt id="kaa.async.InProgress.connect">
<tt class="descname">connect</tt><big>(</big><em>callback</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#kaa.async.InProgress.connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Connects a callback to be invoked when the InProgress has
returned normally (no exception raised).</p>
<p>If the asynchronous task raises an exception, the InProgress
finishes with that exception and the <a class="reference internal" href="#kaa.InProgress.exception" title="kaa.InProgress.exception"><tt class="xref py py-attr docutils literal"><span class="pre">exception</span></tt></a>
signal is emitted.</p>
</dd></dl>

<dl class="method">
<dt id="kaa.InProgress.connect_both">
<tt class="descname">connect_both</tt><big>(</big><em>finished</em>, <em>exception=None</em><big>)</big><a class="headerlink" href="#kaa.InProgress.connect_both" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenience function that connects a callback (or callbacks) to both
the InProgress (for successful result) and exception signals.</p>
<p>This function does not accept additional args/kwargs to be passed to
the callbacks.  If you need that, use <tt class="xref py py-meth docutils literal"><span class="pre">connect()</span></tt>
and <a class="reference internal" href="#kaa.InProgress.exception" title="kaa.InProgress.exception"><tt class="xref py py-attr docutils literal"><span class="pre">exception</span></tt></a>.connect().</p>
<p>If <em>exception</em> is not given, the given callable will be used for <strong>both</strong>
success and exception results, and therefore must be able to handle variable
arguments (as described for each callback below).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>finished</strong> &#8211; callback to be invoked upon successful completion; the
callback is passed a single argument, the result returned
by the asynchronous task.</li>
<li><strong>exception</strong> &#8211; (optional) callback to be invoked when the asynchronous task
raises an exception; the callback is passed three arguments
representing the exception: exception class, exception
instance, and traceback.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="kaa.InProgress.execute">
<tt class="descname">execute</tt><big>(</big><em>func</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#kaa.InProgress.execute" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute the given function and finish the InProgress object with the
result or exception.</p>
<p>If the function raises SystemExit or KeyboardInterrupt, those are
re-raised to allow them to be properly handled by the main loop.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>func</strong> (<em>callable</em>) &#8211; the function to be invoked</li>
<li><strong>args</strong> &#8211; the arguments to be passed to the function</li>
<li><strong>kwargs</strong> &#8211; the keyword arguments to be passed to the function</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the InProgress object being acted upon (self)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="kaa.InProgress.finish">
<tt class="descname">finish</tt><big>(</big><em>result</em><big>)</big><a class="headerlink" href="#kaa.InProgress.finish" title="Permalink to this definition">¶</a></dt>
<dd><p>This method should be called when the owner (creator) of the InProgress is
finished successfully (with no exception).</p>
<p>Any callbacks connected to the InProgress will then be emitted with the
result passed to this method.</p>
<p>If <em>result</em> is an unfinished InProgress, then instead of finishing, we
wait for the result to finish via <tt class="xref py py-meth docutils literal"><span class="pre">waitfor()</span></tt>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>result</strong> &#8211; the result of the completed asynchronous task.  (This can
be thought of as the return value of the task if it had
been executed synchronously.)</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">This method returns self, which makes it convenient to prime InProgress
objects with a finished value. e.g. <tt class="docutils literal"><span class="pre">return</span> <span class="pre">InProgress().finish(42)</span></tt></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="kaa.InProgress.throw">
<tt class="descname">throw</tt><big>(</big><em>type=None</em>, <em>value=None</em>, <em>tb=None</em>, <em>aborted=False</em><big>)</big><a class="headerlink" href="#kaa.InProgress.throw" title="Permalink to this definition">¶</a></dt>
<dd><p>This method should be called when the owner (creator) of the InProgress is
finished because it raised an exception.</p>
<p>Any callbacks connected to the <a class="reference internal" href="#kaa.InProgress.exception" title="kaa.InProgress.exception"><tt class="xref py py-attr docutils literal"><span class="pre">exception</span></tt></a> signal will
then be emitted with the arguments passed to this method.</p>
<p>The parameters correspond to sys.exc_info().  If they are not specified
then the current exception in sys.exc_info() will be used; this is
analogous to a naked <tt class="docutils literal"><span class="pre">raise</span></tt> within an <tt class="docutils literal"><span class="pre">except</span></tt> block.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>type</strong> &#8211; the class of the exception</li>
<li><strong>value</strong> &#8211; the instance of the exception</li>
<li><strong>tb</strong> &#8211; the traceback object representing where the exception took place</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="kaa.InProgress.timeout">
<tt class="descname">timeout</tt><big>(</big><em>timeout</em>, <em>callback=None</em>, <em>abort=False</em><big>)</big><a class="headerlink" href="#kaa.InProgress.timeout" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a new InProgress object linked to this one that will throw
<a class="reference internal" href="#kaa.TimeoutException" title="kaa.TimeoutException"><tt class="xref py py-class docutils literal"><span class="pre">TimeoutException</span></tt></a> if this object is not finished by the
given timeout.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>callback</strong> (<em>callable</em>) &#8211; called (with no additional arguments) just prior
to TimeoutException</li>
<li><strong>abort</strong> (<em>bool</em>) &#8211; invoke <a class="reference internal" href="#kaa.InProgress.abort" title="kaa.InProgress.abort"><tt class="xref py py-meth docutils literal"><span class="pre">abort()</span></tt></a> on the original InProgress
if the timeout occurs.</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a new <a class="reference internal" href="#kaa.InProgress" title="kaa.InProgress"><tt class="xref py py-class docutils literal"><span class="pre">InProgress</span></tt></a> object that is subject to the timeout</p>
</td>
</tr>
</tbody>
</table>
<p>If the original InProgress finishes before the timeout, the new InProgress
(returned by this method) is finished with the result of the original.</p>
<p>If a timeout does occur and the <tt class="docutils literal"><span class="pre">abort</span></tt> argument is False, the
original InProgress object is not affected: it is not finished with the
<tt class="xref py py-class docutils literal"><span class="pre">TimeoutException</span></tt>, nor is it aborted.  You can explicitly
abort the original InProgress:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@kaa.coroutine</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">read_from_socket</span><span class="p">(</span><span class="n">sock</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">sock</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">kaa</span><span class="o">.</span><span class="n">TimeoutException</span><span class="p">,</span> <span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">inprogress</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&#39;Error:&#39;</span><span class="p">,</span> <span class="n">msg</span>
        <span class="n">inprogress</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
</pre></div>
</div>
<p>Aside from the print statement, this is equivalent:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@kaa.coroutine</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">read_from_socket</span><span class="p">(</span><span class="n">sock</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">sock</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">abort</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="kaa.InProgress.wait">
<tt class="descname">wait</tt><big>(</big><em>timeout=None</em><big>)</big><a class="headerlink" href="#kaa.InProgress.wait" title="Permalink to this definition">¶</a></dt>
<dd><p>Blocks until the InProgress is finished.</p>
<p>The main loop is kept alive if waiting in the main thread, otherwise
the thread is blocked until another thread finishes the InProgress.</p>
<p>If the InProgress finishes due to an exception, that exception is
raised.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>timeout</strong> &#8211; if not None, wait() blocks for at most timeout seconds
(which may be fractional).  If wait times out, a
TimeoutException is raised.</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the value the InProgress finished with</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="kaa.InProgress.waitfor">
<tt class="descname">waitfor</tt><big>(</big><em>inprogress</em><big>)</big><a class="headerlink" href="#kaa.InProgress.waitfor" title="Permalink to this definition">¶</a></dt>
<dd><p>Connects to another InProgress object (A) to self (B).  When A finishes
(or throws), B is finished with the result or exception.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>inprogress</strong> (<a class="reference internal" href="#kaa.InProgress" title="kaa.InProgress"><tt class="xref py py-class docutils literal"><span class="pre">InProgress</span></tt></a>) &#8211; the other InProgress object to link to.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<h4>Properties</h4><dl class="attribute">
<dt id="kaa.InProgress.abortable">
<tt class="descname">abortable</tt><a class="headerlink" href="#kaa.InProgress.abortable" title="Permalink to this definition">¶</a></dt>
<dd><p>True if the asynchronous task this InProgress represents can be
aborted by a call to <a class="reference internal" href="#kaa.InProgress.abort" title="kaa.InProgress.abort"><tt class="xref py py-meth docutils literal"><span class="pre">abort()</span></tt></a>.</p>
<p>Normally <a class="reference internal" href="#kaa.InProgress.abort" title="kaa.InProgress.abort"><tt class="xref py py-meth docutils literal"><span class="pre">abort()</span></tt></a> will fail if there are no
callbacks attached to the <a class="reference internal" href="#kaa.InProgress.signals.abort" title="kaa.InProgress.signals.abort"><tt class="xref py py-attr docutils literal"><span class="pre">abort</span></tt></a> signal.
This property may be explicitly set to <tt class="xref docutils literal"><span class="pre">True</span></tt>, in which case
<a class="reference internal" href="#kaa.InProgress.abort" title="kaa.InProgress.abort"><tt class="xref py py-meth docutils literal"><span class="pre">abort()</span></tt></a> will succeed regardless.  An InProgress is
therefore abortable if the <tt class="docutils literal"><span class="pre">abortable</span></tt> property has been explicitly
set to True, or if there are callbacks connected to the
<a class="reference internal" href="#kaa.InProgress.signals.abort" title="kaa.InProgress.signals.abort"><tt class="xref py py-attr docutils literal"><span class="pre">abort</span></tt></a> signal.</p>
<p>This is useful when constructing an InProgress object that corresponds
to an asynchronous task that can be safely aborted with no explicit action.</p>
</dd></dl>

<dl class="attribute">
<dt id="kaa.InProgress.exception">
<tt class="descname">exception</tt><a class="headerlink" href="#kaa.InProgress.exception" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="../core/signals.html#kaa.Signal" title="kaa.Signal"><tt class="xref py py-class docutils literal"><span class="pre">Signal</span></tt></a> emitted when the asynchronous task this InProgress
represents has raised an exception.</p>
<p>Callbacks connected to this signal receive three arguments: exception class,
exception instance, traceback.</p>
</dd></dl>

<dl class="attribute">
<dt id="kaa.InProgress.failed">
<tt class="descname">failed</tt><a class="headerlink" href="#kaa.InProgress.failed" title="Permalink to this definition">¶</a></dt>
<dd><p>True if an exception was thrown to the InProgress, False if it was
finished without error or if it is not yet finished.</p>
</dd></dl>

<dl class="attribute">
<dt id="kaa.InProgress.finished">
<tt class="descname">finished</tt><a class="headerlink" href="#kaa.InProgress.finished" title="Permalink to this definition">¶</a></dt>
<dd><p>True if the InProgress is finished.</p>
</dd></dl>

<dl class="attribute">
<dt id="kaa.InProgress.result">
<tt class="descname">result</tt><a class="headerlink" href="#kaa.InProgress.result" title="Permalink to this definition">¶</a></dt>
<dd><p>The result the InProgress was finished with.  If an exception was thrown
to the InProgress, accessing this property will raise that exception.</p>
</dd></dl>

<h4>Signals</h4><dl class="attribute">
<dt id="kaa.InProgress.signals.abort">
<tt class="descname">abort</tt><a class="headerlink" href="#kaa.InProgress.signals.abort" title="Permalink to this definition">¶</a></dt>
<dd><p>Emitted when abort() is called.</p>
<dl class="describe">
<dt>
<tt class="descname">def callback(exc)</tt></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Param exc:</th><td class="field-body">an exception object the InProgress was aborted with.</td>
</tr>
<tr class="field"><th class="field-name">Type exc:</th><td class="field-body"><a class="reference internal" href="#kaa.InProgressAborted" title="kaa.InProgressAborted"><tt class="xref py py-class docutils literal"><span class="pre">InProgressAborted</span></tt></a></td>
</tr>
</tbody>
</table>
</dd></dl>

<p>If the task cannot be aborted, the callback can return False, which
will cause an exception to be raised by abort().</p>
</dd></dl>

</p>
</dd></dl>

</p>
<div class="section" id="inprogress-collections">
<h2>InProgress Collections<a class="headerlink" href="#inprogress-collections" title="Permalink to this headline">¶</a></h2>
<p><dl class="class">
<dt id="kaa.InProgressAny">
<em class="property">class </em><tt class="descclassname">kaa.</tt><tt class="descname">InProgressAny</tt><big>(</big><em>*objects</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#kaa.InProgressAny" title="Permalink to this definition">¶</a></dt>
<dd><p>InProgress object that finishes when <em>any</em> of the supplied InProgress
objects (in constructor) finish.</p>
<p>Sequences or generators passed as arguments will be flattened, allowing
for this idiom:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">yield</span> <span class="n">InProgressAll</span><span class="p">(</span><span class="n">func</span><span class="p">()</span> <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">coroutines</span><span class="p">)</span>
</pre></div>
</div>
<p>The initializer can take two optional kwargs: pass_index and filter.</p>
<p>If pass_index is True, the InProgressAny object then finishes with a
2-tuple, whose first element is the index (offset from 0) of the InProgress
that finished, and the second element is the result the InProgress was
finished with.</p>
<p>If pass_index is False, the InProgressAny is finished with just the result
and not the index.</p>
<p>If filter is specified, it is a callable that receives two arguments,
the index and finished result (as described above).  If the callable
returns True AND if there are other underlying InProgress objects that
could yet be finished, then this InProgressAny is _not_ finished.</p>
</dd></dl>

</p>
<p><dl class="class">
<dt id="kaa.InProgressAll">
<em class="property">class </em><tt class="descclassname">kaa.</tt><tt class="descname">InProgressAll</tt><big>(</big><em>*objects</em><big>)</big><a class="headerlink" href="#kaa.InProgressAll" title="Permalink to this definition">¶</a></dt>
<dd><p>InProgress object that finishes only when <em>all</em> of the supplied InProgress
objects (in constructor) finish.</p>
<p>The InProgressAll object then finishes with itself. The finished
InProgressAll is useful to fetch the results of the individual InProgress
objects.  It can be treated as an iterator, and can be indexed:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="p">(</span><span class="k">yield</span> <span class="n">kaa</span><span class="o">.</span><span class="n">InProgressAll</span><span class="p">(</span><span class="n">sock1</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">sock2</span><span class="o">.</span><span class="n">read</span><span class="p">())):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">ip</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</p>
</div>
<div class="section" id="inprogress-exceptions">
<h2>InProgress Exceptions<a class="headerlink" href="#inprogress-exceptions" title="Permalink to this headline">¶</a></h2>
<p>The following exceptions can be raised by InProgress methods.</p>
<p><dl class="class">
<dt id="kaa.TimeoutException">
<em class="property">class </em><tt class="descclassname">kaa.</tt><tt class="descname">TimeoutException</tt><big>(</big><em>msg</em>, <em>inprogress</em><big>)</big><a class="headerlink" href="#kaa.TimeoutException" title="Permalink to this definition">¶</a></dt>
<dd><p>This exception is raised by an <a class="reference internal" href="#kaa.InProgress" title="kaa.InProgress"><tt class="xref py py-class docutils literal"><span class="pre">InProgress</span></tt></a> returned by
<a class="reference internal" href="#kaa.InProgress.timeout" title="kaa.InProgress.timeout"><tt class="xref py py-meth docutils literal"><span class="pre">timeout()</span></tt></a> when the timeout occurs.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sock</span> <span class="o">=</span> <span class="n">kaa</span><span class="o">.</span><span class="n">Socket</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">yield</span> <span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;deadhost.com:80&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="k">except</span> <span class="n">kaa</span><span class="o">.</span><span class="n">TimeoutException</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;Connection timed out after 10 seconds&#39;</span>
</pre></div>
</div>
</dd></dl>

</p>
<p><dl class="class">
<dt id="kaa.InProgressAborted">
<em class="property">class </em><tt class="descclassname">kaa.</tt><tt class="descname">InProgressAborted</tt><a class="headerlink" href="#kaa.InProgressAborted" title="Permalink to this definition">¶</a></dt>
<dd><p>This exception is thrown into an InProgress object when 
<a class="reference internal" href="#kaa.InProgress.abort" title="kaa.InProgress.abort"><tt class="xref py py-meth docutils literal"><span class="pre">abort()</span></tt></a> is called.</p>
<p>For <a class="reference internal" href="threads.html#kaa.ThreadCallable" title="kaa.ThreadCallable"><tt class="xref py py-class docutils literal"><span class="pre">ThreadCallable</span></tt></a> and  <a class="reference internal" href="threads.html#kaa.ThreadPoolCallable" title="kaa.ThreadPoolCallable"><tt class="xref py py-class docutils literal"><span class="pre">ThreadPoolCallable</span></tt></a>
this exception is raised inside the threaded callable.  This makes it
potentially an asynchronous exception (when used this way), and therefore
it subclasses BaseException, similar in rationale to KeyboardInterrupt
and SystemExit, and also (for slightly different reasons) GeneratorExit,
which as of Python 2.6 also subclasses BaseException.</p>
</dd></dl>

</p>
</div>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="kaa.inprogress">
<tt class="descclassname">kaa.</tt><tt class="descname">inprogress</tt><big>(</big><em>obj</em><big>)</big><a class="headerlink" href="#kaa.inprogress" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a suitable <a class="reference internal" href="#kaa.InProgress" title="kaa.InProgress"><tt class="xref py py-class docutils literal"><span class="pre">InProgress</span></tt></a> for the given object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>obj</strong> &#8211; object to represent as an InProgress.</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">an <a class="reference internal" href="#kaa.InProgress" title="kaa.InProgress"><tt class="xref py py-class docutils literal"><span class="pre">InProgress</span></tt></a> representing <tt class="docutils literal"><span class="pre">obj</span></tt></p>
</td>
</tr>
</tbody>
</table>
<p>The precise behaviour of an object represented as an
<a class="reference internal" href="#kaa.InProgress" title="kaa.InProgress"><tt class="xref py py-class docutils literal"><span class="pre">InProgress</span></tt></a> should be defined in the documentation for the
class.  For example, the <a class="reference internal" href="#kaa.InProgress" title="kaa.InProgress"><tt class="xref py py-class docutils literal"><span class="pre">InProgress</span></tt></a> for a
<a class="reference internal" href="../core/process.html#kaa.Process" title="kaa.Process"><tt class="xref py py-class docutils literal"><span class="pre">Process</span></tt></a> object will be finished when the process is
terminated.</p>
<p>This function simply calls <tt class="docutils literal"><span class="pre">__inprogress__()</span></tt> of the given <tt class="docutils literal"><span class="pre">obj</span></tt> if one
exists, and if not will raise an exception.  In this sense, it behaves
quite similar to <tt class="docutils literal"><span class="pre">len()</span></tt> and <tt class="docutils literal"><span class="pre">__len__()</span></tt>.</p>
<p>It is safe to call this function on InProgress objects.  (The InProgress
object given will simply be returned.)</p>
<p>A practical demonstration of this protocol is in the Signal object,
which implements the __inprogress__ method. The returned InProgress in
that case is finished when the signal is next emitted. Any object
implementing the __inprogress__ protocol can be passed directly to the
constructor of InProgressAny or InProgressAll.</p>
</dd></dl>

<dl class="function">
<dt id="kaa.delay">
<tt class="descclassname">kaa.</tt><tt class="descname">delay</tt><big>(</big><em>seconds</em><big>)</big><a class="headerlink" href="#kaa.delay" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an InProgress that finishes after the given time in seconds.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>obj</strong> &#8211; object to represent as an InProgress.</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#kaa.InProgress" title="kaa.InProgress"><tt class="xref py py-class docutils literal"><span class="pre">InProgress</span></tt></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">InProgress Objects</a><ul>
<li><a class="reference internal" href="#inprogress-collections">InProgress Collections</a></li>
<li><a class="reference internal" href="#inprogress-exceptions">InProgress Exceptions</a></li>
<li><a class="reference internal" href="#functions">Functions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../core/event.html"
                        title="previous chapter">Events and Event Handlers</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="coroutines.html"
                        title="next chapter">Coroutines</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/async/inprogress.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="coroutines.html" title="Coroutines"
             >next</a> |</li>
        <li class="right" >
          <a href="../core/event.html" title="Events and Event Handlers"
             >previous</a> |</li>
        <li><a href="../index.html">kaa.base v0.99.2dev-382-8399342e documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2005-2012, Dirk Meyer, Jason Tackaberry.
      Last updated on May 13, 2012.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.1.
    </div>
  </body>
</html>