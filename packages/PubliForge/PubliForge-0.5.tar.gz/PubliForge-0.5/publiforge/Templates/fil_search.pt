<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="base">
<head><title></title></head>
<body>
<div id="mainPanel" metal:fill-slot="main">
  ${form.begin()}
  <div id="main">
    <!-- ........................... Search criteria ...................... -->
    <div id="search">
      ${form.grid_text('files', _('Searched files:'))}
      ${form.grid_text('words', _('Searched words:'))}
      <div class="formItem">
        <label for="scope"><em>${_('Scope:')}</em></label>
        <div id="scope">
          <div tal:repeat="item scope">
            ${form.checkbox('~%s' % item[0])} ${item[1]}
          </div>
        </div>
      </div>
      <div class="submit">
        ${form.submit('submit', _('Launch search'), class_='buttonMain slow')}
      </div>
    </div>
    <hr/>
    <!-- ........................... Containers ........................... -->
    <div tal:condition="results" tal:define="container load: container.macro.pt" metal:use-macro="container"/>
    <!-- ............................. Flash .............................. -->
    <div tal:define="flash load: flash.macro.pt" metal:use-macro="flash"/>
    <!-- ............................... Result ........................... -->
    <div tal:condition="results" tal:define="join import: os.path.join">
      <div class="listActions">
        <div class="first">${_('Number of items: ${n}', dict(n=len(results)))}</div>
        <div class="last">Â 
        <span tal:condition="'project' in request.session and 'container' not in request.session" tal:omit-tag="">
          ${form.submit_image('npk!#', _('Create a pack with selected files for "${p}"', dict(p=request.session['project']['label'])),
          '/Static/Images/action_pack.png')}
        </span>
        </div>
      </div>
      <table class="list">
        <tr>
          <th class="checkbox">${form.checkbox('check_all')}</th>
          <th>${_('Pertinence')}</th>
          <th>${_('Storage')}</th>
          <th>${_('File')}</th>
          <th class="last">${_('Actions')}</th>
        </tr>
        <tr tal:repeat="item results">
          <td class="checkbox">
            ${form.checkbox('#%s' % join(item[2], item[3]), id=None, class_='listCheck')}
          </td>
          <td>${item[0]}%</td>
          <td>
            <a href="${route('storage_root', storage_id=item[2])}" class="slow">${item[2]}</a>/
          </td>
          <td>
            <img src="/Static/Images/MimeTypes/${item[1] if item[1] in FILE_TYPES else 'unknown'}.png"
                 alt="${item[1]}" title="${item[1]}"/>
            <a href="${route('file_download', storage_id=item[2], path=item[3])}">${item[3]}</a>
          </td>
          <td class="last">
            ${form.button(route('file_info', storage_id=item[2], path=item[3]),
              src='/Static/Images/action_info_one.png', title=_('File information'), class_="slow")}
            ${form.button(route('storage_browse', storage_id=item[2], path=item[3]),
              src='/Static/Images/action_browse.png', title=_('View in storage'), class_="slow")}
          </td>
        </tr>
      </table>
    </div>
  </div>
  ${form.end()}
</div>  
</body>
</html>