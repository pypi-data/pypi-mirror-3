<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionledger">

<body>
  <div metal:fill-slot="main">

    <metal:payslip metal:define-macro="payslip">

    <tal:variables tal:define="txn python: context.blTransaction();
                     employee nocall: context/aq_parent;
                     gross_id python: context.Ledger.accountsForTag('wages_exp')[0].getId();
                     tax_id python: context.Ledger.accountsForTag('wages_tax')[0].getId()">

    <table summary="" border="0" cellpadding="2" cellspacing="0" width="100%">
       <tr>
           <td align="left" valign="top" tal:content="context/aq_parent/aq_parent/aq_parent/title"/>
           <td align="right" valign="top">
               <table summary="">
                  <tr>
                     <td class="label">Date</td>
                     <td class="form-element" 
                         tal:content="python: txn.effective_date.strftime('%Y/%m/%d')"/>
                  </tr>
               </table>
           </td>
       </tr>
    </table>
    <table summary="" border="0" cellpadding="2" cellspacing="0" width="100%" bgcolor="silver">
       <tr>
           <td valign="top">
              <table summary="" border="0" cellpadding="2" cellspacing="0" width="100%">
                <tr>
                    <td class="label">Employee No.</td>
                    <td class="form-element" tal:content="employee/getId"/>
                    <td class="label">Salary P.A.</td>
                    <td class="form-element" tal:content="employee/salary"/>
                </tr>
                <tr>
                    <td class="label">Name</td>
                    <td class="form-element" tal:content="employee/title"/>
                    <td class="label">Bank Account</td>
                    <td class="form-element" tal:content="employee/bank_account"/>
                </tr>
                <tr>
                    <td class="label">Department</td>
                    <td class="form-element" tal:content="employee/department"/>
                    <td class="label">Tax Number</td>
                    <td class="form-element" tal:content="employee/tax_number"/>
                </tr>
                <tr>
                    <td colspan="2">&nbsp;</td>
                    <td class="label">Tax Code</td>
                    <td class="form-element" tal:content="employee/tax_code"/>

                </tr>
            </table>
           </td>
        </tr>
        <tr>
           <td valign="top">
             <table summary="" border="0" cellpadding="3" cellspacing="3" width="100%">
               <tr>
                 <td width="35%" valign="top">
                   <table summary="" border="1" cellpadding="2" cellspacing="0" bgcolor="white" width="100%"
                          tal:define="gross python: txn.entry(gross_id)">
                     <tr>
                          <td colspan="3" align="center" class="label">Taxable Payments</td>
                     </tr>
                     <tr class="list-header">
                          <td class="label">Type</td>
                          <td class="label">Quantity</td>
                          <td class="label">Value</td>
                     </tr>
                     <tr>
                          <td height="200" valign="top" class="form-element" tal:content="gross/title"/>
                          <td></td>
                          <td align="right" valign="top" class="form-element" nowrap tal:content="gross/amount"/>
                      </tr>
                     <tr>
                          <td colspan="2" class="label">Total Taxable</td>
                          <td align="right" class="form-element" nowrap tal:content="gross/amount"/>
                      </tr>
                 </table>
               </td>
               <td width="35%" valign="top">
                 <table summary="" border="1" cellpadding="2" cellspacing="0" bgcolor="white" width="100%">
                     <tr>
                          <td colspan="3" align="center" class="label">Non-Taxable Payments</td>
                     </tr>
                     <tr class="list-header">
                          <td class="label">Type</td>
                          <td class="label">Quantity</td>
                          <td class="label">Value</td>
                     </tr>
                     <tr>
                          <td height="200"></td>
                          <td></td>
                          <td></td>
                      </tr>
                     <tr>
                          <td colspan="2" class="label">Total Non-Taxable</td>
                          <td></td>
                      </tr>
                 </table>
               </td>
               <td width="25%" valign="top">
                  <table summary="" border="1" cellpadding="2" cellspacing="0" bgcolor="white" width="100%"
                         tal:define="tax python: txn.entry(tax_id)">
                     <tr>
                          <td colspan="2" align="center" class="label">Deductions</td>
                     </tr>
                     <tr class="list-header">
                          <td class="label">Description</td>
                          <td class="label">Amount</td>
                     </tr>
                     <tr>
                          <td height="200" valign="top" class="form-element" tal:content="tax/title"/>
                          <td valign="top" align="right" class="form-element" nowrap tal:content="tax/absAmount"/>
                      </tr>
                      <tr>
                          <td class="label">Total Deductions</td>
                          <td align="right" class="form-element" nowrap tal:content="tax/absAmount"/>
                      </tr>
                </table>
               </td>
              </tr>
             </table>
           </td>
        </tr>
         <tr>
            <td valign="top">
                <table summary="" border="0" cellpadding="3" cellspacing="3" width="100%">
                   <tr>
                       <td width="40%" valign="top">
                   <table summary="" border="1" cellpadding="2" cellspacing="0" bgcolor="white" width="100%">
                     <tr>
                          <td colspan="3" align="center" class="label">Year To Date</td>
                     </tr>
                     <tr class="list-header">
                          <td class="label">Gross Taxable</td>
                          <td class="label">Tax</td>
                          <td class="label">Net</td>
                     </tr>
                     <tr>
                          <td align="right" valign="center" height="40" class="form-element"
                              tal:content="context/gross_to_date"/>
                          <td align="right" valign="center" class="form-element"
                              tal:content="python: abs(context.tax_to_date)"/>
                          <td align="right" valign="center" class="form-element"
                              tal:content="python: -context.net_to_date"/>
                     </tr>
                    </table>
                       </td>
                        <td height="80" valign="top">
                            <table summary="" bgcolor="white" width="100%" height="80">
                               <tr><td class="label" valign="top">Message</td></tr>
                               <tr><td tal:content="structure context/message | nothing"/></tr>
                            </table>
                        </td>
                        <td valign="bottom" width="20%">
                             <table summary="" bgcolor="white" width="100%">
                               <tr>
                                   <td class="label">NET</td>
                                   <td align="right" class="form-element"
                                       tal:content="python:txn.entry(employee.getId()).absAmount()"/>
                               </tr>
                            </table>
                         </td>
                 </tr>
                </table>
            </td>
        </tr>
      </table>
    </tal:variables>
    </metal:payslip>

      <div tal:replace="structure provider:plone.documentactions">
           Document actions (print, sendto etc)
      </div>

  </div>

</body>
</html>
