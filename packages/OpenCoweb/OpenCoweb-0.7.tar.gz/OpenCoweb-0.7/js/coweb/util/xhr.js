define(["coweb/util/Promise"],function(a){var b=function(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&a.setRequestHeader(c,b[c])};return{send:function(c){var d=new a,e=new XMLHttpRequest;c.xhr=d.xhr=e,e.onreadystatechange=function(a){a=a||window.event;var b=e.readyState;if(b===4){e.onreadystatechange=function(){};var f;try{f=e.status||0}catch(g){f=0}f>=200&&f<300||f===304||f===1223?d.resolve(c):(c.error=new Error("failed loading "+c.url+" status:"+f),d.fail(c))}};try{e.open(c.method,c.url,c.sync!==!0),b(e,c.headers),e.send(c.body||null)}catch(f){c.onError("failed sending xhr to "+c.url,f);throw f}return d}}})