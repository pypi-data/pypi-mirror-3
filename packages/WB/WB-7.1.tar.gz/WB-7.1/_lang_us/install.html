<table width="100%" cellpadding=5><tr>
<td bgcolor=#5555ff width=45><a href=about.html><img src=../_img/wb.png></a></td>
<td bgcolor=#ccccff><h3> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
Installing WB </h3></td></tr></table>

<p>
<center>
Luca Fini (<i>lfini@arcetri.astro.it</i>). September 2006
</center>
<p>

<table width="100%" border=1><tr>
<th width="16%"><a href=about.html>About</a></th>
<th width="16%">Install</th>
<th width="16%"><a href=config.html>Config</a></th>
<th width="16%"><a href=help.html>Usage</a></th>
<th width="16%"><a href=copyright.html>Copyright</a></th>
<th width="16%"><a href=wbfaq.html>F.A.Q.</a></th></tr>
</table>

<a name=install>
<h3> Moving files to place</h3>
</a>
To proceed with WB installation you must first locate two directories on
the machine which holds your web server:
the <i>CGI directory</i> and the <i>document root</i>. The <i>CGI directory</i> is
where you must put CGI executables so that the Web server can execute them.
This may vary for different sites; usual places are:

<blockquote>
<tt>/usr/local/apache/cgi-bin</tt><br>
<tt>/var/www/cgi-bin</tt>
</blockquote>

The document root will also be somewhere, depending on the 
configuration of your server; usual places are:

<blockquote>
<tt>/var/www/html</tt><br>
<tt>/opt/htdocs</tt><br>
<tt>/var/htdocs</tt><br>
</blockquote>

and the like.  
<p>
<center> <table width=80% border=1 cellpadding=4> <tr><td bgcolor=#dddddd> <font size=-1>
<b>Note:</b> If you're running an apache Web server you can find out 
the location of the two directories into the configuration file
(<tt>httpd.conf</tt>).
You must look for the variables: <tt>ScriptAlias</tt> and <tt>DocumentRoot</tt>.
</font> </td></tr></table> </center>

<p> <b>WB</b> installation is made in a few steps:

<p>
<ol>
<p><li>Create a subdirectory under the <i>document root</i>
to hold all your billboards; E.g.:

<blockquote>
<tt>&gt; mkdir /var/www/html/BillBoards</tt>
</blockquote>


<p><li> Unpack the WB files into the billboard directory just created. E.g.:
<blockquote>
<tt>&gt; tar xvfz wb.tgz</tt>
</blockquote>
or
<blockquote>
<tt>&gt; gunzip -c wb.tgz | tar xvf </tt>
</blockquote>

<p><li> Move the programs <tt>wb.py</tt> and <tt>wbmgmt.py</tt> into the CGI directory. E.g.:

<blockquote>
<tt>&gt; mv wb.py wbmgmt.py /var/www/cgi-bin</tt>
</blockquote>

<p><li>
The <tt>http</tt> server must have permission to write to this directory.
The easiest way is to define the userid which is running the server as
owner of the directory. You must check your particular installation
to know which is the actual userid (it is usually "apache", or maybe "cochise" or even "nobody").
You may use the <tt>ps</tt> command as follows:

<pre>
: ps -ef | grep httpd
    root   624     1  0   Jul 05 ?        0:09 /usr/local/apache2/bin/httpd 
 cochise 27509   624  0 16:34:03 ?        0:00 /usr/local/apache2/bin/httpd
 cochise 27421   624  0 16:33:05 ?        0:00 /usr/local/apache2/bin/httpd
 ..... more lines ...</pre>

Ignore the "root" line. The other are the actual userid you need.

<p>
<center> <table width=80% border=1 cellpadding=4> <tr><td bgcolor=#dddddd> <font size=-1>
<b>Note:</b> 
various Unix(Linux) versions may have sligtly different syntax for the ps
command. E.g: <tt>ps aux</tt>
</font> </td></tr></table> </center>
<p>

<p><li> Finally edit the <tt>wb.py</tt> code to reflect the details of
        you installation. Here follows the involved lines:
<blockquote>
<pre># Start customization section  
root_http   = 'http://www.my.domain/BillBoards'  
root_dir    = '/var/www/html/BillBoards'  
domain      = 'my.domain'         # e-mail domain  
smtphost    = 'smtp.my.domain'    # smtp host  
def_lang    = 'us'                # Get language from directory _lang_us
auth_mode   = 'unix'              # Specify user authorization method
debug       = 0                   # Set to 1 for debug output  
def_ttl     = 600                 # Session expiring time  
dolog       = 1                   # Set to 0 for no logging </pre> 
</tt></blockquote>

As a starting point you only need to modify the first five items, as follows:
<p>
<dl>
<dt> <b>root_http</b>
<dd> The URL of the BillBoard directory on your web server. In the example above 
     we have supposed that the billboard directory has been created just under
     the <i>Document Root</i>.
<p>
<dt> <b>root_dir</b>
<dd> The directory path of the same BillBoard directory.
<p>
<dt> <b>domain</b>
<dd> Mail domain you want to be used to send notify messages. Messages
     will be sent as coming from the address: <tt>wb@my.domain</tt>
<p>
<dt> <b>smtphost</b>
<dd> The outgoing mail server for your domain
<p>
<dt> <b>def_lang</b>
<dd> The name of the vocabulary file supporting the desired default
     language (Note: different languages can be selected for each
     billboard defined. See: <a href=config.html>configuration</a>).
<p>
<dt> <b>auth_method</b>
<dd> This variable may be either 'unix', or 'local'. User access for
     adding or updating document is protected by userid/password check.
     If the value is 'unix' the password check is performed with the standard
     unix mechanism, i.e.: authorized users must be registered as unix users 
     on the host running the system.<br>
     If the value is 'local' user authentication is performed against a WB specific
     password file which is independent from host user authentication. The local password
     file may be managed by using <tt>wb.py -u</tt>, <tt>wb.py -l</tt>, <tt>wb.py -r</tt>.

</dl>

<p><li>As a final step you must ensure that the <tt>wb.py</tt> program can
       be executed by the web server, and the support files stored in
       the billboard root can be read by <tt>wb.py</tt>. 
       For doing that you may need
       to properly modify the ownership or the rights of the files.
</ol>
<h3>Testing the installation</h3>

<ol>
<p><li> Try to run the <tt>wb.py</tt> from a command line, 
just to see what happens. E.g.:

<blockquote>
<tt>&gt; python wb.py

wb.py - L.Fini (lfini@arcetri.astro.it). Version 4.11, October 2005 

Usage: wb.py -i directory     show billboard info
       wb.py -m [directory]   perform billboard maintenance [only on specified dir]
       wb.py -s bboard doc    show document file structure
       wb.py -u user passwd   add user/password to local password file
       wb.py -v directory     show available languages
</blockquote>

<center> <table width=80% border=1 cellpadding=5> <tr><td bgcolor=#dddddd> <font size=-1>
<b>Note:</b>  You may notice that the program <tt>wb.py</tt> can also be run
as an usual program from a command line. This is useful to perform programmed
maintenance on the billboards (see below).
</font> </td></tr></table> </center>

<p><li> Check the "self run" line, by running again the program. E.g.:

<blockquote>
<tt>&gt; /var/www/cgi-bin/wb.py</tt><pre>
</blockquote>

And you should see the same output as above.
If it doesn't work, check the exact path of your <tt>python</tt> interpreter.
E.g.:

<blockquote>
<tt>&gt; which python </tt><pre>
/usr/bin/python</pre>
</blockquote>

The same path must be written in the very first line of <b>wb.py</b>, as
follows:
<blockquote>
#!/usr/bin/python
</blockquote>


<p><li> Check if you can run the <tt>wb.py</tt> program as a CGI application. Just point your
browser to the right URL, from anywhere on the Internet:

<blockquote>
http://www.my.domain/cgi-bin/wb.py
</blockquote>

And you should see a list of available billboards. <b>Note:</b> You will not actually
see any billboard, because you haven't defined one as yet!
</ol>
<p>
It is now time to proceed to <a href=config.html>configuration</a> in order to define your first billboard.

<h3>Billboard directory maintenance</h3>

Expired documents can be removed from the billboard directory. It is not easy
to do it at the O.S. level: file names are not obvius and documents may have attachments
which must be also deleted. <b>WB</b> provides a
function in its "maintenance" toolset to do that from the Web interface, but a system manager
may want to do it automatically.
<p>
This is as simple as setting up a "cron" item which is started once per day and launches the
<tt>wb.py</tt> script in maintenance mode. E.g.:


<blockquote>
<tt>&gt; python /var/www/cgi-bin/wb.py -m /var/www/html/BillBoards/myboard</tt>
</blockquote>

Where "myboard" is the name of a billboard file you want to be maintained clean.
The command will check all documents and orderly remove expired ones.

<h3>Debugging WB</h3>

When everything fails, you may activate a debug mode in two ways:

<ol>
<li> You can copy the <tt>wb.py</tt> script into a file named 
    <tt>wt.py</tt> (note the final "t" in the file name), and then launch wb with
the new name.

<li> Editing <tt>wb.py</tt> and setting the <tt>debug</tt> variable
to 1 (don't forget to set it back to 0 when finished).
</ol>
<p>
When in debug mode <b>WB</b> will output much information when running
and the standard CGI/python 
traceback function will be enabled.
