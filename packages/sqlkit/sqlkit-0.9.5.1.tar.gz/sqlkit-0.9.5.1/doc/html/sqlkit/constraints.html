<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      
      <title>
    Constraints
 &mdash; sqlkit v0.9.5.1 documentation</title>
      
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sqlkit.css" type="text/css" />
    <link rel="stylesheet" href="../_static/print.css" type="text/css" media="print" />

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="sqlkit v0.9.5.1 documentation" href="../index.html" />
        <link rel="up" title="Browsing data" href="browsing.html" />
        <link rel="next" title="Filters" href="filters.html" />
        <link rel="prev" title="Browsing data" href="browsing.html" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '0.9.5.1',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>


<!-- <link rel="stylesheet" href="http://www.myjqueryplugins.com/plugins/jmenu/demo/jquery/jMenu.jquery.css" type="text/css" /> -->
      <link rel="stylesheet" href="../_static/jMenu.jquery.css" type="text/css" />

      <!-- <script type="text/javascript" src="http://www.myjqueryplugins.com/plugins/jmenu/demo/jquery/jMenu.jquery.js"></script> -->

      <script type="text/javascript">

	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-18221996-2']);
	_gaq.push(['_trackPageview']);

	(function() {
	  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();

      </script>
      <script type="text/javascript" src="../_static/jMenu.jquery.js"></script>
      <script type="text/javascript">
	      $(document).ready(function(){
		      $("#jMenu").jMenu({
			      ulWidth : '150',
			      effects : {
				      effectSpeedOpen : 300,
				      effectSpeedClose : 300,
				      effectTypeOpen : 'slide',
				      effectTypeClose : 'slide',
				      effectOpen : 'linear',
				      effectClose : 'linear'
			      },
			      TimeBeforeOpening : 100,
			      TimeBeforeClosing : 400,
			      animatedText : false,
			      paddingLeft: 1		});
	      })
      </script>
<!-- Preview -->
     <script type="text/javascript" src="../_static/imgpreview.js"></script>
     <script type="text/javascript">
       $(document).ready(function(){
           $('.preview').imgPreview();
       });
     </script>
     
     <!--[if !IE 7]>
	     <style type="text/css">
		     #wrap {display:table;height:100%}
	     </style>
     <![endif]-->
    </head>
    <body>
        




<div id="wrap">
    
<div id="header">

	<div class="logo"><a href="../misc/tour.html">
       <img src="../_static/sqlkit.png" align="left"  alt="Logo" border="0"/></a>
        </div>
	<div id="description">Acces to db made easy</div>
</div>


   <div style="clear:left;"></div>


<div >
	<ul id="jMenu">
            <li><a class="fNiv" href="../index.html" title="Home" 
                  >Home</a></li>

            <li><a li class="fNiv" href="contents.html"
                  title="Sqlkit - the python package" 
                  >Sqlkit</a>

	       <ul>
		 <li ><a href="contents.html"
		       title="Sqlkit - the python package" 
		       >Sqlkit</a></li>

		 <li ><a href="sqlwidget.html" title="Widgets" 
		       >Widgets</a>
		       <ul> 
			 <li ><a href="mask.html" title="Mask" 
			       >Mask view</a></li>
			 <li ><a href="table.html" title="Table" 
			       >Table view</a></li>
		       </ul>
                 </li>
		 <li ><a href="browsing.html" title="Browsing Data" 
		       >Browsing data</a>
		    <ul> 
		      <li ><a href="#" title="Constraints" 
			    >Constraints</a></li>
		      <li ><a href="filters.html" title="Filters" 
			    >Filters</a></li>
		      <li ><a href="totals.html" title="Totals" 
			    >Totals</a></li>
		    </ul>
                 </li>
		 <li ><a href="editing.html" title="Editing Data" 
		       >Editing data</a>
			 <ul> 
			   <li ><a href="completion.html" title="Completion" 
				 >Completion</a></li>
			   <li ><a href="validation.html" title="Validation" 
				 >Validation</a></li>
			   <li ><a href="relationship.html" title="Relationships" 
				 >Relationships</a></li>
			 </ul>
		       </li>
		 <li ><a href="printing.html" title="Printing" 
		       ><span>Printing</span></a></li>
		 <li ><a href="advanced/contents.html" title="Advanced configuration" 
		       >Advanced configuration</a>
			 <ul> 
			   <li ><a href="advanced/fields.html" title="Fields" 
				 >Fields</a></li>
			   <li ><a href="advanced/views.html" title="Views" 
				 >Views</a></li>
			 </ul>
		       </li>

	       </ul>
            </li>

            <li><a class="fNiv" href="../misc/sqledit.html"
                  title="Sqledit GUI" 
                  >Sqledit GUI</a></li>

            <li><a class="fNiv" href="../misc/tutorials.html"
                  title="Support & tutorials" 
                  >Support & Tutorials</a>
	       <ul>
		 <li ><a href="../misc/sqledit.html"
		       title="Sqledit - the application" 
		       >Sqledit - the application</a></li>
		 <li ><a href="../misc/tour.html"
		       title="Sqlkit - the features'tour"
		       >Sqlkit - features' tour</a></li>
		 <li ><a href="../misc/sqledit.html"
		       title="Sqledit - the application" 
		       >Installing instructions</a></li>
		</ul> 
            </li>

            <li><a class="fNiv" href="../layout/contents.html" title="Layout"
                  >Layout</a></li>

            <li><a  class="fNiv"href="../misc/contents.html" title="Download" 
                  >Download</a>

	       <ul>
		 <li ><a href="../misc/contents.html"
		       title="Download"
		       >Download</a></li>
		 <li ><a href="http://sqlkit.argolinux.org/download/Changelog"  title="Changelog"
		       title="Changelog"
		       >Changelog</a></li>
		 <li ><a href="../misc/backward_incompatibilities.html"
		       title="Backward incompatibilities"
		       >Backward incompatibilities</a></li>
	       </ul>
            </li>



        </ul>
</div>
   <div style="clear:left;"></div>

    
    <div class="related">
      <ul>
	
<!-- <div class="prevnext"> -->
<!--    <li class="right"  style="margin-right: 10px">Indice -->
<!--      <a href="../genindex.html" title="Indice generale" -->
<!--                accesskey="I">indice</a></li> -->

        <li class="right">Prev:
        <a href="browsing.html" title="previous chapter">Browsing data</a></li>
        <li class="right">Next:
        <a href="filters.html" title="next chapter">Filters</a></li>
<!-- </div> -->


      </ul>

    </div>

    
  <div class="sphinxsidebar">
     <div class="sphinxsidebarwrapper">


	    <div class="topnav">
    <h3>Table of contents</h3>
		    <ul>
<li><a class="reference external" href="#">Constraints</a><ul>
<li><a class="reference external" href="#django-like-syntax">Django-like syntax</a></li>
<li><a class="reference external" href="#query">query</a><ul>
<li><a class="reference external" href="#operators">operators</a></li>
<li><a class="reference external" href="#conjunctions">conjunctions</a></li>
<li><a class="reference external" href="#django2sqlalchemy">django2sqlalchemy</a></li>
<li><a class="reference external" href="#module-sqlkit.db.django_syntax">Filter simplified syntax</a><ul>
<li><a class="reference external" href="#django-syntax-utilities">Django syntax utilities</a><ul>
<li><a class="reference external" href="#supported-lookup">supported lookup</a></li>
<li><a class="reference external" href="#id2">conjunctions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference external" href="#native-sqlalchemy-constraint">Native sqlalchemy constraint</a><ul>
<li><a class="reference external" href="#aliased-constraints">aliased constraints</a><ul>
<li><a class="reference external" href="#example">example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

		<div class="clearboth"></div>
	    </div>



    <h3>Questions?</h3>

    <p>Subscribe to out mailing list <a href="http://groups.google.com/group/sqlkit">
       Google group</a>:</p>

    <form action="http://groups.google.com/group/sqlkit/boxsubscribe" style="padding-left: 1em">
      <input type="text" name="email" value="your@email"/>
      <input type="submit" name="sub" value="Subscribe" />
    </form>
    <div id="searchbox" style="display: none">

    <h3>Quick search</h3>
	<form class="search" action="../search.html" method="get">
	  <input type="text" name="q" size="18" />
	  <input type="submit" value="Search" />
	  <input type="hidden" name="check_keywords" value="yes" />

	  <input type="hidden" name="area" value="default" />
	</form>
	<p class="searchtip" style="font-size: 90%">
        Enter search terms or a module, class or function name.
	</p>
    <h3>License</h3>
	<img src="../_static/gplv3.png" alt="logo GPLv3">

    </div>
    <script type="text/javascript">$('#searchbox').show(0);</script>

     </div>
  </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">

            <div class="body">
                
<div class="section" id="constraints">
<span id="id1"></span><h1>Constraints<a class="headerlink" href="#constraints" title="Permalink to this headline">¶</a></h1>
<p>Constraints are a mean to limit browsing of data to a limited set. It&#8217;s a
different concept from filtering, as this enforces a limitation while
filtering allows the user to change the values at will.</p>
<div class="section" id="django-like-syntax">
<span id="django-syntax"></span><h2>Django-like syntax<a class="headerlink" href="#django-like-syntax" title="Permalink to this headline">¶</a></h2>
<p>A constraint can be as simple as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span> <span class="o">=</span> <span class="n">SqlTable</span><span class="p">(</span><span class="s">&#39;movie&#39;</span><span class="p">,</span> <span class="n">dbproxy</span><span class="o">=</span><span class="n">db</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">add_constraints</span><span class="p">(</span><span class="n">actors__country</span><span class="o">=</span><span class="s">&#39;ITA&#39;</span><span class="p">,</span> <span class="n">genres__name</span><span class="o">=</span><span class="s">&#39;drama&#39;</span><span class="p">,</span>
                  <span class="n">year__gte</span><span class="o">=</span><span class="mi">1950</span><span class="p">,</span> <span class="n">year__lte</span><span class="o">=</span><span class="mi">1970</span><span class="p">)</span>
</pre></div>
</div>
<p>And browsing of movies will be constrained into dramas with at least one
Italian actor, produced between 1950 and 1970. The double underscore &#8216;__&#8217;
will allow spanning from one table to a related one (provided a relation was
established at sqlalchemy level) and from attribute name to operator to be
used.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This syntax is inspired to <a class="reference external" href="http://www.djangoproject.com">django</a>&#8216;s ORM syntax.
The same syntax can be used to add filters to the sqlwidget, to the <a class="reference external" href="completion.html#filter-completion"><em>completion</em></a> and when <tt class="docutils literal"><span class="pre">.reload()</span></tt> method is used.</p>
</div>
</div>
<div class="section" id="query">
<h2>query<a class="headerlink" href="#query" title="Permalink to this headline">¶</a></h2>
<p>limitation acts on <tt class="docutils literal"><span class="pre">self.query</span></tt> directly. Self query can be modified in
any way accepted by <tt class="docutils literal"><span class="pre">sqlalchemy</span></tt> syntax</p>
<div class="section" id="operators">
<h3>operators<a class="headerlink" href="#operators" title="Permalink to this headline">¶</a></h3>
<p>these operators are recognized:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">OPERATORS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;notlike&#39;</span>    <span class="p">:</span> <span class="s">&#39;not like&#39;</span><span class="p">,</span>
    <span class="s">&#39;like&#39;</span>       <span class="p">:</span> <span class="s">&#39;like&#39;</span><span class="p">,</span>
    <span class="s">&#39;ilike&#39;</span>      <span class="p">:</span> <span class="s">&#39;ilike&#39;</span><span class="p">,</span>
    <span class="s">&#39;notilike&#39;</span>   <span class="p">:</span> <span class="s">&#39;not ilike&#39;</span><span class="p">,</span>
    <span class="s">&#39;iregexp&#39;</span>    <span class="p">:</span> <span class="s">&#39;~*&#39;</span><span class="p">,</span>
    <span class="s">&#39;regexp&#39;</span>     <span class="p">:</span> <span class="s">&#39;~&#39;</span><span class="p">,</span>
    <span class="s">&#39;notiregexp&#39;</span> <span class="p">:</span> <span class="s">&#39;!~*&#39;</span><span class="p">,</span>
    <span class="s">&#39;notregexp&#39;</span>  <span class="p">:</span> <span class="s">&#39;!~&#39;</span><span class="p">,</span>
    <span class="s">&#39;lt&#39;</span>         <span class="p">:</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span>
    <span class="s">&#39;gt&#39;</span>         <span class="p">:</span>  <span class="s">&#39;&gt;&#39;</span><span class="p">,</span>
    <span class="s">&#39;lte&#39;</span>        <span class="p">:</span> <span class="s">&#39;&lt;=&#39;</span><span class="p">,</span>
    <span class="s">&#39;gte&#39;</span>        <span class="p">:</span> <span class="s">&#39;&gt;=&#39;</span><span class="p">,</span>
    <span class="s">&#39;eq&#39;</span>         <span class="p">:</span> <span class="s">&#39;=&#39;</span><span class="p">,</span>
    <span class="s">&#39;neq&#39;</span>        <span class="p">:</span> <span class="s">&#39;!=&#39;</span><span class="p">,</span>
    <span class="s">&#39;equal&#39;</span>      <span class="p">:</span> <span class="s">&#39;=&#39;</span><span class="p">,</span>
    <span class="s">&#39;in&#39;</span>         <span class="p">:</span> <span class="s">&#39;IN&#39;</span><span class="p">,</span>
    <span class="s">&#39;notin&#39;</span>      <span class="p">:</span> <span class="s">&#39;NOT IN&#39;</span><span class="p">,</span>
    <span class="s">&#39;null&#39;</span>       <span class="p">:</span> <span class="s">&#39;IS NULL&#39;</span><span class="p">,</span>
    <span class="s">&#39;notnull&#39;</span>    <span class="p">:</span> <span class="s">&#39;IS NOT NULL&#39;</span><span class="p">,</span>
    <span class="s">&#39;emptynull&#39;</span>  <span class="p">:</span> <span class="s">&#39;IS NULL or EMPTY&#39;</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>and <tt class="docutils literal"><span class="pre">icontains</span></tt> that at the moment map to regexp operators if they exist
or like with % on both sides.</p>
</div>
<div class="section" id="conjunctions">
<h3>conjunctions<a class="headerlink" href="#conjunctions" title="Permalink to this headline">¶</a></h3>
<p>In the example all conditions have been <tt class="docutils literal"><span class="pre">AND</span></tt> ed. It&#8217;s possible to use
<tt class="docutils literal"><span class="pre">OR</span></tt> operator adding <tt class="docutils literal"><span class="pre">or_=True</span></tt>  argument.</p>
</div>
<div class="section" id="django2sqlalchemy">
<h3>django2sqlalchemy<a class="headerlink" href="#django2sqlalchemy" title="Permalink to this headline">¶</a></h3>
<p>You can get a sqlalchemy <tt class="docutils literal"><span class="pre">ClauseList</span></tt> object starting from a django-like
expression using django2sqlalchemy function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sqlkit.db.django_syntax</span> <span class="kn">import</span> <span class="n">django2sqlalchemy</span>
<span class="n">clause_list</span><span class="p">,</span> <span class="n">join_paths</span> <span class="o">=</span> <span class="n">django2sqlalchemy</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">args</span></tt> can be or_=boolean or any django-like query.
Django2sqlalchemy returns a tuple: (clause_list, join_path):</p>
<blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">clause_list:</th><td class="field-body"><p class="first">the list of column expression connected with <tt class="docutils literal"><span class="pre">AND</span></tt> or
<tt class="docutils literal"><span class="pre">OR</span></tt> according to <tt class="docutils literal"><span class="pre">or_</span></tt> argument</p>
</td>
</tr>
<tr class="field"><th class="field-name">join_path:</th><td class="field-body"><p class="first">the list of path needed to add to query via <tt class="docutils literal"><span class="pre">query.join()</span></tt> to
have all the fields the query needs to apply the filters in clause_list</p>
<p>A possibility is to add:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">join_path</span><span class="p">:</span>
   <span class="n">query</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">reset_joinpoint</span><span class="p">()</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</blockquote>
</div>
<div class="section" id="module-sqlkit.db.django_syntax">
<h3>Filter simplified syntax<a class="headerlink" href="#module-sqlkit.db.django_syntax" title="Permalink to this headline">¶</a></h3>
<div class="section" id="django-syntax-utilities">
<h4>Django syntax utilities<a class="headerlink" href="#django-syntax-utilities" title="Permalink to this headline">¶</a></h4>
<p>This module provides some functions to allow use of django syntax in filters.
You can look an introduction on lookup filters on <a class="reference external" href="http://docs.djangoproject.com/en/dev/topics/db/queries/#field-lookups-intro">django&#8217;s site</a> but mind that
we don&#8217;t even share the same syntax. We just borrowed the idea that the operator
and possibly the join can be wired in the keyword <em>name</em>.
The aim is not at all compatibility with django (that has nothing to do with this
framework) but a way to:</p>
<blockquote>
<ul class="simple">
<li>make it easy to add filters and constraints</li>
<li>make it easy to store queries (that need to store filters and constraints)</li>
</ul>
</blockquote>
<p>These function are used in sqlfilter and in completion beside <tt class="docutils literal"><span class="pre">.add_constraint(...)</span></tt>
method of sqlwidget.</p>
<p>You never <em>need</em> to use these functions. If you prefere you can changed the query
directly with SQLAlchemy syntax, and surely there are situations where that&#8217;s
necesssary, nevertheless there are situations where this syntax allows to obtain the
same result in less and more readeable code, probably just one line.</p>
<p>All of these functions act on a mapper becouse it has info on PropertyLoaders. In completion,
the mapper is used to follow the <em>join_path</em> even if the query (a <tt class="docutils literal"><span class="pre">sqlalchemy.select</span></tt>),
will not be issued on a <tt class="docutils literal"><span class="pre">session.query</span></tt> object</p>
<div class="section" id="supported-lookup">
<h5>supported lookup<a class="headerlink" href="#supported-lookup" title="Permalink to this headline">¶</a></h5>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">like/ilike:</th><td class="field-body">use like operator, ilike if available</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">notlike/notilike:</th></tr>
<tr><td>&nbsp;</td><td class="field-body">negate like operator, ilike if available</td>
</tr>
<tr class="field"><th class="field-name">regexp/iregexp:</th><td class="field-body">now ~/~* for postgres and REGEX for mysql like again for the rest</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">notregexp/notiregexp:</th></tr>
<tr><td>&nbsp;</td><td class="field-body">now !~/!~* (only for postgresql)</td>
</tr>
<tr class="field"><th class="field-name">lt/gt:</th><td class="field-body">less than / grater than (&lt;, &gt;)</td>
</tr>
<tr class="field"><th class="field-name">lte/gte:</th><td class="field-body">less than equal/ grater than equal(&lt;=, &gt;=)</td>
</tr>
<tr class="field"><th class="field-name">eq/neq:</th><td class="field-body">equal / not equal ( = , !=)</td>
</tr>
<tr class="field"><th class="field-name">in/notin:</th><td class="field-body">IN (argument must be a list)/ negated</td>
</tr>
<tr class="field"><th class="field-name">null:</th><td class="field-body">IS NULL / IS NOT NULL (depending if arg is True/False)</td>
</tr>
<tr class="field"><th class="field-name">emptynull:</th><td class="field-body">IS NULL or EMPTY</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id2">
<h5>conjunctions<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
<p><a title="sqlkit.db.django_syntax.django2sqlalchemy" class="reference internal" href="#sqlkit.db.django_syntax.django2sqlalchemy"><tt class="xref docutils literal"><span class="pre">django2sqlalchemy()</span></tt></a> and <a title="sqlkit.db.django_syntax.django2query" class="reference internal" href="#sqlkit.db.django_syntax.django2query"><tt class="xref docutils literal"><span class="pre">django2query()</span></tt></a> connect all arguments with AND operator
by default. It&#8217;s possible to use <tt class="docutils literal"><span class="pre">OR</span></tt> operator adding <tt class="docutils literal"><span class="pre">OR=True</span></tt>  argument.</p>
<dl class="function">
<dt id="sqlkit.db.django_syntax.django2sqlalchemy">
<tt class="descclassname">sqlkit.db.django_syntax.</tt><tt class="descname">django2sqlalchemy</tt><big>(</big><em>mapper=None</em>, <em>table=None</em>, <em>OR=False</em>, <em>**kw</em><big>)</big><a class="headerlink" href="#sqlkit.db.django_syntax.django2sqlalchemy" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a tuple (ClauseList, join path).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>mapper</em> &#8211; the mapper that will be used in the query</li>
<li><em>table</em> &#8211; the mapper that will be used in the query</li>
<li><em>OR</em> &#8211; if True the conditions will be ORed</li>
<li><em>kw</em> &#8211; the conditions as per django-like syntax</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="sqlkit.db.django_syntax.django2query">
<tt class="descclassname">sqlkit.db.django_syntax.</tt><tt class="descname">django2query</tt><big>(</big><em>query</em>, <em>mapper_or_class</em>, <em>OR=False</em>, <em>aliased=False</em>, <em>OUTER=False</em>, <em>**kw</em><big>)</big><a class="headerlink" href="#sqlkit.db.django_syntax.django2query" title="Permalink to this definition">¶</a></dt>
<dd><p>return a new query with new constraints expressed in  &#8216;django-style&#8217;</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>query</em> &#8211; the query to which filters will be applied</li>
<li><em>mapper_or_class</em> &#8211; a mapper or a class from which the class will be devised</li>
<li><em>aliased</em> &#8211; passed to <tt class="xref docutils literal"><span class="pre">DjangoParser</span></tt></li>
<li><em>OUTER</em> &#8211; <tt class="xref docutils literal"><span class="pre">DjangoParser</span></tt> will be instantiated as an OUTER join</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
</div>
</div>
<div class="section" id="native-sqlalchemy-constraint">
<h2>Native sqlalchemy constraint<a class="headerlink" href="#native-sqlalchemy-constraint" title="Permalink to this headline">¶</a></h2>
<p>The django syntax is in no way the only possibility. If that is not
sufficient to express the constraints you need you can just use any filter
on the query directly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">tk_tbl</span> <span class="o">=</span> <span class="n">ticket</span><span class="o">.</span><span class="n">Ticket</span><span class="o">.</span><span class="n">__table__</span>
<span class="n">my_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_session</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">ticket</span><span class="o">.</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">setup</span><span class="o">.</span><span class="n">USERNAME</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span><span class="o">.</span><span class="n">id</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">SqlTable</span><span class="p">(</span><span class="n">ticket</span><span class="o">.</span><span class="n">Ticket</span><span class="p">,</span> <span class="n">field_list</span><span class="o">=</span><span class="n">field_list</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="s">&#39;priority&#39;</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">or_</span><span class="p">(</span><span class="n">tk_tbl</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;assigned_by_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">my_id</span> <span class="p">,</span>
                             <span class="n">tk_tbl</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;assigned_to_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">my_id</span> <span class="p">,</span> <span class="p">))</span>
</pre></div>
</div>
<p>this example shows how to force a constraint on ticket requiring that the
ticket be assigned <em>by</em> or <em>to</em> USERNAME. Any further filter applied
interactively will be applied <em>on top</em> of this constraint. This is
equivalent to writing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">assigned_by_id</span><span class="o">=</span><span class="n">my_id</span><span class="p">,</span> <span class="n">assigned_to_id</span><span class="o">=</span><span class="n">my_id</span><span class="p">,</span> <span class="n">OR</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>At the moment of this writing it&#8217;s not possible to write:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">assigned_by_id__username</span><span class="o">=</span><span class="n">USERNAME</span><span class="p">)</span>
</pre></div>
</div>
<p>as the foreign key relation is not followed in this context.</p>
<div class="section" id="aliased-constraints">
<h3>aliased constraints<a class="headerlink" href="#aliased-constraints" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you need to have aliased constraints in order to ha sqlalchemy
build an aliased join to related classes on which you may want to set
constraints. This may be necessary if you want to use constraints along with
order_by and possibly filters on foreign keys.</p>
<div class="section" id="example">
<h4>example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<p>Suppose you have an &#8216;address&#8217; table with a <tt class="docutils literal"><span class="pre">user_id</span></tt> field that is a
ForeignKey to a <tt class="docutils literal"><span class="pre">user.id</span></tt> column. Suppose you want to open a SqlTable on
table addresses, ordered on <tt class="docutils literal"><span class="pre">user_id</span></tt> (well... surely you don&#8217;t want to
order by the <tt class="docutils literal"><span class="pre">id</span></tt> value, you probably have a <tt class="docutils literal"><span class="pre">first_name</span></tt> field that is
much more appropriate for sorting).</p>
<p>Now suppose you also have an <tt class="docutils literal"><span class="pre">active</span></tt> field on the user_table. You can
achieve this (simple) in the following way:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span> <span class="o">=</span> <span class="n">SqlTable</span><span class="p">(</span><span class="s">&#39;address&#39;</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="s">&#39;user_id__first_name&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">user_id__active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">aliased</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>the order_by argument implicitly have built a join with the user table, the
same stands for the constraint <tt class="docutils literal"><span class="pre">user_id__active</span></tt>. Sqlalchemy would have
complained that the table &#8216;user&#8217; was already present, so you need to alias
it. I&#8217;ll probably make this the default in a future version.</p>
</div>
</div>
</div>
</div>


            </div>
        </div>
     </div>
   </div>

        
</div> <!-- wrap -->

            <div class="bottomnav footer">
                <div class="doc_copyright">
                Alessandro Dentella -- Copyright 2006-2007-2008-2009-2010
		  Sqlkit release 0.9.5.1
<!--                 % if hasdoc('copyright'): -->
<!--                     &copy; <a href="../copyright.html">Copyright</a> 2008, Sandro Dentella. -->
<!--                 % else: -->
<!--                     &copy; Copyright 2008, Sandro Dentella. -->
<!--                 % endif -->
                    creato usando  <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.4.
                </div>
            </div>
        












<br style="clear: left" />

    </body>
</html>




