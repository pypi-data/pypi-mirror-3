<?xml version="1.0" encoding="UTF-8"?>
<!--
        This file is part of Nereid. The COPYRIGHT file at the
        top level of this repository contains the full copyright notices
        and license terms.
    -->
<tryton>
  <data noupdate="1">

    <record id="sale_complete_emails" model="electronic_mail.mailbox">
      <field name="name">Sale Complete Mails</field>
      <field name="user" ref="res.user_admin"/>
    </record>

    <record id="sale_complete_send_email" model="electronic_mail.template">
      <field name="mailbox" ref="sale_complete_emails"/>
      <field name="from_">Sales Services</field>
      <field name="to">${record.invoice_address.email.value}</field>
      <field name="subject">Order Completed</field>
      <field name="engine">genshi</field>
      <field name="model" search="[('model', '=', 'sale.sale')]"/>
      <field name="plain">Your Sale has been completed. To view the order click the link below:
      ${ url_for('sale.sale.render', sale=sale.id, _external=True) }
      </field>
      <field name="html">Your Sale has been completed. To view the order click the link below:
      ${ url_for('sale.sale.render', sale=sale.id, _external=True) }
      </field>
    </record>

    <record id="trigger_sale_complete" model='ir.trigger'>
      <field name="name">Sale Completion Email</field>
      <field name="model" search="[('model', '=', 'sale.sale')]"/>
      <field name="on_write" eval="True"/>
      <field name="condition">self.state=='done'</field>
      <field name="action_model" search="[('model', '=', 'electronic_mail.template')]"/>
      <field name="action_function">mail_from_trigger</field>
      <field name="email_template" ref="sale_complete_send_email"/>
    </record>
  
    <record id="default_checkout_method" model="nereid.checkout">
        <field name="name">Default</field>
        <field name="active">1</field>
        <field name="is_allowed_for_guest">1</field>
        <field name="model" search="[('model', '=', 'nereid.checkout.default')]" />
    </record>

  </data>
</tryton>
