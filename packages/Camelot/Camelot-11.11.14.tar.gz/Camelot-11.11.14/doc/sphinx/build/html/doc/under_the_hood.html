

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Under the hood &mdash; Camelot  documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="Camelot  documentation" href="../index.html" />
    <link rel="up" title="Creating models" href="models.html" />
    <link rel="next" title="Customizing the Admin classes" href="admin.html" />
    <link rel="prev" title="Views" href="views.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2652891-3']);
  _gaq.push(['_trackPageview']);
</script>

  </head>
  <body>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="admin.html" title="Customizing the Admin classes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="views.html" title="Views"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Camelot  documentation</a> &raquo;</li>
          <li><a href="../contents.html" >Camelot Documentation contents</a> &raquo;</li>
          <li><a href="index.html" >Camelot Documentation</a> &raquo;</li>
          <li><a href="models.html" accesskey="U">Creating models</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="under-the-hood">
<span id="id1"></span><h1>Under the hood<a class="headerlink" href="#under-the-hood" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setting-up-the-model">
<h2>Setting up the model<a class="headerlink" href="#setting-up-the-model" title="Permalink to this headline">¶</a></h2>
<p>A lot of things happen under the hood when a model is defined using Elixir, and
picked up by Camelot :</p>
<div class="section" id="metadata">
<h3>Metadata<a class="headerlink" href="#metadata" title="Permalink to this headline">¶</a></h3>
<p>Each file that contains a part of the model definition should contain these lines :</p>
<p>They associate the Entities defined in this file with the default metadata.  The
metadata is a datastructure that contains information about the database in which
the tables for the model will be created.</p>
</div>
<div class="section" id="engine">
<h3>Engine<a class="headerlink" href="#engine" title="Permalink to this headline">¶</a></h3>
<p>The settings.py file should contain a function named ENGINE that returns a
connection to the database.  This connection will be associated with the default
metadata used in the model definition.</p>
<p>As such, all defined models are associated with this database.</p>
</div>
<div class="section" id="setup-model">
<h3>Setup model<a class="headerlink" href="#setup-model" title="Permalink to this headline">¶</a></h3>
<p>When the application starts up, the setup_model function in the settings.py file
is called.  In this function, all model files should be imported, to make sure the
model has been completely setup.</p>
</div>
</div>
<div class="section" id="working-without-the-default-model">
<h2>Working without the default model<a class="headerlink" href="#working-without-the-default-model" title="Permalink to this headline">¶</a></h2>
<p>Camelot comes with a default model for Persons, Organizations, History tracking, etc.</p>
<p>You might want to turn this off, here&#8217;s how to do so :</p>
<ol class="arabic simple">
<li>In your settings.py, remove the line &#8216;import camelot.model&#8217; and the line
&#8216;from camelot.model.authentication import updateLastLogin&#8217;, this will make sure
no tables are created for the default Camelot model.  Tables are only created for
the models that have been imported before the call to &#8216;setup_all()&#8217;</li>
</ol>
<ol class="arabic simple" start="2">
<li>Have a look in &#8216;camelot/model/__init__.py&#8217; and copy the lines that do
the initialization of the elixir session and metadata to the top of your
own model file, imported first in the &#8216;setup_model()&#8217; function.</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">elixir</span>

<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">MetaData</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">scoped_session</span><span class="p">,</span> <span class="n">create_session</span>

<span class="n">elixir</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">scoped_session</span><span class="p">(</span> <span class="n">create_session</span> <span class="p">)</span>

<span class="kn">from</span> <span class="nn">camelot.core.conf</span> <span class="kn">import</span> <span class="n">settings</span>

<span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>

<span class="n">__metadata__</span> <span class="o">=</span> <span class="n">metadata</span>

<span class="n">__metadata__</span><span class="o">.</span><span class="n">bind</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">ENGINE</span><span class="p">()</span>
<span class="n">__metadata__</span><span class="o">.</span><span class="n">autoflush</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">__metadata__</span><span class="o">.</span><span class="n">transactional</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>
</div>
</div>
<div class="section" id="using-camelot-without-the-gui">
<h2>Using Camelot without the GUI<a class="headerlink" href="#using-camelot-without-the-gui" title="Permalink to this headline">¶</a></h2>
<p>Often a Camelot application also has a non GUI part, like batch scripts, server side
scripts, etc.</p>
<p>It is of course perfectly possible to reuse the whole model definition in those non
GUI parts.  The easiest way to do so is to leave the Camelot GUI application as it
is and then in the non GUI script, initialize the model first</p>
<p>import settings
settings.setup_model()</p>
<p>From that point, all model manipulations can be done.  Access to the session can
be obtained via any Entity subclass, such as Person</p>
<p>session = Person.query.session</p>
<p>After the manipulations to the model have been done, they can be flushed to the db</p>
<p>session.flush()</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Under the hood</a><ul>
<li><a class="reference internal" href="#setting-up-the-model">Setting up the model</a><ul>
<li><a class="reference internal" href="#metadata">Metadata</a></li>
<li><a class="reference internal" href="#engine">Engine</a></li>
<li><a class="reference internal" href="#setup-model">Setup model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#working-without-the-default-model">Working without the default model</a></li>
<li><a class="reference internal" href="#using-camelot-without-the-gui">Using Camelot without the GUI</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="views.html"
                        title="previous chapter">Views</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="admin.html"
                        title="next chapter">Customizing the Admin classes</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/doc/under_the_hood.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="admin.html" title="Customizing the Admin classes"
             >next</a> |</li>
        <li class="right" >
          <a href="views.html" title="Views"
             >previous</a> |</li>
        <li><a href="../index.html">Camelot  documentation</a> &raquo;</li>
          <li><a href="../contents.html" >Camelot Documentation contents</a> &raquo;</li>
          <li><a href="index.html" >Camelot Documentation</a> &raquo;</li>
          <li><a href="models.html" >Creating models</a> &raquo;</li> 
      </ul>
    </div>

<br/>
<a href="http://example.com/my_article.html#disqus_thread">Comments</a>
<br/>

<div id="disqus_thread"></div>
<script type="text/javascript">
  /**
    * var disqus_identifier; [Optional but recommended: Define a unique identifier (e.g. post id or slug) for this thread] 
    */

  /** var disqus_developer = 1 **/

  (function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = 'http://camelot.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=camelot">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




    <div class="footer">
        &copy; <a href="../copyright.html">Copyright</a> 2009 - 2011, Conceptive Engineering.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.
    </div>
<div class="footer">
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

<script type="text/javascript">
var disqus_shortname = 'camelot';
(function () {
  var s = document.createElement('script'); s.async = true;
  s.src = 'http://disqus.com/forums/camelot/count.js';
  (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



  </body>
</html>