<div metal:define-macro="files_edit" tal:omit-tag=""
       xmlns:tal="http://xml.zope.org/namespaces/tal"
       xmlns:metal="http://xml.zope.org/namespaces/metal">
  <div class="listActions">
    <div class="first">
      <img src="/Static/Images/storage22.png" alt="${_('Storages')}"/>
    </div>
    <div class="last">
      ${form.button(route('storage_index'), src='/Static/Images/action_add.png',
        title=_('Add files'), class_='slow')}
    </div>
  </div>
  <table class="list">
    <caption>${_('Files')}</caption>
    <thead>
      <tr>
        <th colspan="2">${_('Storage')}</th>
        <th>${_('Path in storage')}</th>
        <th>${_('Path in target')}</th>
        <th class="center">${_('Visible')}</th>
        <th class="last">${_('Actions')}</th>
      </tr>
    </thead>
    <tbody tal:repeat="file_type file_types" class="group">
      <tr>
        <th colspan="6">${file_type_labels[file_type]}</th>
      </tr>
      <tr tal:repeat="item files[file_type]" tal:attributes="id action[4:] == item[0] and 'current'">
        <td class="checkbox"></td>
        <td>
          <a href="${route('storage_root', storage_id=item[1])}" class="slow">${item[1]}</a>/
        </td>
        <td>
         <img src="/Static/Images/MimeTypes/${item[0] if item[0] in MIME_TYPES else 'unknown'}.png" alt="${item[0]}" title="${item[0]}"/>
          <a href="${route('file_download', storage_id=item[1], path=item[2])}">${item[2]}</a>
        </td>
        <td>
          <span tal:condition="file_type == 'template'" tal:omit-tag="">
            ${form.text('template_%s/%s' % (item[1], item[2]))}
            <span class="error" tal:condition="form.has_error('template_%s/%s' % (item[1], item[2]))">
              ${form.error('template_%s/%s' % (item[1], item[2]))}
            </span>
          </span>
        </td>
        <td class="center">
          ${form.checkbox('%s_%s/%s_see' % (file_type, item[1], item[2]))}
        </td>
        <td class="last" tal:switch="action == 'rmv?%s_%s/%s' % (file_type, item[1], item[2])">
          <span tal:case="True" tal:omit-tag="">
            ${form.submit('rmv!%s_%s/%s.x' % (file_type, item[1], item[2]), _('Confirm removal'), class_='button')}
            ${form.submit_cancel(_('Cancel'))}
          </span>
          <span tal:case="False" tal:omit-tag="">
           ${form.button(route('file_info', storage_id=item[1], path=item[2]), src='/Static/Images/action_info_one.png', title=_('File information'), class_="slow")}
           ${form.button(route('storage_browse', storage_id=item[1], path=item[2]), src='/Static/Images/action_browse.png', title=_('View in storage'), class_='slow')}
           <img src="/Static/Images/action_pipe.png" alt="Pipe"/>
           ${form.submit_image('rmv?%s_%s/%s' % (file_type, item[1], item[2]), _('Remove file'), '/Static/Images/action_remove_one.png')}
          </span>
      </td>
      </tr>
    </tbody>
  </table>
</div>