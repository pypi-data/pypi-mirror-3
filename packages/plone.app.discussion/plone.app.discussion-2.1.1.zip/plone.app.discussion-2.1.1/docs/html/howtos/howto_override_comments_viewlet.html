

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>How to override plone.app.discussion’s comments viewlet &mdash; plone.app.discussion v2.0 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="plone.app.discussion v2.0 documentation" href="../index.html" />
    <link rel="up" title="Howtos" href="index.html" />
    <link rel="next" title="API/Interfaces" href="../api.html" />
    <link rel="prev" title="Howto extend the comment form with additional fields" href="howto_extend_the_comment_form.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../api.html" title="API/Interfaces"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="howto_extend_the_comment_form.html" title="Howto extend the comment form with additional fields"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">plone.app.discussion v2.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Howtos</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="how-to-override-plone-app-discussion-s-comments-viewlet">
<h1>How to override plone.app.discussion&#8217;s comments viewlet<a class="headerlink" href="#how-to-override-plone-app-discussion-s-comments-viewlet" title="Permalink to this headline">¶</a></h1>
<p>This document explains how to override the plone.app.discussion comments
viewlet that controls the way existing comments are displayed.</p>
<p>There are three different ways to override plone.app.discussion&#8217;s comments
viewlet: through-the-web, on the file system with z3c.jbot, and by overriding
the comments viewlet class on the file system.</p>
<p>Overriding the comments viewlet template throught-the-web is the quick and
dirty approach. Using z3c.jbot is the recommended approach if you just want to
override the comments viewlet template. If you want full control over the
comments viewlet class, for instance if you want to add/customize view methods,
overriding the comments viewlet class on the file system is the recommended
approach.</p>
<div class="section" id="override-the-comments-template-through-the-web">
<h2>Override the comments template through-the web<a class="headerlink" href="#override-the-comments-template-through-the-web" title="Permalink to this headline">¶</a></h2>
<p>Overriding the comments template through-the web is the easiest way to
customize the comments viewlet:</p>
<div class="highlight-python"><pre>* Go to the ZMI (http://localhost:8080/Plone/manage_main)
* Click on "portal_view_customizations"
* Customize plone.comments (plone.app.discussion.interfaces.IDiscussionLayer)</pre>
</div>
</div>
<div class="section" id="override-the-comments-template-with-z3c-jbot-on-the-file-system">
<h2>Override the comments template with z3c.jbot on the file system<a class="headerlink" href="#override-the-comments-template-with-z3c-jbot-on-the-file-system" title="Permalink to this headline">¶</a></h2>
<p>The easiest way to override the comments template on the file
system is with <a href="#id1"><span class="problematic" id="id2">`z3c.jbot`_</span></a>. <a href="#id3"><span class="problematic" id="id4">`z3c.jbot`_</span></a> allows you to override any
Plone template just by putting a file in a specific directory.</p>
<p><cite>z3c.jbot</cite>:: <a class="reference external" href="http://pypi.python.org/pypi/z3c.jbot">http://pypi.python.org/pypi/z3c.jbot</a></p>
<p>Add z3c.jbot to the dependencies of your package by adding a
line to your setup.py file:</p>
<div class="highlight-python"><pre>install_requires=[
    ...
    'z3c.jbot',
],</pre>
</div>
<p>Register an overrides directory where you can put your file
overrides in your configure.zcml file:</p>
<div class="highlight-python"><pre>&lt;include package="z3c.jbot" file="meta.zcml" /&gt;

&lt;browser:jbot
    directory="overrides"
    layer="&lt;layer&gt;" /&gt;</pre>
</div>
<p>Replace &lt;layer&gt; with a custom browserlayer of your package.</p>
<p>Create the template directory we just registered:</p>
<div class="highlight-python"><pre>$ mkdir overrides</pre>
</div>
<p>Copy the comments viewlet template we want to override to the
overrides directory we just created and registered:</p>
<div class="highlight-python"><pre>$ cp ../parts/omelette/plone/app/discussion/browser/comments.pt overrides/plone.app.discussion.browser.comments.pt</pre>
</div>
<p>Restart your Plone instance and you can start to customize
the plone.app.discussion.browser.comments.pt we just created.</p>
</div>
<div class="section" id="override-the-comments-viewlet-class-on-the-file-system">
<h2>Override the comments viewlet class on the file system<a class="headerlink" href="#override-the-comments-viewlet-class-on-the-file-system" title="Permalink to this headline">¶</a></h2>
<p>Overriding/subclassing the comments viewlet class is allows you not only to
override the comments viewlet template, but also the comment viewlets view
methods. There are many ways to override components in Plone with the Zope
Component Architecture (ZCA), which is beyond the scope of this howto.</p>
<p>We are going to register our own browserlayer</p>
<p>First we define our browser layer in interfaces.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone.app.discussion.interfaces</span> <span class="kn">import</span> <span class="n">IDiscussionLayer</span>

<span class="k">class</span> <span class="nc">IMyDiscussionLayer</span><span class="p">(</span><span class="n">IDiscussionLayer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Marker interface for a custom plone.app.discussion browser layer</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Next, we register the browserlayer in our generic setup (GS) setup in the
profiles/default/browserlayer.xml file:</p>
<div class="highlight-python"><pre>&lt;?xml version="1.0"?&gt;
&lt;layers&gt;
  &lt;layer name="my.discussionlayer"
         interface="my.discussion.interfaces.IMyDiscussionLayer" /&gt;
&lt;/layers&gt;</pre>
</div>
<p>configure.zcml:</p>
<div class="highlight-python"><pre>&lt;!-- Override plone.app.discussion's comments viewlet --&gt;
&lt;browser:viewlet
  name="plone.comments"
  for="Products.CMFCore.interfaces.IContentish"
  layer="my.discussion.interfaces.IDiscussionLayer"
  manager="plone.app.layout.viewlets.interfaces.IBelowContent"
  view="plone.app.layout.globals.interfaces.IViewView"
  class=".comments.CommentsViewlet"
  permission="zope2.View"
  /&gt;</pre>
</div>
<p>note: Note that we override the comments viewlet by using the my.discussion.interfaces.IMyDiscussionLayer browser layer and not the default plone.app.discussion.interfaces.IDiscussionLayer browser layer.</p>
<p>Once we registered the custom discussion browser layer and the viewlet, we can create a
comments.py file with our custom version of the comments viewlet:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Products.Five.browser.pagetemplatefile</span> <span class="kn">import</span> <span class="n">ViewPageTemplateFile</span>

<span class="kn">from</span> <span class="nn">plone.app.discussion.browser.comments</span> <span class="kn">import</span> <span class="n">CommentsViewlet</span> <span class="k">as</span> <span class="n">PloneAppDiscussionCommentsViewlet</span>
<span class="kn">from</span> <span class="nn">plone.app.discussion.browser.comments</span> <span class="kn">import</span> <span class="n">CommentForm</span>


<span class="k">class</span> <span class="nc">CommentsViewlet</span><span class="p">(</span><span class="n">PloneAppDiscussionCommentsViewlet</span><span class="p">):</span>

    <span class="n">form</span> <span class="o">=</span> <span class="n">CommentForm</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">ViewPageTemplateFile</span><span class="p">(</span><span class="s">&#39;comments.pt&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_commenter_home_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">username</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">/memberhome/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">portal_url</span><span class="p">(),</span> <span class="n">username</span><span class="p">)</span>
</pre></div>
</div>
<p>To override the comments viewlet template, we create a comment.pt file in the
same directory and copy the contents from:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="override-the-comments-viewlet-javascript">
<h2>Override the comments viewlet Javascript<a class="headerlink" href="#override-the-comments-viewlet-javascript" title="Permalink to this headline">¶</a></h2>
<p>Overriding the comments viewlet javascript works just like overriding the
comments viewlet. We register the javascript file for our custom browser
layer and remove the existing javascript file in
profiles/default/jsregistry.xml:</p>
<div class="highlight-python"><pre>&lt;?xml version="1.0"?&gt;
&lt;object name="portal_javascripts"&gt;
 &lt;!-- Remove plone.app.discussion comments javascript --&gt;
 &lt;javascript
     id="++resource++plone.app.discussion.javascripts/comments.js"
     remove="True"
     /&gt;
 &lt;!-- Register a custom version of the plone.app.discussion javascript --&gt;
 &lt;javascript
     id="++resource++example.myaddonproduct.javascripts/comments.js" /&gt;
&lt;/object&gt;</pre>
</div>
<p>browser/configure.zcml:</p>
<div class="highlight-python"><pre>&lt;!-- Resource directory for javascripts --&gt;
&lt;browser:resourceDirectory
  name="example.myaddonproduct.javascripts"
  directory="javascripts"
  layer="example.myaddonprocuts.interfaces.IBrowserLayer"
  /&gt;</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">How to override plone.app.discussion&#8217;s comments viewlet</a><ul>
<li><a class="reference internal" href="#override-the-comments-template-through-the-web">Override the comments template through-the web</a></li>
<li><a class="reference internal" href="#override-the-comments-template-with-z3c-jbot-on-the-file-system">Override the comments template with z3c.jbot on the file system</a></li>
<li><a class="reference internal" href="#override-the-comments-viewlet-class-on-the-file-system">Override the comments viewlet class on the file system</a></li>
<li><a class="reference internal" href="#override-the-comments-viewlet-javascript">Override the comments viewlet Javascript</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="howto_extend_the_comment_form.html"
                        title="previous chapter">Howto extend the comment form with additional fields</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../api.html"
                        title="next chapter">API/Interfaces</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/howtos/howto_override_comments_viewlet.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../api.html" title="API/Interfaces"
             >next</a> |</li>
        <li class="right" >
          <a href="howto_extend_the_comment_form.html" title="Howto extend the comment form with additional fields"
             >previous</a> |</li>
        <li><a href="../index.html">plone.app.discussion v2.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Howtos</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Timo Stollenwerk - Plone Foundation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>