
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>IPython Cluster Plugin &mdash; StarCluster v0.93 documentation</title>
    <link rel="stylesheet" href="../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.93',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="StarCluster v0.93 documentation" href="../index.html" />
    <link rel="up" title="Plugin Documentation" href="index.html" />
    <link rel="next" title="TMUX Plugin" href="tmux.html" />
    <link rel="prev" title="Plugin Documentation" href="index.html" />
<link rel="stylesheet" href="../_static/nobile.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../_static/neuton.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../_static/starcluster.ico"/>

  </head>
  <body>
<div class="header-small">
	
	<div class="logo-small">
		<a href="../index.html">
      		<img class="logo" src="../_static/logo-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tmux.html" title="TMUX Plugin"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Plugin Documentation"
             accesskey="P">previous</a> |</li>
    	<li><a href="../index.html">Home</a> &raquo;</li>
          <li><a href="../contents.html" >Master Table of Contents</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Plugin Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="ipython-cluster-plugin">
<span id="ipcluster-plugin"></span><h1>IPython Cluster Plugin<a class="headerlink" href="#ipython-cluster-plugin" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These docs are for <a class="reference external" href="http://ipython.org">IPython</a> 0.12+ which is installed in the latest
StarCluster 11.10 Ubuntu-based AMIs. See <cite>starcluster listpublic</cite> for
a list of available AMIs.</p>
</div>
<p>To configure your cluster as an <a class="reference external" href="http://ipython.org/ipython-doc/stable/parallel/parallel_intro.html#introduction">interactive IPython cluster</a> you must first
define the <tt class="docutils literal"><span class="pre">ipcluster</span></tt> plugin in your config file:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[plugin ipcluster]</span>
<span class="na">setup_class</span> <span class="o">=</span> <span class="s">starcluster.plugins.ipcluster.IPCluster</span>
</pre></div>
</div>
<p>If you&#8217;d like to use the new IPython web notebook (highly recommended!) you&#8217;ll
also want to add the following settings:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[plugin ipcluster]</span>
<span class="na">setup_class</span> <span class="o">=</span> <span class="s">starcluster.plugins.ipcluster.IPCluster</span>
<span class="na">enable_notebook</span> <span class="o">=</span> <span class="s">True</span>
<span class="c"># set a password for the notebook for increased security</span>
<span class="na">notebook_passwd</span> <span class="o">=</span> <span class="s">a-secret-password</span>
</pre></div>
</div>
<p>After defining the plugin in your config, add the ipcluster plugin to the list
of plugins in one of your cluster templates:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[cluster smallcluster]</span>
<span class="na">plugins</span> <span class="o">=</span> <span class="s">ipcluster</span>
</pre></div>
</div>
<div class="section" id="using-the-ipython-cluster">
<span id="using-ipython-cluster"></span><h2>Using the IPython Cluster<a class="headerlink" href="#using-the-ipython-cluster" title="Permalink to this headline">¶</a></h2>
<p>To use your new IPython cluster log in directly to the master node of the
cluster as the <tt class="docutils literal"><span class="pre">CLUSTER_USER</span></tt> and create a parallel client:</p>
<div class="highlight-python"><pre>$ starcluster sshmaster mycluster -u myuser
$ ipython
[~]&gt; from IPython.parallel import Client
[~]&gt; rc = Client(packer='pickle')</pre>
</div>
<p>Once the client has been started, create a &#8216;view&#8217; over the entire cluster and
begin running parallel tasks. Below is an example of performing a parallel map
across all nodes in the cluster:</p>
<div class="highlight-python"><pre>[~]&gt; view = rc[:]
[~]&gt; results = view.map_async(lambda x: x**30, range(8))
[~]&gt; print results.get()
[0,
 1,
 1073741824,
 205891132094649L,
 1152921504606846976L,
 931322574615478515625L,
 221073919720733357899776L,
 22539340290692258087863249L]</pre>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See the <a class="reference external" href="http://ipython.org/ipython-doc/stable/parallel">IPython parallel docs</a> (0.12+) to learn more about the IPython
parallel API</p>
</div>
</div>
<div class="section" id="connecting-from-your-local-ipython-installation">
<h2>Connecting from your Local IPython Installation<a class="headerlink" href="#connecting-from-your-local-ipython-installation" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You must have IPython 0.12+ installed to use this feature</p>
</div>
<p>If you&#8217;d rather control the cluster from your <em>local</em> IPython installation use
the <tt class="docutils literal"><span class="pre">shell</span></tt> command and pass the <tt class="docutils literal"><span class="pre">--ipcluster</span></tt> option:</p>
<div class="highlight-python"><pre>$ starcluster shell --ipcluster=mycluster</pre>
</div>
<p>This will start StarCluster&#8217;s development shell and configure a remote parallel
session for you automatically. StarCluster will create a parallel client in a
variable named <tt class="docutils literal"><span class="pre">ipclient</span></tt> and a corresponding view of the entire cluster in a
variable named <tt class="docutils literal"><span class="pre">ipview</span></tt> which you can use to run parallel tasks on the remote
cluster:</p>
<div class="highlight-python"><pre>$ starcluster shell --ipcluster=mycluster
[~]&gt; ipclient.ids
[0, 1, 2, 3]
[~]&gt; res = ipview.map_async(lambda x: x**30, range(8))
[~]&gt; print res.get()</pre>
</div>
</div>
<div class="section" id="using-ipython-parallel-scripts-with-starcluster">
<h2>Using IPython Parallel Scripts with StarCluster<a class="headerlink" href="#using-ipython-parallel-scripts-with-starcluster" title="Permalink to this headline">¶</a></h2>
<p>If you wish to run parallel IPython scripts from your local machine that run on
the remote cluster you will need to use the following configuration when
creating the parallel client in your code:</p>
<div class="highlight-python"><pre>from IPython.parallel import Client
rc = Client('~/.starcluster/ipcluster/&lt;cluster&gt;-&lt;region&gt;.json'
            sshkey='/path/to/cluster/keypair.rsa'
            packer='pickle')</pre>
</div>
<p>For example, let&#8217;s say we started a cluster called &#8216;mycluster&#8217; in region
&#8216;us-east-1&#8217; with keypair &#8216;mykey&#8217; stored in /home/user/.ssh/mykey.rsa. In this
case the above config should be updated to:</p>
<div class="highlight-python"><pre>from IPython.parallel import Client
rc = Client('/home/user/.starcluster/ipcluster/mycluster-us-east-1.json'
            sshkey='/home/user/.ssh/mykey.rsa'
            packer='pickle')</pre>
</div>
</div>
<div class="section" id="using-the-ipython-html-notebook">
<span id="ipython-notebook"></span><h2>Using the IPython HTML Notebook<a class="headerlink" href="#using-the-ipython-html-notebook" title="Permalink to this headline">¶</a></h2>
<p>The IPython cluster plugin comes with support for the new <a class="reference external" href="http://web.mit.edu">IPython web
notebook</a>. As mentioned in the intro section, you will need to specify a few
extra settings in the IPython cluster plugin&#8217;s config in order to use the web
notebook:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[plugin ipcluster]</span>
<span class="na">setup_class</span> <span class="o">=</span> <span class="s">starcluster.plugins.ipcluster.IPCluster</span>
<span class="na">enable_notebook</span> <span class="o">=</span> <span class="s">True</span>
<span class="c"># set a password for the notebook for increased security</span>
<span class="na">notebook_passwd</span> <span class="o">=</span> <span class="s">a-secret-password</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">notebook_passwd</span></tt> setting specifies the password to set on the remote
IPython notebook server. If you do not specify the <tt class="docutils literal"><span class="pre">notebook_passwd</span></tt> setting
the plugin will randomly generate a password for you. You will be required to
enter this password in order to login and use the notebook server on the
cluster. In addition to enforcing a notebook password, StarCluster also enables
SSL in the notebook server in order to secure the transmission of your password
when logging in.</p>
<p>Once you have these settings in the plugin&#8217;s config simply start a cluster and
let the plugin configure your IPython cluster:</p>
<div class="highlight-python"><pre>$ starcluster start iptest
StarCluster - (http://web.mit.edu/starcluster)
Software Tools for Academics and Researchers (STAR)
Please submit bug reports to starcluster@mit.edu

... (abbreviated output)
&gt;&gt;&gt; Running plugin ipcluster
&gt;&gt;&gt; Writing IPython cluster config files
&gt;&gt;&gt; Starting IPython cluster with 9 engines
&gt;&gt;&gt; Waiting for JSON connector file...
&gt;&gt;&gt; Saving JSON connector file to 'iptest-us-east-1.json'
iptest-us-east-1.json 100% ||||||||||||||||||||||||| Time: 00:00:00   0.00 B/s
&gt;&gt;&gt; Setting up IPython web notebook for user: myuser
&gt;&gt;&gt; Creating SSL certificate for user myuser
&gt;&gt;&gt; Authorizing tcp port 8888 on 0.0.0.0/0
&gt;&gt;&gt; IPython notebook URL: https://ec2-99-99-99-99.compute-1.amazonaws.com:8888
&gt;&gt;&gt; The notebook password is: XXXXXXXXX
&gt;&gt;&gt; IPCluster has been started on iptest for user 'myuser'.
&gt;&gt;&gt; IPCluster took 0.247 mins</pre>
</div>
<p>Pay special attention to the following two lines as you&#8217;ll need them to login
to the cluster&#8217;s IPython notebook server from your web browser:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">IPython</span> <span class="n">notebook</span> <span class="n">URL</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">ec2</span><span class="o">-</span><span class="n">XXXX</span><span class="o">.</span><span class="n">compute</span><span class="o">-</span><span class="mf">1.</span><span class="n">amazonaws</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">8888</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">The</span> <span class="n">notebook</span> <span class="n">password</span> <span class="ow">is</span><span class="p">:</span> <span class="n">XXXXXXXXX</span>
</pre></div>
</div>
<p>Navigate to the given <em>https</em> address and use the password to login:</p>
<img alt="../_images/ipnotebooklogin.png" src="../_images/ipnotebooklogin.png" />
<p>After you&#8217;ve logged in you should be looking at IPython&#8217;s dashboard page:</p>
<img alt="../_images/ipnotebookdashboard.png" src="../_images/ipnotebookdashboard.png" />
<p>Since this is a brand new cluster there aren&#8217;t any existing IPython notebook&#8217;s
to play with. Click the <tt class="docutils literal"><span class="pre">New</span> <span class="pre">Notebook</span></tt> button to create a new IPython notebook:</p>
<img alt="../_images/ipnotebooknew.png" src="../_images/ipnotebooknew.png" />
<p>This will create a new blank IPython notebook. To begin using the notebook,
click inside the first input cell and begin typing some Python code. You can
enter multiple lines of code in one cell if you like. When you&#8217;re ready to
execute your code press <tt class="docutils literal"><span class="pre">shift-enter</span></tt>. This will execute the code in the
current cell and show any output in a new <cite>output</cite> cell below.</p>
<p>You can modify existing cells simply by clicking in the cell, changing some
text, and pressing <tt class="docutils literal"><span class="pre">shift-enter</span></tt> again to re-run the cell. While a cell is
being executed you will notice that the IPython notebook goes into a <cite>busy</cite>
mode:</p>
<img alt="../_images/ipnotebookbusy.png" src="../_images/ipnotebookbusy.png" />
<p>You can keep adding and executing more cells to the notebook while in <cite>busy</cite>
mode, however, the cells will run in the order they were executed one after the
other. Only one cell can be running at a time.</p>
<p>Once you&#8217;ve finished adding content to your notebook you can save your work to
the cluster by pressing the <tt class="docutils literal"><span class="pre">save</span></tt> button. Since this is a new notebook you
should  also change the name before saving which will temporarily change the
<tt class="docutils literal"><span class="pre">save</span></tt> button to <tt class="docutils literal"><span class="pre">rename</span></tt>:</p>
<img alt="../_images/ipnotebookrename.png" src="../_images/ipnotebookrename.png" />
<p>This will save the notebook to <tt class="docutils literal"><span class="pre">&lt;notebook</span> <span class="pre">title&gt;.ipynb</span></tt> in your
<tt class="docutils literal"><span class="pre">CLUSTER_USER</span></tt>&#8216;s home folder. If you&#8217;ve configured StarCluster to mount an
EBS volume on <tt class="docutils literal"><span class="pre">/home</span></tt> then these notebook files will automatically be saved
to the EBS volume when the cluster shuts down. If this is not the case you will
want to download the notebook files before you terminate the cluster if you
wish to save them:</p>
<img alt="../_images/ipnotebookdownload.png" src="../_images/ipnotebookdownload.png" />
<p>Press <tt class="docutils literal"><span class="pre">ctrl-m</span> <span class="pre">h</span></tt> within the web notebook to see all available keyboard
shortcuts and commands</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See the <a class="reference external" href="http://ipython.org/ipython-doc/stable/interactive/htmlnotebook.html#basic-usage">official IPython notebook docs</a> for more details on using the IPython notebook</p>
</div>
</div>
<div class="section" id="using-parallel-ipython-in-the-ipython-notebook">
<h2>Using Parallel IPython in the IPython Notebook<a class="headerlink" href="#using-parallel-ipython-in-the-ipython-notebook" title="Permalink to this headline">¶</a></h2>
<p>It&#8217;s also very easy to combine the notebook with IPython&#8217;s parallel framework
running on StarCluster to create an HPC-powered notebook. Simply use the same
commands described in the <a class="reference internal" href="#using-ipython-cluster"><em>Using the IPython Cluster</em></a> section to set up a
parallel client and view in the notebook:</p>
<img alt="../_images/ipnotebookparallel.png" src="../_images/ipnotebookparallel.png" />
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">IPython Cluster Plugin</a><ul>
<li><a class="reference internal" href="#using-the-ipython-cluster">Using the IPython Cluster</a></li>
<li><a class="reference internal" href="#connecting-from-your-local-ipython-installation">Connecting from your Local IPython Installation</a></li>
<li><a class="reference internal" href="#using-ipython-parallel-scripts-with-starcluster">Using IPython Parallel Scripts with StarCluster</a></li>
<li><a class="reference internal" href="#using-the-ipython-html-notebook">Using the IPython HTML Notebook</a></li>
<li><a class="reference internal" href="#using-parallel-ipython-in-the-ipython-notebook">Using Parallel IPython in the IPython Notebook</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Plugin Documentation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tmux.html"
                        title="next chapter">TMUX Plugin</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tmux.html" title="TMUX Plugin"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Plugin Documentation"
             >previous</a> |</li>
    	<li><a href="../index.html">Home</a> &raquo;</li>
          <li><a href="../contents.html" >Master Table of Contents</a> &raquo;</li>
          <li><a href="index.html" >Plugin Documentation</a> &raquo;</li> 
      </ul>
    </div>


    <div class="footer">
        &copy; Copyright 2011, Software Tools for Academics and Researchers.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>


<script type="text/javascript">
//<![CDATA[
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    //]]>
    </script><script type="text/javascript">
//<![CDATA[
    try{
        var pageTracker = _gat._getTracker("UA-1048253-12");
        pageTracker._trackPageview();
    } catch(err) {}
    //]]>
    </script>

  </body>
</html>