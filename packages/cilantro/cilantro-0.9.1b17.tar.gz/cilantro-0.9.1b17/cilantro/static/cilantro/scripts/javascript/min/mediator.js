var __slice=Array.prototype.slice;define(["underscore"],function(a){var b,c;return b={},c={subscribe:function(a,d,e){var f;return b[a]==null&&(b[a]=[]),e?f=function(){return c.unsubscribe(a,f,!0),d.apply(null,arguments)}:f=d,b[a].push(f)},publish:function(){var c,d,e,f,g,h;d=arguments[0],c=2>arguments.length?[]:__slice.call(arguments,1);if(!(f=b[d]))return;for(g=0,h=f.length;g<h;g++){e=f[g];try{e&&e.apply(null,c)}catch(i){setTimeout(function(){throw i})}}setTimeout(function(){return b[d]=a.compact(f)})},unsubscribe:function(a,c,d){var e,f;if(!(e=b[a]))return;if((f=e.indexOf(c))>=0)return d?e[f]=null:e.splice(f,1)}},c})