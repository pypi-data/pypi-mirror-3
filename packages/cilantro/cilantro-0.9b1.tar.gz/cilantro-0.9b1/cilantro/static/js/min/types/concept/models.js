var __hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},__bind=function(a,b){return function(){return a.apply(b,arguments)}},__indexOf=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1};define(["common/models/state"],function(a){var b,c;return b=function(){function b(){b.__super__.constructor.apply(this,arguments)}return __extends(b,a.Model),b.prototype.url=function(){return b.__super__.url.apply(this,arguments)+"/"},b}(),c=function(){function a(){this.toggleEnableByDomain=__bind(this.toggleEnableByDomain,this),a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Collection),a.prototype.model=b,a.prototype.url=App.urls.criteria,a.prototype.initialize=function(){return App.hub.subscribe("domain/active",this.toggleEnableByDomain),App.hub.subscribe("subdomain/active",this.toggleEnableByDomain),this.bind("reset",this.groupByDomain),this.bind("active",this.activate),this.bind("inactive",this.inactivate),App.hub.subscribe("concept/request",__bind(function(a){var b;b=this.get(a);if(b)return App.hub.publish("domain/request",b.get("domain").id),b.activate()},this)),this._activeByDomain={},this._activeDomain=null},a.prototype.groupByDomain=function(){return this._byDomain={},this._bySubdomain={},this.each(__bind(function(a){var b,c,d,e,f,g,h,i,j,k;return b=a.get("domain"),b.parent?(((i=(c=this._bySubdomain)[f=b.id])!=null?i:c[f]=[]).push(a),((j=(d=this._byDomain)[g=b.parent.id])!=null?j:d[g]=[]).push(a)):((k=(e=this._byDomain)[h=b.id])!=null?k:e[h]=[]).push(a)},this))},a.prototype.toggleEnableByDomain=function(a){var b,c;this._activeDomain=a,b=this._bySubdomain[a]||this._byDomain[a],this.map(function(a){return __indexOf.call(b,a)<0?a.disable():(a.enable(),a.inactivate())});if(c=this._activeByDomain[a])return c.activate()},a.prototype.activate=function(a){var b;return this._activeByDomain[this._activeDomain]=a,b=this._bySubdomain[this._activeDomain]||this._byDomain[this._activeDomain],_(b).without(a).map(function(a){return a.inactivate()})},a.prototype.inactivate=function(a){},a}(),{Model:b,Collection:c}})