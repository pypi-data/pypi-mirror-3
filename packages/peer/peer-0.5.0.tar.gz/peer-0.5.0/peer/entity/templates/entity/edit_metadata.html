{% extends "base.html" %}

{% load i18n entity_permissions %}

{% block jspluginscss %}
<link type="text/css" href="{{ STATIC_URL }}js/SAMLmetaJS/css/samlmetajs.css" rel="Stylesheet" />
{% endblock %}

{% block extracss %}
<link type="text/css" href="{{ STATIC_URL }}css/terms-of-use.css" rel="Stylesheet" />
{% endblock %}

{% block content %}
{% canedit entity %}{% include "entity/menu.html" %}{% endcanedit %}
<section class="mainContent">

  <hgroup>
    <h1>{% trans "Edit metadata" %}</h1>
    <h2>{{ entity.name }}</h2>
  </hgroup>

  <div id="metadata-tabs">

    <ul>
      <li><a href="#text-tab">{% trans "By text editing ..." %}</a></li>
      <li><a href="#upload-tab">{% trans "By uploading a file ..." %}</a></li>
      <li><a href="#remote-tab">{% trans "By fetching a remote URL ..." %}</a></li>
    </ul>

    <div id="text-tab"><div>{{ text_html|safe }}</div></div>
    <div id="upload-tab"><div>{{ file_html|safe }}</div></div>
    <div id="remote-tab"><div>{{ remote_html|safe }}</div></div>
  </div>
</section>
{% endblock %}

{% block extrajs %}
{% if needs_google_maps %}
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
{% endif %}
<script type="text/javascript" src="{{ STATIC_URL }}/js/SAMLmetaJS/samlmeta.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}/js/SAMLmetaJS/mdreader.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}/js/SAMLmetaJS/samlmeta.xml.js"></script>
{% for plugin in samlmetajs_plugins %}
<script type="text/javascript" src="{{ STATIC_URL }}/js/SAMLmetaJS/samlmeta.plugin.{{ plugin }}.js"></script>
{% endfor %}

<script type="text/javascript">
(function($) {
    // IE does not have an indexOf array method, how cool is that?
    if(!Array.indexOf) {
        Array.prototype.indexOf = function(obj) {
            for(var i=0; i < this.length; i++) {
                if(this[i] === obj){
                    return i;
                }
            }
        return -1;
        };
    }

    $(document).ready(function(){
        var tabs = ['text', 'upload', 'remote'];
        $("#metadata-tabs").tabs({
            'selected': tabs.indexOf('{{ edit_mode }}')
        });
        if ($.browser.msie && $.browser.version <= 9) {
            // We should be doing capability detection here but the problem
            // with IE <= 9 parser is that it exists but its API is
            // different and the namespaces are handled in a different way
            // See https://github.com/UNINETT/SAMLmetaJS/issues/7
            $("textarea#id_metadata_text").before("<p><span class='ui-icon ui-icon-alert'></span>Your browser does not support advanced XML manipulation via javascript so you can not use the advanced metadata editor. Please upgrade your browser for a better experience.</p>");
        } else {
            $("textarea#id_metadata_text").SAMLmetaJS({
                'showValidation': true,
                'showValidationLevel': {
                    'info': false,
                    'ok': false,
                    'warning': true,
                    'error': true
                }
            });
            $("form#text_edit_form").submit(
                function () {
                    $("a[href='#rawmetadata']").click();
                    return true;
                }
            );
        }
    });
})(jQuery);
</script>
<script type="text/javascript" src="{{ STATIC_URL }}js/terms-of-use.js"></script>
{% endblock %}
