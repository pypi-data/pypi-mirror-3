<metal:main use-macro="load: layout.pt">
  <metal:content metal:fill-slot="content">
    <h1>Email Authenticator</h1>

    <form class="form-horizontal" method="POST">
      <fieldset>
        <legend>Authenticate through your email...</legend>
        <tal:email tal:condition="python: not send_submitted and not validate_submitted">
          <div class="control-group" tal:define="error python: 'username' in eform.form.errors"
              tal:attributes="class python: error and 'error control-group' or 'control-group'">
            <label class="control-label" for="username">Email</label>
            <div class="controls">
              ${eform.text("username", size=30)}
              <span class="help-inline" tal:condition="error">
                ${eform.errorlist("username")}
              </span>
              <p class="help-block">
                Email you signed up with. Should be the same as the username.
              </p>
            </div>
          </div>
        </tal:email>
        <tal:code tal:condition="python: send_submitted or validate_submitted">
          ${cform.hidden("username", size=30)}
          <div class="control-group" tal:define="error python: 'code' in cform.form.errors"
              tal:attributes="class python: error and 'error control-group' or 'control-group'">
            <label class="control-label" for="code">Access Code</label>
            <div class="controls">
              ${cform.password("code", size=10)}
              <span class="help-inline" tal:condition="error">
                ${cform.errorlist("code")}
              </span>
              <p class="help-block">
                Provided in the email sent to you.
              </p>
            </div>
          </div>
        </tal:code>
        <div class="form-actions">
          <tal:email tal:condition="python: not send_submitted and not validate_submitted">
            <input type="submit" name="submit" class="btn btn-primary" value="Send mail" />
          </tal:email>
          <tal:code tal:condition="python: send_submitted or validate_submitted">
            <input type="submit" name="submit" name="submit" class="btn btn-primary" value="Authenticate" />
          </tal:code
        </div>
      </fieldset>
    </form>
  </metal:content>
</metal:main