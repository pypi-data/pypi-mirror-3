<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<div class="component-title-block"><div class="component-title">Tutoriel : créer votre première application web pour Google AppEngine</div></div>


<div class="para">Ce tutoriel va vous guider pas à pas a construire une apllication web
de gestion de Blog afin de vous faire découvrir les fonctionnalités de
<span class="emphasis">CubicWeb</span>.</div>
<div class="para">Nous supposons que vous avec déjà suivi le guide :ref:`installationGAE`.</div>
<div class="para">Unknown interpreted text role "ref".</div>
<div class="sect1-title">
<a name="creez-une-nouvelle-application"></a>1. Créez une nouvelle application</div>

<div class="para">Nous choisissons dans ce tutoriel de développer un blog comme un exemple
d'application web et nous allons expliciter toutes les étapes nécessaires
à sa réalisation.</div>
<div class="programlisting">
cubicweb-ctl newgapp blogdemo
</div>
<div class="para">
<span class="emphasis">newgapp</span> est la commande permettant de créer une instance <span class="emphasis">CubicWeb</span> pour
le datastore.</div>
<div class="para">Assurez-vous que votre variable d'environnement <span class="literal">PYTHONPATH</span> est correctement
initialisée (:ref:`installationGAE`)</div>
<div class="para">Unknown interpreted text role "ref".</div>

<div class="sect1-title">
<a name="definissez-un-schema"></a>2. Définissez un schéma</div>

<div class="para">Le modèle de données ou schéma est au coeur d'une application <span class="emphasis">CubicWeb</span>.
C'est là où vous allez devoir définir le type de contenu que votre application
devra gérer.</div>
<div class="para">Commençons par un schéma simple que nous améliorerons progressivemment.</div>
<div class="para">Une fois votre instance <span class="literal">blogdemo</span> crée, vous trouverez un fichier <span class="literal">schema.py</span>
contenant la définition des entités suivantes : <span class="literal">Blog</span> and <span class="literal">BlogEntry</span>.</div>
<div class="programlisting">
class Blog(EntityType):
    title = String(maxsize=50, required=True)
    description = String()

class BlogEntry(EntityType):
    title = String(maxsize=100, required=True)
    publish_date = Date(default='TODAY')
    text = String(fulltextindexed=True)
    category = String(vocabulary=('important','business'))
    entry_of = SubjectRelation('Blog', cardinality='?*')
</div>
<div class="para">Un <span class="literal">Blog</span> a un titre et une description. Le titre est une chaîne
de caractères requise par la classe parente EntityType and ne doit
pas excéder 50 caractères. La description est une chaîne de
caractères sans contraintes.</div>
<div class="para">Une <span class="literal">BlogEntry</span> a un titre, une date de publication et du texte
étant son contenu. Le titre est une chaîne de caractères qui ne
doit pas excéder 100 caractères. La date de publication est de type Date et a
pour valeur par défaut TODAY, ce qui signifie que lorsqu'une
<span class="literal">BlogEntry</span> sera créée, sa date de publication sera la date
courante a moins de modifier ce champ. Le texte est une chaîne de
caractères qui sera indexée en plein texte et sans contraintes.</div>
<div class="para">Une <span class="literal">BlogEntry</span> a aussi une relation nommée <span class="literal">entry_of</span> qui la
relie à un <span class="literal">Blog</span>. La cardinalité <span class="literal">?*</span> signifie que BlogEntry
peut faire partie de zero a un Blog (<span class="literal">?</span> signifie <span class="emphasis">zero ou un</span>) et
qu'un Blog peut avoir une infinité de BlogEntry (<span class="literal">*</span> signifie
<span class="emphasis">n'importe quel nombre incluant zero</span>).
Par soucis de complétude, nous rappellerons que <span class="literal">+</span> signifie
<span class="emphasis">un ou plus</span>.</div>

<div class="sect1-title">
<a name="lancez-l-application"></a>3. Lancez l'application</div>

<div class="para">Définir ce simple schéma est suffisant pour commencer. Assurez-vous
que vous avez suivi les étapes décrites dans la section installation
(en particulier visitez <a class="" href="http://localhost:8080/_load">http://localhost:8080/_load</a> en tant qu'administrateur
afin d'initialiser le datastore), puis lancez votre application avec la commande</div>
<div class="programlisting">
python dev_appserver.py BlogDemo
</div>
<div class="para">puis dirigez vous vers <a class="" href="http://localhost:8080/">http://localhost:8080/</a> (ou si c'est plus facile
vous pouvez utiliser la démo en ligne <a class="" href="http://lax.appspot.com/">http://lax.appspot.com/</a>).
[FIXME] -- changer la demo en ligne en quelque chose qui marche (!)</div>
<div class="image"><img src="./images/lax-book.00-login.en.png" alt="login screen"></div><div class="para">Après vous être authentifié, vous arrivez sur la page d'accueil de votre
application. Cette page liste les types d'entités accessibles dans votre
application, en l'occurrence : Blog et Articles. Si vous lisez <span class="literal">blog_plural</span>
et <span class="literal">blogentry_plural</span> cela signifie que l'internationalisation (i18n)
n'a pas encore fonctionné. Ignorez cela pour le moment.</div>
<div class="image"><img src="./images/lax-book.01-start.en.png" alt="home page"></div>
<div class="sect1-title">
<a name="creez-des-entites-systeme"></a>4. Créez des entités système</div>

<div class="para">Vous ne pourrez créer de nouveaux utilisateurs que dans le cas où vous
avez choisi de ne pas utiliser l'authentification Google.</div>
<div class="para">[WRITE ME : create users manages permissions etc]</div>

<div class="sect1-title">
<a name="creez-des-entites-applicatives"></a>5. Créez des entités applicatives</div>

<div class="sect2-title">
<a name="creez-un-blog"></a>5.1. Créez un Blog</div>

<div class="para">Créons à présent quelques entités. Cliquez sur <span class="emphasis">[+]</span> sur la
droite du lien Blog. Appelez cette nouvelle entité Blog <span class="literal">Tech-Blog</span>
et tapez pour la description <span class="literal">everything about technology</span>,
puis validez le formulaire d'édition en cliquant sur le bouton
<span class="literal">Validate</span>.</div>
<div class="image"><img src="./images/lax-book.02-create-blog.en.png" alt="from to create blog"></div><div class="para">En cliquant sur le logo situé dans le coin gauche de la fenêtre,
vous allez être redirigé vers la page d'accueil. Ensuite, si vous allez
sur le lien Blog, vous devriez voir la liste des entités Blog, en particulier
celui que vous venez juste de créer <span class="literal">Tech-Blog</span>.</div>
<div class="image"><img src="./images/lax-book.03-list-one-blog.en.png" alt="displaying a list of a single blog"></div><div class="para">Si vous cliquez sur <span class="literal">Tech-Blog</span> vous devriez obtenir une description
détaillée, ce qui dans notre cas, n'est rien de plus que le titre
et la phrase <span class="literal">everything about technology</span>
</div>
<div class="image"><img src="./images/lax-book.04-detail-one-blog.en.png" alt="displaying the detailed view of a blog"></div><div class="para">Maintenant retournons sur la page d'accueil et créons un nouveau
Blog <span class="literal">MyLife</span> et retournons sur la page d'accueil, puis suivons
le lien Blog et nous constatons qu'à présent deux blogs sont listés.</div>
<div class="image"><img src="./images/lax-book.05-list-two-blog.en.png" alt="displaying a list of two blogs"></div>
<div class="sect2-title">
<a name="creons-un-article"></a>5.2. Créons un article</div>

<div class="para">Revenons sur la page d'accueil et cliquons sur <span class="emphasis">[+]</span> à droite du lien
<span class="emphasis">articles</span>. Appellons cette nouvelle entité <span class="literal">Hello World</span> et introduisons
un peut de texte avant de <span class="literal">Valider</span>. Vous venez d'ajouter un article
sans avoir précisé à quel Blog il appartenait. Dans la colonne de gauche
se trouve une boite intitulé <span class="literal">actions</span>, cliquez sur le menu <span class="literal">modifier</span>.
Vous êtes de retour sur le formulaire d'édition de l'article que vous
venez de créer, à ceci près que ce formulaire a maintenant une nouvelle
section intitulée <span class="literal">ajouter relation</span>. Choisissez <span class="literal">entry_of</span> dans ce menu,
cela va faire apparaitre une deuxième menu déroulant dans lequel vous
allez pouvoir séléctionner le Blog <span class="literal">MyLife</span>.</div>
<div class="para">Vous auriez pu aussi, au moment où vous avez crée votre article, sélectionner
<span class="literal">appliquer</span> au lieu de <span class="literal">valider</span> et le menu <span class="literal">ajouter relation</span> serait apparu.</div>
<div class="image"><img src="./images/lax-book.06-add-relation-entryof.en.png" alt="editing a blog entry to add a relation to a blog"></div><div class="para">Validez vos modifications en cliquant sur <span class="literal">Valider</span>. L'entité article
qui est listée contient maintenant un lien vers le Blog auquel il
appartient, <span class="literal">MyLife</span>.</div>
<div class="image"><img src="./images/lax-book.07-detail-one-blogentry.en.png" alt="displaying the detailed view of a blogentry"></div><div class="para">Rappelez-vous que pour le moment, tout a été géré par la plate-forme
<span class="emphasis">CubicWeb</span> et que la seule chose qui a été fournie est le schéma de
données. D'ailleurs pour obtenir une vue graphique du schéma, exécutez
la commande <span class="literal">laxctl genschema blogdemo</span> et vous pourrez visualiser
votre schéma a l'URL suivante : <a class="" href="http://localhost:8080/schema">http://localhost:8080/schema</a>
</div>
<div class="image"><img src="./images/lax-book.08-schema.en.png" alt="graphical view of the schema (aka data-model)"></div>
<div class="sect2-title">
<a name="change-view-permission"></a>5.3. Change view permission</div>



<div class="sect1-title">
<a name="conclusion"></a>6. Conclusion</div>

<div class="sect2-title">
<a name="exercise"></a>6.1. Exercise</div>

<div class="para">Create new blog entries in <span class="literal">Tech-blog</span>.</div>

<div class="sect2-title">
<a name="what-we-learned"></a>6.2. What we learned</div>

<div class="para">Creating a simple schema was enough to set up a new application that
can store blogs and blog entries.</div>

<div class="sect2-title">
<a name="what-is-next"></a>6.3. What is next ?</div>

<div class="para">Although the application is fully functionnal, its look is very
basic. In the following section we will learn to create views to
customize how data is displayed.</div>



