<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.7: http://docutils.sourceforge.net/" />
<title>PollyReports -- A Database Report Generator</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 6253 2010-03-02 00:24:53Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: left }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="pollyreports-a-database-report-generator">
<h1 class="title">PollyReports -- A Database Report Generator</h1>

<p>PollyReports.py provides a set of classes for database report writing.  It
assumes that you are using Reportlab to do PDF generation, but can work with
any &quot;canvas-like&quot; object as desired.</p>
<p>PollyReports provides the following framework for report generation:</p>
<blockquote>
<p>A Report object has a data source bound to it at instantiation.  One or more
Band objects (at least, a detail Band) must be added to it, and then the
generate() method will be called to process the data source.  The data source
must be an iterator that produces objects that can be accessed via []
operations, meaning mainly dict, list, and tuple types, i.e. the most common
types of records returned by standard database modules.  The detail band is
generated() once for each row.</p>
<p>Band objects contain a list of Elements (generally at least one) which define
how data from the row should be printed.  An Element may print any normal data
item or label and may be subclassed to handle other things like images.
Generating a band in turn calls Element.generate() for each element, producing
a list of Renderers with the first item in the list being the overall height of
the band.  The height is used to decide if the band will fit on the current
page; if not, a new page will be created first.  When the page is finally ready
for the band, Renderer.render() will be called for each Renderer in the element
list in order to actually render the data.</p>
</blockquote>
<p>As noted above, PollyReports expects a Reportlab-like canvas interface.</p>
<p>The module has been kept as clean as possible, so that, though I don't actually
recommend it, it would not be insane to say</p>
<blockquote>
<tt class="docutils literal">from PollyReports import *</tt></blockquote>
<p>Importing only what you expect to use is still a better idea, of course.</p>
<div class="section" id="class-structure">
<h1>Class Structure</h1>
<p>In the descriptions below, only methods and properties intended to be &quot;public&quot;
will be described.  I have taken no particular steps to hide the non-public
methods, but I make no representation that I won't change them later.</p>
<p>Of course, I make no representation that I won't change the public interface
either; but it is reasonable to assume that I won't do that as often.</p>
<p>All measurements used in PollyReports are in terms of points, where one point
is equal to 1/72 inch.  In actuality, this is a feature of Reportlab (and of
PDF generation in general), not merely a feature of PollyReports.</p>
<p>Attributes are shown with their default values, if any.</p>
<div class="section" id="class-report">
<h2>class Report</h2>
<blockquote>
<p><tt class="docutils literal">rpt = Report(datasource)</tt></p>
<p><em>datasource</em> must be an iterable object which yields objects that
can be indexed with [].  A standard database cursor yielding
lists, tuples, or dicts is the expected case.  When Report.generate()
is called, this datasource will be consumed one row at a time.</p>
<p>If the datasource is empty, no output is generated.</p>
<p><strong>Methods</strong></p>
<p><tt class="docutils literal">rpt.generate(canvas)</tt></p>
<p>The generate method requires a single parameter, which must be a
Reportlab Canvas object or an object that presents a similar interface.
As it stands now, the following methods and attributes are the only
ones being used by PollyReports:</p>
<pre class="literal-block">
canvas.drawRightString()
canvas.drawString()
canvas.line()
canvas._pagesize
canvas.restoreState()
canvas.saveState()
canvas.setFont()
canvas.setLineWidth()
canvas.setStrokeGray()
canvas.showPage()
canvas.translate()
</pre>
<p><strong>Attributes</strong></p>
<p>This is where the main work of setting up a Report gets done.
In a future version, it's entirely possible I may add these things
to the initialization function of the Report object, but for now,
they are accessed by attribute only.</p>
<p><tt class="docutils literal">rpt.topmargin = 36</tt> defines the top margin of the report.</p>
<p><tt class="docutils literal">rpt.bottommargin = 36</tt> defines the bottom margin of the report.</p>
<p><tt class="docutils literal">rpt.detailband = None</tt> should be initialized to a Band object (see below)
which will be generated once per row in the data source.</p>
<p><tt class="docutils literal">rpt.pageheader = None</tt> is a Band object which is printed at the top
of each page. When the pageheader Band is generated, it receives the
row of data that will appear as the first on the page.</p>
<p><tt class="docutils literal">rpt.pagefooter = None</tt>
is a Band object which is printed at the bottom
of each page. When the pagefooter Band is generated, it receives the
row of data that will appear as the first on the page.</p>
<p><tt class="docutils literal">rpt.reportfooter = None</tt>
is a Band object which is printed at the very end of the report.
When the reportfooter Band is generated, it receives the
row of data that was last processed.</p>
<p><tt class="docutils literal">rpt.groupheaders = []</tt>
is a list of Band objects which are printed at the beginning of a new
group of records, as defined by the 'value' of the Band (see below for
more details).  Whenever the value changes, that header, and all higher-level
(i.e. earlier in the list) headers automatically print.
When a groupheader Band is generated, it receives the
row of data that will be the first in the new group.</p>
<p><tt class="docutils literal">rpt.groupfooters = []</tt>
is a list of Band objects which are printed at the end of a new
group of records, as defined by the 'value' of the Band (see below for
more details).  Whenever the value changes, that footer, and all lower-level
(i.e. later in the list) footers automatically print.
When a groupfooter Band is generated, it receives the
row of data that was last in the group.</p>
<p><tt class="docutils literal">rpt.pagenumber = 0</tt> is not generally changed by the caller; however,
as a Report attribute, it is accessible to an Element using the <tt class="docutils literal">sysvar</tt>
option, so it is documented here.  While Report.generate is running,
the pagenumber attribute contains the current page number.</p>
</blockquote>
</div>
<div class="section" id="class-band">
<h2>class Band</h2>
<blockquote>
<p><tt class="docutils literal">band = Band(elements, childbands, key, getvalue, newpagebefore = 0, newpageafter = 0)</tt></p>
<p><em>elements</em> is a list of Element (or Element-like) objects which define what data from
the row to print, and how to print it.  See Element, below, for details.</p>
<p><em>childbands</em> is a list of Band objects which will be appended below this Band when
it is generated.  Child bands float below their parent, so if the parent has an
Element which renders at different heights, the Elements in the child band(s) will
not overwrite it.</p>
<p><em>getvalue</em> is a function which accepts one parameter, the row, and returns an
item of data.  This permits calculations or modifications of the data before use.
If getvalue is not provided, key is used.
If neither key nor getvalue are provided, the value of the Band is None.</p>
<p><em>key</em> is the key used to access data within the row, i.e., the row will be
accessed as <tt class="docutils literal">row[key]</tt>.  key is only used if getvalue is not provided.</p>
<p><em>Note: Band values are used only in group headers and group footers, to determine
if the value has changed.</em></p>
<p><em>newpagebefore</em> and <em>newpageafter</em>, if true, indicate that a new page must
be started at the indicated time.
Neither apply to detail bands, page headers, or page footers, and newpageafter
also does not apply to the report footer.</p>
<p><strong>Methods</strong> and <strong>Attributes</strong></p>
<p>Bands have no public methods or attributes.</p>
</blockquote>
</div>
<div class="section" id="class-element">
<h2>class Element</h2>
<blockquote>
<p><tt class="docutils literal">element = Element(pos, font, text = None, key = None, getvalue = None,
sysvar = None, right = 0, format = str, leading = None, onrender = None)</tt></p>
<p><em>Note: An important feature of an Element is its value.  In general, the value
of an Element is relative to the current row, though this is not always so.
There are four methods an Element may employ to acquire a value, and they
are always applied in this order: getvalue, key, text, sysvar.  If more than
one of these methods is defined, the first in order is the only one which will
be applied.</em></p>
<p><em>pos</em> is a tuple of (x, y) defining the location relative to the top left
corner of the band where the Element will be rendered.</p>
<p><em>fonts</em> is a tuple of (fontname, fontsize) defining the font to be used
when rendering the Element.</p>
<p><em>getvalue</em> is a function which accepts one parameter, the row, and returns an
item of data.  This permits calculations or modifications of the data before use.
If getvalue is provided (and key is omitted, of course), it will be used; if it is
None, one of the lower-level access methods will be applied.</p>
<p><em>key</em> is the key used to access data within the row, i.e., the row will be
accessed as <tt class="docutils literal">row[key]</tt>.  If the key is provided, it will be used; if it is None,
one of the other access methods will be applied.</p>
<p><em>text</em> is a value to be used directly as the value of this Element, regardless
of the current row's content.</p>
<p><em>sysvar</em> is used to acquire a value from an attribute of the top-level Report
object.  It is usually used to access the current page number, i.e. <tt class="docutils literal">sysvar = &quot;pagenumber&quot;</tt>.</p>
<p><em>right</em>, if true, indicates that the Element should be rendered aligned to the right
rather than to the left.  The pos value will then indicate the upper-right corner
of the Element.</p>
<p><em>format</em> is a reference to a function or other callable (str by default) which
is applied to the Element's value before rendering.</p>
<p><em>leading</em> is the number of points to add to the &quot;official&quot; height of the Element
to accomodate line and Band spacing.  If not given, an internal calculation will be applied.</p>
<p><em>onrender</em> is a reference to a function that is called when the Element is
rendered.  It is actually passed to the Renderer (see below).  onrender is
called with a single parameter, a reference to the Renderer.  Assuming you
called that parameter “obj”, the Element which spawned the Renderer is
accessible as obj.parent, and the Report as obj.parent.report.</p>
<p><strong>Methods</strong></p>
<p>Elements have no public methods.</p>
<p><strong>Attributes</strong></p>
<p><tt class="docutils literal">element.report</tt> contains a reference to the top-level Report object.
This is initialized at the beginning of Report.generate().</p>
</blockquote>
</div>
<div class="section" id="class-sumelement">
<h2>class SumElement</h2>
<blockquote>
<p><tt class="docutils literal">sumelement = SumElement(pos, font, text = None, key = None, getvalue = None,
sysvar = None, right = 0, format = str, leading = None, onrender = None)</tt></p>
<p>SumElement is a subclass of Element which is used to calculate a sum (total)
of the value of the SumElement over a group of records.  SumElements are only
effective when included within group footers or the report footer.  In general,
a SumElement sums up its values continuously until the value is retrieved,
i.e. until the SumElement is rendered, at which point the running total is
reset to zero.</p>
<p>SumElements have the same parameters, methods, and attributes as regular
Elements; see above for details of these features.</p>
</blockquote>
</div>
<div class="section" id="class-renderer">
<h2>class Renderer</h2>
<blockquote>
Renderers are internal objects used by PollyReports to print out the values
of Elements.  As they are entirely internal, they will not be described in
any particular detail here; if you need to understand more fully how they
work, please consult the source code.</blockquote>
</div>
<div class="section" id="class-rule">
<h2>class Rule</h2>
<blockquote>
<p><tt class="docutils literal">rule = Rule(pos, width, thickness = 1)</tt></p>
<p>The Rule class is used to print out horizontal lines, such as separators.</p>
<p><em>pos</em> is a tuple defining the starting position of the Rule when rendered.</p>
<p><em>width</em> is the width (extending right from the position indicated by <em>pos</em>)
to which the Rule will extend.</p>
<p><em>thickness</em> defines the thickness of the Rule when rendered.</p>
<p><strong>Methods</strong> and <strong>Attributes</strong></p>
<p>Rules have no public methods or attributes.</p>
</blockquote>
</div>
</div>
</div>
</body>
</html>
