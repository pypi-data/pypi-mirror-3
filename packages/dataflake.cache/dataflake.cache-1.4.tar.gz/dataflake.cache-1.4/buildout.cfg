# This buildout is used for development of dataflake.cache.
# It gets the necessary eggs and creates a test runner and a python
# interpreter.

[buildout]
develop = .
parts = 
    test 
    coverage
    sphinx
    tox
    docbuilder
    pdfbuilder

[test]
recipe = zc.recipe.testrunner
defaults = ['-cv']
eggs = dataflake.cache

[coverage]
recipe = zc.recipe.testrunner
defaults = ['--coverage=parts/coverage']
eggs = dataflake.cache

[sphinx]
recipe = zc.recipe.egg
eggs =  
  dataflake.cache[docs]
dependent-scripts = true
scripts =
    sphinx-build
    rst2
interpreter = docpy

[tox]
recipe = zc.recipe.egg
eggs = tox

[docbuilder]
recipe = collective.recipe.template
input = inline:
    #!/bin/sh
    # Build the Sphinx documentation in one step
    export PATH="${buildout:bin-directory}:$PATH"
    cd "${buildout:directory}/docs"
    make clean
    make doctest html
output = ${buildout:bin-directory}/docbuilder.sh
mode = 755

[pdfbuilder]
recipe = collective.recipe.template
input = inline:
    #!/bin/sh
    # Build the Sphinx documentation as PDF in one step
    export PATH="${buildout:bin-directory}:$PATH"
    cd "${buildout:directory}/docs"
    make latex
    cd _build/latex
    make all-pdf
    cp dataflake.cache.pdf ../html/
output = ${buildout:bin-directory}/pdfbuilder.sh
mode = 755

