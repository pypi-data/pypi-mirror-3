<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bastionledger">
 
<body>
  <div metal:fill-slot="main" 
       tal:define="now python:DateTime();
                   definitions context/shareDefinitionValues;
                     utool context/@@plone_portal_state/portal_url;
                   voting context/votingClasses;
		   voters python: context.voters(now)">

      <h1><img src="" alt="" tal:define="icon python:context.getIcon(1)" 
               tal:attributes="src string:${utool}/${icon}">&nbsp;<span tal:replace="context/Title | context/getId"/> Share Definitions</h1>

      <a href=""
           class="link-parent"
           tal:define="parent_url python:context.navigationParent(context, template.getId())"
           tal:condition="parent_url"
           tal:attributes="href parent_url"
           i18n:translate="go_to_parent_url">Up one level</a>

     <fieldset>
        <legend>Share Issues</legend>

      <table summary="" width="100%" tal:condition="definitions">
         <tr class="row">
             <td class="field">&nbsp;</td>
             <td class="field"><label>Name</label></td>
             <td class="field"><label>Class</label></td>
             <td class="field"><label>Issued</label></td>
             <td class="field" align="right"><label>Face Value</label></td>
             <td class="field" align="right"><label>Allocated</label></td>
             <td class="field" align="right"><label>Allotted</label></td>
         </tr>
         <tr class="row" tal:repeat="defn definitions">
             <td class="field">
                 <img src="" alt="" tal:define="icon python:defn.getIcon(1)" 
                      tal:attributes="src string:${utool}/${icon}"/>
             </td>
             <td class="field">
                <a href="" tal:attributes="href defn/absolute_url"
                   tal:content="defn/title_or_id"/>
             </td>
             <td class="field" tal:content="defn/voting_class"/>
             <td class="field" tal:content="defn/issue_date"/>
             <td class="field" align="right" tal:content="defn/face"/>
             <td class="field" align="right" tal:content="defn/allocated"/>
             <td class="field" align="right" tal:content="python: defn.allotted(now)"/>
         </tr>
      </table>

      <p class="formHelp" tal:condition="not: definitions">No share classes have been
          defined.  You should consider adding some.</p>
      </fieldset>
    
      <fieldset>
           <legend>Voting classes</legend>

           <table tal:condition="python: voting and voters">
              <caption align="bottom" class="formHelp">* indicates a joint holding</caption>
              <tr>
                  <td><label>Class</label></td>
                  <td><label>Member</label></td>
                  <td align="right"><label>Votes</label></td>
              </tr>
              <tal:vclass tal:repeat="vclass voting">
                 <tal:voter tal:repeat="voter voters">
                    <tal:block tal:define="votes python: context.votesForVoter(vclass, voter)"
                               tal:condition="votes">
                       <tr>
                           <td><span tal:replace="vclass" tal:condition="repeat/vclass/first"/></td>
                           <td valign="top">
                              <a href="" 
                                 tal:attributes="href string:${utool}/authors/${voter}" 
                                 tal:content="voter"/>
                           </td>
                           <td valign="top" align="right" tal:content="votes"/>
                           <td><span class="formHelp" 
                                     tal:condition="python: context.isJointHolding(vclass, voter)">*</span></td>
                       </tr>
                    </tal:block>
                 </tal:voter>
              </tal:vclass>
           </table>

           <p class="formHelp" tal:condition="not: voting">There are no voting shares.  Edit
              the <i>Voting Class</i> field in your share definitions to use this feature.</p>

      </fieldset>

      <div tal:replace="structure provider:plone.documentactions">
           Document actions (print, sendto etc)
      </div>
  </div>
 
</body>
</html>
