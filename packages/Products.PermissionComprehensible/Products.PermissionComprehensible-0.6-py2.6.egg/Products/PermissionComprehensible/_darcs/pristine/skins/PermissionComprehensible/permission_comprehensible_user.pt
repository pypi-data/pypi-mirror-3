<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<metal:block fill-slot="top_slot"
             tal:define="dummy python:request.set('disable_border', 1)" />

<body>

<div metal:fill-slot="main">

    <h1 class="documentFirstHeading"
        i18n:translate="heading_permission_comprehensible">
        Comprehensible permissions, User View
    </h1>

    <p>A view of the roles the user <span tal:replace="request/user" /> has.</p>
    
    <h2>Local roles</h2>

    <p>Roles the user has been granted on this particular object.</p>
      <!-- Too much python logic in a TAL statement.  Baaad Morten.   BAAAD Morten! -->
      <ul>
      <li tal:repeat="role python:filter(None, [request['user'] in usernames and role for role, usernames in context.pc_get_local_roles().items()])">
	<a href="#" tal:attributes="href string:${context/absolute_url}/permission_comprehensible_role?role=${role}" tal:content="role">role</a></li>
      </ul>

    <h2>Roles in this context</h2>

    <p>All roles in this context, in this object and inherited from parent.</p>

    <ul>
      <li tal:repeat="role python:context.acl_users.getUserById(request['user']).getRolesInContext(context)"><a
	href="#" tal:attributes="href string:${context/absolute_url}/permission_comprehensible_role?role=${role}" tal:content="role">role</a></li>
    </ul>

    <h2>Global roles (site-wide)</h2>

    <p>Roles granted to the user in the entire site.</p>

    <ul>
      <li tal:repeat="role python:context.acl_users.getUserById(request['user']).getRoles()" tal:content="role"><a
	href="#" tal:attributes="href string:${context/absolute_url}/permission_comprehensible_role?role=${role}" tal:content="role">role</a></li>
    </ul>

  </div>

</body>

</html>
