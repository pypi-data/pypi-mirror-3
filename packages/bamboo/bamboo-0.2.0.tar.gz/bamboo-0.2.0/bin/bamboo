#!/usr/bin/env python
import eventlet
import argparse
import logging
import sys

import bamboo

log = bamboo.log.getChild('main')


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('configfile', type=file)
    parser.add_argument('--debug', action='store_true', dest='debug')
    parser.add_argument('--quiet', action='store_true', dest='quiet')
    args = parser.parse_args()

    if args.debug:
        bamboo.log.setLevel(logging.DEBUG)
    if args.quiet:
        bamboo.log.setLevel(logging.ERROR)

    config = bamboo.load_config(args.configfile)
    if config is None:
        return

    handlers = bamboo.start(config)
    log.info('All handlers configured and running')
    while True:
        eventlet.sleep(60)


if __name__ == '__main__':
    sys.exit(main())
