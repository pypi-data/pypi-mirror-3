<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4: http://docutils.sourceforge.net/" />
<title>Cities and cities.py</title>
<link rel="stylesheet" href="docutils.css" type="text/css" />
</head>
<body>
<div class="document" id="cities-and-cities-py">
<h1 class="title">Cities and cities.py</h1>
<p>A colleague pointed me to the <a class="reference" href="http://www.gnu.org/directory/miscfiles.html">GNU miscfiles</a> cities database after
I posted <a class="reference" href="geolocation_and_pathcross.html">geolocation and path cross</a>, suggesting that it would be
a useful database to support.  Being that it includes five hundred
places around the globe, and I already have the database installed,
I have to agree.</p>
<p>GNU miscfiles is a package of, well miscellaneous files.  It contains,
amongst other things a list of world currencies, languages and the file
we're looking at today <tt class="docutils literal"><span class="pre">cities.dat</span></tt>.</p>
<p>In v1.4.2, the version I have installed, <tt class="docutils literal"><span class="pre">cities.dat</span></tt> contains 497
entries.  The file is a simple flat Unicode database, with records
separated by <tt class="docutils literal"><span class="pre">//</span></tt>, a format that would be as well suited to processing
with <a class="reference" href="http://www.gnu.org/software/gawk/gawk.html">awk</a> as it would with <a class="reference" href="http://www.python.org/">Python</a>.</p>
<pre class="literal-block">
ID          : 12
Type        : City
Population  :
Size        :
Name        : Alblasserwaard
 Country    : NL
 Region     :
Location    : Earth
 Longitude  :    4.833
 Latitude   :   51.867
 Elevation  :
Date        : 19961206
Entered-By  : Rob.Hooft&#64;EMBL-Heidelberg.DE
//
ID          : 13
Type        : Pass
Population  :
Size        :
Name        : Albula Pass
 Country    :
 Region     :
Location    : Earth
 Longitude  :    9.833
 Latitude   :   46.583
 Elevation  :
Date        : 19961206
Entered-By  : Rob.Hooft&#64;EMBL-Heidelberg.DE
</pre>
<p>You don't need to hand process the data though, I've added <tt class="docutils literal"><span class="pre">cities.py</span></tt>
to the <tt class="docutils literal"><span class="pre">upoints</span></tt> tarball that takes care of importing the data.  When
you import the entries with <tt class="docutils literal"><span class="pre">cities.Cities()</span></tt> it returns a dictionary
of <tt class="docutils literal"><span class="pre">City</span></tt> objects that are children of the <tt class="docutils literal"><span class="pre">Trigpoint</span></tt> objects
defined for <a class="reference" href="trigpointing_and_point_py.html">Trigpointing and point.py</a></p>
<p>On my <a class="reference" href="http://www.gentoo.org/">Gentoo</a> desktop the cities database is installed as
<tt class="docutils literal"><span class="pre">/usr/share/misc/cities.dat</span></tt>, and can be imported as simply as:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">from</span> <span class="nn">upoints</span> <span class="k">import</span> <span class="n">cities</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Cities</span> <span class="o">=</span> <span class="n">cities</span><span class="o">.</span><span class="n">Cities</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&quot;/usr/share/misc/cities.dat&quot;</span><span class="p">))</span>
</pre></div>
<p>And the imported database can be used in a variety of ways:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%i</span><span class="s"> cities&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">Cities</span><span class="p">))</span>
<span class="go">497 cities</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&quot;Cities larger with more than 8 million people&quot;</span><span class="p">)</span>
<span class="go">Cities larger with more than 8 million people</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">city</span> <span class="ow">in</span> <span class="n">Cities</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">city</span><span class="o">.</span><span class="n">population</span> <span class="o">&gt;</span> <span class="mf">8000000</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">print</span><span class="p">(</span><span class="s">&quot;  </span><span class="si">%s</span><span class="s"> - </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">city</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">city</span><span class="o">.</span><span class="n">population</span><span class="p">))</span>
<span class="go">   Bombay - 8243405</span>
<span class="go">   Jakarta - 9200000</span>
<span class="go">   Moskwa - 8769000</span>
<span class="go">   Sao Paolo - 10063110</span>
<span class="go">   Tokyo - 8354615</span>
<span class="go">   Mexico - 8831079</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&quot;Mountains&quot;</span><span class="p">)</span>
<span class="go">Mountains</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">city</span> <span class="ow">in</span> <span class="n">Cities</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">city</span><span class="o">.</span><span class="n">ptype</span> <span class="o">==</span> <span class="s">&quot;Mountain&quot;</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">print</span><span class="p">(</span><span class="s">&quot;  </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">city</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="go">   Aconcagua</span>
<span class="go">   Popocatepetl</span>
</pre></div>
<p>You can recreate the database as a smoke test using the following:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;cities.dat&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">//</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Cities</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
<p>unfortunately the files aren't simply comparable using <tt class="docutils literal"><span class="pre">diff</span></tt> because
of some unusual formatting in the original file, but visually scanning
over the <tt class="docutils literal"><span class="pre">diff</span> <span class="pre">-w</span></tt> output shows that we have a correct export.</p>
<p>The <tt class="docutils literal"><span class="pre">City</span></tt> class inherits <tt class="docutils literal"><span class="pre">Trigpoint</span></tt> which in turn inherits
<tt class="docutils literal"><span class="pre">Point</span></tt>, and therefore has all the same methods they do.  This allows
you to calculate distances and bearings between the <tt class="docutils literal"><span class="pre">City</span></tt> objects or
any other derivative object of the parent classes.  For example, you
could use the <tt class="docutils literal"><span class="pre">dump_xearth_markers</span></tt> function from <tt class="docutils literal"><span class="pre">utils.py</span></tt>:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">from</span> <span class="nn">upoints.utils</span> <span class="k">import</span> <span class="n">dump_xearth_markers</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">scottish_cities</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">region</span> <span class="o">==</span> <span class="s">&quot;Scotland&quot;</span><span class="p">,</span> <span class="n">Cities</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">scottish_markers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">scottish_cities</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dump_xearth_markers</span><span class="p">(</span><span class="n">scottish_markers</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">)))</span>
<span class="go">57.150000 -2.083000 &quot;Aberdeen&quot; # 1</span>
<span class="go">55.950000 -3.183000 &quot;Edinburgh&quot; # 83</span>
<span class="go">55.867000 -4.267000 &quot;Glasgow&quot; # 92</span>
</pre></div>
<p>Take a look at the <a class="reference" href="http://epydoc.sourceforge.net/">epydoc</a> generated documentation that is included in
the tarball to see what can be done.</p>
<!-- :vim: set ft=rst ts=2 sw=2 et: -->
</div>
<div class="footer">
<hr class="footer" />
<a class="reference" href="python_cities.txt">View document source</a>.
Generated by <a class="reference" href="http://docutils.sourceforge.net/">Docutils</a> from <a class="reference" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> source.

</div>
</body>
</html>
