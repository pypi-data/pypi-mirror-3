[migrate_users]
parts =
    export_users
    copy_users
    import_users
    setup_plugins
done = 
    dump_memberdata
    copy_memberdata
    load_memberdata

[export_users]
<= obj_mems
recipe = collective.migrator:export_obj
instance = remote

[copy_users]
<= obj_mems
recipe = collective.migrator:copy_file
source = remote
target = local
source_dir = ${remote:export}
target_dir = ${local:import}

[import_users]
<= obj_mems
recipe = collective.migrator:import_obj
replace = 1
instance = local

[setup_plugins]
recipe = collective.migrator:ext_method
source = scripts/site_config.py
func = activate_pas_plugins
output = activate_pas_plugins.out
instance = local

[obj_mems]
obj = 
    acl_users/source_users
    acl_users/source_groups
    acl_users/portal_role_manager
    portal_memberdata
files =
    source_users.zexp
    source_groups.zexp
    portal_role_manager.zexp
    portal_memberdata.zexp

[dump_memberdata]
recipe = collective.migrator:ext_method
source = scripts/memberdata.py
func = dump_memberdata
output = memberdata.txt
instance = remote

[copy_memberdata]
recipe = collective.migrator:copy_file
files = memberdata.txt
source = remote

target = local
source_dir = ${buildout:directory}
target_dir = ${local:extensions}

[load_memberdata]
recipe = collective.migrator:ext_method
source = scripts/memberdata.py
func = load_memberdata
output = memberdata.out
instance = local

[get_user_list]
recipe = collective.migrator:ext_method
source = scripts/site_config.py
func = get_obj_list
output = memlist.new
instance = local
obj = Members

[migrate_btrees]
<= obj_mems
recipe = collective.migrator:ext_method
source = scripts/site_config.py
func = migrate_btrees
output = btrees.txt
instance = local
args = obj
loop = obj

