(function(f){f.cleditor.buttons.image={name:"image",title:"Add image",command:"insertimage",popupName:"image",stripIndex:f.cleditor.buttons.image.stripIndex,buttonClick:b,};function a(i){i.hidePopups();i.focus()}function c(i){i.find("li").live("mouseenter",function(){f(this).addClass("wysiwyg-files-hover");f(".wysiwyg-files-action").remove();f("<div/>",{"class":"wysiwyg-files-action wysiwyg-files-action-remove",title:"Delete"}).appendTo(this)}).live("mouseleave",function(){f(this).removeClass("wysiwyg-files-hover");f(".wysiwyg-files-action").remove()})}function h(i){f(".wysiwyg-files-action-remove").die("click");f(".wysiwyg-files-action-remove").live("click",function(l){f(".wysiwyg-files-file-preview").remove();f("#currimgs .wysiwyg-dialog-title").text("Delete image");l.preventDefault();var j=f(this).parent("li");var m='<div id="deldiv"><p>Are you sure you want to delete this file?</p><div class=""><input type="button" name="cancel" value="No" /><input type="button" name="remove" value="Yes" /></div></div>';var k=f(".wysiwyg-files-list");f(".wysiwyg-files-list").replaceWith(m);i.find("li.wysiwyg-files-png, li.wysiwyg-files-jpg, li.wysiwyg-files-jpeg, li.wysiwyg-files-gif, li.wysiwyg-files-ico, li.wysiwyg-files-bmp").die("mouseenter");f("#deldiv").find("input[name=remove]").click(function(){f(this).attr({disabled:true});f("#deldiv").find("input[name=cancel]").attr({disabled:true});var n=j.find("a").text();f.getJSON(fm_url,{action:"remove",file:n},function(o){if(o.success){alert(o.data)}else{alert(o.error)}f("#currimgs .wysiwyg-dialog-title").text("Insert image");f("#deldiv").replaceWith('<img src="'+media_url+'imgs/ajax-pager.gif" alt="Loading..." id="fileloading" />');e();f("#deldiv").find("input[name=cancel]").attr({disabled:false});f(this).attr({disabled:false})})});f("#deldiv").find("input[name=cancel]").bind("click",function(){f("#currimgs .wysiwyg-dialog-title").text("Insert image");f("#deldiv").replaceWith(k)})})}function g(i,j){i.find("li").find("a").die("click");i.find("li").find("a").live("click",function(l){f(".wysiwyg-files-wrapper").find("li").css("backgroundColor","#FFF");f(this).parent("li").css("backgroundColor","#BDF");var k=f.trim(f(this).attr("rel"));if(k!=""){j.editor.execCommand(j.command,k,null,j.button);f(".wysiwyg-dialog-modal-div").hide();a(j.editor)}})}function d(i){i.find("li.wysiwyg-files-png, li.wysiwyg-files-jpg, li.wysiwyg-files-jpeg, li.wysiwyg-files-gif, li.wysiwyg-files-ico, li.wysiwyg-files-bmp").live("mouseenter",function(){var j=f(this);f("<img/>",{"class":"wysiwyg-files-ajax wysiwyg-files-file-preview",src:j.find("a").attr("rel"),alt:j.text()}).appendTo("body");f("img.wysiwyg-files-file-preview").load(function(){f(this).removeClass("wysiwyg-files-ajax")})}).live("mousemove",function(j){f("img.wysiwyg-files-file-preview").css("left",j.pageX+15);f("img.wysiwyg-files-file-preview").css("top",j.pageY)}).live("mouseleave",function(){f("img.wysiwyg-files-file-preview").remove()})}function e(){f.getJSON(fm_url,{action:"list"},function(j){if(j.success){var k='<ul class="wysiwyg-files-list">';f.each(j.data.files,function(m,l){var n=m.replace(/^.*?\./,"").toLowerCase();k+='<li class="wysiwyg-files-file wysiwyg-files-'+n+'"><a href="#" rel="'+l+'">'+m+"</a></li>"});k+="</ul>";if(f.isEmptyObject(j.data.files)){k='<div id="fileloading">No files found</div>'}if(f("#fileloading").length){f("#fileloading").replaceWith(k)}else{f(".wysiwyg-files-list").replaceWith(k)}var i=f(".wysiwyg-dialog-content").find(".wysiwyg-files-wrapper");c(i);d(i);h(i)}else{alert(j.error)}})}function b(l,m){var k=m.editor;var i='<img src="'+media_url+'imgs/ajax-pager.gif" alt="Loading..." id="fileloading" />';if(!f("#fileloading").length){f(".wysiwyg-files-wrapper li").replaceWith(i)}if(f("div#fileloading").length){f("div#fileloading").replaceWith(i)}var j=f(".wysiwyg-dialog-content").find(".wysiwyg-files-wrapper");e();g(j,m);f("#currimgs").show();k.focus()}})(jQuery);